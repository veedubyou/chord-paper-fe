{"version":3,"sources":["assets/img/symphony.png","assets/img/error.jpeg","assets/img/google_signin.svg","components/lyrics/Tab.tsx","common/Whitespace.ts","common/ChordModel/Lyric.ts","common/ChordModel/ChordBlock.ts","common/ChordModel/Collection.ts","common/ChordModel/ChordLinePatcher.ts","common/ChordModel/ChordLine.ts","common/mapObject.ts","common/music/foundation/assert.ts","common/music/foundation/Distance.ts","common/music/foundation/Note.ts","common/music/foundation/Interval.ts","common/music/foundation/NoteIntervalConversion.ts","common/music/transpose/Transpose.ts","common/ChordModel/ChordSong.ts","common/paths.ts","components/about/About.tsx","components/edit/DragAndDrop.tsx","common/PlainFn.ts","components/GlobalKeyListener.tsx","common/music/scale/Scale.ts","components/guitar/FretSelector.tsx","common/music/guitar/Fretboard.ts","common/music/guitar/Scale.ts","components/guitar/ScaleChart.tsx","components/guitar/MenuSelectableScaleChart.tsx","components/guitar/ScaleSelection.tsx","components/guitar/GuitarDemo.tsx","components/edit/LineSelection.ts","common/backend/requests.ts","common/backend/errors.ts","components/display/ErrorImage.tsx","components/user/userContext.ts","components/LoadSongDialog.tsx","components/display/ErrorPage.tsx","components/tutorial/Common.tsx","components/WithSongContext.tsx","components/edit/BatchDelete.ts","components/edit/CopyAndPaste.ts","components/edit/InteractionContext.ts","components/edit/HighlightChordLyricStyle.ts","components/lyrics/Serialization.tsx","components/display/Lyric.tsx","components/display/ChordSymbol.tsx","components/edit/block-dnd/useChordDrop.ts","components/edit/block-dnd/common.ts","components/edit/block-dnd/ChordlessTokenDroppable.tsx","components/edit/block-dnd/ChordTokenDroppable.tsx","components/edit/block-dnd/DraggableChordSymbol.tsx","components/edit/block-dnd/useChordTokenDragState.ts","components/edit/ControlledTextInput.tsx","components/edit/TextInput.tsx","components/edit/Token.tsx","components/edit/Block.tsx","components/edit/WithHoverMenu.tsx","components/edit/lyric_input/SelectionUtils.ts","components/edit/lyric_input/useKeyHandler.ts","components/edit/lyric_input/usePasteHandler.ts","components/edit/lyric_input/useSelectionHandler.ts","components/edit/lyric_input/LyricInput.tsx","components/edit/WithLyricInput.tsx","components/display/SectionLabel.ts","components/edit/EditableTypography.tsx","components/PlayerTimeContext.tsx","components/track_player/common.tsx","components/edit/TimeInput.tsx","components/edit/WithSection.tsx","components/edit/Line.tsx","components/edit/NewLine.tsx","components/edit/Undo.ts","components/edit/ChordPaperBody.tsx","components/reducer/reducer.ts","components/tutorial/Playground.tsx","components/tutorial/AddChord.tsx","components/tutorial/AddLine.tsx","components/tutorial/ChordPositioning.tsx","components/tutorial/CopyAndPaste.tsx","components/tutorial/DragAndDropChord.tsx","components/tutorial/EditChord.tsx","components/tutorial/EditLyrics.tsx","components/tutorial/Instrumental.tsx","components/tutorial/MergeLine.tsx","components/tutorial/PasteLyrics.tsx","components/tutorial/RemoveChord.tsx","components/tutorial/RemoveLine.tsx","components/tutorial/Start.tsx","components/tutorial/Labels.tsx","components/tutorial/PlayMode.tsx","components/tutorial/SplitLine.tsx","components/tutorial/Saving.tsx","components/tutorial/RemoveMultipleLines.tsx","components/track_player/internal_player/BeginningIcon.tsx","components/track_player/internal_player/ForwardIcon.tsx","components/track_player/internal_player/ControlButton.tsx","components/track_player/internal_player/ControlGroup.tsx","components/track_player/internal_player/PlayrateControl.tsx","components/track_player/internal_player/SectionLabel.tsx","components/track_player/internal_player/TransposeControl.tsx","components/track_player/internal_player/ControlPane.tsx","components/track_player/internal_player/stem/StemTrackControlPane.tsx","components/tutorial/TrackPlayer.tsx","components/tutorial/TimeLabels.tsx","components/Tutorial.tsx","components/user/Login.tsx","components/SideMenu.tsx","components/SongFetcher.tsx","common/ChordModel/tracks/BaseTrack.ts","common/ChordModel/tracks/SingleTrack.ts","common/ChordModel/tracks/StemTrack.ts","components/track_player/dialog/error.ts","components/track_player/dialog/LabelField.tsx","components/track_player/internal_player/google_drive.ts","components/track_player/dialog/URLField.tsx","components/track_player/dialog/SingleTrackRow.tsx","components/track_player/dialog/StemTrackRow.tsx","components/track_player/dialog/SplitStemTrackRow.tsx","common/ChordModel/tracks/SplitStemRequest.ts","components/track_player/dialog/TrackListEditDialog.tsx","components/track_player/internal_player/usePlayerControls.ts","components/track_player/MicroPlayer.tsx","components/track_player/internal_player/reactPlayerProps.ts","components/track_player/internal_player/single/SingleTrackPlayer.tsx","components/track_player/internal_player/stem/audioCtx.ts","components/track_player/internal_player/stem/LoadedStemTrackPlayer.tsx","components/track_player/internal_player/stem/StemTrackPlayer.tsx","components/track_player/LoadingSplitStemTrackView.tsx","common/ChordModel/tracks/Track.ts","common/ChordModel/tracks/TrackList.ts","components/track_player/providers/useTracklistFetch.ts","components/track_player/WaitingSpinner.tsx","components/track_player/TrackPlayer.tsx","components/track_player/providers/useTrackFetch.ts","components/track_player/MultiTrackPlayer.tsx","components/track_player/JamStation.tsx","components/track_player/providers/TrackListProvider.tsx","components/display/LastSavedAt.tsx","components/edit/Header.tsx","components/edit/menu/load.ts","components/edit/menu/TransposeMenu.tsx","components/edit/menu/ChordPaperMenu.tsx","components/edit/menu/save.ts","components/edit/menu/cloudSave.tsx","components/edit/ChordPaper.tsx","components/play/keyMap.ts","components/play/PlayBlock.tsx","components/play/PlayLine.tsx","components/play/PlayContent.tsx","components/play/DisplaySettingsDialog.tsx","components/play/PlayMenu.tsx","components/play/Play.tsx","components/SongRouter.tsx","components/Version.tsx","App.tsx","components/useCloud.tsx","serviceWorker.ts","index.tsx"],"names":["module","exports","SizedTab","allTabTypes","sizedTab","SmallTab","serializedStr","MediumTab","LargeTab","findTabType","attrName","attr","tabType","find","undefined","Error","isValidTabValue","lyricTabTypeOfDOMNode","node","HTMLElement","tagName","toLowerCase","dataAttribute","dataset","sizeStyleFn","size","root","display","width","makeSizeStyle","makeStyles","makeSizeMap","makeEditingSizeStyle","style","backgroundColor","blueGrey","content","margin","makeEditingSizeMap","useEditingSizeMap","Tab","props","normalSizeMap","useSizeMap","editingSizeMap","sizeMap","edit","type","className","contentEditable","data-lyrictabtype","isWhitespace","s","test","inflateIfEmpty","value","LyricValidator","iots","serializedLyric","tokenizationRegex","regex","RegExp","Lyric","serializedLyrics","this","transformFn","matches","match","List","lyricsArr","map","rawStr","other","arr","joinChar","container","join","validatedFields","ChordBlockValidator","chord","lyric","DefaultRecord","id","RecordConstructor","Record","ChordBlock","params","record","isChordBlockRecord","shortid","generate","maybeNew","key","newRecord","set","new","updater","update","plainObject","toJS","lodash","omit","splitIndex","tokens","lyricTokens","prevBlockLyricTokens","slice","thisBlockLyricTokens","lyricString","get","prevBlockLyrics","thisBlockLyrics","isEqual","isEmpty","length","tokenize","isRecord","unionLyric","fromValidatedFields","jsonStr","result","parseJSON","isLeft","jsonObj","right","validationResult","decode","left","CollectionMethods","elements","getAtIndex","updateCollection","collection","replace","remove","removeMultiple","updateAll","addBeginning","addAfter","Collection","list","isList","of","toJSON","toArray","transformer","newList","indexOf","ids","index","withMutations","i","wrappedUpdater","idable","indexOfBefore","newElem","splice","idables","forEach","delete","removeCount","newItems","replacer","item","findIndex","elem","differ","dmp","DiffMatchPatch","diffTimeout","matchThreshold","rawStringGetter","lyrics","ChordLineIterator","chordLine","currBlockIndex","currCharIndex","blockBuffer","prependLyrics","chordBlocks","getElementAtIndex","currentBlock","currentRawLyrics","charAt","skipChar","currentChar","nextChar","insertChar","atBlockBoundary","prevBlockIndex","deleteChar","updateAllElements","block","normalizeBlocks","orphanTab","replaceChordLineLyrics","newLyrics","currRawLyrics","newRawLyrics","diffs","diff_main","diff_cleanupSemanticLossless","iterator","diff","diffOperation","diffChar","DiffOperation","DIFF_EQUAL","skip","DIFF_INSERT","insert","DIFF_DELETE","addTabsToOrphanedBlocks","newBlocks","push","removeOrphanedBlocksWithNoChords","finish","requiredFields","LabelSectionValidator","name","TimeSectionValidator","time","SectionValidator","optionalFields","label","section","ChordLineValidator","timeSectionSortFn","a","b","ChordLine","isChordLineRecord","blocks","newChord","replaceElement","newName","removeSectionName","newTime","removeSectionTime","splitByTokenIndex","newPrevBlock","newCurrBlock","nextLine","totalLyricLength","remainingChars","lyricLength","splitCharIndex","blockIndex","blocksOfCurrLine","transform","blocksOfNextLine","splitByCharIndex","firstHalfBlock","secondHalfBlock","remainingBlocks","hasLastBlock","lastIndex","append","blocksAreEqual","otherBlock","contentEquals","chordBlock","chordBlockElems","sectionFromLabel","mapObjectKey","source","mapObject","_value","dest","hasOwnProperty","oldValue","assertFound","checkWholeNumber","val","modulo","base","asSemitone","AllNotes","C","Cb","D","Db","E","Eb","F","Fb","G","Gb","A","Ab","B","Bb","AllNoteLetters","ChromaticNotes","getNoteLetter","note","letter","includes","NoteUtility","chromaticNoteIndex","noteLetter","noteLetterIndex","enharmonics","noteNameIndex","semitones","targetNoteIndex","otherNote","otherNoteIndex","semitonesBetween","degree","targetNoteLetterIndex","otherNoteName","otherNoteNameIndex","NoteUtilities","IntervalUtility","interval","naturalInterval","unqualifiedInterval","naturalIntervalToSemitone","isInterval","minor","augmented","doubleAugmented","tripleAugmented","diminished","doubleDiminished","unqualified","naturalIntervalToDegree","findNaturalIntervalByDegree","naturalIntervals","minorIntervals","b1","b2","b3","b4","b5","b6","b7","augmentedIntervals","doubleAugmentedIntervals","tripleAugmentedIntervals","diminishedIntervals","bb1","bb2","bb3","bb4","bb5","bb6","bb7","doubleDiminishedIntervals","bbb2","bbb3","bbb5","bbb6","bbb7","AllIntervals","checkIntervalType","intervalSet","alteredInterval","intervalToNote","rootNote","intervalProperties","noteProperties","enharmonicTargetNotes","semitonesUp","targetNoteName","noteNameFrom","targetNote","noteToInterval","rootNoteProperties","naturalSemitone","semitoneDifference","findInterval","degreesBetween","IntervalToNote","intervalsToNotesOfRootNote","NoteToInterval","notesToIntervalsOfRootNote","transposeSymbol","symbol","fromKey","toKey","matchingNotes","startsWith","matchingNote","transposedNote","transposeNote","transposeSong","song","transposeBlock","bass","baseChord","split","transposeChord","line","MetadataValidator","title","composedBy","performedBy","SongSummaryTypes","owner","lastSavedAt","DateFromISOString","metadata","SongSummaryValidator","ListSongSummaryValidator","SongSummary","fields","jsonList","songSummaryList","ChordSongValidator","ChordSong","isChordSongRecord","lines","chordLines","user","userID","currIndex","mergeLines","prevLine","currLine","appendLineToPrev","lastBlockIndex","updateElement","addSpaceToEndOfLine","newCurrLine","linesAreEqual","otherLine","blockID","timeSections","sort","newTitle","newPerformedBy","newComposedBy","chordLineValidatedFields","parse","JSON","stringify","fromJSONObject","lyricLines","lyricLine","fromLyrics","rootPath","aboutPath","guitarDemoPath","songPath","SongIDPath","mode","SongIDModePath","newSongPath","withNew","path","demoPath","URL","RootPaper","withStyles","theme","marginTop","spacing","padding","minHeight","minWidth","Paper","About","Grid","data-testid","xs","Typography","variant","href","HTML5BackendWithCTRLKey","backend","HTML5Backend","welpThingsBroke","console","error","untypesafeBackend","handleTopDragEnter","__original__handleTopDragEnter","e","altKeyPressed","ctrlKey","metaKey","altKey","handleTopDragOver","__original__handleTopDragOver","DragAndDrop","DndProvider","children","noopFn","GlobalKeyListenerContext","React","createContext","useRegisterKeyListener","useContext","useRegisterTopKeyListener","GlobalKeyListenerProvider","keyListeners","useRef","wrapListener","listener","event","target","isContentEditable","defaultPrevented","stopImmediatePropagation","Provider","wrappedListener","current","original","wrapped","window","addEventListener","entry","removeEventListener","removeAll","unshift","addAll","ScaleTypes","Lydian","importance","Ionian","Mixolydian","Dorian","Aeolian","Phrygian","Locrian","Dominant","buildScale","keyCenter","scaleName","scaleNotes","scaleInterval","center","notes","AllScales","buildScaleCollection","ScaleUtility","scale","FretSelector","TextField","InputLabelProps","shrink","startingFret","onChange","parseInt","onStartingFretChanged","AllStringNames","highE","FretboardClass","noteMap","buildString","baseNote","fretmap","noteUtility","maxFrets","nextNotes","endingFret","stringName","fretboardView","frets","fret","Fretboard","getLabelText","scaleNote","labelType","ChartBox","fontFamily","Box","stringNameMap","convertScaleViewToFingers","scaleView","fingers","stringNumber","fretLabels","fretLabel","fretNumber","labelColour","shape","Shape","SQUARE","CIRCLE","text","labelText","color","ScaleChart","elemRef","prevSVGuitarChord","useEffect","guitarScaleView","fretboardLabels","notePositions","getPositions","generateGuitarScaleView","svguitarChord","SVGuitarChord","barres","scaleLabel","configure","position","fretLabelPosition","FretLabelPosition","LEFT","draw","querySelectorAll","SVGTextElement","pos","x","baseVal","numberOfItems","y","getItem","getPos","setTimeout","setAttribute","refProps","ref","Tooltip","tooltip","background","boxShadow","shadows","UnstyledTooltip","MarginBox","MenuSelectableScaleChart","useState","setLabel","initialStartingFret","setStartingFret","menu","placement","interactive","AllScaleValues","allOptions","ScaleSelection","filterOptions","createFilterOptions","matchFrom","copiedScaleOptions","cloneDeep","Autocomplete","multiple","options","getOptionLabel","scaleValue","renderInput","scales","_event","newValue","onSelection","SwiperCore","use","Navigation","Pagination","RangePosition","UnstyledPaper","GuitarDemo","setScales","firstRowSwiperRef","secondRowSwiperRef","makeSlide","selectableScale","secondRow","overflow","firstRowSwiper","firstRowSlides","slidesPerView","navigation","loop","onSlideChange","swiper","secondRowSlideIndex","realIndex","slideToLoop","onSwiper","secondRowSwiper","secondRowSlides","initialSlide","backendHost","process","login","authToken","ky","post","headers","Authorization","json","parsed","getSong","songID","getTrackList","timeout","getSongsForUser","createSong","updateSong","isUnsaved","put","deleteSong","updateTrackList","tracklist","song_id","useErrorMessage","enqueueSnackbar","useSnackbar","showErrorMsg","msg","unknownError","showGenericErrorMsg","HTTPError","responseClone","response","clone","code","useErrorStyles","objectFit","ErrorImage","errorStyles","showError","src","ErrorImg","alt","User","googleUser","getAuthResponse","id_token","listen","refreshAuthToken","call","getNewAuthToken","UserContext","validateResponse","LoadSongDialog","state","fetchState","setFetchState","history","useHistory","wrapInDialog","contents","Dialog","open","onClose","fullWidth","DialogTitle","DialogContent","summaries","summarySortFn","loadSummaries","summariesResult","fromJSONList","summaryListItem","summary","songLink","withID","detailElement","detail","details","toLocaleString","Fragment","ListItem","button","onClick","ListItemText","primary","primaryTypographyProps","secondary","secondaryTypographyProps","Divider","LinearProgress","ErrorPage","LyricsTypography","palette","light","ChordTypography","main","LineBreak","OriginalComponent","normalizeNodeBoundary","offset","getPositionForNode","MIDDLE","offsetFromParent","findOffsetForNode","END","parentNode","nodeType","Node","TEXT_NODE","START","nodeValue","getPositionForTextNode","ELEMENT_NODE","childNodes","getPositionForElementNode","nodes","getSelectedLineIDs","selection","getSelection","rangeCount","range","wideRange","document","createRange","firstRange","getRangeAt","setStart","startContainer","startOffset","setEnd","endContainer","endOffset","rangeIndex","compareBoundaryPoints","Range","START_TO_START","END_TO_END","getWideSelectionBoundary","normalizeRange","lineElements","lineIDs","lineElementIndex","lineElement","intersectsNode","lineID","getAttribute","handleBatchLineDelete","songDispatch","lineIDStrs","CopiedChordLinesValidator","copiedChordLines","useLineCopyHandler","filter","copyMsg","serialized","payload","forCopying","serializeCopiedChordLines","clipboardData","setData","preventDefault","defaultSetter","startInteraction","endInteraction","InteractionContext","useEditingState","editing","setEditing","startEdit","finishEdit","highlightedSpaceStyle","highlightedWordStyle","outlineStyle","borderStyle","borderColor","borderRadius","borderWidth","withCustomLyricSelector","selector","customLyricClassSelector","withCustomChordSymbolSelector","customChordSymbolClassSelector","dragOverChordLyricStyle","highlightedSpace","highlightedWord","customOutlineStyles","outline","spaceClassSelector","wordClassSelector","chordSymbolSelector","hoverChordLyricStyle","chordTargetSelector","customChordTargetClassSelector","withCustomChordTargetSelector","deserializeLyrics","token","tokenIndex","deserializeLyricStr","serializeLyrics","childNode","textContent","lyricTypographyProps","lyricStyle","createStyles","whiteSpace","wordSpacing","LyricTypography","LyricDisplay","customClassName","clsx","isEntirelySpace","cursor","userSelect","ChordSymbol","endsWith","formattedChord","useChordDrop","useDrop","accept","drop","collect","monitor","isOver","shallow","ChordlessTokenDroppable","dropRef","childClassName","dragOverClassName","hoverableClassName","childrenWithClassName","cloneElement","RootRef","rootRef","ChordTokenDroppable","onDragOver","DraggableChordSymbol","sourceBlockID","useDrag","chordBlockID","end","maybeDropResult","dropResult","getDropResult","onDrop","destinationBlockID","dropType","dropEffect","dragRef","reducer","action","isDraggingOver","ControlledTextInput","useTheme","onFinish","browserInputProps","typographyVariant","typography","inputProps","paddingSpacing","fontSize","opacity","grey","classes","autoFocus","InputProps","inputRef","onBlur","onValueChange","onKeyDown","placeholder","TextInput","setValue","InvisibleTypography","top","ChordTargetBox","Token","lyricClassName","lyricBlock","invisibleTarget","ChordInput","borderBottom","borderBottomColor","borderBottomWidth","useFirstTokenStyle","dragOver","red","hoverable","dark","useNormalTokenStyle","Block","chordTokenStyle","chordlessTokenStyle","useReducer","dragOverState","dispatch","getValue","handlers","useCallback","useChordTokenDragState","gridClassName","onChordDragOver","onLyricDragOver","whitespaceLyric","clickHandler","onBlockSplit","stopPropagation","endEdit","onChordChange","makeChordlessToken","invisibleTargetOption","firstLyricToken","subsequentLyricTokens","firstLyricBlock","lyricBlocks","lyricToken","chordRow","direction","Button","contained","UnstyledButton","WithHoverMenu","hoverMenu","ButtonGroup","orientation","menuItems","menuItem","icon","contentEditableElement","contentEditableRef","selectionRange","contains","insertNodeAtSelection","deleteContents","insertNode","collapse","normalize","childIndex","parent","child","nodeBeforeSelection","targetNodeIndex","currNodeIndex","enterHandler","callback","specialBackspaceHandler","collapsed","firstChild","isSelectionAtBeginning","tabHandler","domLyricTab","shiftKey","domNode","backspaceHandler","parentElement","removeChild","directionKeyHandler","nodeIndex","childNodeIndex","childCount","textNode","nodeAfterSelection","setBaseAndExtent","useKeyDownHandler","sizeType","createElement","useDomLyricTab","specialEnterCallback","specialBackspaceCallback","enterCallback","handler","serializedLyricsFromRange","documentFragment","cloneContents","composeMultilinePaste","pasteContent","currentRange","beforeRange","afterRange","selectNodeContents","splitContentBySelection","beforeSelection","afterSelection","serializedLyricsForThisLine","remainingSerializedLyrics","lastLyric","handlePlainTextPaste","getData","linesOfText","flatMap","createTextNode","newPasteLines","isCollapsed","setStartAfter","setEndAfter","handleSelectionChange","InputTypography","useContentEditableStyle","pointerEvents","LyricInput","createRef","handleKeyDown","onSpecialBackspace","onSpecialEnter","handlePaste","pasteJSONCallback","pastePlainTextCallback","usePasteHandler","onJSONPaste","canHandle","executePaste","firstLine","restOfLines","onLyricOverflow","contentEditableStyle","lyricContent","focus","newRange","removeAllRanges","addRange","onPaste","suppressContentEditableWarning","UnstyledLyricInput","WithLyricInput","useMemo","lyricEdit","newLyric","lyricPasteOverflow","overflowContent","insertionLineID","overflowLyrics","jsonPaste","deserializedCopyResult","obj","deserializeCopiedChordLines","errorMsg","message","insertLineID","copiedLines","specialBackspace","latterLineID","specialEnter","bottom","sectionLabelStyle","PlaceholderTypography","EditableTypography","editingState","setEditingState","editControl","onStartEdit","onEndEdit","editableLine","typographyProps","nonEditableLine","PlayerTimeContext","PlayerTimeProvider","getPlayerTimeRef","roundedTopCornersStyle","borderTopLeftRadius","borderTopRightRadius","roundedCornersStyle","controlPaneStyle","alignItems","widthOfString","phattestString","font","canvasContext","getContext","measurement","measureText","greyTextColour","BottomRightBox","withBottomRightBox","TitleBar","justifyContent","textAlign","UnstyledControlledTextInput","TimeInput","secondsToString","seconds","Duration","fromMillis","toFormat","initialValue","inputBoxRef","decomposeTimeString","timeString","numericValue","Number","secondsPart","Math","floor","validateTimeValue","minutesPart","isNaN","minutes","buttonAdornment","InputAdornment","IconButton","edge","currentGetPlayerTime","playerTimeSeconds","formattedValue","colonIndex","substring","formatValue","sanitizedValue","replaceAll","sanitizeValue","startAdornment","disableUnderline","UnstyledEditableTypography","WithSection","handleLabelChange","handleTimeChange","childElement","timeInput","disableTooltipFocus","arrow","disableFocusListener","AtomicSelectionBox","BackspaceIcon","UnstyledBackspaceIcon","HighlightableBox","textOverflow","memo","removing","setRemoving","chordChange","blockSplit","startRemove","withHoverMenu","basicLine","lineContent","editLabel","withLyricInput","yeetDirection","Slide","in","onExited","data-lineid","HighlightableGrid","UnstyledDivider","AddCircleOutlineIcon","UnstyledAddCircleOutlineIcon","handleAddLine","justify","handleUndoRedo","isSpecialKey","useUninteractiveStyle","ChordPaperBody","interacting","setInteracting","handleCopy","addKeyListener","removeKeyListener","interactionContextValue","uninteractiveStyle","allowInteraction","firstNewLine","paperClassName","onCopy","elevation","tabIndex","ChordPaperStateConstructor","undoStack","currentSongIndex","getCurrentSong","currentSong","chordSongReducer","newSong","chordSongReducerWithoutUndo","blowAwayRedoStack","removeElement","splitLine","mergeLineWithPrevious","removeMultipleElements","replaceLyrics","newChordLines","newLyricLine","setChord","splitBlock","sourceLine","findLineWithBlock","destinationLine","sameLine","syncSameLines","newLine","setSectionTime","updateTime","setSectionName","updateName","transpose","originalKey","transposeKey","useChordSongReducer","initialSong","reducerWithChangeCallback","newState","initialState","CheckCircleIcon","success","UnstyledCheckCircleIcon","Badge","UnstyledBadge","Playground","setFinish","expectedSong","badgeContent","invisible","AddChord","AddLine","ChordPositioning","example","CopyAndPaste","variantMapping","body1","DragAndDropChord","EditChord","EditLyrics","Instrumental","tabExample","MergeLine","PasteLyrics","RemoveChord","RemoveLine","Header","Preamble","Starting","LabelTypography","Labels","PlayMode","SplitLine","Saving","RemoveMultipleLines","BeginningIcon","SvgIcon","d","ForwardIcon","PrimaryButton","SecondaryButton","makeControlButton","tooltipMsg","ColoredButton","preventKeyInvocation","onKeyUp","ControlButton","Play","Pause","JumpBack","JumpForward","SkipBack","SkipForward","Beginning","DecreasePlayrate","IncreasePlayrate","TransposeDown","TransposeUp","ControlGroupBox","alignContent","flexShrink","flexGrow","VerticalMiddleDivider","marginLeft","marginRight","marginBottom","ControlGroup","realContents","isEdge","dividers","edgeDivider","divider","flexItem","PlayrateBox","PercentageDisplay","PlayrateControl","playrate","round","playratePercentage","percentage","decreaseDisabled","increaseDisabled","disabled","SectionLabelBox","SectionLabel","TransposeBox","TransposeDisplay","TransposeControl","transposeLevel","transposeText","RightJustifiedControlGroup","ControlPaneBox","buttonHeight","flexWrap","maxHeight","ControlPane","addTopKeyListener","playPauseButton","playing","onTogglePlay","show","handleKey","onSkipBack","onJumpBack","onSkipForward","onJumpForward","transposeControl","level","onGoToBeginning","enabled","sectionLabel","FullSizedBox","paddingLeft","paddingRight","VolumeSlider","Slider","withColoredButtonStyle","height","textTransform","DisabledButton","ColouredButtons","white","pink","yellow","purple","lightBlue","lightGreen","StemTrackControlPane","buttons","stemControls","stemButton","RenderedButton","buttonColour","onEnabledChanged","volume","onVolumeChanged","min","max","step","valueLabelDisplay","SmallControlPaneBox","TrackPlayer","makeStemControl","TimeSetter","TimeLabels","allExercises","route","component","PlayArrowIcon","UnstyledPlayArrowIcon","Fab","UnstyledFab","Tutorial","matchEntry","exerciseEntry","exerciseIndex","nextButton","nextExercise","to","UnstyledTypography","useSigninStyles","Login","gapiLoaded","setGapiLoaded","signinStyles","userNotSignedIn","gapi","load","handleGoogleLogin","currentUser","idToken","loginResult","parsedUser","onUserChanged","auth2","init","client_id","scope","then","authClient","attachClickHandler","getElementById","failureReason","isSignedIn","SigninIcon","userDescription","withPointerStyle","MenuIcon","UnstyledMenuIcon","CloseIcon","UnstyledCloseIcon","Drawer","flexDirection","UnstyledDrawer","VerticalGridItem","maxWidth","TitleGrid","TitleName","CollapsedMenuSurface","FullHeightGrid","useFillerStyle","SideMenu","expanded","setExpanded","showLoadSongsDialog","setShowLoadSongsDialog","learnSubmenuOpen","setLearnSubMenuOpen","fillerStyle","learnClickHandler","linkStyle","textDecoration","collapsedMenu","anchor","expandedMenu","ListItemIcon","exerciseLinks","exerciseRoute","inset","Collapse","tutorialMenu","InternalFetcher","fetchSong","fetchResult","CircularProgress","thickness","SongFetcher","useParams","validateValue","trim","BaseTrackValidator","SingleTrackValidator","track_type","url","SingleTrack","makeStemTrackValidator","emptyKeyMap","trackType","stringTypes","stem_urls","StemTrack","stems_urls","TwoStemEmptyObject","accompaniment","vocals","TwoStemTrackValidator","TwoStemTrack","newLabel","FourStemEmptyObject","drums","FourStemTrackValidator","FourStemTrack","FiveStemEmptyObject","piano","FiveStemTrackValidator","FiveStemTrack","textFieldValidation","validValue","helperText","LabelField","googleDriveExportLinkRegex","googleDriveViewerLinkRegex","ensureGoogleDriveCacheBusted","randID","isGoogleDriveExportLink","URLField","results","convertViewLinkToExportLink","RowContainer","SingleTrackRow","track","updatedTrack","newURL","onRemove","StemTrackRow","stemURLFields","stemKey","fieldLabel","urlFieldLabels","rows","createSubsequentRows","SplitStemTrackRow","currentlyProcessing","urlLabelText","original_url","SplitStemTrackValidator","job_status","job_status_message","job_status_debug_log","job_progress","SplitStemTrack","splitType","originalURL","jobStatus","jobStatusMessage","jobProgress","jobStatusDebugLog","FlexBox","justifyItems","InlineBlockBox","UnstyledBox","AddNewRowBox","LoadedTrackListEditDialog","initialTrackList","trackList","tracks","setTrackList","version","setVersion","addTrackMenuElement","setAddTrackMenuElement","bumpVersion","cloneTrackList","handleAddTrackMenu","currentTarget","handleCloseAddTrackMenu","handleAddSingleTrack","handleAddTrack","handleAddTwoStemTrack","handleAddFourStemTrack","handleAddFiveStemTrack","handleAddSplitStemTrack","newTrackRequest","newTrack","appendTrack","removeTrack","hasError","validate","trackChangeHandler","updateTrack","trackListInputs","rowKey","showAddTrackMenu","anchorEl","MenuItem","body2","DialogActions","onSubmit","TrackListEditDialog","internalContent","trackListLoad","onRefresh","unfocusedControls","playerRef","_current","newCurrent","togglePlay","jumpBack","jumpForward","goToBeginning","skipBack","skipForward","currentTime","currentTimeFormatted","onProgress","onPlay","onPause","currentSectionLabel","getSection","usePlayerControls","setPlaying","setCurrentTime","setPlayratePercentage","currentTimeRef","getCurrentTime","seekTo","pauseAction","currentSectionIndex","currentSection","skipBackButton","previousSection","skipForwardButton","findNextSectionIndex","sectionIndex","nextSectionIndex","nextSectionToSkipTo","nextSection","nextNextSectionIndex","playedSeconds","PlayIcon","UnstyledPlayIcon","PauseIcon","UnstyledPauseIcon","ExpandButton","MicroPlayer","tempJumpIcon","setTempJumpIcon","playerControls","playersLoaded","tooltipMessage","makeBasePlayerProps","controls","playbackRate","progressInterval","filePlayerStyle","SingleTrackPlayer","trackURL","reactPlayerProps","basePlayerProps","config","file","forceAudio","attributes","makeReactPlayerProps","isCurrentTrack","focused","audioCtx","getAudioCtx","AudioContext","createToneNodes","stem","volumeNode","Tone","playerNode","audioBuffer","grainSize","overlap","chain","endNode","LoadedStemTrackPlayer","toneNodes","stems","initialPlayerState","masterVolumePercentage","masterPitchShift","muted","volumePercentage","playerState","setPlayerState","playerStateRef","silentURL","createBuffer","sampleRate","arrayBuffer","audioBufferToWav","blob","Blob","createObjectURL","createEmptySongURL","duration","filePlayerProps","onVolumeChange","makeFilePlayerProps","newPlayerState","refreshTrackFn","minDuration","maxDuration","buffer","start","pause","adjustedToneTime","abs","stemState","stemIndex","stemVolume","stemVolumeDecibels","log10","mute","_stemState","detune","currentTrack","toneNode","sync","toDestination","unsync","disconnect","dispose","stemControlPane","stemInput","newVolume","newPitchShift","PaddedBox","StemTrackPlayer","fetchStateRef","fetchAudioBuffer","handleProgress","onDownloadProgress","decodeAudioData","fetchAudioBufferWithProgress","progress","currentFetchState","newFetchState","loadedBytes","transferredBytes","totalBytes","loadPlayers","audioBufferPromises","bufferPromise","Promise","all","resolvedKeyBuffers","encounteredError","stemInputs","buttonSpecs","buttonSpec","audioBufferSearch","AudioBuffer","keyObject","total","stemTotal","loaded","formattedProgress","prettyBytes","progressBar","percent","LoadingSplitStemTrackView","TrackValidator","TrackListValidator","TrackList","useTracklistFetch","tracklistID","refresh","useDebouncedCallback","handleFetchedTracklist","fetchTrackList","updateTracklist","userAuthToken","updateResult","CenteredBox","WaitingSpinner","LoadedTrackPlayer","innerPlayer","trackID","tracklistLoad","useTrackFetch","trackLoad","TitleBarButton","usePaddingLeftStyle","Select","UnstyledSelect","FullPlayerContainer","transportControlsWidth","MultiTrackPlayer","paddingLeftStyle","onMinimize","trackListEditButton","onOpenTrackEditDialog","trackRefreshButton","onSelectCurrentTrack","trackListPicker","items","currentTrackIndex","titleBar","JamStation","playerVisibilityState","setPlayerVisibilityState","randomID","trackEditDialogState","setTrackEditDialogState","setLoadPlayers","setCurrentTrackIndex","trackListIsEmpty","collapsedButtonFn","expandFn","collapsedButtonClassName","openTrackEditDialog","closeTrackEditDialog","trackEditDialog","onTrackListChanged","showPlayer","minimizePlayer","fullPlayer","TrackListProvider","handleTrackListChanged","isOwner","LastSavedAt","Date","setLastRefreshed","setInterval","clearInterval","lastSaved","DateTime","fromJSDate","diffNow","as","DATE_MED","relativeDescription","toRelative","timeDescription","UnstyledLastSavedAt","paddingBottom","align","newComposer","newPerformer","paddingTop","useLoadMenuAction","onLoad","inputElem","filePickerHandler","fileList","files","fileReader","FileReader","onload","ev","ArrayBuffer","deserialize","readAsText","createFilePickerHandler","click","FormControl","UnstyledFormControl","TransposeMenu","transposedKey","keySelection","setKeySelection","keySelectChangeHandler","changedField","newSelectValue","newKeySelection","createKeySelect","currentKey","changeHandler","keyName","InputLabel","htmlFor","SpeedDial","UnstyledSpeedDial","ChordPaperMenu","setOpen","transposeMenuOpen","setTransposeMenuOpen","offlineMode","setOfflineMode","loadAction","loadedSong","saveAction","fork","objectURL","download","revokeObjectURL","cloudSaveAction","createNewSong","ownedSong","createResult","deserializeResult","log","deserializedSong","withMode","useCloudCreateSong","shouldShowDialog","setShouldShowDialog","closeDialog","deleteAction","deleteResult","deleteDialog","useCloudDeleteSongDialog","showDeleteDialog","useKonamiCode","onOpen","ariaLabel","SpeedDialAction","tooltipTitle","songClone","forkSong","useWhiteStyle","ChordPaper","whiteStyle","trackPlayer","scrollBackwardsKeys","scrollForwardKeys","PlayBlock","TopMarginBox","PlayLine","lineComponent","labelElement","PlayContent","numberOfEmptyColumns","setNumberOfEmptyColumns","numberOfColumnsPerPage","displaySettings","columnMargin","windowWidth","useWindowWidth","columnWidth","snapThreshold","scrollPage","forward","nextPos","scrollX","scrollDelta","scrollType","distanceFromLastColumn","scrollTo","behavior","scrollForward","scrollBackward","handleLeftClick","handleRightClick","ColumnedPaper","columnGap","columnRuleWidth","columnRuleStyle","columnRuleColor","columns","setScrollBarWidth","scrollbarWidth","documentElement","prevScrollbarWidthValue","FullHeightBox","pageBreakInside","emptyColumns","cols","isScrollBackwardsKey","isScrollForwardsKey","numberOfColumnsInLastPage","body","scrollWidth","nextNumberOfEmptyColumns","onMouseDown","onContextMenu","FormLabel","UnstyledFormLabel","RadioLabelTypography","DisplaySettingsDialog","numberOfColumns","defaultSettings","toString","settings","setSettings","validateNumber","strValue","convertedNumber","validateInt","convertedInteger","validatedSettings","numberOfColumnsResults","fontSizeResults","columnMarginResults","inputSpecs","field","adornment","validationErrorPropsFn","makeInput","spec","textFieldProps","defaultValue","newSettings","endAdornment","scrollTypeToggle","RadioGroup","FormControlLabel","control","UnstyledMoreVertIcon","PlayMenu","displaySettingsOpen","setDisplaySettingsOpen","onDisplaySettingsChange","FabProps","onMouseDownCapture","onExit","useTransparentStyle","setDisplaySettings","transparentStyle","onEdit","ThemeProvider","createMuiTheme","fontWeightRegular","transformToFC","editPath","playPath","exact","PaddedTypography","Version","contrastText","SnackbarProvider","variantSuccess","UnstyledSnackbarProvider","AppLayout","backgroundImage","Background","MainSong","SongRouter","dirtyRef","_song","shouldSave","handleError","save","saveIfChanged","isOnline","unloadMessageFn","returnValue","isEditMode","location","pathname","useCloud","onSongChange","useSave","unsavedPrompt","propsWithoutInitialSong","originalComponentProps","AppContent","wrapperFn","setUser","handleUserChanged","newUser","useLocation","loadSongPath","isFullScreen","isPlayMode","withRegularAppLayout","routes","from","App","titleTemplate","defaultTitle","GlobalKeyListener","Boolean","hostname","ReactDOM","render","StrictMode","navigator","serviceWorker","ready","registration","unregister","catch"],"mappings":"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","file":"static/js/main.44b1dbd9.chunk.js","sourcesContent":["module.exports = __webpack_public_path__ + \"static/media/symphony.4ca23f9c.png\";","module.exports = __webpack_public_path__ + \"static/media/error.c3a3f87e.jpeg\";","module.exports = __webpack_public_path__ + \"static/media/google_signin.c386978e.svg\";","import { makeStyles } from \"@material-ui/core\";\nimport React from \"react\";\nimport blueGrey from \"@material-ui/core/colors/blueGrey\";\n\n// for data attribute\nexport const dataSetTabName = \"lyrictabtype\";\nexport const dataAttributeTabName: \"data-lyrictabtype\" = \"data-lyrictabtype\";\n\nexport enum SizedTab {\n    SmallTab,\n    MediumTab,\n    LargeTab,\n}\n\nexport interface LyricTabType {\n    sizedTab: SizedTab;\n    serializedStr: \"\\ue100\" | \"\\ue200\" | \"\\ue400\";\n    [dataAttributeTabName]: \"1\" | \"2\" | \"4\";\n}\n\nexport const allTabTypes: LyricTabType[] = [\n    {\n        sizedTab: SizedTab.SmallTab,\n        serializedStr: \"\\ue100\",\n        [dataAttributeTabName]: \"1\",\n    },\n    {\n        sizedTab: SizedTab.MediumTab,\n        serializedStr: \"\\ue200\",\n        [dataAttributeTabName]: \"2\",\n    },\n    {\n        sizedTab: SizedTab.LargeTab,\n        serializedStr: \"\\ue400\",\n        [dataAttributeTabName]: \"4\",\n    },\n];\n\nexport const findTabType = <T extends keyof LyricTabType>(\n    attrName: T,\n    attr: LyricTabType[T]\n): LyricTabType => {\n    const tabType: LyricTabType | undefined = allTabTypes.find(\n        (tabType: LyricTabType) => tabType[attrName] === attr\n    );\n\n    if (tabType === undefined) {\n        throw new Error(`Unexpectedly can't find tab type by ${attrName}`);\n    }\n\n    return tabType;\n};\n\nexport const isValidTabValue = <T extends keyof LyricTabType>(\n    attrName: T,\n    attr: any\n): attr is LyricTabType[T] => {\n    const tabType: LyricTabType | undefined = allTabTypes.find(\n        (tabType: LyricTabType) => tabType[attrName] === attr\n    );\n\n    return tabType !== undefined;\n};\n\nexport const lyricTabTypeOfDOMNode = (node: Node): SizedTab | null => {\n    if (node instanceof HTMLElement && node.tagName.toLowerCase() === \"span\") {\n        const dataAttribute = node.dataset[dataSetTabName];\n\n        if (isValidTabValue(dataAttributeTabName, dataAttribute)) {\n            const tabType = findTabType(dataAttributeTabName, dataAttribute);\n            return tabType.sizedTab;\n        }\n    }\n\n    return null;\n};\n\nconst sizeBasis = 1.5;\n\nconst sizeStyleFn = (size: number) => {\n    return {\n        root: {\n            display: \"inline-block\",\n            width: `${sizeBasis * size}em`,\n        },\n    };\n};\n\nconst makeSizeStyle = (size: number) => {\n    return makeStyles(sizeStyleFn(size));\n};\n\nconst makeSizeMap = {\n    [SizedTab.SmallTab]: makeSizeStyle(1),\n    [SizedTab.MediumTab]: makeSizeStyle(2),\n    [SizedTab.LargeTab]: makeSizeStyle(4),\n};\n\nconst useSizeMap = () => {\n    // listing explicitly instead of using a loop to let\n    // typescript know the available keys\n    return {\n        [SizedTab.SmallTab]: makeSizeMap[SizedTab.SmallTab](),\n        [SizedTab.MediumTab]: makeSizeMap[SizedTab.MediumTab](),\n        [SizedTab.LargeTab]: makeSizeMap[SizedTab.LargeTab](),\n    };\n};\n\nconst makeEditingSizeStyle = (size: number) => {\n    const style = sizeStyleFn(size);\n\n    return makeStyles({\n        root: {\n            backgroundColor: blueGrey[100],\n            \"&:before\": {\n                content: '\"\\\\a0\"',\n            },\n            margin: \"0.05em\",\n            ...style.root,\n        },\n    });\n};\n\nconst makeEditingSizeMap = {\n    [SizedTab.SmallTab]: makeEditingSizeStyle(1),\n    [SizedTab.MediumTab]: makeEditingSizeStyle(2),\n    [SizedTab.LargeTab]: makeEditingSizeStyle(4),\n};\n\nconst useEditingSizeMap = () => {\n    // listing explicitly instead of using a loop to let\n    // typescript know the available keys\n    return {\n        [SizedTab.SmallTab]: makeEditingSizeMap[SizedTab.SmallTab](),\n        [SizedTab.MediumTab]: makeEditingSizeMap[SizedTab.MediumTab](),\n        [SizedTab.LargeTab]: makeEditingSizeMap[SizedTab.LargeTab](),\n    };\n};\n\nexport type DomLyricTabFn = (sizeType: SizedTab) => Node;\n\nexport const useDomLyricTab = (): DomLyricTabFn => {\n    const sizeMap = useEditingSizeMap();\n\n    return (sizeType: SizedTab): Node => {\n        const node = document.createElement(\"span\");\n        node.className = sizeMap[sizeType].root;\n        node.contentEditable = \"false\";\n\n        const tabType = findTabType(\"sizedTab\", sizeType);\n        node.dataset[dataSetTabName] = tabType[dataAttributeTabName];\n\n        return node;\n    };\n};\n\ninterface TabProps {\n    type: SizedTab;\n    edit: boolean;\n}\n\nconst Tab: React.FC<TabProps> = (props: TabProps): JSX.Element => {\n    const normalSizeMap = useSizeMap();\n    const editingSizeMap = useEditingSizeMap();\n\n    const sizeMap = props.edit ? editingSizeMap : normalSizeMap;\n    const tabType = findTabType(\"sizedTab\", props.type);\n\n    return (\n        <span\n            className={sizeMap[props.type].root}\n            contentEditable=\"false\"\n            data-lyrictabtype={tabType[dataAttributeTabName]}\n        ></span>\n    );\n};\n\nexport default Tab;\n","export const isWhitespace = (s: string): boolean => {\n    return /^\\s+$/.test(s);\n};\n\nexport const inflatingWhitespace = (): string => {\n    return \"\\u00A0\";\n};\n\nexport const inflateIfEmpty = (value: string) => {\n    if (isWhitespace(value)) {\n        return inflatingWhitespace();\n    }\n\n    return value;\n};\n","import { List } from \"immutable\";\nimport * as iots from \"io-ts\";\nimport { allTabTypes, isValidTabValue } from \"../../components/lyrics/Tab\";\nimport { isWhitespace } from \"../Whitespace\";\n\nexport const LyricValidator = iots.type({\n    serializedLyric: iots.string,\n});\n\nexport type LyricValidatedFields = iots.TypeOf<typeof LyricValidator>;\n\nconst tokenizationRegex: RegExp = ((): RegExp => {\n    let regex = \"\";\n    // add the regex for each special tab \"character\"\n    for (const tabType of allTabTypes) {\n        regex += `(${tabType.serializedStr})|`;\n    }\n\n    // match each word (with apostrophe inclusive for words like I'm)\n    // and all other non-words\n    regex += `(\\\\w|')+|[^w]`;\n    regex = `(${regex})`;\n\n    return new RegExp(regex, \"g\");\n})();\n\nexport class Lyric {\n    private readonly serializedLyric: string;\n\n    constructor(serializedLyrics: string) {\n        this.serializedLyric = serializedLyrics;\n    }\n\n    get<T>(transformFn: (serializedLyrics: string) => T): T {\n        return transformFn(this.serializedLyric);\n    }\n\n    tokenize(): List<Lyric> {\n        const matches = this.serializedLyric.match(tokenizationRegex);\n        if (matches === null) {\n            return List();\n        }\n\n        const lyricsArr = matches.map((rawStr: string) => new Lyric(rawStr));\n        return List(lyricsArr);\n    }\n\n    append(other: Lyric | string): Lyric {\n        if (typeof other === \"string\") {\n            return new Lyric(this.serializedLyric + other);\n        } else {\n            return new Lyric(this.serializedLyric + other.serializedLyric);\n        }\n    }\n\n    isEmpty(): boolean {\n        return this.serializedLyric === \"\";\n    }\n\n    isEntirelySpace(): boolean {\n        return (\n            isWhitespace(this.serializedLyric) ||\n            isValidTabValue(\"serializedStr\", this.serializedLyric)\n        );\n    }\n\n    isEqual(other: Lyric): boolean {\n        return this.serializedLyric === other.serializedLyric;\n    }\n\n    static join(arr: List<Lyric>, joinChar: string): Lyric {\n        const rawLyricStrs: List<string> = arr.map((container: Lyric) => {\n            return container.serializedLyric;\n        });\n\n        return new Lyric(rawLyricStrs.join(joinChar));\n    }\n\n    static fromValidatedFields(validatedFields: LyricValidatedFields): Lyric {\n        return new Lyric(validatedFields.serializedLyric);\n    }\n}\n","import { Either, isLeft, left, parseJSON, right } from \"fp-ts/lib/Either\";\nimport * as iots from \"io-ts\";\nimport lodash from \"lodash\";\nimport shortid from \"shortid\";\nimport { IDable } from \"./Collection\";\nimport { Lyric, LyricValidator } from \"./Lyric\";\nimport { List, Record } from \"immutable\";\n\ninterface ChordBlockConstructorParams {\n    chord: string;\n    lyric: Lyric;\n}\n\nexport const ChordBlockValidator = iots.type({\n    chord: iots.string,\n    lyric: LyricValidator,\n    type: iots.literal(\"ChordBlock\"),\n});\n\nexport type ChordBlockValidatedFields = iots.TypeOf<typeof ChordBlockValidator>;\n\ntype RecordType = {\n    id: string;\n    chord: string;\n    lyric: Lyric;\n    type: \"ChordBlock\";\n};\n\nconst DefaultRecord: RecordType = {\n    id: \"\",\n    chord: \"\",\n    lyric: new Lyric(\"\"),\n    type: \"ChordBlock\" as \"ChordBlock\",\n};\n\nconst RecordConstructor = Record(DefaultRecord);\ntype ChordBlockRecord = ReturnType<typeof RecordConstructor>;\n\nexport class ChordBlock implements IDable<ChordBlock> {\n    readonly record: ChordBlockRecord;\n\n    constructor(params: ChordBlockConstructorParams | ChordBlockRecord) {\n        if (ChordBlock.isChordBlockRecord(params)) {\n            this.record = params;\n            return;\n        }\n\n        let { chord, lyric } = params;\n\n        this.record = new RecordConstructor({\n            id: shortid.generate(),\n            chord: chord,\n            lyric: lyric,\n            type: \"ChordBlock\",\n        });\n    }\n\n    static isChordBlockRecord(\n        params: ChordBlockConstructorParams | ChordBlockRecord\n    ): params is ChordBlockRecord {\n        return Record.isRecord(params);\n    }\n\n    get id(): string {\n        return this.record.id;\n    }\n\n    get lyric(): Lyric {\n        return this.record.lyric;\n    }\n\n    get chord(): string {\n        return this.record.chord;\n    }\n\n    get type(): \"ChordBlock\" {\n        return this.record.type;\n    }\n\n    private new(maybeNew: ChordBlockRecord): ChordBlock {\n        if (maybeNew === this.record) {\n            return this;\n        }\n\n        return new ChordBlock(maybeNew);\n    }\n\n    set<K extends keyof RecordType>(key: K, value: RecordType[K]): ChordBlock {\n        const newRecord = this.record.set(key, value);\n        return this.new(newRecord);\n    }\n\n    update<K extends keyof RecordType>(\n        key: K,\n        updater: (value: RecordType[K]) => RecordType[K]\n    ): ChordBlock {\n        const newRecord = this.record.update(key, updater);\n        return this.new(newRecord);\n    }\n\n    toJSON(): object {\n        const plainObject = this.record.toJS();\n        return lodash.omit(plainObject, \"id\");\n    }\n\n    static fromValidatedFields(\n        validatedFields: ChordBlockValidatedFields\n    ): ChordBlock {\n        const unionLyric = validatedFields.lyric;\n        const serializedLyric = Lyric.fromValidatedFields(unionLyric);\n\n        return new ChordBlock({\n            chord: validatedFields.chord,\n            lyric: serializedLyric,\n        });\n    }\n\n    static deserialize(jsonStr: string): Either<Error, ChordBlock> {\n        const result: Either<Error, unknown> = parseJSON(\n            jsonStr,\n            () => new Error(\"Failed to parse json string\")\n        );\n\n        if (isLeft(result)) {\n            return result;\n        }\n\n        const jsonObj = result.right;\n        const validationResult = ChordBlockValidator.decode(jsonObj);\n\n        if (isLeft(validationResult)) {\n            return left(new Error(\"Invalid Chord Block object\"));\n        }\n\n        const unionLyric = validationResult.right.lyric;\n        const serializedLyric = Lyric.fromValidatedFields(unionLyric);\n\n        return right(\n            new ChordBlock({\n                chord: validationResult.right.chord,\n                lyric: serializedLyric,\n            })\n        );\n    }\n\n    get lyricTokens(): List<Lyric> {\n        return this.lyric.tokenize();\n    }\n\n    // splits a block, and returns the block before\n    // e.g.\n    // {id:\"A\", chord: \"B7\", lyric:\"my dear we're\"}\n    // splitBlock(4) =>\n    // {id:\"B\", chord: \"B7\", lyric:\"my dear \"}\n    // {id:\"A\", chord: \"\", \"we're\"}\n    splitByTokenIndex(splitIndex: number): [ChordBlock, ChordBlock] {\n        if (splitIndex === 0) {\n            throw new Error(\"Split index can't be zero\");\n        }\n\n        const tokens = this.lyricTokens;\n        const prevBlockLyricTokens = tokens.slice(0, splitIndex);\n        const thisBlockLyricTokens = tokens.slice(splitIndex);\n\n        const prevBlock: ChordBlock = new ChordBlock({\n            chord: this.chord,\n            lyric: Lyric.join(prevBlockLyricTokens, \"\"),\n        });\n\n        const newCurrBlock: ChordBlock = this.set(\"chord\", \"\").set(\n            \"lyric\",\n            Lyric.join(thisBlockLyricTokens, \"\")\n        );\n\n        return [prevBlock, newCurrBlock];\n    }\n\n    splitByCharIndex(splitIndex: number): [ChordBlock, ChordBlock] {\n        if (splitIndex === 0) {\n            return [new ChordBlock({ chord: \"\", lyric: new Lyric(\"\") }), this];\n        }\n\n        const lyricString: string = this.lyric.get((s: string) => s);\n        const prevBlockLyrics: Lyric = new Lyric(\n            lyricString.slice(0, splitIndex)\n        );\n        const thisBlockLyrics: Lyric = new Lyric(lyricString.slice(splitIndex));\n\n        const prevBlock: ChordBlock = new ChordBlock({\n            chord: this.chord,\n            lyric: prevBlockLyrics,\n        });\n\n        const newCurrBlock = this.set(\"chord\", \"\").set(\n            \"lyric\",\n            thisBlockLyrics\n        );\n\n        return [prevBlock, newCurrBlock];\n    }\n\n    contentEquals(other: ChordBlock): boolean {\n        return this.chord === other.chord && this.lyric.isEqual(other.lyric);\n    }\n\n    isEmpty(): boolean {\n        return this.chord === \"\" && this.lyric.isEmpty();\n    }\n\n    lyricLength(): number {\n        const lyricString = this.lyric.get((s: string) => s);\n        return lyricString.length;\n    }\n}\n","import { List } from \"immutable\";\n\n// use the name of the class the ID is describing for T\n// e.g. IDable<Person>\nexport interface IDable<T extends IDable<T>> {\n    readonly id: string;\n    readonly type: T[\"type\"];\n}\n\nexport abstract class CollectionMethods<\n    B extends CollectionMethods<B, T>,\n    T extends IDable<T>\n> {\n    protected abstract get elements(): Collection<T>;\n\n    abstract updateCollection(\n        updater: (collection: Collection<T>) => Collection<T>\n    ): B;\n\n    getElement(\n        ...params: Parameters<Collection<T>[\"get\"]>\n    ): ReturnType<Collection<T>[\"get\"]> {\n        return this.elements.get(...params);\n    }\n\n    getElementAtIndex(\n        ...params: Parameters<Collection<T>[\"getAtIndex\"]>\n    ): ReturnType<Collection<T>[\"getAtIndex\"]> {\n        return this.elements.getAtIndex(...params);\n    }\n\n    setElement(...params: Parameters<Collection<T>[\"set\"]>): B {\n        return this.updateCollection((collection) => collection.set(...params));\n    }\n\n    replaceElement(...params: Parameters<Collection<T>[\"replace\"]>): B {\n        return this.updateCollection((collection) =>\n            collection.replace(...params)\n        );\n    }\n\n    removeElement(...params: Parameters<Collection<T>[\"remove\"]>): B {\n        return this.updateCollection((collection) =>\n            collection.remove(...params)\n        );\n    }\n\n    removeMultipleElements(\n        ...params: Parameters<Collection<T>[\"removeMultiple\"]>\n    ): B {\n        return this.updateCollection((collection) =>\n            collection.removeMultiple(...params)\n        );\n    }\n\n    updateElement(...params: Parameters<Collection<T>[\"update\"]>): B {\n        return this.updateCollection((collection) =>\n            collection.update(...params)\n        );\n    }\n\n    updateAllElements(...params: Parameters<Collection<T>[\"updateAll\"]>): B {\n        return this.updateCollection((collection) =>\n            collection.updateAll(...params)\n        );\n    }\n\n    addBeginning(...params: Parameters<Collection<T>[\"addBeginning\"]>): B {\n        return this.updateCollection((collection) =>\n            collection.addBeginning(...params)\n        );\n    }\n\n    addAfter(...params: Parameters<Collection<T>[\"addAfter\"]>): B {\n        return this.updateCollection((collection) =>\n            collection.addAfter(...params)\n        );\n    }\n}\n\nexport class Collection<T extends IDable<T>> {\n    readonly list: List<T>;\n\n    constructor(elements?: T[] | List<T>) {\n        if (elements === undefined) {\n            this.list = List();\n            return;\n        }\n\n        if (List.isList(elements)) {\n            this.list = elements;\n        } else {\n            this.list = List.of(...elements);\n        }\n    }\n\n    toJSON(): object {\n        return this.list.toJSON();\n    }\n\n    private new(maybeNew: List<T>): Collection<T> {\n        if (maybeNew === this.list) {\n            return this;\n        }\n\n        return new Collection(maybeNew);\n    }\n\n    get length(): number {\n        return this.list.size;\n    }\n\n    toArray(): Array<T> {\n        return this.list.toArray();\n    }\n\n    transform(transformer: (list: List<T>) => List<T>): Collection<T> {\n        const newList = transformer(this.list);\n        return this.new(newList);\n    }\n\n    static indexOf<S extends IDable<S>>(list: List<S>, id: string): number {\n        const index = list.findIndex((elem: S) => elem.id === id);\n\n        if (index < 0) {\n            throw new Error(\"Can't find element inside collection\");\n        }\n\n        return index;\n    }\n\n    indexOf(id: string): number {\n        return Collection.indexOf(this.list, id);\n    }\n\n    multiIndexOf(ids: string[]): number[] {\n        return ids.map(this.indexOf);\n    }\n\n    set(...params: Parameters<List<T>[\"set\"]>): Collection<T> {\n        const newList = this.list.set(...params);\n        return this.new(newList);\n    }\n\n    update(index: number, updater: (value: T) => T): Collection<T> {\n        const wrappedUpdater = (value: T | undefined): T => {\n            if (value === undefined) {\n                throw new Error(\"Can't have undefined indices\");\n            }\n\n            return updater(value);\n        };\n\n        const newList = this.list.update(index, wrappedUpdater);\n        return this.new(newList);\n    }\n\n    updateAll(updater: (value: T, index: number) => T): Collection<T> {\n        const wrappedUpdater = (value: T | undefined, index: number): T => {\n            if (value === undefined) {\n                throw new Error(\"Can't have undefined indices\");\n            }\n\n            return updater(value, index);\n        };\n\n        const newList = this.list.withMutations((list) => {\n            for (let i = 0; i < list.size; i++) {\n                list.update(\n                    i,\n                    (value: T | undefined): T => wrappedUpdater(value, i)\n                );\n            }\n        });\n\n        return this.new(newList);\n    }\n\n    // adds a element after the specified id\n    addAfter(idable: IDable<T>, ...newElem: T[]): Collection<T> {\n        const indexOfBefore = this.indexOf(idable.id);\n        const newList = this.list.splice(indexOfBefore + 1, 0, ...newElem);\n        return this.new(newList);\n    }\n\n    addBeginning(...newElem: T[]): Collection<T> {\n        const newList = this.list.splice(0, 0, ...newElem);\n        return this.new(newList);\n    }\n\n    remove(idable: IDable<T>): Collection<T> {\n        const index = this.indexOf(idable.id);\n        const newList = this.list.splice(index, 1);\n        return this.new(newList);\n    }\n\n    removeMultiple(idables: IDable<T>[]): Collection<T> {\n        let list = this.list;\n\n        idables.forEach((idable: IDable<T>) => {\n            const index = Collection.indexOf(list, idable.id);\n            list = list.delete(index);\n        });\n\n        return this.new(list);\n    }\n\n    splice(\n        idable: IDable<T>,\n        removeCount: number,\n        ...newItems: T[]\n    ): Collection<T> {\n        const index = this.indexOf(idable.id);\n        const newList = this.list.splice(index, removeCount, ...newItems);\n        return this.new(newList);\n    }\n\n    replace(idable: IDable<T>, replacer: (item: T) => T): Collection<T> {\n        const index = this.indexOf(idable.id);\n        const updater = (item: T | undefined): T => {\n            if (item === undefined) {\n                throw new Error(\n                    \"Item can't be undefined because index is valid\"\n                );\n            }\n\n            return replacer(item);\n        };\n\n        const newList = this.list.update(index, updater);\n        return this.new(newList);\n    }\n\n    forEach(...params: Parameters<List<T>[\"forEach\"]>): void {\n        this.list.forEach(...params);\n    }\n\n    get(idable: IDable<T>): T {\n        const index = this.indexOf(idable.id);\n        const item = this.list.get(index);\n        if (item === undefined) {\n            throw new Error(\"Index found but item not in list\");\n        }\n\n        return item;\n    }\n\n    getAtIndex(index: number): T {\n        const item = this.list.get(index);\n        if (item === undefined) {\n            throw new Error(\"Item not in list\");\n        }\n\n        return item;\n    }\n}\n","import { DiffMatchPatch, DiffOperation } from \"diff-match-patch-typescript\";\nimport { findTabType, SizedTab } from \"../../components/lyrics/Tab\";\nimport { ChordBlock } from \"./ChordBlock\";\nimport { ChordLine } from \"./ChordLine\";\nimport { Collection } from \"./Collection\";\nimport { Lyric } from \"./Lyric\";\n\nconst differ: DiffMatchPatch = (() => {\n    const dmp = new DiffMatchPatch();\n    dmp.diffTimeout = 0;\n    dmp.matchThreshold = 0;\n    return dmp;\n})();\n\n// we know what we're doing here - the raw serialized string is to be compared\nconst rawStringGetter = (lyrics: string) => lyrics;\n\nclass ChordLineIterator {\n    private chordLine: ChordLine;\n    private currBlockIndex: number;\n    private currCharIndex: number;\n    private blockBuffer: string[];\n    private prependLyrics: string;\n\n    constructor(chordLine: ChordLine) {\n        this.chordLine = chordLine;\n\n        this.currBlockIndex = 0;\n        this.currCharIndex = 0;\n\n        this.blockBuffer = chordLine.chordBlocks.list.map(() => \"\").toArray();\n        this.prependLyrics = \"\";\n    }\n\n    private atBlockBoundary(): boolean {\n        return this.currCharIndex === 0;\n    }\n\n    private currentBlock(): ChordBlock {\n        return this.chordLine.getElementAtIndex(this.currBlockIndex);\n    }\n\n    private currentRawLyrics(): string {\n        return this.currentBlock().lyric.get(rawStringGetter);\n    }\n\n    private currentChar(): string {\n        return this.currentRawLyrics().charAt(this.currCharIndex);\n    }\n\n    private nextChar(): void {\n        this.currCharIndex += 1;\n\n        if (this.currCharIndex >= this.currentRawLyrics().length) {\n            this.currBlockIndex += 1;\n            this.currCharIndex = 0;\n        }\n    }\n\n    skip(skipChar: string): void {\n        if (this.currentChar() !== skipChar) {\n            throw new Error(\"Mismatched characters when skipping\");\n        }\n\n        this.blockBuffer[this.currBlockIndex] += skipChar;\n\n        this.nextChar();\n    }\n\n    insert(insertChar: string): void {\n        if (!this.atBlockBoundary()) {\n            this.blockBuffer[this.currBlockIndex] += insertChar;\n        } else {\n            // bias towards inserting at the end of the previous block if between two blocks\n            // since chords are aligned to the beginning of the block, we don't want to shift the lyrics\n            // inside a block unnecessarily\n            const prevBlockIndex = this.currBlockIndex - 1;\n            if (prevBlockIndex >= 0) {\n                this.blockBuffer[prevBlockIndex] += insertChar;\n            } else {\n                this.prependLyrics += insertChar;\n            }\n        }\n    }\n\n    delete(deleteChar: string): void {\n        if (this.currentChar() !== deleteChar) {\n            throw new Error(\"Mismatched characters when deleting\");\n        }\n\n        this.nextChar();\n    }\n\n    finish(): ChordLine {\n        this.chordLine = this.chordLine.updateAllElements((block, index) => {\n            const lyric = new Lyric(this.blockBuffer[index]);\n            return block.set(\"lyric\", lyric);\n        });\n\n        if (this.prependLyrics !== \"\") {\n            this.chordLine = this.chordLine.addBeginning(\n                new ChordBlock({\n                    chord: \"\",\n                    lyric: new Lyric(this.prependLyrics),\n                })\n            );\n        }\n\n        return this.chordLine.normalizeBlocks();\n    }\n}\n\nconst removeOrphanedBlocksWithNoChords = (chordLine: ChordLine): ChordLine => {\n    const newBlocks: ChordBlock[] = [];\n\n    for (const block of chordLine.chordBlocks.toArray()) {\n        if (!block.lyric.isEmpty() || block.chord !== \"\") {\n            newBlocks.push(block);\n        }\n    }\n\n    return chordLine.updateCollection(() => new Collection(newBlocks));\n};\n\nconst orphanTab: string = findTabType(\n    \"sizedTab\",\n    SizedTab.SmallTab\n).serializedStr;\n\nconst addTabsToOrphanedBlocks = (chordLine: ChordLine): ChordLine => {\n    const orphanTabBlockIfEmpty = (block: ChordBlock): ChordBlock => {\n        if (!block.lyric.isEmpty()) {\n            return block;\n        }\n\n        return block.set(\"lyric\", new Lyric(orphanTab));\n    };\n\n    return chordLine.updateAllElements(orphanTabBlockIfEmpty);\n};\n\nexport const replaceChordLineLyrics = (\n    chordLine: ChordLine,\n    newLyrics: Lyric\n): ChordLine => {\n    const currRawLyrics = chordLine.lyrics.get(rawStringGetter);\n    const newRawLyrics = newLyrics.get(rawStringGetter);\n\n    const diffs = differ.diff_main(currRawLyrics, newRawLyrics);\n    differ.diff_cleanupSemanticLossless(diffs);\n\n    const iterator = new ChordLineIterator(chordLine);\n\n    for (const diff of diffs) {\n        const diffOperation = diff[0];\n        for (const diffChar of diff[1]) {\n            switch (diffOperation) {\n                case DiffOperation.DIFF_EQUAL: {\n                    iterator.skip(diffChar);\n                    break;\n                }\n                case DiffOperation.DIFF_INSERT: {\n                    iterator.insert(diffChar);\n                    break;\n                }\n                case DiffOperation.DIFF_DELETE: {\n                    iterator.delete(diffChar);\n                    break;\n                }\n            }\n        }\n    }\n\n    chordLine = iterator.finish();\n\n    chordLine = removeOrphanedBlocksWithNoChords(chordLine);\n    chordLine = addTabsToOrphanedBlocks(chordLine);\n    return chordLine;\n};\n","import { Either, isLeft, left, parseJSON, right } from \"fp-ts/lib/Either\";\nimport * as iots from \"io-ts\";\nimport lodash from \"lodash\";\nimport shortid from \"shortid\";\nimport {\n    ChordBlock,\n    ChordBlockValidatedFields,\n    ChordBlockValidator,\n} from \"./ChordBlock\";\nimport { replaceChordLineLyrics } from \"./ChordLinePatcher\";\nimport { Collection, CollectionMethods, IDable } from \"./Collection\";\nimport { Lyric } from \"./Lyric\";\nimport { List, Record } from \"immutable\";\n\nconst requiredFields = iots.type({\n    elements: iots.array(ChordBlockValidator),\n    type: iots.literal(\"ChordLine\"),\n});\n\nconst LabelSectionValidator = iots.type({\n    type: iots.literal(\"label\"),\n    name: iots.string,\n});\n\nconst TimeSectionValidator = iots.type({\n    type: iots.literal(\"time\"),\n    name: iots.string,\n    time: iots.number,\n});\n\nconst SectionValidator = iots.union([\n    LabelSectionValidator,\n    TimeSectionValidator,\n]);\n\nconst optionalFields = iots.partial({\n    label: iots.string,\n    section: SectionValidator,\n});\n\nexport const ChordLineValidator = iots.intersection([\n    requiredFields,\n    optionalFields,\n]);\n\nexport type LabelSection = iots.TypeOf<typeof LabelSectionValidator>;\nexport type TimeSection = iots.TypeOf<typeof TimeSectionValidator>;\nexport type Section = iots.TypeOf<typeof SectionValidator>;\nexport type ChordLineValidatedFields = iots.TypeOf<typeof ChordLineValidator>;\n\nexport const timeSectionSortFn = (a: TimeSection, b: TimeSection): number => {\n    if (a.time < b.time) {\n        return -1;\n    }\n\n    if (a.time > b.time) {\n        return 1;\n    }\n\n    return 0;\n};\n\ntype RecordType = {\n    id: string;\n    section?: Section;\n    elements: Collection<ChordBlock>;\n    type: \"ChordLine\";\n};\n\nconst DefaultRecord: RecordType = {\n    id: \"\",\n    section: undefined,\n    elements: new Collection<ChordBlock>(),\n    type: \"ChordLine\",\n};\n\nconst RecordConstructor = Record(DefaultRecord);\ntype ChordLineRecord = ReturnType<typeof RecordConstructor>;\n\ntype ConstructorParams = {\n    blocks?: Collection<ChordBlock> | ChordBlock[];\n    section?: Section;\n};\n\nexport class ChordLine\n    extends CollectionMethods<ChordLine, ChordBlock>\n    implements IDable<ChordLine>\n{\n    readonly record: ChordLineRecord;\n\n    constructor(params: ConstructorParams | ChordLineRecord) {\n        super();\n\n        if (ChordLine.isChordLineRecord(params)) {\n            this.record = params as ChordLineRecord;\n            return;\n        }\n\n        let elements: Collection<ChordBlock>;\n\n        if (params.blocks === undefined) {\n            elements = new Collection([\n                new ChordBlock({ chord: \"\", lyric: new Lyric(\"\") }),\n            ]);\n        } else {\n            if (params.blocks instanceof Collection) {\n                elements = params.blocks;\n            } else {\n                elements = new Collection(params.blocks);\n            }\n        }\n\n        this.record = RecordConstructor({\n            id: shortid.generate(),\n            type: \"ChordLine\",\n            section: params.section,\n            elements: elements,\n        });\n    }\n\n    static isChordLineRecord(\n        params: ConstructorParams | ChordLineRecord\n    ): params is ChordLineRecord {\n        return Record.isRecord(params);\n    }\n\n    toJSON(): object {\n        const plainObject = this.record.toJSON();\n        return lodash.omit(plainObject, \"id\");\n    }\n\n    // for copying purposes, the section is usually not\n    // intended to be pasted elsewhere\n    forCopying(): ChordLine {\n        return this.set(\"section\", undefined);\n    }\n\n    private new(maybeNew: ChordLineRecord): ChordLine {\n        if (maybeNew === this.record) {\n            return this;\n        }\n\n        return new ChordLine(maybeNew);\n    }\n\n    get id(): string {\n        return this.record.id;\n    }\n\n    get type(): \"ChordLine\" {\n        return this.record.type;\n    }\n\n    get section(): Section | undefined {\n        return this.record.section;\n    }\n\n    protected get elements(): Collection<ChordBlock> {\n        return this.record.elements;\n    }\n\n    updateCollection(\n        updater: (collection: Collection<ChordBlock>) => Collection<ChordBlock>\n    ): ChordLine {\n        return this.update(\"elements\", updater);\n    }\n\n    set<K extends keyof RecordType>(key: K, value: RecordType[K]): ChordLine {\n        const newRecord = this.record.set(key, value);\n        return this.new(newRecord);\n    }\n\n    update<K extends keyof RecordType>(\n        key: K,\n        updater: (value: RecordType[K]) => RecordType[K]\n    ): ChordLine {\n        const newRecord = this.record.update(key, updater);\n        return this.new(newRecord);\n    }\n\n    static sectionFromLabel(label?: string): Section | undefined {\n        if (label === undefined) {\n            return undefined;\n        }\n\n        return {\n            type: \"label\",\n            name: label,\n        };\n    }\n\n    static fromValidatedFields(\n        validatedFields: ChordLineValidatedFields\n    ): ChordLine {\n        const chordBlockElems: ChordBlock[] = validatedFields.elements.map(\n            (value: ChordBlockValidatedFields) => {\n                return ChordBlock.fromValidatedFields(value);\n            }\n        );\n\n        let section: Section | undefined = validatedFields.section;\n        if (section === undefined) {\n            section = this.sectionFromLabel(validatedFields.label);\n        }\n\n        return new ChordLine({\n            blocks: new Collection(chordBlockElems),\n            section: section,\n        });\n    }\n\n    static deserialize(jsonStr: string): Either<Error, ChordLine> {\n        const result: Either<Error, unknown> = parseJSON(\n            jsonStr,\n            () => new Error(\"Failed to parse json string\")\n        );\n\n        if (isLeft(result)) {\n            return result;\n        }\n\n        const jsonObj = result.right;\n        const validationResult = ChordLineValidator.decode(jsonObj);\n\n        if (isLeft(validationResult)) {\n            return left(new Error(\"Invalid Chord Line object\"));\n        }\n\n        return right(this.fromValidatedFields(validationResult.right));\n    }\n\n    static fromLyrics(lyrics: Lyric): ChordLine {\n        const block = new ChordBlock({\n            chord: \"\",\n            lyric: lyrics,\n        });\n\n        return new ChordLine({\n            blocks: new Collection([block]),\n        });\n    }\n\n    get chordBlocks(): Collection<ChordBlock> {\n        return this.elements;\n    }\n\n    get lyrics(): Lyric {\n        const lyricTokens: List<Lyric> = this.chordBlocks.list.map(\n            (chordBlock: ChordBlock): Lyric => chordBlock.lyric\n        );\n\n        return Lyric.join(lyricTokens, \"\");\n    }\n\n    replaceLyrics(newLyrics: Lyric): ChordLine {\n        if (this.lyrics.isEqual(newLyrics)) {\n            return this;\n        }\n\n        return replaceChordLineLyrics(this, newLyrics);\n    }\n\n    setChord(idable: IDable<ChordBlock>, newChord: string): ChordLine {\n        const newChordLine = this.replaceElement(idable, (block) => {\n            return block.set(\"chord\", newChord);\n        });\n\n        return newChordLine.normalizeBlocks();\n    }\n\n    removeSectionName(): [ChordLine, boolean] {\n        if (this.section === undefined) {\n            return [this, false];\n        }\n\n        return [this.set(\"section\", undefined), true];\n    }\n\n    setSectionName(newName: string): [ChordLine, boolean] {\n        if (newName === \"\") {\n            return this.removeSectionName();\n        }\n\n        if (this.section === undefined) {\n            return [\n                this.set(\"section\", {\n                    type: \"label\",\n                    name: newName,\n                }),\n                true,\n            ];\n        }\n\n        const withUpdatedSection = this.update(\n            \"section\",\n            (section: Section | undefined): Section => {\n                if (section === undefined) {\n                    throw new Error(\"Impossible\");\n                }\n\n                return {\n                    ...section,\n                    name: newName,\n                };\n            }\n        );\n\n        return [withUpdatedSection, true];\n    }\n\n    removeSectionTime(): [ChordLine, boolean] {\n        if (this.section === undefined) {\n            return [this, false];\n        }\n\n        return [\n            this.set(\"section\", {\n                type: \"label\",\n                name: this.section.name,\n            }),\n            true,\n        ];\n    }\n\n    setSectionTime(newTime: number | null): [ChordLine, boolean] {\n        if (newTime === null) {\n            return this.removeSectionTime();\n        }\n\n        const name = this.section !== undefined ? this.section.name : \"\";\n\n        return [\n            this.set(\"section\", {\n                type: \"time\",\n                name: name,\n                time: newTime,\n            }),\n            true,\n        ];\n    }\n\n    splitBlock(idable: IDable<ChordBlock>, splitIndex: number): ChordLine {\n        const block = this.elements.get(idable);\n\n        const [newPrevBlock, newCurrBlock] =\n            block.splitByTokenIndex(splitIndex);\n\n        return this.updateCollection((elements) => {\n            return elements.splice(idable, 1, newPrevBlock, newCurrBlock);\n        });\n    }\n\n    splitByCharIndex(splitIndex: number): [ChordLine, ChordLine] {\n        const splitAtBeginning = splitIndex === 0;\n        if (splitAtBeginning) {\n            const nextLine = new ChordLine({\n                blocks: this.chordBlocks,\n            });\n\n            const newCurrLine = this.updateCollection(\n                () =>\n                    new Collection([\n                        new ChordBlock({ chord: \"\", lyric: new Lyric(\"\") }),\n                    ])\n            );\n\n            return [newCurrLine, nextLine];\n        }\n\n        const totalLyricLength = this.lyrics.get((s: string) => s).length;\n        const splitAtEnd = splitIndex >= totalLyricLength;\n        if (splitAtEnd) {\n            return [this, new ChordLine({})];\n        }\n\n        // split in the middle otherwise\n\n        const [splitCharIndex, blockIndex] = (() => {\n            let remainingChars = splitIndex;\n\n            for (let i = 0; i < this.elements.length; i++) {\n                const block = this.elements.getAtIndex(i);\n                const lyricLength = block.lyricLength();\n\n                if (remainingChars - lyricLength >= 0) {\n                    remainingChars -= lyricLength;\n                    continue;\n                }\n\n                return [remainingChars, i];\n            }\n\n            throw new Error(\n                \"Unexpected: shouldn't have walked this many characters\"\n            );\n        })();\n\n        let blocksOfCurrLine = this.elements.transform((list) =>\n            list.slice(0, blockIndex)\n        );\n        let blocksOfNextLine = new Collection<ChordBlock>();\n        if (splitCharIndex > 0) {\n            const block = this.elements.getAtIndex(blockIndex);\n\n            const [firstHalfBlock, secondHalfBlock] =\n                block.splitByCharIndex(splitCharIndex);\n\n            blocksOfCurrLine = blocksOfCurrLine.transform((list) =>\n                list.push(firstHalfBlock)\n            );\n            blocksOfNextLine = blocksOfNextLine.transform((list) =>\n                list.push(secondHalfBlock)\n            );\n\n            const remainingBlocks = this.elements.transform((list) =>\n                list.slice(blockIndex + 1)\n            );\n            blocksOfNextLine = blocksOfNextLine.transform((list) =>\n                list.push(...remainingBlocks.toArray())\n            );\n        } else {\n            blocksOfNextLine = this.elements.transform((list) =>\n                list.slice(blockIndex)\n            );\n        }\n\n        const newCurrLine = this.set(\"elements\", blocksOfCurrLine);\n        const nextLine = new ChordLine({ blocks: blocksOfNextLine });\n\n        return [newCurrLine, nextLine];\n    }\n\n    // passes through every block to ensure that blocks without chords exist (except for the first)\n    normalizeBlocks(): ChordLine {\n        const newBlocks: ChordBlock[] = [];\n\n        this.elements.forEach((block: ChordBlock) => {\n            const hasLastBlock = newBlocks.length > 0;\n            const shouldMergeWithLastBlock = block.chord === \"\" && hasLastBlock;\n\n            if (shouldMergeWithLastBlock) {\n                const lastIndex = newBlocks.length - 1;\n                newBlocks[lastIndex] = newBlocks[lastIndex].update(\n                    \"lyric\",\n                    (lyric: Lyric) => {\n                        return lyric.append(block.lyric);\n                    }\n                );\n            } else {\n                newBlocks.push(block);\n            }\n        });\n\n        // avoid rejiggering the data if it's a no-op\n        if (newBlocks.length === this.elements.length) {\n            return this;\n        }\n\n        return this.set(\"elements\", new Collection(newBlocks));\n    }\n\n    contentEquals(other: ChordLine): boolean {\n        if (this.chordBlocks.length !== other.chordBlocks.length) {\n            return false;\n        }\n\n        if (!lodash.isEqual(this.section, other.section)) {\n            return false;\n        }\n\n        let blocksAreEqual = true;\n        this.chordBlocks.forEach(\n            (block: ChordBlock, index: number): void | false => {\n                const otherBlock = other.chordBlocks.getAtIndex(index);\n                if (!block.contentEquals(otherBlock)) {\n                    blocksAreEqual = false;\n                    return false;\n                }\n            }\n        );\n\n        return blocksAreEqual;\n    }\n\n    isEmpty(): boolean {\n        if (this.chordBlocks.length > 1) {\n            return false;\n        }\n\n        if (this.chordBlocks.length === 0) {\n            return true;\n        }\n\n        return this.chordBlocks.getAtIndex(0).isEmpty();\n    }\n}\n","type ValueOf<T> = T[keyof T];\n\ntype Dest<T, U> = {\n    [P in keyof T]: U;\n};\n\nexport function mapObjectKey<T extends object, U>(\n    source: T,\n    transformFn: (key: keyof T) => U\n): {\n    [P in keyof T]: U; // ugly to inline this, but this allows the type hints in VS Code to be more explicit\n} {\n    return mapObject(\n        source,\n        (_value: ValueOf<T>, key: keyof T): U => transformFn(key)\n    );\n}\nexport function mapObject<T extends object, U>(\n    source: T,\n    transformFn: (value: ValueOf<T>, key: keyof T) => U\n): {\n    [P in keyof T]: U; // ugly to inline this, but this allows the type hints in VS Code to be more explicit\n} {\n    const dest = {} as Dest<T, U>;\n    for (const key in source) {\n        if (source.hasOwnProperty(key)) {\n            const oldValue = source[key];\n            dest[key] = transformFn(oldValue, key);\n        }\n    }\n    return dest;\n}\n","export const assertFound = (index: number) => {\n    if (index === -1) {\n        throw new Error(\"Thing that should be found is not found\");\n    }\n};\n","// all possible distances in semitones for any interval or any 2 notes (modulo 12)\nexport type Semitone = 0 | 1 | 2 | 3 | 4 | 5 | 6 | 7 | 8 | 9 | 10 | 11;\n\n// 0 indexed degrees\n// all possible distances in numbers for any interval\n// e.g. a 7th has a distance of 6 (7 - 1)\n// this also doubles as the note name difference\n// as a \"second\", e.g. C to D, necessarily implies that the lettering must change\nexport type Degree = 0 | 1 | 2 | 3 | 4 | 5 | 6;\n\nconst checkWholeNumber = (val: number) => {\n    if (val % 1 !== 0) {\n        throw new Error(\"input isn't a whole number!\");\n    }\n};\n\nconst modulo = (val: number, base: number): number => {\n    return ((val % base) + base) % base;\n};\n\nexport const asSemitone = (val: number): Semitone => {\n    checkWholeNumber(val);\n    return modulo(val, 12) as Semitone;\n};\n\nexport const asDegree = (val: number): Degree => {\n    checkWholeNumber(val);\n    return modulo(val, 7) as Degree;\n};\n","import { mapObjectKey } from \"../../mapObject\";\nimport { assertFound } from \"./assert\";\nimport { asDegree, asSemitone, Degree, Semitone } from \"./Distance\";\n\ntype NaturalNote = \"C\" | \"D\" | \"E\" | \"F\" | \"G\" | \"A\" | \"B\";\n\ntype FlatNote = `${NaturalNote}b`;\ntype SharpNote = `${NaturalNote}#`;\nexport type Note = NaturalNote | FlatNote | SharpNote;\nexport type NoteLetter = NaturalNote;\n\nexport const AllNotes: Record<Note, undefined> = {\n    C: undefined,\n    Cb: undefined,\n    \"C#\": undefined,\n    D: undefined,\n    Db: undefined,\n    \"D#\": undefined,\n    E: undefined,\n    Eb: undefined,\n    \"E#\": undefined,\n    F: undefined,\n    Fb: undefined,\n    \"F#\": undefined,\n    G: undefined,\n    Gb: undefined,\n    \"G#\": undefined,\n    A: undefined,\n    Ab: undefined,\n    \"A#\": undefined,\n    B: undefined,\n    Bb: undefined,\n    \"B#\": undefined,\n};\n\nexport const AllNoteLetters: NoteLetter[] = [\"C\", \"D\", \"E\", \"F\", \"G\", \"A\", \"B\"];\n\nexport const ChromaticNotes: Note[][] = [\n    [\"C\", \"B#\"],\n    [\"Db\", \"C#\"],\n    [\"D\"],\n    [\"Eb\", \"D#\"],\n    [\"E\", \"Fb\"],\n    [\"F\", \"E#\"],\n    [\"Gb\", \"F#\"],\n    [\"G\"],\n    [\"Ab\", \"G#\"],\n    [\"A\"],\n    [\"Bb\", \"A#\"],\n    [\"B\", \"Cb\"],\n];\n\nexport const getNoteLetter = (note: Note): NoteLetter => {\n    const letter = note.charAt(0) as NoteLetter;\n    if (!AllNoteLetters.includes(letter)) {\n        throw new Error(\"Note letter reduction function failed\");\n    }\n\n    return letter;\n};\n\nexport class NoteUtility {\n    private note: Note;\n    private chromaticNoteIndex: number;\n    private noteLetter: NoteLetter;\n    private noteLetterIndex: number;\n\n    constructor(note: Note) {\n        this.note = note;\n        const chromaticNoteIndex = ChromaticNotes.findIndex(\n            (enharmonics: Note[]) => enharmonics.includes(this.note)\n        );\n        assertFound(chromaticNoteIndex);\n        this.chromaticNoteIndex = chromaticNoteIndex;\n\n        this.noteLetter = getNoteLetter(note);\n\n        const noteNameIndex = AllNoteLetters.findIndex(\n            (elem: NoteLetter) => elem === this.noteLetter\n        );\n        assertFound(noteNameIndex);\n        this.noteLetterIndex = noteNameIndex;\n    }\n\n    // returns enharmonic notes from some semitones above\n    // e.g. 3 semitones from C is [D#, Eb]\n    semitonesUp(semitones: Semitone): Note[] {\n        const targetNoteIndex =\n            (this.chromaticNoteIndex + semitones) % ChromaticNotes.length;\n\n        return ChromaticNotes[targetNoteIndex];\n    }\n\n    // returns the amount of semitones between this note and the other\n    // e.g. between C and Fb is 4 semitones\n    semitonesBetween(otherNote: Note): Semitone {\n        const otherNoteIndex = ChromaticNotes.findIndex((enharmonics: Note[]) =>\n            enharmonics.includes(otherNote)\n        );\n        assertFound(otherNoteIndex);\n\n        return asSemitone(otherNoteIndex - this.chromaticNoteIndex);\n    }\n\n    // returns whether this note and the other note is enharmonic\n    // e.g. returns true for C# and Db, true for F and F, false for G and A\n    isEnharmonicTo(otherNote: Note): boolean {\n        return this.semitonesBetween(otherNote) === 0;\n    }\n\n    // returns the note name x many degrees above the current note name\n    // e.g. 2 degrees above Cb is E, 2 degrees above B is D, etc.\n    noteNameFrom(degree: Degree): NoteLetter {\n        const targetNoteLetterIndex =\n            (this.noteLetterIndex + degree) % AllNoteLetters.length;\n        return AllNoteLetters[targetNoteLetterIndex];\n    }\n\n    // returns the unqualified degree between notes\n    // e.g. between C and D is a second\n    // but between Cb and D# is also a second\n    degreesBetween(otherNote: Note): Degree {\n        const otherNoteName = getNoteLetter(otherNote);\n        const otherNoteNameIndex = AllNoteLetters.findIndex(\n            (elem: NoteLetter) => elem === otherNoteName\n        );\n        assertFound(otherNoteNameIndex);\n\n        return asDegree(otherNoteNameIndex - this.noteLetterIndex);\n    }\n}\n\nexport const NoteUtilities: Record<Note, NoteUtility> = mapObjectKey(\n    AllNotes,\n    (note: Note) => new NoteUtility(note)\n);\n","import { mapObjectKey } from \"../../mapObject\";\nimport { asSemitone, Degree, Semitone } from \"./Distance\";\n\ntype NaturalInterval = \"1\" | \"2\" | \"3\" | \"4\" | \"5\" | \"6\" | \"7\";\n// a bit of a difference in nomenclature here\n// in traditional music theory\n// minor 2 is 2 with semitone down, and dim 2 is 2 with 2 semitones down\n// minor 1 doesn't exist, but dim 1 is 1 with half step down\n// we're going go treat perfect intervals like 1, 4, 5 like they could be 'minor'ed\n// and diminished is 2 semitones down\ntype MinorInterval = `b${NaturalInterval}`;\ntype AugmentedInterval = `#${NaturalInterval}`;\ntype DoubleAugmentedInterval = `##${NaturalInterval}`;\ntype TripleAugmentedInterval = `###${\"4\"}`;\ntype DiminishedInterval = `bb${NaturalInterval}`;\ntype DoubleDiminishedInterval = `bbb${Exclude<NaturalInterval, \"1\" | \"4\">}`;\n\nexport type Interval =\n    | NaturalInterval\n    | MinorInterval\n    | AugmentedInterval\n    | DoubleAugmentedInterval\n    | TripleAugmentedInterval\n    | DiminishedInterval\n    | DoubleDiminishedInterval;\n\nexport class IntervalUtility {\n    interval: Interval;\n\n    constructor(interval: Interval) {\n        this.interval = interval;\n    }\n\n    get semitones(): Semitone {\n        const naturalInterval = unqualifiedInterval(this.interval);\n        let semitones = naturalIntervalToSemitone[naturalInterval];\n\n        if (isInterval.minor(this.interval)) {\n            semitones -= 1;\n        } else if (isInterval.augmented(this.interval)) {\n            semitones += 1;\n        } else if (isInterval.doubleAugmented(this.interval)) {\n            semitones += 2;\n        } else if (isInterval.tripleAugmented(this.interval)) {\n            semitones += 3;\n        } else if (isInterval.diminished(this.interval)) {\n            semitones -= 2;\n        } else if (isInterval.doubleDiminished(this.interval)) {\n            semitones -= 3;\n        }\n\n        return asSemitone(semitones);\n    }\n\n    get degree(): Degree {\n        const unqualified = unqualifiedInterval(this.interval);\n        return naturalIntervalToDegree[unqualified];\n    }\n}\n\nexport const findInterval = (semitones: Semitone, degree: Degree): Interval => {\n    const naturalInterval = findNaturalIntervalByDegree(degree);\n    const naturalSemitone = naturalIntervalToSemitone[naturalInterval];\n    const semitoneDifference = asSemitone(semitones - naturalSemitone);\n\n    if (semitoneDifference === asSemitone(0)) {\n        return naturalInterval;\n    }\n\n    if (semitoneDifference === asSemitone(1)) {\n        return `#${naturalInterval}`;\n    }\n\n    if (semitoneDifference === asSemitone(2)) {\n        return `##${naturalInterval}`;\n    }\n\n    if (naturalInterval === \"4\" && semitoneDifference === asSemitone(3)) {\n        return `###${naturalInterval}`;\n    }\n\n    if (semitoneDifference === asSemitone(-1)) {\n        return `b${naturalInterval}`;\n    }\n\n    if (semitoneDifference === asSemitone(-2)) {\n        return `bb${naturalInterval}`;\n    }\n\n    if (\n        (naturalInterval === \"2\" ||\n            naturalInterval === \"3\" ||\n            naturalInterval === \"5\" ||\n            naturalInterval === \"6\" ||\n            naturalInterval === \"7\") &&\n        semitoneDifference === asSemitone(-3)\n    ) {\n        return `bbb${naturalInterval}`;\n    }\n\n    throw new Error(\"No matching interval for semitone and number distance\");\n};\n\nconst naturalIntervalToSemitone: Record<NaturalInterval, Semitone> = {\n    \"1\": 0,\n    \"2\": 2,\n    \"3\": 4,\n    \"4\": 5,\n    \"5\": 7,\n    \"6\": 9,\n    \"7\": 11,\n};\n\nconst findNaturalIntervalByDegree = (degree: Degree): NaturalInterval => {\n    let naturalInterval: NaturalInterval;\n    for (naturalInterval in naturalIntervalToDegree) {\n        if (naturalIntervalToDegree[naturalInterval] === degree) {\n            return naturalInterval;\n        }\n    }\n\n    throw new Error(\"Invalid number distance passed in\");\n};\n\nconst naturalIntervalToDegree: Record<NaturalInterval, Degree> = {\n    \"1\": 0,\n    \"2\": 1,\n    \"3\": 2,\n    \"4\": 3,\n    \"5\": 4,\n    \"6\": 5,\n    \"7\": 6,\n};\n\nconst naturalIntervals: Record<NaturalInterval, undefined> = {\n    \"1\": undefined,\n    \"2\": undefined,\n    \"3\": undefined,\n    \"4\": undefined,\n    \"5\": undefined,\n    \"6\": undefined,\n    \"7\": undefined,\n};\n\nconst minorIntervals: Record<MinorInterval, undefined> = {\n    b1: undefined,\n    b2: undefined,\n    b3: undefined,\n    b4: undefined,\n    b5: undefined,\n    b6: undefined,\n    b7: undefined,\n};\n\nconst augmentedIntervals: Record<AugmentedInterval, undefined> = {\n    \"#1\": undefined,\n    \"#2\": undefined,\n    \"#3\": undefined,\n    \"#4\": undefined,\n    \"#5\": undefined,\n    \"#6\": undefined,\n    \"#7\": undefined,\n};\n\nconst doubleAugmentedIntervals: Record<DoubleAugmentedInterval, undefined> = {\n    \"##1\": undefined,\n    \"##2\": undefined,\n    \"##3\": undefined,\n    \"##4\": undefined,\n    \"##5\": undefined,\n    \"##6\": undefined,\n    \"##7\": undefined,\n};\n\nconst tripleAugmentedIntervals: Record<TripleAugmentedInterval, undefined> = {\n    \"###4\": undefined,\n};\n\nconst diminishedIntervals: Record<DiminishedInterval, undefined> = {\n    bb1: undefined,\n    bb2: undefined,\n    bb3: undefined,\n    bb4: undefined,\n    bb5: undefined,\n    bb6: undefined,\n    bb7: undefined,\n};\n\nconst doubleDiminishedIntervals: Record<DoubleDiminishedInterval, undefined> = {\n    bbb2: undefined,\n    bbb3: undefined,\n    bbb5: undefined,\n    bbb6: undefined,\n    bbb7: undefined,\n};\n\nexport const AllIntervals: Record<Interval, undefined> = {\n    ...naturalIntervals,\n    ...minorIntervals,\n    ...augmentedIntervals,\n    ...diminishedIntervals,\n    ...doubleAugmentedIntervals,\n    ...doubleDiminishedIntervals,\n    ...tripleAugmentedIntervals,\n};\n\nexport const IntervalUtilities: Record<Interval, IntervalUtility> =\n    mapObjectKey(\n        AllIntervals,\n        (interval: Interval) => new IntervalUtility(interval)\n    );\n\nconst unqualifiedInterval = (interval: Interval): NaturalInterval => {\n    return interval.charAt(interval.length - 1) as NaturalInterval;\n};\n\nconst checkIntervalType = <T extends Interval>(\n    interval: Interval,\n    intervalSet: Record<T, undefined>\n): interval is T => {\n    for (const alteredInterval in intervalSet) {\n        if (alteredInterval === interval) {\n            return true;\n        }\n    }\n    return false;\n};\n\nconst isInterval = {\n    minor: (interval: Interval): interval is MinorInterval =>\n        checkIntervalType(interval, minorIntervals),\n\n    augmented: (interval: Interval): interval is AugmentedInterval =>\n        checkIntervalType(interval, augmentedIntervals),\n\n    diminished: (interval: Interval): interval is DiminishedInterval =>\n        checkIntervalType(interval, diminishedIntervals),\n\n    doubleAugmented: (\n        interval: Interval\n    ): interval is DoubleAugmentedInterval =>\n        checkIntervalType(interval, doubleAugmentedIntervals),\n\n    doubleDiminished: (\n        interval: Interval\n    ): interval is DoubleDiminishedInterval =>\n        checkIntervalType(interval, doubleDiminishedIntervals),\n\n    tripleAugmented: (\n        interval: Interval\n    ): interval is TripleAugmentedInterval =>\n        checkIntervalType(interval, tripleAugmentedIntervals),\n};\n","// generating all intervals for all notes\n\nimport { mapObjectKey } from \"../../mapObject\";\nimport {\n    AllIntervals,\n    findInterval,\n    Interval,\n    IntervalUtility,\n} from \"./Interval\";\nimport {\n    NoteUtilities,\n    AllNotes,\n    getNoteLetter,\n    Note,\n    NoteLetter,\n} from \"./Note\";\n\ntype IntervalToNoteMapping = Record<Interval, Note>;\ntype NoteToIntervalMapping = Record<Note, Interval>;\n\nconst intervalsToNotesOfRootNote = (rootNote: Note): IntervalToNoteMapping => {\n    return mapObjectKey(AllIntervals, (interval: Interval) =>\n        intervalToNote(rootNote, interval)\n    );\n};\n\nconst intervalToNote = (rootNote: Note, interval: Interval): Note => {\n    const intervalProperties = new IntervalUtility(interval);\n    const semitones = intervalProperties.semitones;\n    const degree = intervalProperties.degree;\n\n    const noteProperties = NoteUtilities[rootNote];\n    const enharmonicTargetNotes: Note[] = noteProperties.semitonesUp(semitones);\n    const targetNoteName: NoteLetter = noteProperties.noteNameFrom(degree);\n\n    for (const targetNote of enharmonicTargetNotes) {\n        if (getNoteLetter(targetNote) === targetNoteName) {\n            return targetNote;\n        }\n    }\n\n    return enharmonicTargetNotes[0];\n};\n\nconst notesToIntervalsOfRootNote = (rootNote: Note): NoteToIntervalMapping => {\n    return mapObjectKey(AllNotes, (note: Note) =>\n        noteToInterval(rootNote, note)\n    );\n};\n\nconst noteToInterval = (rootNote: Note, otherNote: Note): Interval => {\n    const rootNoteProperties = NoteUtilities[rootNote];\n\n    const semitones = rootNoteProperties.semitonesBetween(otherNote);\n    const degrees = rootNoteProperties.degreesBetween(otherNote);\n\n    return findInterval(semitones, degrees);\n};\n\nexport const IntervalToNote: Record<Note, IntervalToNoteMapping> = mapObjectKey(\n    AllNotes,\n    (rootNote: Note) => intervalsToNotesOfRootNote(rootNote)\n);\n\nexport const NoteToInterval: Record<Note, NoteToIntervalMapping> = mapObjectKey(\n    AllNotes,\n    (rootNote: Note) => notesToIntervalsOfRootNote(rootNote)\n);\n","import { ChordBlock } from \"../../ChordModel/ChordBlock\";\nimport { ChordSong } from \"../../ChordModel/ChordSong\";\nimport { AllNotes, Note } from \"../foundation/Note\";\nimport {\n    IntervalToNote,\n    NoteToInterval,\n} from \"../foundation/NoteIntervalConversion\";\n\nconst transposeNote = (note: Note, fromKey: Note, toKey: Note): Note => {\n    const interval = NoteToInterval[fromKey][note];\n\n    return IntervalToNote[toKey][interval];\n};\n\nconst transposeSymbol = (\n    symbol: string,\n    fromKey: Note,\n    toKey: Note\n): string => {\n    const matchingNotes: Note[] = [];\n\n    let note: Note;\n    for (note in AllNotes) {\n        if (symbol.startsWith(note)) {\n            matchingNotes.push(note);\n        }\n    }\n\n    if (matchingNotes.length === 0) {\n        return symbol;\n    }\n\n    let matchingNote: Note = matchingNotes[0];\n    for (const note of matchingNotes) {\n        // use the longest matching note as the root\n        // e.g. in C#7, C# is a better match than C\n        if (note.length > matchingNote.length) {\n            matchingNote = note;\n        }\n    }\n\n    const transposedNote = transposeNote(matchingNote, fromKey, toKey);\n    return symbol.replace(matchingNote, transposedNote);\n};\n\nconst transposeChord = (chord: string, fromKey: Note, toKey: Note): string => {\n    let bass: string | null = null;\n    let baseChord: string = chord;\n    if (chord.includes(\"/\")) {\n        const tokens = chord.split(\"/\");\n        baseChord = tokens[0];\n        // we don't expect more than one slash, but just to be careful\n        const remainingTokens = tokens.slice(1);\n        bass = remainingTokens.join(\"/\");\n    }\n\n    baseChord = transposeSymbol(baseChord, fromKey, toKey);\n    if (bass === null) {\n        return baseChord;\n    }\n\n    bass = transposeSymbol(bass, fromKey, toKey);\n    return baseChord + \"/\" + bass;\n};\n\nexport const transposeSong = (\n    song: ChordSong,\n    fromKey: Note,\n    toKey: Note\n): ChordSong => {\n    const transposeBlock = (block: ChordBlock): ChordBlock => {\n        if (block.chord === \"\") {\n            return block;\n        }\n\n        return block.update(\"chord\", (chord: string) =>\n            transposeChord(chord, fromKey, toKey)\n        );\n    };\n\n    const newSong = song.updateAllElements((line) => {\n        return line.updateAllElements((block) => {\n            return transposeBlock(block);\n        });\n    });\n\n    return newSong;\n};\n","import { Either, isLeft, left, right } from \"fp-ts/lib/Either\";\nimport { Json, parse } from \"fp-ts/Json\";\nimport * as iots from \"io-ts\";\nimport { DateFromISOString } from \"io-ts-types\";\nimport lodash from \"lodash\";\nimport { User } from \"../../components/user/userContext\";\nimport { ChordBlock } from \"./ChordBlock\";\nimport {\n    ChordLine,\n    ChordLineValidatedFields,\n    ChordLineValidator,\n    TimeSection,\n    timeSectionSortFn,\n} from \"./ChordLine\";\nimport { Collection, CollectionMethods, IDable } from \"./Collection\";\nimport { Lyric } from \"./Lyric\";\nimport { List, Record } from \"immutable\";\nimport { Note } from \"../music/foundation/Note\";\nimport { transposeSong } from \"../music/transpose/Transpose\";\n\nconst MetadataValidator = iots.type({\n    title: iots.string,\n    composedBy: iots.string,\n    performedBy: iots.string,\n});\n\ntype Metadata = iots.TypeOf<typeof MetadataValidator>;\n\nconst SongSummaryTypes = {\n    id: iots.string,\n    owner: iots.string,\n    lastSavedAt: iots.union([DateFromISOString, iots.null]),\n    metadata: MetadataValidator,\n};\n\nconst SongSummaryValidator = iots.type(SongSummaryTypes);\n\nconst ListSongSummaryValidator = iots.array(SongSummaryValidator);\n\ntype SongSummaryValidatedFields = iots.TypeOf<typeof SongSummaryValidator>;\n\nexport class SongSummary implements SongSummaryValidatedFields {\n    id: string;\n    owner: string;\n    lastSavedAt: Date | null;\n    metadata: Metadata;\n\n    constructor(fields?: SongSummaryValidatedFields) {\n        if (fields === undefined) {\n            this.id = \"\";\n            this.owner = \"\";\n            this.metadata = {\n                title: \"\",\n                composedBy: \"\",\n                performedBy: \"\",\n            };\n            this.lastSavedAt = null;\n            return;\n        }\n\n        this.id = fields.id;\n        this.owner = fields.owner;\n        this.metadata = fields.metadata;\n        this.lastSavedAt = fields.lastSavedAt;\n    }\n\n    static fromJSONObject(jsonObj: unknown): Either<Error, SongSummary> {\n        const validationResult = SongSummaryValidator.decode(jsonObj);\n\n        if (isLeft(validationResult)) {\n            return left(new Error(\"Invalid Song Summary object\"));\n        }\n\n        return right(new SongSummary({ ...validationResult.right }));\n    }\n\n    static fromJSONList(jsonList: unknown): Either<Error, SongSummary[]> {\n        const validationResult = ListSongSummaryValidator.decode(jsonList);\n\n        if (isLeft(validationResult)) {\n            return left(new Error(\"Invalid Song Summary list\"));\n        }\n\n        const songSummaryList: SongSummary[] = validationResult.right.map(\n            (fields: SongSummaryValidatedFields): SongSummary => {\n                return new SongSummary({ ...fields });\n            }\n        );\n\n        return right(songSummaryList);\n    }\n}\n\nconst ChordSongValidator = iots.type({\n    ...SongSummaryTypes,\n    elements: iots.array(ChordLineValidator),\n});\n\ntype ChordSongValidatedFields = iots.TypeOf<typeof ChordSongValidator>;\n\ntype RecordType = {\n    id: string;\n    owner: string;\n    lastSavedAt: Date | null;\n    metadata: Metadata;\n    elements: Collection<ChordLine>;\n};\n\nconst DefaultRecord: RecordType = {\n    id: \"\",\n    owner: \"\",\n    lastSavedAt: null,\n    metadata: {\n        title: \"\",\n        composedBy: \"\",\n        performedBy: \"\",\n    },\n    elements: new Collection<ChordLine>(),\n};\n\nconst RecordConstructor = Record(DefaultRecord);\ntype ChordSongRecord = ReturnType<typeof RecordConstructor>;\n\ntype ConstructorParams = {\n    lines?: Collection<ChordLine> | ChordLine[];\n    fields?: SongSummaryValidatedFields;\n};\n\nexport class ChordSong\n    extends CollectionMethods<ChordSong, ChordLine>\n    implements SongSummaryValidatedFields\n{\n    readonly record: ChordSongRecord;\n\n    constructor(params: ConstructorParams | ChordSongRecord) {\n        super();\n\n        if (ChordSong.isChordSongRecord(params)) {\n            this.record = params as ChordSongRecord;\n            return;\n        }\n\n        const record: RecordType = {\n            ...DefaultRecord,\n            metadata: { ...DefaultRecord.metadata },\n        };\n\n        if (params.lines === undefined) {\n            record.elements = new Collection([new ChordLine({})]);\n        } else {\n            if (params.lines instanceof Collection) {\n                record.elements = params.lines;\n            } else {\n                record.elements = new Collection(params.lines);\n            }\n        }\n\n        if (params.fields !== undefined) {\n            record.id = params.fields.id;\n            record.owner = params.fields.owner;\n            record.metadata = params.fields.metadata;\n            record.lastSavedAt = params.fields.lastSavedAt;\n        }\n\n        this.record = RecordConstructor(record);\n    }\n\n    static isChordSongRecord(\n        params: ConstructorParams | ChordSongRecord\n    ): params is ChordSongRecord {\n        return Record.isRecord(params);\n    }\n\n    toJSON(): object {\n        return this.record.toJSON();\n    }\n\n    private new(maybeNew: ChordSongRecord): ChordSong {\n        if (maybeNew === this.record) {\n            return this;\n        }\n\n        return new ChordSong(maybeNew);\n    }\n\n    get id(): string {\n        return this.record.id;\n    }\n\n    get owner(): string {\n        return this.record.owner;\n    }\n\n    get metadata(): Metadata {\n        return this.record.metadata;\n    }\n\n    get lastSavedAt(): Date | null {\n        return this.record.lastSavedAt;\n    }\n\n    protected get elements(): Collection<ChordLine> {\n        return this.record.elements;\n    }\n\n    updateCollection(\n        updater: (collection: Collection<ChordLine>) => Collection<ChordLine>\n    ): ChordSong {\n        return this.update(\"elements\", updater);\n    }\n\n    set<K extends keyof RecordType>(key: K, value: RecordType[K]): ChordSong {\n        const newRecord = this.record.set(key, value);\n        return this.new(newRecord);\n    }\n\n    update<K extends keyof RecordType>(\n        key: K,\n        updater: (value: RecordType[K]) => RecordType[K]\n    ): ChordSong {\n        const newRecord = this.record.update(key, updater);\n        return this.new(newRecord);\n    }\n\n    static fromValidatedFields(\n        validatedFields: ChordSongValidatedFields\n    ): ChordSong {\n        const chordLines: ChordLine[] = validatedFields.elements.map(\n            (chordLineValidatedFields: ChordLineValidatedFields) => {\n                return ChordLine.fromValidatedFields(chordLineValidatedFields);\n            }\n        );\n\n        return new ChordSong({\n            lines: new Collection(chordLines),\n            fields: validatedFields,\n        });\n    }\n\n    static deserialize(jsonStr: string): Either<Error, ChordSong> {\n        const result: Either<unknown, Json> = parse(jsonStr);\n\n        if (isLeft(result)) {\n            return left(new Error(JSON.stringify(result.left)));\n        }\n\n        const jsonObj = result.right;\n        return ChordSong.fromJSONObject(jsonObj);\n    }\n\n    static fromJSONObject(jsonObj: unknown): Either<Error, ChordSong> {\n        const validationResult = ChordSongValidator.decode(jsonObj);\n\n        if (isLeft(validationResult)) {\n            return left(new Error(\"Invalid Chord Song object\"));\n        }\n\n        return right(this.fromValidatedFields(validationResult.right));\n    }\n\n    static fromLyricsLines(lyricLines: Lyric[]): ChordSong {\n        const chordLines: ChordLine[] = lyricLines.map((lyricLine: Lyric) =>\n            ChordLine.fromLyrics(lyricLine)\n        );\n\n        const params: ConstructorParams = {\n            lines: new Collection(chordLines),\n        };\n\n        return new ChordSong(params);\n    }\n\n    get chordLines(): Collection<ChordLine> {\n        return this.elements;\n    }\n\n    get timeSections(): List<TimeSection> {\n        const timeSections: TimeSection[] = [];\n\n        this.chordLines.forEach((line: ChordLine) => {\n            if (line.section?.type === \"time\") {\n                timeSections.push(line.section);\n            }\n        });\n\n        timeSections.sort(timeSectionSortFn);\n        return List(timeSections);\n    }\n\n    get title(): string {\n        return this.metadata.title;\n    }\n\n    set title(newTitle: string) {\n        this.metadata.title = newTitle;\n    }\n\n    get performedBy(): string {\n        return this.metadata.performedBy;\n    }\n\n    set performedBy(newPerformedBy: string) {\n        this.metadata.performedBy = newPerformedBy;\n    }\n\n    get composedBy(): string {\n        return this.metadata.composedBy;\n    }\n\n    set composedBy(newComposedBy: string) {\n        this.metadata.composedBy = newComposedBy;\n    }\n\n    get(idable: IDable<ChordLine>): ChordLine {\n        return this.chordLines.get(idable);\n    }\n\n    // fork clones only the contents of the song, not the ownership information\n    // i.e. not ID, not owner ID, not last saved, etc\n    fork(): ChordSong {\n        const clone = this.set(\"id\", \"\")\n            .set(\"owner\", \"\")\n            .set(\"lastSavedAt\", null);\n\n        return clone;\n    }\n\n    isUnsaved(): boolean {\n        return this.id === \"\";\n    }\n\n    isOwner(user: User | null): boolean {\n        if (this.owner === \"\") {\n            return false;\n        }\n\n        if (user === null) {\n            return false;\n        }\n\n        return this.owner === user.userID;\n    }\n\n    mergeLineWithPrevious(idable: IDable<ChordLine>): [ChordSong, boolean] {\n        const currIndex = this.chordLines.indexOf(idable.id);\n\n        const hasPreviousLine = currIndex > 0;\n        // no previous line to merge with, just bail\n        if (!hasPreviousLine) {\n            return [this, false];\n        }\n\n        // the user experience usually would like a space between lines when they're merged\n        // e.g.\n        // Never Gonna\n        // Give You Up\n        // =>\n        // Never GonnaGive You Up is awkward\n\n        const addSpaceToEndOfLine = (line: ChordLine): ChordLine => {\n            const lastBlockIndex = line.chordBlocks.length - 1;\n\n            return line.updateElement(lastBlockIndex, (block) => {\n                return block.update(\"lyric\", (lyric) => {\n                    return lyric.append(\" \");\n                });\n            });\n        };\n\n        const appendLineToPrev = (\n            prevLine: ChordLine,\n            currLine: ChordLine\n        ): ChordLine => {\n            return prevLine.updateCollection((elements) => {\n                return elements.transform((list) =>\n                    list.push(...currLine.chordBlocks.toArray())\n                );\n            });\n        };\n\n        const mergeLines = (\n            prevLine: ChordLine,\n            currLine: ChordLine\n        ): ChordLine => {\n            prevLine = addSpaceToEndOfLine(prevLine);\n            prevLine = appendLineToPrev(prevLine, currLine);\n            prevLine = prevLine.normalizeBlocks();\n\n            return prevLine;\n        };\n\n        const newChordSong = this.updateCollection((elements) => {\n            const currLine = elements.getAtIndex(currIndex);\n\n            elements = elements.update(currIndex - 1, (prevLine) =>\n                mergeLines(prevLine, currLine)\n            );\n\n            elements = elements.remove(currLine);\n\n            return elements;\n        });\n\n        return [newChordSong, true];\n    }\n\n    splitLine(\n        idable: IDable<ChordLine>,\n        splitIndex: number\n    ): [ChordSong, boolean] {\n        const chordLine = this.chordLines.get(idable);\n\n        const [newCurrLine, nextLine] = chordLine.splitByCharIndex(splitIndex);\n\n        const newChordSong = this.updateCollection((elements) => {\n            return elements.splice(chordLine, 1, newCurrLine, nextLine);\n        });\n\n        return [newChordSong, true];\n    }\n\n    contentEquals(other: ChordSong): boolean {\n        if (this.chordLines.length !== other.chordLines.length) {\n            return false;\n        }\n\n        if (!lodash.isEqual(this.metadata, other.metadata)) {\n            return false;\n        }\n\n        let linesAreEqual = true;\n        this.chordLines.forEach(\n            (line: ChordLine, index: number): void | false => {\n                const otherLine = other.chordLines.getAtIndex(index);\n                if (!line.contentEquals(otherLine)) {\n                    linesAreEqual = false;\n                    return false;\n                }\n            }\n        );\n\n        return linesAreEqual;\n    }\n\n    findLineWithBlock(blockID: IDable<ChordBlock>): ChordLine {\n        const line = this.chordLines.list.find((line): boolean => {\n            const blockResult = line.chordBlocks.list.find(\n                (block: ChordBlock) => block.id === blockID.id\n            );\n\n            return blockResult !== undefined;\n        });\n\n        if (line === undefined) {\n            throw new Error(\"BlockID can't be found in the entire song\");\n        }\n\n        return line;\n    }\n\n    transpose(fromKey: Note, toKey: Note): ChordSong {\n        return transposeSong(this, fromKey, toKey);\n    }\n}\n","// P A T H S\n// by Isayama\n\ntype Mode = \"edit\" | \"play\";\nconst newSongID = \"new\";\n\nexport class RootPath {\n    URL(): string {\n        return \"/\";\n    }\n}\nexport const rootPath = new RootPath();\n\nexport class AboutPath {\n    URL(): string {\n        return \"/about\";\n    }\n}\nexport const aboutPath = new AboutPath();\n\nexport class GuitarDemoPath {\n    URL(): string {\n        return \"/guitar-demo\";\n    }\n}\n\nexport const guitarDemoPath = new GuitarDemoPath();\n\nexport class SongPath {\n    URL(): string {\n        return \"/song\";\n    }\n\n    withID(id: string): SongIDPath {\n        return new SongIDPath(id);\n    }\n\n    withNew(): SongIDPath {\n        return new SongIDPath(newSongID);\n    }\n}\nexport const songPath = new SongPath();\n\nexport class SongIDPath {\n    private readonly id: string;\n\n    constructor(id: string) {\n        this.id = id;\n    }\n    URL(): string {\n        return `/song/${this.id}`;\n    }\n\n    isNew(): boolean {\n        return this.id === newSongID;\n    }\n\n    withMode(mode: Mode): SongIDModePath {\n        return new SongIDModePath(this.id, mode);\n    }\n\n    parent(): SongPath {\n        return songPath;\n    }\n}\nexport const newSongPath = songPath.withNew();\n\nexport class SongIDModePath {\n    private readonly id: string;\n    private readonly mode: Mode;\n    constructor(id: string, mode: Mode) {\n        this.id = id;\n        this.mode = mode;\n    }\n    URL(): string {\n        return `/song/${this.id}/${this.mode}`;\n    }\n\n    parent(): SongIDPath {\n        return new SongIDPath(this.id);\n    }\n\n    static isPlayMode(path: string): boolean {\n        const result = path.match(/\\/song\\/.+\\/play/i);\n        return result !== null;\n    }\n\n    static isEditMode(path: string): boolean {\n        const result = path.match(/\\/song\\/.+\\/edit/i);\n        return result !== null;\n    }\n}\n\nexport class DemoPath {\n    URL(): string {\n        const neverGonnaGiveYouPlasticLoveUUID =\n            \"c531c0fe-6e8d-4cfe-9c5f-120e3402ccd9\";\n\n        return new SongIDPath(neverGonnaGiveYouPlasticLoveUUID).URL();\n    }\n}\nexport const demoPath = new DemoPath();\n","import { Grid, Paper, Theme, Typography } from \"@material-ui/core\";\nimport { withStyles } from \"@material-ui/styles\";\nimport React from \"react\";\nimport { inflatingWhitespace } from \"../../common/Whitespace\";\n\nconst RootPaper = withStyles((theme: Theme) => ({\n    root: {\n        marginTop: theme.spacing(5),\n        padding: theme.spacing(5),\n        minHeight: theme.spacing(46),\n        minWidth: theme.spacing(92),\n    },\n}))(Paper);\n\nconst About: React.FC<{}> = (): JSX.Element => {\n    return (\n        <Grid container data-testid=\"About\">\n            <Grid item xs={3}></Grid>\n            <Grid item xs={6}>\n                <RootPaper>\n                    <Typography variant=\"h6\">About Chord Paper</Typography>\n                    <Typography variant=\"h6\">\n                        {inflatingWhitespace()}\n                    </Typography>\n                    <Typography>\n                        Chord Paper makes writing and reading chord sheets\n                        easier than the traditional monospace font formatting.\n                        It's a passion project born out of frustration at the\n                        clunkiness of writing chords on a computer.\n                    </Typography>\n                    <Typography>{inflatingWhitespace()}</Typography>\n                    <Typography>\n                        Hope you will find that Chord Paper helps you focus more\n                        of your musical time on playing and listening, and less\n                        on formatting.\n                    </Typography>\n                    <Typography>{inflatingWhitespace()}</Typography>\n                    <Typography>\n                        Background audio separation is built on{\" \"}\n                        <a href=\"https://github.com/deezer/spleeter\">\n                            Spleeter\n                        </a>\n                        .\n                    </Typography>\n                    <Typography>{inflatingWhitespace()}</Typography>\n                    <Typography>Credits:</Typography>\n                    <Typography>\n                        Kubernetes infrastructure and deployment:{\" \"}\n                        <a href=\"https://github.com/pw1124\">@pw1124</a>\n                    </Typography>\n                    <Typography>\n                        Initial design (all the good parts!): Key\n                    </Typography>\n                    <Typography>\n                        Everything else:{\" \"}\n                        <a href=\"https://github.com/veedubyou\">@veedubyou</a>\n                    </Typography>\n                </RootPaper>\n            </Grid>\n            <Grid item xs={3}></Grid>\n        </Grid>\n    );\n};\n\nexport default About;\n","import React from \"react\";\nimport { DndProvider } from \"react-dnd\";\nimport { HTML5Backend } from \"react-dnd-html5-backend\";\n\ntype DragEventHandler = (e: DragEvent) => void;\n\ntype UnsafeBackend = {\n    handleTopDragEnter: DragEventHandler | null | undefined;\n    handleTopDragOver: DragEventHandler | null | undefined;\n    __original__handleTopDragEnter: DragEventHandler | null | undefined;\n    __original__handleTopDragOver: DragEventHandler | null | undefined;\n    altKeyPressed: boolean;\n};\n\n// extremely hacky - overriding the implementation of the backend forcibly\n// however React-DND is pretty much unmaintained, so there are few other choices\nexport const HTML5BackendWithCTRLKey = (\n    ...params: Parameters<typeof HTML5Backend>\n) => {\n    const backend = HTML5Backend(...params);\n\n    const welpThingsBroke = (): never => {\n        console.error(\n            \"----------------------BAD THING HAPPENED----------------------\"\n        );\n        console.error(\"HTML5 Drag and Drop backend changed internally\");\n        console.error(\"Drag and drop is probably broken\");\n        console.error(\n            \"----------------------BAD THING HAPPENED----------------------\"\n        );\n\n        throw new Error(\"HTMLBackend changed and is now broken\");\n    };\n\n    const untypesafeBackend: UnsafeBackend =\n        backend as unknown as UnsafeBackend;\n\n    if (\n        untypesafeBackend.handleTopDragEnter === undefined ||\n        untypesafeBackend.handleTopDragEnter === null\n    ) {\n        welpThingsBroke();\n    }\n\n    untypesafeBackend.__original__handleTopDragEnter =\n        untypesafeBackend.handleTopDragEnter;\n\n    untypesafeBackend.handleTopDragEnter = (e: DragEvent) => {\n        untypesafeBackend.__original__handleTopDragEnter?.(e);\n        untypesafeBackend.altKeyPressed = e.ctrlKey || e.metaKey || e.altKey;\n    };\n\n    if (\n        untypesafeBackend.handleTopDragOver === undefined ||\n        untypesafeBackend.handleTopDragOver === null\n    ) {\n        welpThingsBroke();\n    }\n\n    untypesafeBackend.__original__handleTopDragOver =\n        untypesafeBackend.handleTopDragOver;\n    untypesafeBackend.handleTopDragOver = (e: DragEvent) => {\n        untypesafeBackend.__original__handleTopDragOver?.(e);\n        untypesafeBackend.altKeyPressed = e.ctrlKey || e.metaKey || e.altKey;\n    };\n\n    return backend;\n};\n\ninterface DragAndDropProps {\n    children: React.ReactElement;\n}\n\nconst DragAndDrop: React.FC<DragAndDropProps> = (\n    props: DragAndDropProps\n): JSX.Element => {\n    return (\n        <DndProvider backend={HTML5BackendWithCTRLKey}>\n            {props.children}\n        </DndProvider>\n    );\n};\n\nexport default DragAndDrop;\n","export type PlainFn = () => void;\nexport const noopFn: PlainFn = () => {};\n","import React, { useContext, useRef } from \"react\";\nimport { noopFn } from \"../common/PlainFn\";\n\ntype KeyListener = (event: KeyboardEvent) => void;\ninterface StoredKeyListener {\n    original: KeyListener;\n    wrapped: KeyListener;\n}\ntype RegisterKeyListenerFn = (listener: KeyListener) => void;\n\nconst GlobalKeyListenerContext = React.createContext<\n    [RegisterKeyListenerFn, RegisterKeyListenerFn, RegisterKeyListenerFn]\n>([noopFn, noopFn, noopFn]);\n\ninterface GlobalKeyListenerProviderProps {\n    children: React.ReactNode;\n}\n\nexport const useRegisterKeyListener = (): [\n    RegisterKeyListenerFn,\n    RegisterKeyListenerFn\n] => {\n    const [registerKeyListener, , unregisterKeyListener] = useContext(\n        GlobalKeyListenerContext\n    );\n    return [registerKeyListener, unregisterKeyListener];\n};\n\nexport const useRegisterTopKeyListener = (): [\n    RegisterKeyListenerFn,\n    RegisterKeyListenerFn\n] => {\n    const [, registerTopKeyListener, unregisterKeyListener] = useContext(\n        GlobalKeyListenerContext\n    );\n    return [registerTopKeyListener, unregisterKeyListener];\n};\n\nconst GlobalKeyListenerProvider: React.FC<GlobalKeyListenerProviderProps> = (\n    props: GlobalKeyListenerProviderProps\n): JSX.Element => {\n    const keyListeners = useRef<StoredKeyListener[]>([]);\n\n    const removeAll = () => {\n        for (let entry of keyListeners.current) {\n            window.removeEventListener(\"keydown\", entry.wrapped, true);\n        }\n    };\n\n    const addAll = () => {\n        for (let entry of keyListeners.current) {\n            window.addEventListener(\"keydown\", entry.wrapped, true);\n        }\n    };\n\n    const wrapListener = (listener: KeyListener): KeyListener => {\n        return (event: KeyboardEvent): void => {\n            const isTypingContext =\n                event.target instanceof HTMLElement &&\n                (event.target.tagName === \"INPUT\" ||\n                    event.target.tagName === \"TEXTAREA\" ||\n                    event.target.isContentEditable);\n\n            if (isTypingContext) {\n                return;\n            }\n\n            listener(event);\n\n            if (event.defaultPrevented) {\n                event.stopImmediatePropagation();\n            }\n            return;\n        };\n    };\n\n    const registerKeyListener = (listener: KeyListener) => {\n        const wrappedListener = wrapListener(listener);\n\n        keyListeners.current.push({\n            original: listener,\n            wrapped: wrappedListener,\n        });\n\n        window.addEventListener(\"keydown\", wrappedListener, true);\n    };\n\n    const registerTopKeyListener = (listener: KeyListener) => {\n        const wrappedListener = wrapListener(listener);\n\n        removeAll();\n        keyListeners.current.unshift({\n            original: listener,\n            wrapped: wrappedListener,\n        });\n        addAll();\n    };\n\n    const unregisterKeyListener = (listener: KeyListener) => {\n        const index = keyListeners.current.findIndex(\n            (entry: StoredKeyListener) => entry.original === listener\n        );\n        if (index === -1) {\n            return;\n        }\n\n        const entry = keyListeners.current[index];\n\n        window.removeEventListener(\"keydown\", entry.wrapped, true);\n        keyListeners.current.splice(index, 1);\n    };\n\n    return (\n        <GlobalKeyListenerContext.Provider\n            value={[\n                registerKeyListener,\n                registerTopKeyListener,\n                unregisterKeyListener,\n            ]}\n        >\n            {props.children}\n        </GlobalKeyListenerContext.Provider>\n    );\n};\n\nexport default GlobalKeyListenerProvider;\n","import { mapObjectKey } from \"../../mapObject\";\nimport { Importance } from \"../foundation/Importance\";\nimport { Interval } from \"../foundation/Interval\";\nimport { AllNotes, Note } from \"../foundation/Note\";\nimport { IntervalToNote } from \"../foundation/NoteIntervalConversion\";\n\nexport type ScaleInterval = {\n    interval: Interval;\n    // the importance of the note should be determined by the chord context\n    // but we may not always get that context\n    importance: Importance;\n};\n\nexport type ScaleNote = {\n    note: Note;\n    interval: Interval;\n    importance: Importance;\n};\n\nexport type ScaleType = ScaleInterval[];\n\nexport type ScaleName =\n    | \"Ionian\"\n    | \"Dorian\"\n    | \"Phrygian\"\n    | \"Lydian\"\n    | \"Mixolydian\"\n    | \"Aeolian\"\n    | \"Locrian\"\n    | \"Dominant\";\n\nexport const ScaleTypes: Record<ScaleName, ScaleType> = {\n    // modes\n    Lydian: [\n        { interval: \"1\", importance: \"root\" },\n        { interval: \"2\", importance: \"normal\" },\n        { interval: \"3\", importance: \"chordtone\" },\n        { interval: \"#4\", importance: \"special\" },\n        { interval: \"5\", importance: \"chordtone\" },\n        { interval: \"6\", importance: \"normal\" },\n        { interval: \"7\", importance: \"chordtone\" },\n    ],\n    Ionian: [\n        { interval: \"1\", importance: \"root\" },\n        { interval: \"2\", importance: \"normal\" },\n        { interval: \"3\", importance: \"chordtone\" },\n        { interval: \"4\", importance: \"normal\" },\n        { interval: \"5\", importance: \"chordtone\" },\n        { interval: \"6\", importance: \"normal\" },\n        { interval: \"7\", importance: \"chordtone\" },\n    ],\n    Mixolydian: [\n        { interval: \"1\", importance: \"root\" },\n        { interval: \"2\", importance: \"normal\" },\n        { interval: \"3\", importance: \"chordtone\" },\n        { interval: \"4\", importance: \"normal\" },\n        { interval: \"5\", importance: \"chordtone\" },\n        { interval: \"6\", importance: \"normal\" },\n        { interval: \"b7\", importance: \"chordtone\" },\n    ],\n    Dorian: [\n        { interval: \"1\", importance: \"root\" },\n        { interval: \"2\", importance: \"normal\" },\n        { interval: \"b3\", importance: \"chordtone\" },\n        { interval: \"4\", importance: \"normal\" },\n        { interval: \"5\", importance: \"chordtone\" },\n        { interval: \"6\", importance: \"special\" },\n        { interval: \"b7\", importance: \"chordtone\" },\n    ],\n    Aeolian: [\n        { interval: \"1\", importance: \"root\" },\n        { interval: \"2\", importance: \"normal\" },\n        { interval: \"b3\", importance: \"chordtone\" },\n        { interval: \"4\", importance: \"normal\" },\n        { interval: \"5\", importance: \"chordtone\" },\n        { interval: \"b6\", importance: \"normal\" },\n        { interval: \"b7\", importance: \"chordtone\" },\n    ],\n    Phrygian: [\n        { interval: \"1\", importance: \"root\" },\n        { interval: \"b2\", importance: \"special\" },\n        { interval: \"b3\", importance: \"chordtone\" },\n        { interval: \"4\", importance: \"normal\" },\n        { interval: \"5\", importance: \"chordtone\" },\n        { interval: \"b6\", importance: \"normal\" },\n        { interval: \"b7\", importance: \"chordtone\" },\n    ],\n    Locrian: [\n        { interval: \"1\", importance: \"root\" },\n        { interval: \"b2\", importance: \"special\" },\n        { interval: \"b3\", importance: \"chordtone\" },\n        { interval: \"4\", importance: \"normal\" },\n        { interval: \"b5\", importance: \"chordtone\" },\n        { interval: \"b6\", importance: \"normal\" },\n        { interval: \"b7\", importance: \"chordtone\" },\n    ],\n    // dominant\n    Dominant: [\n        { interval: \"1\", importance: \"root\" },\n        { interval: \"b2\", importance: \"special\" },\n        { interval: \"#2\", importance: \"special\" },\n        { interval: \"3\", importance: \"chordtone\" },\n        { interval: \"#4\", importance: \"special\" },\n        { interval: \"b6\", importance: \"special\" },\n        { interval: \"b7\", importance: \"chordtone\" },\n    ],\n};\n\nexport type Scale = {\n    center: Note;\n    name: ScaleName;\n    notes: ScaleNote[];\n};\n// scale mapping for all keys\nexport type ScaleCollection = Record<Note, Scale>;\n\nconst buildScaleCollection = (scaleName: ScaleName): ScaleCollection => {\n    return mapObjectKey(AllNotes, (keyCenter: Note) =>\n        buildScale(keyCenter, scaleName)\n    );\n};\n\nconst buildScale = (keyCenter: Note, scaleName: ScaleName): Scale => {\n    const convertToScaleNote = (scaleInterval: ScaleInterval) => {\n        return {\n            note: IntervalToNote[keyCenter][scaleInterval.interval],\n            interval: scaleInterval.interval,\n            importance: scaleInterval.importance,\n        };\n    };\n\n    const scaleNotes: ScaleNote[] =\n        ScaleTypes[scaleName].map(convertToScaleNote);\n\n    return {\n        center: keyCenter,\n        name: scaleName,\n        notes: scaleNotes,\n    };\n};\n\nexport const AllScales: Record<ScaleName, ScaleCollection> = mapObjectKey(\n    ScaleTypes,\n    (scaleName: ScaleName) => buildScaleCollection(scaleName)\n);\n\nexport class ScaleUtility {\n    scale: Scale;\n    constructor(scale: Scale) {\n        this.scale = scale;\n    }\n\n    name(): string {\n        return `${this.scale.center} ${this.scale.name}`;\n    }\n}\n","import { TextField } from \"@material-ui/core\";\nimport React from \"react\";\nimport { StartingFret } from \"./ScaleChart\";\n\ninterface FretSelectorProps {\n    startingFret: StartingFret;\n    onStartingFretChanged: (startingFret: StartingFret) => void;\n}\n\nconst FretSelector: React.FC<FretSelectorProps> = (\n    props: FretSelectorProps\n): JSX.Element => {\n    return (\n        <TextField\n            label=\"Starting Fret\"\n            type=\"number\"\n            InputLabelProps={{\n                shrink: true,\n            }}\n            variant=\"outlined\"\n            value={props.startingFret}\n            onChange={(event: React.ChangeEvent<HTMLInputElement>) => {\n                const val = parseInt(event.target.value);\n                if (val <= 0 || val > 21) {\n                    return;\n                }\n\n                if (val % 1 !== 0) {\n                    return;\n                }\n\n                props.onStartingFretChanged(val as StartingFret);\n            }}\n        />\n    );\n};\n\nexport default FretSelector;\n","import { mapObjectKey } from \"../../mapObject\";\nimport { asSemitone } from \"../foundation/Distance\";\nimport { AllNotes, Note, NoteUtilities } from \"../foundation/Note\";\n\nexport type StringName = \"E\" | \"A\" | \"D\" | \"G\" | \"B\" | \"highE\";\nexport const AllStringNames: Record<StringName, undefined> = {\n    highE: undefined,\n    B: undefined,\n    G: undefined,\n    D: undefined,\n    A: undefined,\n    E: undefined,\n};\n\ntype Fretmap = Record<Note, number[]>;\n\nexport type Fret = {\n    fret: number;\n    note: Note;\n};\n\nexport type FretboardView = Record<StringName, Fret[]>;\n\nclass FretboardClass {\n    static readonly maxFrets = 24;\n    noteMap: Record<StringName, Fretmap>;\n\n    static buildString(baseNote: Note): Fretmap {\n        const fretmap: Fretmap = mapObjectKey(AllNotes, (): number[] => []);\n        const noteUtility = NoteUtilities[baseNote];\n        for (let i = 0; i <= FretboardClass.maxFrets; i++) {\n            const nextNotes = noteUtility.semitonesUp(asSemitone(i));\n            for (const note of nextNotes) {\n                fretmap[note].push(i);\n            }\n        }\n\n        return fretmap;\n    }\n\n    constructor() {\n        this.noteMap = {\n            highE: FretboardClass.buildString(\"E\"),\n            B: FretboardClass.buildString(\"B\"),\n            G: FretboardClass.buildString(\"G\"),\n            D: FretboardClass.buildString(\"D\"),\n            A: FretboardClass.buildString(\"A\"),\n            E: FretboardClass.buildString(\"E\"),\n        };\n    }\n\n    getPositions(\n        note: Note,\n        startingFret: number,\n        endingFret: number\n    ): FretboardView {\n        const fretboardView: FretboardView = mapObjectKey(\n            AllStringNames,\n            () => []\n        );\n\n        let stringName: StringName;\n        for (stringName in fretboardView) {\n            const frets = this.noteMap[stringName][note];\n            for (const fret of frets) {\n                if (fret < startingFret || fret > endingFret) {\n                    continue;\n                }\n\n                fretboardView[stringName].push({\n                    fret: fret,\n                    note: note,\n                });\n            }\n        }\n\n        return fretboardView;\n    }\n}\n\nexport const Fretboard = new FretboardClass();\n","import { mapObjectKey } from \"../../mapObject\";\nimport { Importance } from \"../foundation/Importance\";\nimport { Scale, ScaleNote } from \"../scale/Scale\";\nimport { AllStringNames, Fret, Fretboard, StringName } from \"./Fretboard\";\n\nexport type GuitarFretLabel = {\n    fret: number;\n    labelText: string;\n    importance: Importance;\n};\n\nconst getLabelText = (scaleNote: ScaleNote, labelType: \"interval\" | \"note\") => {\n    switch (labelType) {\n        case \"interval\": {\n            return scaleNote.interval;\n        }\n\n        case \"note\": {\n            return scaleNote.note;\n        }\n    }\n};\n\nexport const generateGuitarScaleView = (\n    scale: Scale,\n    startingFret: number,\n    endingFret: number,\n    labelType: \"interval\" | \"note\"\n): Record<StringName, GuitarFretLabel[]> => {\n    const fretboardLabels: Record<StringName, GuitarFretLabel[]> = mapObjectKey(\n        AllStringNames,\n        () => []\n    );\n\n    for (const scaleNote of scale.notes) {\n        const notePositions = Fretboard.getPositions(\n            scaleNote.note,\n            startingFret,\n            endingFret\n        );\n        let stringName: StringName;\n        for (stringName in notePositions) {\n            const fretLabel = notePositions[stringName].map(\n                (fret: Fret): GuitarFretLabel => ({\n                    fret: fret.fret,\n                    labelText: getLabelText(scaleNote, labelType),\n                    importance: scaleNote.importance,\n                })\n            );\n\n            fretboardLabels[stringName].push(...fretLabel);\n        }\n    }\n\n    return fretboardLabels;\n};\n","import { Box } from \"@material-ui/core\";\nimport { withStyles } from \"@material-ui/styles\";\nimport React, { useEffect, useRef } from \"react\";\nimport { Finger, FretLabelPosition, Shape, SVGuitarChord } from \"svguitar\";\nimport { StringName } from \"../../common/music/guitar/Fretboard\";\nimport {\n    generateGuitarScaleView,\n    GuitarFretLabel,\n} from \"../../common/music/guitar/Scale\";\nimport { Scale } from \"../../common/music/scale/Scale\";\n\nconst ChartBox = withStyles({\n    root: {\n        transform: \"rotate(270deg)\",\n\n        \"& svg\": {\n            // magic number, but it makes charts not overlap\n            transform: \"scale(0.85)\",\n        },\n        \"& .title\": {\n            fontFamily: \"PoriChord\",\n        },\n    },\n})(Box);\n\nconst fretWindow = 4;\n\nconst stringNameMap: Record<StringName, number> = {\n    highE: 1,\n    B: 2,\n    G: 3,\n    D: 4,\n    A: 5,\n    E: 6,\n};\n\nconst convertScaleViewToFingers = (\n    scaleView: Record<StringName, GuitarFretLabel[]>,\n    startingFret: number\n): Finger[] => {\n    const fingers: Finger[] = [];\n\n    let stringName: StringName;\n    for (stringName in scaleView) {\n        const stringNumber = stringNameMap[stringName];\n\n        const fretLabels = scaleView[stringName];\n        for (const fretLabel of fretLabels) {\n            let fretNumber: number = (() => {\n                const fretNumber = fretLabel.fret - startingFret + 1;\n                if (fretNumber <= 0) {\n                    throw new Error(\n                        \"Invalid finger generated - got a zero or negative fretting\"\n                    );\n                }\n\n                return fretNumber;\n            })();\n\n            const labelColour: string | undefined = (() => {\n                switch (fretLabel.importance) {\n                    case \"normal\": {\n                        return \"black\";\n                    }\n\n                    case \"root\": {\n                        return \"#f44336\";\n                    }\n\n                    case \"chordtone\": {\n                        return \"#64b5f6\";\n                    }\n\n                    case \"special\": {\n                        return \"purple\";\n                    }\n                }\n            })();\n\n            const shape: Shape =\n                fretLabel.importance === \"root\" ? Shape.SQUARE : Shape.CIRCLE;\n\n            fingers.push([\n                stringNumber,\n                fretNumber,\n                {\n                    text: fretLabel.labelText,\n                    color: labelColour,\n                    shape: shape,\n                },\n            ]);\n        }\n    }\n\n    return fingers;\n};\n\nexport type StartingFret =\n    | 1\n    | 2\n    | 3\n    | 4\n    | 5\n    | 6\n    | 7\n    | 8\n    | 9\n    | 10\n    | 11\n    | 12\n    | 13\n    | 14\n    | 15\n    | 16\n    | 17\n    | 18\n    | 19\n    | 20\n    | 21;\n\ninterface ScaleChartProps {\n    scale: Scale;\n    startingFret: StartingFret;\n    scaleLabel: string;\n}\n\nconst ScaleChart: React.FC<ScaleChartProps> = (\n    props: ScaleChartProps\n): JSX.Element => {\n    const elemRef = useRef<HTMLElement>(null);\n    const prevSVGuitarChord = useRef<SVGuitarChord | null>(null);\n\n    const getPos = (elem: SVGTextElement): [number, number] | undefined => {\n        if (\n            elem.x.baseVal.numberOfItems === 0 ||\n            elem.y.baseVal.numberOfItems === 0\n        ) {\n            return undefined;\n        }\n\n        return [\n            elem.x.baseVal.getItem(0).value,\n            elem.y.baseVal.getItem(0).value,\n        ];\n    };\n\n    useEffect(() => {\n        if (elemRef.current === null) {\n            return;\n        }\n\n        if (prevSVGuitarChord.current !== null) {\n            prevSVGuitarChord.current.remove();\n        }\n\n        const endingFret = props.startingFret + fretWindow;\n        const guitarScaleView = generateGuitarScaleView(\n            props.scale,\n            props.startingFret,\n            endingFret,\n            \"note\"\n        );\n\n        const svguitarChord = new SVGuitarChord(elemRef.current);\n\n        svguitarChord.chord({\n            barres: [],\n            fingers: convertScaleViewToFingers(\n                guitarScaleView,\n                props.startingFret\n            ),\n            title: props.scaleLabel,\n        });\n\n        svguitarChord.configure({\n            position: props.startingFret,\n            fretLabelPosition: FretLabelPosition.LEFT,\n        });\n\n        svguitarChord.draw();\n        prevSVGuitarChord.current = svguitarChord;\n\n        const texts = elemRef.current.querySelectorAll(\".nut-text,.position\");\n        texts.forEach((elem: Element) => {\n            if (!(elem instanceof SVGTextElement)) {\n                return;\n            }\n\n            const pos = getPos(elem);\n            if (pos === undefined) {\n                return;\n            }\n\n            setTimeout(() =>\n                elem.setAttribute(\"transform\", `rotate(90,${pos[0]},${pos[1]})`)\n            );\n        });\n    }, [props.scale, props.startingFret, props.scaleLabel]);\n\n    // https://github.com/mui-org/material-ui/issues/17010\n    const refProps = {\n        ref: elemRef,\n    };\n\n    return <ChartBox {...refProps}></ChartBox>;\n};\n\nexport default ScaleChart;\n","import {\n    Box,\n    Grid,\n    TextField,\n    Theme,\n    Tooltip as UnstyledTooltip,\n} from \"@material-ui/core\";\nimport { withStyles } from \"@material-ui/styles\";\nimport React, { useState } from \"react\";\nimport { Scale, ScaleUtility } from \"../../common/music/scale/Scale\";\nimport FretSelector from \"./FretSelector\";\nimport ScaleChart, { StartingFret } from \"./ScaleChart\";\n\nconst Tooltip = withStyles((theme: Theme) => ({\n    tooltip: {\n        background: \"white\",\n        boxShadow: theme.shadows[2],\n    },\n}))(UnstyledTooltip);\n\nconst MarginBox = withStyles((theme: Theme) => ({\n    root: {\n        margin: theme.spacing(2),\n    },\n}))(Box);\n\ninterface MenuSelectableScaleChartProps {\n    scale: Scale;\n    initialStartingFret: StartingFret;\n}\n\nconst MenuSelectableScaleChart: React.FC<MenuSelectableScaleChartProps> = (\n    props: MenuSelectableScaleChartProps\n): JSX.Element => {\n    const [label, setLabel] = useState(new ScaleUtility(props.scale).name());\n    const [startingFret, setStartingFret] = useState(props.initialStartingFret);\n\n    const menu = (\n        <Grid container>\n            <Grid item xs={6}>\n                <MarginBox>\n                    <FretSelector\n                        startingFret={startingFret}\n                        onStartingFretChanged={setStartingFret}\n                    />\n                </MarginBox>\n            </Grid>\n            <Grid item xs={6}>\n                <MarginBox>\n                    <TextField\n                        label=\"Label\"\n                        InputLabelProps={{\n                            shrink: true,\n                        }}\n                        variant=\"outlined\"\n                        value={label}\n                        onChange={(\n                            event: React.ChangeEvent<HTMLInputElement>\n                        ) => {\n                            setLabel(event.target.value);\n                        }}\n                    />\n                </MarginBox>\n            </Grid>\n        </Grid>\n    );\n\n    return (\n        <Tooltip placement=\"top\" interactive title={menu}>\n            <span>\n                <ScaleChart\n                    scale={props.scale}\n                    scaleLabel={label}\n                    startingFret={startingFret}\n                />\n            </span>\n        </Tooltip>\n    );\n};\n\nexport default MenuSelectableScaleChart;\n","import TextField from \"@material-ui/core/TextField\";\nimport Autocomplete, {\n    AutocompleteRenderInputParams,\n    createFilterOptions,\n} from \"@material-ui/lab/Autocomplete\";\nimport React from \"react\";\nimport { AllNotes, Note } from \"../../common/music/foundation/Note\";\nimport { ScaleName, ScaleTypes } from \"../../common/music/scale/Scale\";\nimport lodash from \"lodash\";\n\nexport type SelectableScale = {\n    note: Note;\n    scaleName: ScaleName;\n    label: string;\n};\n\nconst AllScaleValues: SelectableScale[] = (() => {\n    const allOptions: SelectableScale[] = [];\n    let note: Note;\n    let scaleName: ScaleName;\n\n    for (note in AllNotes) {\n        for (scaleName in ScaleTypes) {\n            allOptions.push({\n                note: note,\n                scaleName: scaleName,\n                label: `${note} ${scaleName}`,\n            });\n        }\n    }\n\n    return allOptions;\n})();\n\ninterface ScaleSelectionProps {\n    scales: SelectableScale[];\n    onSelection: (selection: SelectableScale[]) => void;\n}\n\nconst ScaleSelection: React.FC<ScaleSelectionProps> = (\n    props: ScaleSelectionProps\n): JSX.Element => {\n    const filterOptions = createFilterOptions<SelectableScale>({\n        matchFrom: \"start\",\n    });\n\n    const changeHandler = (\n        _event: React.ChangeEvent<{}>,\n        newValue: SelectableScale[]\n    ) => {\n        props.onSelection(newValue);\n    };\n\n    // another workaround\n    // the selection box needs to be able to provide duplicate options\n    // e.g. C ionian, D dorian, C ionian\n    // it can't do that right now, but this mechanism can emulate it\n    // by making the options a difference reference every time\n    // https://github.com/mui-org/material-ui/issues/18755#issuecomment-864118839\n    const copiedScaleOptions = lodash.cloneDeep(AllScaleValues);\n\n    return (\n        <Autocomplete\n            multiple\n            options={copiedScaleOptions}\n            filterOptions={filterOptions}\n            getOptionLabel={(scaleValue) => scaleValue.label}\n            renderInput={(params: AutocompleteRenderInputParams) => (\n                <TextField {...params} variant=\"outlined\" label=\"Scales\" />\n            )}\n            value={props.scales}\n            onChange={changeHandler}\n        />\n    );\n};\n\nexport default ScaleSelection;\n","import { Box, Grid, Paper as UnstyledPaper, Theme } from \"@material-ui/core\";\nimport { withStyles } from \"@material-ui/styles\";\nimport React, { useRef, useState } from \"react\";\nimport \"swiper/components/navigation/navigation.min.css\";\nimport SwiperCore, { Navigation, Pagination } from \"swiper/core\";\nimport { Swiper, SwiperSlide } from \"swiper/react\";\nimport \"swiper/swiper.min.css\";\nimport { AllScales, ScaleUtility } from \"../../common/music/scale/Scale\";\nimport FretSelector from \"./FretSelector\";\nimport { StartingFret } from \"./ScaleChart\";\nimport MenuSelectableScaleChart from \"./MenuSelectableScaleChart\";\nimport ScaleSelection, { SelectableScale } from \"./ScaleSelection\";\n\n// install Swiper modules\nSwiperCore.use([Navigation, Pagination]);\n\nconst MarginBox = withStyles((theme: Theme) => ({\n    root: {\n        margin: theme.spacing(2),\n    },\n}))(Box);\n\nconst Paper = withStyles({\n    root: {\n        display: \"block\",\n    },\n})(UnstyledPaper);\n\ninterface GuitarDemoProps {}\n\nconst GuitarDemo: React.FC<GuitarDemoProps> = (\n    props: GuitarDemoProps\n): JSX.Element => {\n    const [scales, setScales] = useState<SelectableScale[]>([]);\n    const [startingFret, setStartingFret] = useState<StartingFret>(5);\n\n    const firstRowSwiperRef = useRef<SwiperCore | null>(null);\n    const secondRowSwiperRef = useRef<SwiperCore | null>(null);\n\n    const menu = (\n        <Grid container>\n            <Grid item xs={9}>\n                <MarginBox>\n                    <ScaleSelection scales={scales} onSelection={setScales} />\n                </MarginBox>\n            </Grid>\n            <Grid item xs={3}>\n                <MarginBox>\n                    <FretSelector\n                        startingFret={startingFret}\n                        onStartingFretChanged={setStartingFret}\n                    />\n                </MarginBox>\n            </Grid>\n        </Grid>\n    );\n\n    const makeSlide = (selectableScale: SelectableScale): JSX.Element => {\n        const scale =\n            AllScales[selectableScale.scaleName][selectableScale.note];\n        return (\n            <SwiperSlide>\n                <MenuSelectableScaleChart\n                    key={new ScaleUtility(scale).name()}\n                    scale={scale}\n                    initialStartingFret={startingFret}\n                />\n            </SwiperSlide>\n        );\n    };\n\n    const slidesPerView = 4;\n    const secondRow = scales.length > slidesPerView;\n    const overflow = scales.length > 2 * slidesPerView;\n\n    const firstRowSwiper: JSX.Element = (() => {\n        const rotateSecondRow = (swiper: SwiperCore) => {\n            if (!overflow) {\n                return;\n            }\n\n            if (secondRowSwiperRef.current === null) {\n                return;\n            }\n\n            const secondRowSlideIndex =\n                (swiper.realIndex + slidesPerView) % scales.length;\n            secondRowSwiperRef.current.slideToLoop(secondRowSlideIndex);\n        };\n\n        const firstRowSlides: JSX.Element[] = (() => {\n            if (overflow) {\n                return scales.map(makeSlide);\n            }\n\n            const firstSetScales = scales.slice(0, slidesPerView);\n            return firstSetScales.map(makeSlide);\n        })();\n\n        return (\n            <Swiper\n                slidesPerView={slidesPerView}\n                navigation={overflow}\n                loop={overflow}\n                onSlideChange={rotateSecondRow}\n                onSwiper={(swiper: SwiperCore) => {\n                    firstRowSwiperRef.current = swiper;\n                }}\n            >\n                {firstRowSlides}\n            </Swiper>\n        );\n    })();\n\n    const secondRowSwiper: JSX.Element | null = (() => {\n        if (!secondRow) {\n            return null;\n        }\n\n        const secondRowSlides: JSX.Element[] = (() => {\n            if (overflow) {\n                return scales.map(makeSlide);\n            }\n\n            const secondSetScales = scales.slice(\n                slidesPerView,\n                2 * slidesPerView\n            );\n            return secondSetScales.map(makeSlide);\n        })();\n\n        return (\n            <Swiper\n                slidesPerView={slidesPerView}\n                loop={overflow}\n                onSwiper={(swiper: SwiperCore) => {\n                    secondRowSwiperRef.current = swiper;\n                }}\n                initialSlide={slidesPerView}\n            >\n                {secondRowSlides}\n            </Swiper>\n        );\n    })();\n\n    return (\n        <Paper>\n            {menu}\n            {firstRowSwiper}\n            {secondRowSwiper}\n        </Paper>\n    );\n};\n\nexport default GuitarDemo;\n","enum RangePosition {\n    START,\n    END,\n    MIDDLE,\n}\n\nconst parentNode = (node: Node): Node => {\n    if (node.parentNode === null) {\n        throw new Error(\"Node doesn't have parent\");\n    }\n\n    return node.parentNode;\n};\n\nconst normalizeNodeBoundary = (\n    container: Node,\n    offset: number\n): [Node, number] => {\n    const position = getPositionForNode(container, offset);\n    if (position === RangePosition.MIDDLE) {\n        return [container, offset];\n    }\n\n    let offsetFromParent = findOffsetForNode(container);\n    if (position === RangePosition.END) {\n        offsetFromParent += 1;\n    }\n\n    return normalizeNodeBoundary(parentNode(container), offsetFromParent);\n};\n\n// ranges from selection tend to end up inside elements\n// e.g. selecting line 2 might look like\n// <div><div>line 1 |sel-start|</div></div>\n// <div><div>line 2 |sel-end|</div></div>\n// but what we really want is more like\n// <div><div>line 1 </div></div>\n// |sel-start|<div><div>line 2 </div></div>|sel-end|\n// this function adjusts the boundaries of range by climbing up the DOM tree\n// when the range boundary is at the start or end edge of an element\nconst normalizeRange = (range: Range) => {\n    const [startContainer, startOffset] = normalizeNodeBoundary(\n        range.startContainer,\n        range.startOffset\n    );\n    const [endContainer, endOffset] = normalizeNodeBoundary(\n        range.endContainer,\n        range.endOffset\n    );\n\n    range.setStart(startContainer, startOffset);\n    range.setEnd(endContainer, endOffset);\n};\n\nconst getPositionForTextNode = (\n    container: Node,\n    offset: number\n): RangePosition => {\n    if (offset === 0) {\n        return RangePosition.START;\n    }\n\n    const nodeValue: string | null = container.nodeValue;\n    if (nodeValue === null) {\n        throw new Error(\"Text node has no value?\");\n    }\n\n    if (offset === nodeValue.length) {\n        return RangePosition.END;\n    }\n\n    return RangePosition.MIDDLE;\n};\n\nconst getPositionForElementNode = (\n    container: Node,\n    offset: number\n): RangePosition => {\n    const childNodes = container.childNodes;\n    if (offset === 0) {\n        return RangePosition.START;\n    }\n\n    if (offset === childNodes.length) {\n        return RangePosition.END;\n    }\n\n    return RangePosition.MIDDLE;\n};\n\nconst getPositionForNode = (container: Node, offset: number): RangePosition => {\n    switch (container.nodeType) {\n        case Node.TEXT_NODE: {\n            return getPositionForTextNode(container, offset);\n        }\n        case Node.ELEMENT_NODE: {\n            return getPositionForElementNode(container, offset);\n        }\n\n        default: {\n            throw new Error(\"Crash for now \" + container.nodeType);\n        }\n    }\n};\n\nconst findOffsetForNode = (node: Node): number => {\n    if (node.parentNode === null) {\n        throw new Error(\"wtf\");\n    }\n\n    const nodes = node.parentNode.childNodes;\n\n    for (let i = 0; i < nodes.length; i++) {\n        if (nodes.item(i) === node) {\n            return i;\n        }\n    }\n\n    throw new Error(\"Child node doesn't exist in parent???\");\n};\n\n// selection can be represented as many discontiguous ranges, but that doesn't help us\n// figure out whether a line is under selection or not.\n// this utility function figures out a range that's the superset of all ranges in the selection\n// with the start point as the earliest start point, and the end point as the latest end point\nconst getWideSelectionBoundary = (selection: Selection): Range => {\n    const wideRange = document.createRange();\n    const firstRange = selection.getRangeAt(0);\n    wideRange.setStart(firstRange.startContainer, firstRange.startOffset);\n    wideRange.setEnd(firstRange.endContainer, firstRange.endOffset);\n    // selecting in the app can result in many dis\n\n    for (let rangeIndex = 1; rangeIndex < selection.rangeCount; rangeIndex++) {\n        const range = selection.getRangeAt(rangeIndex);\n\n        if (\n            range.compareBoundaryPoints(Range.START_TO_START, wideRange) === -1\n        ) {\n            wideRange.setStart(range.startContainer, range.startOffset);\n        }\n\n        if (range.compareBoundaryPoints(Range.END_TO_END, wideRange) === 1) {\n            wideRange.setEnd(range.endContainer, range.endOffset);\n        }\n    }\n\n    return wideRange;\n};\n\nexport const getSelectedLineIDs = (): string[] => {\n    const selection: Selection | null = window.getSelection();\n    if (selection === null || selection.rangeCount === 0) {\n        return [];\n    }\n\n    const range = getWideSelectionBoundary(selection);\n    normalizeRange(range);\n\n    const lineElements = document.querySelectorAll(\"[data-lineid]\");\n    const lineIDs: string[] = [];\n\n    for (\n        let lineElementIndex = 0;\n        lineElementIndex < lineElements.length;\n        lineElementIndex++\n    ) {\n        const lineElement = lineElements.item(lineElementIndex);\n\n        if (!range.intersectsNode(lineElement)) {\n            continue;\n        }\n\n        const lineID: string | null = lineElement.getAttribute(\"data-lineid\");\n        if (lineID === null) {\n            throw new Error(\n                \"Unexpected - line element should have line ID because that's how it was selected\"\n            );\n        }\n\n        lineIDs.push(lineID);\n    }\n\n    return lineIDs;\n};\n","import { Either, left, right } from \"fp-ts/lib/Either\";\nimport ky from \"ky\";\nimport { ChordSong } from \"../ChordModel/ChordSong\";\nimport { TrackList } from \"../ChordModel/tracks/TrackList\";\n\nconst backendHost = ((): string => {\n    const localURL = \"http://localhost:5000\";\n\n    if (\n        process.env.NODE_ENV === \"development\" ||\n        process.env.NODE_ENV === \"test\"\n    ) {\n        return localURL;\n    }\n\n    const backendURL: string | undefined = process.env.REACT_APP_BACKEND_URL;\n    if (backendURL === undefined) {\n        console.error(\"Production build doesn't have backend URL set!\");\n        return localURL;\n    }\n\n    return backendURL;\n})();\n\nexport const login = async (\n    authToken: string\n): Promise<Either<Error, unknown>> => {\n    let parsed: unknown;\n\n    try {\n        parsed = await ky\n            .post(`${backendHost}/login`, {\n                headers: {\n                    Authorization: \"Bearer \" + authToken,\n                },\n            })\n            .json();\n    } catch (e) {\n        return left(e);\n    }\n\n    return right(parsed);\n};\n\nexport const getSong = async (\n    songID: string\n): Promise<Either<Error, unknown>> => {\n    let parsed: unknown;\n\n    try {\n        parsed = await ky.get(`${backendHost}/songs/${songID}`).json();\n    } catch (e) {\n        return left(e);\n    }\n\n    return right(parsed);\n};\n\nexport const getTrackList = async (\n    songID: string\n): Promise<Either<Error, unknown>> => {\n    let parsed: unknown;\n\n    try {\n        parsed = await ky\n            .get(`${backendHost}/songs/${songID}/tracklist`, { timeout: false })\n            .json();\n    } catch (e) {\n        return left(e);\n    }\n\n    return right(parsed);\n};\n\nexport const getSongsForUser = async (\n    userID: string,\n    authToken: string\n): Promise<Either<Error, unknown>> => {\n    let parsed: unknown;\n\n    try {\n        parsed = await ky\n            .get(`${backendHost}/users/${userID}/songs`, {\n                headers: {\n                    Authorization: \"Bearer \" + authToken,\n                },\n            })\n            .json();\n    } catch (e) {\n        return left(e);\n    }\n\n    return right(parsed);\n};\n\nexport const createSong = async (\n    song: ChordSong,\n    authToken: string\n): Promise<Either<Error, unknown>> => {\n    let parsed: unknown;\n\n    try {\n        parsed = await ky\n            .post(`${backendHost}/songs`, {\n                json: song,\n                headers: {\n                    Authorization: \"Bearer \" + authToken,\n                },\n            })\n            .json();\n    } catch (e) {\n        return left(e);\n    }\n\n    return right(parsed);\n};\n\nexport const updateSong = async (\n    song: ChordSong,\n    authToken: string\n): Promise<Either<Error, unknown>> => {\n    if (song.isUnsaved()) {\n        return left(\n            new Error(\"A song that hasn't been created can't be updated\")\n        );\n    }\n\n    let parsed: unknown;\n\n    try {\n        parsed = await ky\n            .put(`${backendHost}/songs/${song.id}`, {\n                json: song,\n                headers: {\n                    Authorization: \"Bearer \" + authToken,\n                },\n            })\n            .json();\n    } catch (e) {\n        return left(e);\n    }\n\n    return right(parsed);\n};\n\nexport const deleteSong = async (\n    song: ChordSong,\n    authToken: string\n): Promise<Either<Error, true>> => {\n    if (song.isUnsaved()) {\n        return left(\n            new Error(\"A song that hasn't been created can't be deleted\")\n        );\n    }\n\n    try {\n        await ky.delete(`${backendHost}/songs/${song.id}`, {\n            headers: {\n                Authorization: \"Bearer \" + authToken,\n            },\n        });\n    } catch (e) {\n        return left(e);\n    }\n\n    return right(true);\n};\n\nexport const updateTrackList = async (\n    tracklist: TrackList,\n    authToken: string\n): Promise<Either<Error, unknown>> => {\n    if (tracklist.song_id === \"\") {\n        return left(new Error(\"No song ID on the tracklist\"));\n    }\n\n    let parsed: unknown;\n\n    try {\n        parsed = await ky\n            .put(`${backendHost}/songs/${tracklist.song_id}/tracklist`, {\n                json: tracklist,\n                headers: {\n                    Authorization: \"Bearer \" + authToken,\n                },\n            })\n            .json();\n    } catch (e) {\n        return left(e);\n    }\n\n    return right(parsed);\n};\n","import { useSnackbar } from \"notistack\";\nimport ky from \"ky\";\n\ninterface BackendError {\n    code: string;\n    msg: string;\n}\n\nconst validateError = (json: unknown): json is BackendError => {\n    if (typeof json !== \"object\") {\n        return false;\n    }\n\n    if (json === null || json === undefined) {\n        return false;\n    }\n\n    return \"code\" in json && \"msg\" in json;\n};\n\nexport const useErrorMessage = () => {\n    const { enqueueSnackbar } = useSnackbar();\n\n    const showErrorMsg = (msg: string) => {\n        enqueueSnackbar(msg, { variant: \"error\" });\n    };\n\n    return async (unknownError: any) => {\n        const showGenericErrorMsg = () => {\n            console.error(unknownError);\n\n            showErrorMsg(\n                \"An unknown error has occurred - please check the console for more details\"\n            );\n        };\n\n        if (!(unknownError instanceof ky.HTTPError)) {\n            showGenericErrorMsg();\n            return;\n        }\n\n        // cloning the response so that it can continue to be reused\n        const responseClone = unknownError.response.clone();\n        const error: unknown = await responseClone.json();\n\n        if (!validateError(error)) {\n            showGenericErrorMsg();\n            return;\n        }\n\n        console.error(error.msg);\n\n        switch (error.code) {\n            case \"create_song_exists\": {\n                showErrorMsg(\n                    \"Save failed: The song already exists and can't be created again!\"\n                );\n                break;\n            }\n\n            case \"update_song_overwrite\": {\n                showErrorMsg(\n                    \"Autosave failed: This song has been updated recently and saving now will clobber previously saved results. Please try to load the song in another tab and copy your work over to save it\"\n                );\n                break;\n            }\n            case \"song_not_found\": {\n                showErrorMsg(\"Not found: A song of this ID cannot be found\");\n                break;\n            }\n            case \"failed_google_verification\": {\n                showErrorMsg(\n                    \"Google verification failed: Please try to refresh and login again\"\n                );\n                break;\n            }\n\n            case \"get_songs_for_user_not_allowed\": {\n                showErrorMsg(\n                    \"Loading songs failed: You don't have permission to see this user's songs\"\n                );\n                break;\n            }\n\n            case \"update_song_owner_not_allowed\": {\n                showErrorMsg(\n                    \"Autosave failed: You don't have permission to update this user's songs\"\n                );\n                break;\n            }\n\n            case \"update_song_wrong_id\": {\n                showErrorMsg(\n                    \"Autosave failed: There is a mismatch of song IDs. Please refresh and try again\"\n                );\n                break;\n            }\n\n            case \"datastore_error\": {\n                showErrorMsg(\n                    \"The data operation was not successful - please check the console for more details\"\n                );\n                break;\n            }\n\n            default: {\n                showErrorMsg(\n                    \"An unknown error has occurred - please check the console for more details\"\n                );\n                break;\n            }\n        }\n    };\n};\n","import { makeStyles } from \"@material-ui/styles\";\nimport React, { useEffect } from \"react\";\nimport ErrorImg from \"../../assets/img/error.jpeg\";\nimport { useErrorMessage } from \"../../common/backend/errors\";\n\nconst useErrorStyles = makeStyles({\n    root: {\n        objectFit: \"contain\",\n    },\n});\n\ninterface ErrorImageProps {\n    error: unknown;\n}\n\nconst ErrorImage: React.FC<ErrorImageProps> = (\n    props: ErrorImageProps\n): JSX.Element => {\n    const errorStyles = useErrorStyles();\n    const showError = useErrorMessage();\n\n    useEffect(() => {\n        showError(props.error);\n    }, [props, showError]);\n\n    return (\n        <img\n            src={ErrorImg}\n            className={errorStyles.root}\n            alt=\"Song Loading Error\"\n        />\n    );\n};\n\nexport default ErrorImage;\n","import React from \"react\";\n\ninterface LoginResponse {\n    id: string;\n    name: string | null;\n}\n\nexport class User {\n    private googleUser: gapi.auth2.CurrentUser;\n    name: string | null;\n    userID: string;\n    authToken: string;\n\n    constructor(\n        googleUser: gapi.auth2.CurrentUser,\n        userID: string,\n        name: string | null\n    ) {\n        this.googleUser = googleUser;\n        this.userID = userID;\n        this.name = name;\n\n        this.authToken = googleUser.get().getAuthResponse().id_token;\n\n        this.googleUser.listen(() => {\n            this.refreshAuthToken.call(this);\n        });\n    }\n\n    private refreshAuthToken() {\n        this.authToken = this.getNewAuthToken();\n    }\n\n    private getNewAuthToken(): string {\n        const user = this.googleUser.get();\n        return user.getAuthResponse().id_token;\n    }\n}\n\nexport const UserContext = React.createContext<User | null>(null);\n\nexport const deserializeUser = (\n    response: unknown,\n    googleUser: gapi.auth2.CurrentUser\n): User | null => {\n    if (!validateResponse(response)) {\n        return null;\n    }\n\n    return new User(googleUser, response.id, response.name);\n};\n\nconst validateResponse = (response: unknown): response is LoginResponse => {\n    if (typeof response !== \"object\") {\n        return false;\n    }\n\n    if (response === null || response === undefined) {\n        return false;\n    }\n\n    return \"id\" in response && \"name\" in response;\n};\n","import {\n    Dialog,\n    DialogContent,\n    DialogTitle,\n    Divider,\n    LinearProgress,\n    List,\n    ListItem,\n    ListItemText,\n    Typography,\n} from \"@material-ui/core\";\nimport { isLeft } from \"fp-ts/lib/Either\";\nimport React, { useState } from \"react\";\nimport { useHistory } from \"react-router-dom\";\nimport { getSongsForUser } from \"../common/backend/requests\";\nimport { SongSummary } from \"../common/ChordModel/ChordSong\";\nimport { FetchState } from \"../common/fetch\";\nimport { songPath } from \"../common/paths\";\nimport { PlainFn } from \"../common/PlainFn\";\nimport ErrorImage from \"./display/ErrorImage\";\nimport { UserContext } from \"./user/userContext\";\n\ninterface LoadSongsDialogProps {\n    open: boolean;\n    onClose?: PlainFn;\n}\n\nconst LoadSongDialog: React.FC<LoadSongsDialogProps> = (\n    props: LoadSongsDialogProps\n): JSX.Element => {\n    const [fetchState, setFetchState] = useState<FetchState<SongSummary[]>>({\n        state: \"not-started\",\n    });\n    const user = React.useContext(UserContext);\n    const history = useHistory();\n\n    const wrapInDialog = (contents: React.ReactNode): React.ReactElement => {\n        return (\n            <Dialog open={props.open} onClose={props.onClose} fullWidth>\n                <DialogTitle>Load Songs</DialogTitle>\n                <DialogContent>{contents}</DialogContent>\n            </Dialog>\n        );\n    };\n\n    if (user === null) {\n        return wrapInDialog(\n            <Typography>\n                You must be logged in to load a song graahhhhh *foams at mouth*\n            </Typography>\n        );\n    }\n\n    const summarySortFn = (a: SongSummary, b: SongSummary): number => {\n        if (a.lastSavedAt === b.lastSavedAt) {\n            return 0;\n        }\n\n        // sort in reverse order - most recently saved should come first\n        if (a.lastSavedAt === null) {\n            return 1;\n        }\n\n        if (b.lastSavedAt === null) {\n            return -1;\n        }\n\n        return a.lastSavedAt < b.lastSavedAt ? 1 : -1;\n    };\n\n    const loadSummaries = async () => {\n        const result = await getSongsForUser(user.userID, user.authToken);\n        if (isLeft(result)) {\n            setFetchState({ state: \"error\", error: result.left });\n            return;\n        }\n\n        const summariesResult = SongSummary.fromJSONList(result.right);\n        if (isLeft(summariesResult)) {\n            setFetchState({ state: \"error\", error: summariesResult.left });\n            return;\n        }\n\n        const summaries = summariesResult.right;\n        summaries.sort(summarySortFn);\n\n        setFetchState({ state: \"loaded\", item: summaries });\n    };\n\n    const summaryListItem = (summary: SongSummary): React.ReactElement => {\n        const songLink = songPath.withID(summary.id);\n\n        const navigateToSong = () => {\n            history.push(songLink.URL());\n            props.onClose?.();\n        };\n\n        const detailElement = (\n            detail: string,\n            label: string\n        ): React.ReactNode => {\n            if (detail === \"\") {\n                return null;\n            }\n\n            return (\n                <Typography\n                    key={`${summary.id}-${label}`}\n                    display=\"block\"\n                    variant=\"caption\"\n                >\n                    {`${label}: ${detail}`}\n                </Typography>\n            );\n        };\n\n        const details = (\n            <>\n                {detailElement(summary.metadata.performedBy, \"Performed by\")}\n                {detailElement(summary.metadata.composedBy, \"Composed by\")}\n                {summary.lastSavedAt !== null && (\n                    <Typography\n                        key={`${summary.id}-lastSavedAt`}\n                        display=\"block\"\n                        variant=\"caption\"\n                    >\n                        {`Last Saved At: ${summary.lastSavedAt.toLocaleString()}`}\n                    </Typography>\n                )}\n            </>\n        );\n\n        const title =\n            summary.metadata.title !== \"\"\n                ? summary.metadata.title\n                : \"(Untitled)\";\n\n        return (\n            <React.Fragment key={summary.id}>\n                <ListItem key={summary.id} button onClick={navigateToSong}>\n                    <ListItemText\n                        primary={title}\n                        primaryTypographyProps={{\n                            key: `${summary.id}-primary`,\n                        }}\n                        secondary={details}\n                        secondaryTypographyProps={{\n                            key: `${summary.id}-seccondary`,\n                        }}\n                    />\n                </ListItem>\n                <Divider key={`${summary.id}-divider`} />\n            </React.Fragment>\n        );\n    };\n\n    const summaryCards = (summaries: SongSummary[]): React.ReactElement => {\n        if (summaries.length === 0) {\n            return (\n                <Typography>\n                    You don't have any songs saved. GET TO IT\n                </Typography>\n            );\n        }\n\n        return <List>{summaries.map(summaryListItem)}</List>;\n    };\n\n    switch (fetchState.state) {\n        case \"not-started\": {\n            setFetchState({ state: \"loading\" });\n            loadSummaries();\n            return <></>;\n        }\n        case \"error\": {\n            return wrapInDialog(<ErrorImage error={fetchState.error} />);\n        }\n        case \"loading\": {\n            return wrapInDialog(<LinearProgress />);\n        }\n        case \"loaded\": {\n            return wrapInDialog(summaryCards(fetchState.item));\n        }\n    }\n};\n\nexport default LoadSongDialog;\n","import { Grid, Paper, Theme, Typography } from \"@material-ui/core\";\nimport { withStyles } from \"@material-ui/styles\";\nimport React from \"react\";\n\nconst RootPaper = withStyles((theme: Theme) => ({\n    root: {\n        margin: theme.spacing(5),\n        padding: theme.spacing(5),\n        minHeight: theme.spacing(46),\n        minWidth: theme.spacing(92),\n        position: \"relative\",\n    },\n}))(Paper);\n\nconst ErrorPage: React.FC<{}> = (): JSX.Element => {\n    return (\n        <Grid container data-testid=\"Tutorial\">\n            <Grid item xs={3}></Grid>\n            <Grid item xs={6}>\n                <RootPaper>\n                    <Typography>An Error Occurred Oh No</Typography>\n                </RootPaper>\n            </Grid>\n            <Grid item xs={3}></Grid>\n        </Grid>\n    );\n};\n\nexport default ErrorPage;\n","import { Theme, Typography } from \"@material-ui/core\";\nimport { withStyles } from \"@material-ui/styles\";\nimport React from \"react\";\nimport { inflatingWhitespace } from \"../../common/Whitespace\";\nexport const LyricsTypography = withStyles((theme: Theme) => ({\n    root: {\n        color: theme.palette.secondary.light,\n    },\n}))(Typography);\n\nexport const ChordTypography = withStyles((theme: Theme) => ({\n    root: {\n        color: theme.palette.primary.main,\n    },\n}))(Typography);\n\nexport const LineBreak = () => {\n    return <Typography>{inflatingWhitespace()}</Typography>;\n};\n","import React from \"react\";\nimport { ChordSong } from \"../common/ChordModel/ChordSong\";\nimport { ChordSongAction, useChordSongReducer } from \"./reducer/reducer\";\nimport { useCloud } from \"./useCloud\";\n\ninterface OriginalComponentProps {\n    song: ChordSong;\n    songDispatch: React.Dispatch<ChordSongAction>;\n}\n\nexport const withSongContext = <P extends OriginalComponentProps>(\n    OriginalComponent: React.FC<P>\n): React.FC<Omit<P, \"songDispatch\">> => {\n    return (props: Omit<P, \"songDispatch\">): JSX.Element => {\n        const [song, songDispatch] = useChordSongReducer(props.song);\n\n        const { song: throwawaySong, ...propsWithoutInitialSong } = props;\n\n        // https://github.com/microsoft/TypeScript/issues/35858\n        const originalComponentProps = {\n            ...propsWithoutInitialSong,\n            song: song,\n            songDispatch: songDispatch,\n        } as P;\n\n        return <OriginalComponent {...originalComponentProps} />;\n    };\n};\n\nexport const withCloudSaveSongContext = <P extends OriginalComponentProps>(\n    OriginalComponent: React.FC<P>\n): React.FC<Omit<P, \"songDispatch\">> => {\n    return (props: Omit<P, \"songDispatch\">): JSX.Element => {\n        const [onSongChange, useSave] = useCloud();\n        const [song, songDispatch] = useChordSongReducer(\n            props.song,\n            onSongChange\n        );\n        const unsavedPrompt = useSave(song, songDispatch);\n\n        const { song: throwawaySong, ...propsWithoutInitialSong } = props;\n\n        // https://github.com/microsoft/TypeScript/issues/35858\n        const originalComponentProps = {\n            ...propsWithoutInitialSong,\n            song: song,\n            songDispatch: songDispatch,\n        } as P;\n\n        return (\n            <>\n                {unsavedPrompt}\n                <OriginalComponent {...originalComponentProps} />\n            </>\n        );\n    };\n};\n","import { ChordLine } from \"../../common/ChordModel/ChordLine\";\nimport { IDable } from \"../../common/ChordModel/Collection\";\nimport { ChordSongAction } from \"../reducer/reducer\";\nimport { getSelectedLineIDs } from \"./LineSelection\";\n\nexport const handleBatchLineDelete = (\n    event: KeyboardEvent,\n    songDispatch: React.Dispatch<ChordSongAction>\n): boolean => {\n    if (event.key !== \"Backspace\") {\n        return false;\n    }\n\n    const lineIDStrs: string[] = getSelectedLineIDs();\n    if (lineIDStrs.length === 0) {\n        return false;\n    }\n\n    const lineIDs = lineIDStrs.map(\n        (id: string): IDable<ChordLine> => ({\n            type: \"ChordLine\",\n            id: id,\n        })\n    );\n\n    songDispatch({\n        type: \"batch-remove-lines\",\n        lineIDs: lineIDs,\n    });\n\n    return true;\n};\n","import { Either, isLeft, left, parseJSON, right } from \"fp-ts/lib/Either\";\nimport { List } from \"immutable\";\nimport * as iots from \"io-ts\";\nimport { useSnackbar } from \"notistack\";\nimport {\n    ChordLine,\n    ChordLineValidatedFields,\n    ChordLineValidator,\n} from \"../../common/ChordModel/ChordLine\";\nimport { ChordSong } from \"../../common/ChordModel/ChordSong\";\nimport { getSelectedLineIDs } from \"./LineSelection\";\n\nconst CopiedChordLinesValidator = iots.type({\n    copiedChordLines: iots.array(ChordLineValidator),\n});\n\ninterface CopiedChordLines {\n    copiedChordLines: ChordLine[];\n}\n\nexport const deserializeCopiedChordLines = (\n    jsonStr: string\n): Either<Error, ChordLine[]> | null => {\n    const result: Either<Error, unknown> = parseJSON(\n        jsonStr,\n        () => new Error(\"Failed to parse json string\")\n    );\n\n    if (isLeft(result)) {\n        return result;\n    }\n\n    const jsonObj = result.right as any;\n\n    // if the JSON doesn't contain this field, then it's a JSON copy payload\n    // from somewhere else - don't handle it\n    if (jsonObj.copiedChordLines === undefined) {\n        return null;\n    }\n\n    const validationResult = CopiedChordLinesValidator.decode(jsonObj);\n\n    if (isLeft(validationResult)) {\n        return left(new Error(\"Invalid Chord Lines payload\"));\n    }\n\n    const validatedChordLineObjects = validationResult.right.copiedChordLines;\n    const chordLines: ChordLine[] = validatedChordLineObjects.map(\n        (obj: ChordLineValidatedFields) => {\n            return ChordLine.fromValidatedFields(obj);\n        }\n    );\n\n    return right(chordLines);\n};\n\nconst serializeCopiedChordLines = (chordLines: List<ChordLine>): string => {\n    const copyableLines: List<ChordLine> = chordLines.map((line: ChordLine) =>\n        line.forCopying()\n    );\n    const payload: CopiedChordLines = {\n        copiedChordLines: copyableLines.toArray(),\n    };\n\n    return JSON.stringify(payload);\n};\n\nexport const useLineCopyHandler = (song: ChordSong) => {\n    const { enqueueSnackbar } = useSnackbar();\n\n    return (event: React.ClipboardEvent<HTMLDivElement>): boolean => {\n        const lineIDs: string[] = getSelectedLineIDs();\n        const lines: List<ChordLine> = song.chordLines.list.filter(\n            (line: ChordLine): boolean => {\n                return lineIDs.includes(line.id);\n            }\n        );\n\n        if (lines.size === 0) {\n            return false;\n        }\n\n        const serialized = serializeCopiedChordLines(lines);\n        event.clipboardData.setData(\"application/json\", serialized);\n\n        event.preventDefault();\n\n        let copyMsg: string;\n        if (lines.size === 1) {\n            copyMsg = `1 line copied to your clipboard`;\n        } else {\n            copyMsg = `${lines.size} lines copied to your clipboard`;\n        }\n\n        enqueueSnackbar(copyMsg, { variant: \"info\" });\n        return true;\n    };\n};\n","import React, { useState, useContext } from \"react\";\nimport { noopFn, PlainFn } from \"../../common/PlainFn\";\n\nexport interface InteractionSetter {\n    startInteraction: PlainFn;\n    endInteraction: PlainFn;\n}\n\nconst defaultSetter: InteractionSetter = {\n    startInteraction: noopFn,\n    endInteraction: noopFn,\n};\n\nexport const InteractionContext =\n    React.createContext<InteractionSetter>(defaultSetter);\n\ninterface EditingState {\n    editing: boolean;\n    startEdit: PlainFn;\n    finishEdit: PlainFn;\n}\n\nexport const useEditingState = (): EditingState => {\n    const [editing, setEditing] = useState(false);\n    const { startInteraction, endInteraction } = useContext(InteractionContext);\n\n    const startEdit = () => {\n        setEditing(true);\n        startInteraction();\n    };\n\n    const finishEdit = () => {\n        setEditing(false);\n        endInteraction();\n    };\n\n    return {\n        editing: editing,\n        startEdit: startEdit,\n        finishEdit: finishEdit,\n    };\n};\n","import { Theme } from \"@material-ui/core\";\nimport { CSSProperties } from \"@material-ui/styles\";\n\nexport const spaceClassName = \"LyricTokenSpace\";\nexport const wordClassName = \"LyricTokenWord\";\nexport const firstTokenClassName = \"FirstLyricToken\";\n\nexport const chordTargetClassName = \"ChordTarget\";\nexport const chordSymbolClassName = \"ChordSymbol\";\n\nconst highlightedSpaceStyle = (theme: Theme): CSSProperties => ({\n    backgroundColor: theme.palette.primary.main,\n});\n\nconst highlightedWordStyle = (theme: Theme): CSSProperties => ({\n    color: theme.palette.primary.main,\n});\n\nconst outlineStyle = (theme: Theme): CSSProperties => ({\n    borderStyle: \"solid\",\n    borderColor: theme.palette.primary.main,\n    borderRadius: \"0.3em\",\n    borderWidth: \"0.075em\",\n});\n\nexport interface HighlightChordLyricStyleOptions {\n    outline?: (theme: Theme) => CSSProperties;\n    customLyricClassSelector?: string;\n    customChordTargetClassSelector?: string;\n    customChordSymbolClassSelector?: string;\n}\n\nconst withCustomLyricSelector = (\n    selector: string,\n    options?: HighlightChordLyricStyleOptions\n): string => {\n    if (options?.customLyricClassSelector === undefined) {\n        return selector;\n    }\n\n    return `${selector}.${options.customLyricClassSelector}`;\n};\n\nconst withCustomChordTargetSelector = (\n    selector: string,\n    options?: HighlightChordLyricStyleOptions\n): string => {\n    if (options?.customChordTargetClassSelector === undefined) {\n        return selector;\n    }\n\n    return `${selector}.${options.customChordTargetClassSelector}`;\n};\n\nconst withCustomChordSymbolSelector = (\n    selector: string,\n    options?: HighlightChordLyricStyleOptions\n): string => {\n    if (options?.customChordSymbolClassSelector === undefined) {\n        return selector;\n    }\n\n    return `${selector}.${options.customChordSymbolClassSelector}`;\n};\n\nexport const dragOverChordLyricStyle = (\n    options?: HighlightChordLyricStyleOptions\n) => {\n    return (theme: Theme) => {\n        const highlightedSpace = highlightedSpaceStyle(theme);\n        const highlightedWord = highlightedWordStyle(theme);\n\n        const customOutlineStyles: CSSProperties | undefined =\n            options?.outline !== undefined ? options.outline(theme) : undefined;\n\n        const outline = {\n            ...outlineStyle(theme),\n            ...customOutlineStyles,\n        };\n\n        const spaceClassSelector = withCustomLyricSelector(\n            `.${spaceClassName}`,\n            options\n        );\n        const wordClassSelector = withCustomLyricSelector(\n            `.${wordClassName}`,\n            options\n        );\n\n        const chordSymbolSelector = withCustomChordSymbolSelector(\n            `.${chordSymbolClassName}`,\n            options\n        );\n\n        return {\n            root: {\n                [`& ${spaceClassSelector}`]: highlightedSpace,\n                [`& ${wordClassSelector}`]: highlightedWord,\n                [`& ${chordSymbolSelector}`]: outline,\n            },\n        };\n    };\n};\n\nexport const hoverChordLyricStyle = (\n    options?: HighlightChordLyricStyleOptions\n) => {\n    return (theme: Theme) => {\n        const highlightedSpace = highlightedSpaceStyle(theme);\n        const highlightedWord = highlightedWordStyle(theme);\n\n        const customOutlineStyles: CSSProperties | undefined =\n            options?.outline !== undefined ? options.outline(theme) : undefined;\n\n        const outline = {\n            ...outlineStyle(theme),\n            ...customOutlineStyles,\n        };\n\n        const spaceClassSelector = withCustomLyricSelector(\n            `.${spaceClassName}`,\n            options\n        );\n        const wordClassSelector = withCustomLyricSelector(\n            `.${wordClassName}`,\n            options\n        );\n        const chordTargetSelector = withCustomChordTargetSelector(\n            `.${chordTargetClassName}`,\n            options\n        );\n        const chordSymbolSelector = withCustomChordSymbolSelector(\n            `.${chordSymbolClassName}`,\n            options\n        );\n\n        return {\n            root: {\n                [`& ${chordTargetSelector}:hover ~ ${spaceClassSelector}`]:\n                    highlightedSpace,\n                [`& ${chordTargetSelector}:hover ~ * ${spaceClassSelector}`]:\n                    highlightedSpace,\n\n                [`& ${chordTargetSelector}:hover ~ ${wordClassSelector}`]:\n                    highlightedWord,\n                [`& ${chordTargetSelector}:hover ~ * ${wordClassSelector}`]:\n                    highlightedWord,\n\n                [`& ${chordTargetSelector}${chordSymbolSelector}:hover`]:\n                    outline,\n                [`& ${chordTargetSelector}:hover ${chordSymbolSelector}`]:\n                    outline,\n            },\n        };\n    };\n};\n","import { List } from \"immutable\";\nimport React from \"react\";\nimport { Lyric } from \"../../common/ChordModel/Lyric\";\nimport Tab, {\n    findTabType,\n    isValidTabValue,\n    lyricTabTypeOfDOMNode,\n    SizedTab,\n} from \"./Tab\";\n\nconst deserializeLyricStr = (\n    lyrics: string,\n    tokenIndex: number,\n    edit: boolean\n): React.ReactElement | string => {\n    if (isValidTabValue(\"serializedStr\", lyrics)) {\n        const tabType = findTabType(\"serializedStr\", lyrics);\n        return <Tab key={tokenIndex} type={tabType.sizedTab} edit={edit} />;\n    }\n\n    return lyrics;\n};\n\nexport const deserializeLyrics = (\n    lyric: Lyric,\n    edit: boolean\n): (React.ReactElement | string)[] => {\n    const nodes: (React.ReactElement | string)[] = [];\n    const tokens: List<Lyric> = lyric.tokenize();\n\n    for (let i = 0; i < tokens.size; i++) {\n        const token = tokens.get(i);\n        if (token === undefined) {\n            throw new Error(\"Token index not found\");\n        }\n        const node: React.ReactElement | string = token.get((lyrics: string) =>\n            deserializeLyricStr(lyrics, i, edit)\n        );\n\n        // merge strings where possible\n        if (\n            typeof node === \"string\" &&\n            nodes.length > 0 &&\n            typeof nodes[nodes.length - 1] === \"string\"\n        ) {\n            nodes[nodes.length - 1] += node;\n        } else {\n            nodes.push(node);\n        }\n    }\n\n    return nodes;\n};\n\nexport const serializeLyrics = (childNodes: NodeListOf<ChildNode>): Lyric => {\n    let serializedLyrics: string = \"\";\n    childNodes.forEach((childNode: ChildNode) => {\n        const sizedTab: SizedTab | null = lyricTabTypeOfDOMNode(childNode);\n\n        if (sizedTab !== null) {\n            const tabType = findTabType(\"sizedTab\", sizedTab);\n            serializedLyrics += tabType.serializedStr;\n        } else {\n            serializedLyrics += childNode.textContent;\n        }\n    });\n\n    return new Lyric(serializedLyrics);\n};\n","import { createStyles, Typography, withStyles } from \"@material-ui/core\";\nimport clsx from \"clsx\";\nimport React from \"react\";\nimport { Lyric } from \"../../common/ChordModel/Lyric\";\nimport { DataTestID } from \"../../common/DataTestID\";\nimport {\n    spaceClassName,\n    wordClassName,\n} from \"../edit/HighlightChordLyricStyle\";\nimport { deserializeLyrics } from \"../lyrics/Serialization\";\n\nexport const lyricTypographyVariant: \"h6\" = \"h6\";\n\nexport const lyricTypographyProps = {\n    variant: lyricTypographyVariant,\n    display: \"inline\" as \"inline\",\n};\n\nexport const lyricStyle = createStyles({\n    root: {\n        whiteSpace: \"pre\",\n        wordSpacing: \".15em\",\n        display: \"inline-block\",\n    },\n});\n\nexport const LyricTypography = withStyles(lyricStyle)(Typography);\n\ninterface LyricTypographyProps extends DataTestID {\n    children: Lyric;\n    className?: string;\n}\n\nconst LyricDisplay: React.FC<LyricTypographyProps> = (\n    props: LyricTypographyProps\n): JSX.Element => {\n    const customClassName = props.className ?? \"\";\n\n    const className = clsx({\n        [spaceClassName]: props.children.isEntirelySpace(),\n        [wordClassName]: !props.children.isEntirelySpace(),\n        [customClassName]: props.className !== undefined,\n    });\n\n    return (\n        <LyricTypography\n            {...lyricTypographyProps}\n            className={className}\n            data-testid={props[\"data-testid\"]}\n        >\n            {deserializeLyrics(props.children, false)}\n        </LyricTypography>\n    );\n};\n\nexport default LyricDisplay;\n","import { Typography } from \"@material-ui/core\";\nimport { withStyles } from \"@material-ui/styles\";\nimport React from \"react\";\nimport { inflateIfEmpty } from \"../../common/Whitespace\";\nimport { lyricTypographyVariant } from \"./Lyric\";\n\nconst ChordTypography = withStyles({\n    root: {\n        whiteSpace: \"pre\",\n        cursor: \"pointer\",\n        fontFamily: \"PoriChord\",\n        userSelect: \"all\",\n    },\n})(Typography);\n\nexport interface ChordSymbolProps {\n    children: string;\n    className?: string;\n}\n\nconst ChordSymbol: React.FC<ChordSymbolProps> = (\n    props: ChordSymbolProps\n): JSX.Element => {\n    const formattedChord = (): string => {\n        let chord = props.children;\n        if (chord.endsWith(\" \")) {\n            return chord;\n        }\n\n        chord = chord + \" \";\n\n        return inflateIfEmpty(chord);\n    };\n\n    return (\n        <ChordTypography\n            variant={lyricTypographyVariant} // keep chords and lyrics the same size\n            display=\"inline\"\n            data-testid=\"ChordSymbol\"\n            className={props.className}\n        >\n            {formattedChord()}\n        </ChordTypography>\n    );\n};\n\nexport default ChordSymbol;\n","import { ConnectDropTarget, DropTargetMonitor, useDrop } from \"react-dnd\";\nimport { ChordBlock } from \"../../../common/ChordModel/ChordBlock\";\nimport { IDable } from \"../../../common/ChordModel/Collection\";\nimport { DNDChord, DNDChordType } from \"./common\";\n\ninterface DropObject {\n    type: \"dropped-chord-result\";\n    readonly tokenIndex: number;\n    readonly blockID: IDable<ChordBlock>;\n}\n\nexport interface DropResult extends DropObject {\n    dropEffect: \"move\" | \"copy\";\n}\n\nexport const isDropResult = (\n    maybeDropResult: any\n): maybeDropResult is DropResult => {\n    if (maybeDropResult === null || maybeDropResult === undefined) {\n        return false;\n    }\n\n    if (typeof maybeDropResult !== \"object\") {\n        return false;\n    }\n\n    return maybeDropResult.type === \"dropped-chord-result\";\n};\n\ninterface DropCollector {\n    isOver: boolean;\n}\n\nexport const useChordDrop = (\n    blockID: IDable<ChordBlock>,\n    tokenIndex: number\n): [ConnectDropTarget, boolean] => {\n    const [{ isOver }, dropRef] = useDrop<DNDChord, DropObject, DropCollector>({\n        accept: DNDChordType,\n        drop: (): DropObject => {\n            return {\n                type: \"dropped-chord-result\",\n                blockID: blockID,\n                tokenIndex: tokenIndex,\n            };\n        },\n        collect: (monitor: DropTargetMonitor): DropCollector => ({\n            isOver: monitor.isOver({ shallow: true }),\n        }),\n    });\n\n    return [dropRef, isOver];\n};\n","import { ChordBlock } from \"../../../common/ChordModel/ChordBlock\";\nimport { IDable } from \"../../../common/ChordModel/Collection\";\n\nexport const DNDChordType: \"chord\" = \"chord\";\n\nexport interface DNDChord {\n    type: typeof DNDChordType;\n    sourceBlockID: IDable<ChordBlock>;\n    chord: string;\n}\n\nexport const NewDNDChord = (\n    sourceBlockID: IDable<ChordBlock>,\n    chord: string\n): DNDChord => {\n    return {\n        type: DNDChordType,\n        sourceBlockID: sourceBlockID,\n        chord: chord,\n    };\n};\n\nexport interface ClassNameable {\n    className?: string;\n}\n\nexport type DragOverHandler = (isDraggingOver: boolean) => void;\n","import { RootRef } from \"@material-ui/core\";\nimport React from \"react\";\nimport { ChordBlock } from \"../../../common/ChordModel/ChordBlock\";\nimport { IDable } from \"../../../common/ChordModel/Collection\";\nimport { ClassNameable } from \"./common\";\nimport { useChordDrop } from \"./useChordDrop\";\n\ninterface ChordlessTokenDroppableProps {\n    children: React.ReactElement<ClassNameable>;\n    hoverableClassName: string;\n    dragOverClassName: string;\n    blockID: IDable<ChordBlock>;\n    tokenIndex: number;\n}\n\nconst ChordlessTokenDroppable: React.FC<ChordlessTokenDroppableProps> = (\n    props: ChordlessTokenDroppableProps\n): JSX.Element => {\n    const [dropRef, isOver] = useChordDrop(props.blockID, props.tokenIndex);\n\n    const childClassName: string = isOver\n        ? props.dragOverClassName\n        : props.hoverableClassName;\n\n    const childrenWithClassName = React.cloneElement(props.children, {\n        className: childClassName,\n    });\n\n    return <RootRef rootRef={dropRef}>{childrenWithClassName}</RootRef>;\n};\n\nexport default ChordlessTokenDroppable;\n","import { RootRef } from \"@material-ui/core\";\nimport React, { useEffect } from \"react\";\nimport { ChordBlock } from \"../../../common/ChordModel/ChordBlock\";\nimport { IDable } from \"../../../common/ChordModel/Collection\";\nimport { useChordDrop } from \"./useChordDrop\";\n\ninterface ChordTokenDroppableProps {\n    children: React.ReactElement;\n    blockID: IDable<ChordBlock>;\n    onDragOver: (isDraggingOver: boolean) => void;\n}\n\nconst ChordTokenDroppable: React.FC<ChordTokenDroppableProps> = (\n    props: ChordTokenDroppableProps\n) => {\n    const [dropRef, isOver] = useChordDrop(props.blockID, 0);\n\n    const onDragOver = props.onDragOver;\n\n    useEffect(() => {\n        onDragOver(isOver);\n    }, [onDragOver, isOver]);\n\n    return <RootRef rootRef={dropRef}>{props.children}</RootRef>;\n};\n\nexport default ChordTokenDroppable;\n","import { RootRef } from \"@material-ui/core\";\nimport React from \"react\";\nimport { DragSourceMonitor, useDrag } from \"react-dnd\";\nimport { ChordBlock } from \"../../../common/ChordModel/ChordBlock\";\nimport { IDable } from \"../../../common/ChordModel/Collection\";\nimport ChordSymbol, { ChordSymbolProps } from \"../../display/ChordSymbol\";\nimport { DNDChord, NewDNDChord } from \"./common\";\nimport { isDropResult } from \"./useChordDrop\";\n\ninterface DraggableChordSymbolProps extends ChordSymbolProps {\n    chordBlockID: IDable<ChordBlock>;\n    onDrop: (params: {\n        chord: string;\n        sourceBlockID: IDable<ChordBlock>;\n        destinationBlockID: IDable<ChordBlock>;\n        splitIndex: number;\n        dropType: \"move\" | \"copy\";\n    }) => void;\n}\n\nconst DraggableChordSymbol: React.FC<DraggableChordSymbolProps> = (\n    props: DraggableChordSymbolProps\n): JSX.Element => {\n    const [, dragRef] = useDrag({\n        item: NewDNDChord(props.chordBlockID, props.children),\n        end: (chord: DNDChord | undefined, monitor: DragSourceMonitor) => {\n            if (chord === undefined) {\n                return;\n            }\n\n            const dropResult = monitor.getDropResult();\n\n            if (!isDropResult(dropResult)) {\n                return;\n            }\n\n            props.onDrop({\n                chord: chord.chord,\n                sourceBlockID: chord.sourceBlockID,\n                destinationBlockID: dropResult.blockID,\n                splitIndex: dropResult.tokenIndex,\n                dropType: dropResult.dropEffect,\n            });\n        },\n    });\n\n    return (\n        <RootRef rootRef={dragRef}>\n            <ChordSymbol className={props.className}>\n                {props.children}\n            </ChordSymbol>\n        </RootRef>\n    );\n};\n\nexport default DraggableChordSymbol;\n","import { List } from \"immutable\";\nimport { useCallback, useReducer } from \"react\";\nimport { DragOverHandler } from \"./common\";\n\ntype SetDragOverAction = {\n    index: number;\n    isDraggingOver: boolean;\n};\n\nconst reducer = (\n    list: List<boolean>,\n    action: SetDragOverAction\n): List<boolean> => {\n    return list.set(action.index, action.isDraggingOver);\n};\n\nexport const useChordTokenDragState = (\n    hoverableClassName: string,\n    dragOverClassName: string\n): [string, DragOverHandler, DragOverHandler] => {\n    const [dragOverState, dispatch] = useReducer(reducer, List([false, false]));\n\n    const getValue = (index: number): boolean => {\n        const value = dragOverState.get(index);\n        if (value === undefined) {\n            throw new Error(\"Out of index error\");\n        }\n\n        return value;\n    };\n\n    const handlers = [\n        useCallback(\n            (isDraggingOver: boolean) =>\n                dispatch({\n                    index: 0,\n                    isDraggingOver: isDraggingOver,\n                }),\n            [dispatch]\n        ),\n        useCallback(\n            (isDraggingOver: boolean) =>\n                dispatch({\n                    index: 1,\n                    isDraggingOver: isDraggingOver,\n                }),\n            [dispatch]\n        ),\n    ];\n\n    const isDragging = getValue(0) || getValue(1);\n    const gridClassName = isDragging ? dragOverClassName : hoverableClassName;\n\n    return [gridClassName, handlers[0], handlers[1]];\n};\n","import {\n    InputBaseComponentProps,\n    TextField,\n    TextFieldProps,\n    Theme,\n    TypographyVariant,\n    useTheme,\n} from \"@material-ui/core\";\nimport grey from \"@material-ui/core/colors/grey\";\nimport { CSSProperties, StyledComponentProps } from \"@material-ui/styles\";\nimport React from \"react\";\n\ninterface ControlledTextInputProps extends StyledComponentProps {\n    value: string;\n    onValueChange: (newValue: string) => void;\n    onFinish?: (newValue: string) => void;\n    width?: string;\n    variant: TextFieldProps[\"variant\"];\n    InputProps?: TextFieldProps[\"InputProps\"];\n    inputRef?: TextFieldProps[\"inputRef\"];\n    error?: TextFieldProps[\"error\"];\n    typographyVariant?: TypographyVariant;\n    placeholder?: string;\n    paddingSpacing?: number;\n}\n\nconst ControlledTextInput: React.FC<ControlledTextInputProps> = (\n    props: ControlledTextInputProps\n): JSX.Element => {\n    const theme: Theme = useTheme();\n\n    const updateValue = (\n        event: React.ChangeEvent<HTMLInputElement | HTMLTextAreaElement>\n    ) => {\n        props.onValueChange(event.target.value);\n    };\n\n    const keyDownHandler = (event: React.KeyboardEvent<HTMLDivElement>) => {\n        if (event.key === \"Enter\") {\n            finish(props.value);\n        }\n    };\n\n    const finish = (newValue: string) => {\n        props.onFinish?.(newValue);\n    };\n\n    const blurHandler = () => {\n        finish(props.value);\n    };\n\n    const browserInputProps = (() => {\n        let variant: CSSProperties | undefined = undefined;\n        if (props.typographyVariant !== undefined) {\n            variant = theme?.typography?.[props.typographyVariant];\n        }\n\n        const padding: number = (() => {\n            if (props.paddingSpacing === undefined) {\n                return 0;\n            }\n\n            return theme.spacing(props.paddingSpacing);\n        })();\n\n        const fontSize: string | number | undefined = variant?.fontSize;\n\n        const inputProps: InputBaseComponentProps = {\n            style: {\n                padding: padding,\n                fontSize: fontSize,\n                opacity: 1,\n                background: grey[100],\n            },\n            className: props.classes?.root,\n        };\n\n        if (props.width !== undefined && inputProps.style) {\n            inputProps.style.width = props.width;\n        }\n\n        return inputProps;\n    })();\n\n    return (\n        <TextField\n            autoFocus\n            variant={props.variant}\n            inputProps={{\n                \"data-testid\": \"InnerInput\",\n                ...browserInputProps,\n            }}\n            InputProps={props.InputProps}\n            inputRef={props.inputRef}\n            value={props.value}\n            onBlur={blurHandler}\n            onChange={updateValue}\n            onKeyDown={keyDownHandler}\n            placeholder={props.placeholder}\n            error={props.error}\n            fullWidth\n            data-testid=\"TextInput\"\n        />\n    );\n};\n\nexport default ControlledTextInput;\n","import { TextFieldProps, TypographyVariant } from \"@material-ui/core\";\nimport { StyledComponentProps } from \"@material-ui/styles\";\nimport React, { useState } from \"react\";\nimport ControlledTextInput from \"./ControlledTextInput\";\n\ninterface TextInputProps extends StyledComponentProps {\n    value: string;\n    onFinish?: (newValue: string) => void;\n    width?: string;\n    typographyVariant?: TypographyVariant;\n    variant: TextFieldProps[\"variant\"];\n}\n\nconst TextInput: React.FC<TextInputProps> = (\n    props: TextInputProps\n): JSX.Element => {\n    const [value, setValue] = useState<string>(props.value);\n\n    return (\n        <ControlledTextInput\n            classes={props.classes}\n            value={value}\n            onValueChange={setValue}\n            variant={props.variant}\n            typographyVariant={props.typographyVariant}\n            width={props.width}\n            onFinish={props.onFinish}\n        />\n    );\n};\n\nexport default TextInput;\n","import { Box, withStyles } from \"@material-ui/core\";\nimport clsx from \"clsx\";\nimport React from \"react\";\nimport LyricDisplay, {\n    LyricTypography,\n    lyricTypographyProps,\n} from \"../display/Lyric\";\nimport {\n    chordSymbolClassName,\n    chordTargetClassName,\n    firstTokenClassName,\n} from \"./HighlightChordLyricStyle\";\nimport { Lyric } from \"../../common/ChordModel/Lyric\";\nimport { deserializeLyrics } from \"../lyrics/Serialization\";\n\nconst InvisibleTypography = withStyles({\n    root: {\n        color: \"transparent\",\n        cursor: \"pointer\",\n        userSelect: \"none\",\n        position: \"absolute\",\n        left: 0,\n        top: 0,\n        transform: \"translate(0%, -110%)\",\n    },\n})(LyricTypography);\n\ninterface ChordTargetBoxProps {\n    children: React.ReactNode;\n    className?: string;\n    onClick?: (event: React.MouseEvent<HTMLSpanElement>) => void;\n}\n\nconst ChordTargetBox: React.FC<ChordTargetBoxProps> = (\n    props: ChordTargetBoxProps\n): JSX.Element => {\n    return (\n        <InvisibleTypography\n            {...lyricTypographyProps}\n            onClick={props.onClick}\n            className={props.className}\n            data-testid=\"ChordEditButton\"\n        >\n            {props.children}\n        </InvisibleTypography>\n    );\n};\n\ninterface TokenProps {\n    children: Lyric;\n    index: number;\n    className?: string;\n    invisibleTarget?: { onClick: ChordTargetBoxProps[\"onClick\"] };\n}\n\nconst Token: React.FC<TokenProps> = (props: TokenProps): JSX.Element => {\n    const invisibleTarget = (): JSX.Element | null => {\n        if (props.invisibleTarget === undefined) {\n            return null;\n        }\n\n        const content: React.ReactNode[] = deserializeLyrics(\n            props.children,\n            false\n        );\n\n        return (\n            <ChordTargetBox\n                className={clsx(chordTargetClassName, chordSymbolClassName)}\n                onClick={props.invisibleTarget.onClick}\n            >\n                {content}\n            </ChordTargetBox>\n        );\n    };\n\n    const lyricClassName: string | undefined =\n        props.index === 0 ? firstTokenClassName : undefined;\n\n    const lyricBlock = (\n        <LyricDisplay\n            className={lyricClassName}\n            data-testid={`Token-${props.index}`}\n        >\n            {props.children}\n        </LyricDisplay>\n    );\n\n    return (\n        <Box\n            className={props.className}\n            key={props.index}\n            position=\"relative\"\n            display=\"inline\"\n            data-testid={`TokenBox-${props.index}`}\n        >\n            {invisibleTarget()}\n            {lyricBlock}\n        </Box>\n    );\n};\n\nexport default Token;\n","import { Box, Grid, makeStyles, Theme } from \"@material-ui/core\";\nimport red from \"@material-ui/core/colors/red\";\nimport { withStyles } from \"@material-ui/styles\";\nimport clsx from \"clsx\";\nimport { List } from \"immutable\";\nimport React from \"react\";\nimport { ChordBlock } from \"../../common/ChordModel/ChordBlock\";\nimport { IDable } from \"../../common/ChordModel/Collection\";\nimport { Lyric } from \"../../common/ChordModel/Lyric\";\nimport { DataTestID } from \"../../common/DataTestID\";\nimport { inflatingWhitespace } from \"../../common/Whitespace\";\nimport ChordSymbol from \"../display/ChordSymbol\";\nimport { lyricTypographyVariant } from \"../display/Lyric\";\nimport { ChordSongAction } from \"../reducer/reducer\";\nimport ChordlessTokenDroppable from \"./block-dnd/ChordlessTokenDroppable\";\nimport ChordTokenDroppable from \"./block-dnd/ChordTokenDroppable\";\nimport DraggableChordSymbol from \"./block-dnd/DraggableChordSymbol\";\nimport { useChordTokenDragState } from \"./block-dnd/useChordTokenDragState\";\nimport {\n    chordTargetClassName,\n    dragOverChordLyricStyle,\n    firstTokenClassName,\n    hoverChordLyricStyle,\n} from \"./HighlightChordLyricStyle\";\nimport { useEditingState } from \"./InteractionContext\";\nimport TextInput from \"./TextInput\";\nimport Token from \"./Token\";\n\nconst chordSymbolClassName = \"ChordSymbol\";\n\nconst blockChordSymbolClassName = \"BlockChordSymbol\";\nconst blockChordTargetClassName = \"BlockChordTarget\";\n\nconst ChordInput = withStyles((theme: Theme) => ({\n    root: {\n        fontFamily: \"PoriChord\",\n        borderBottom: \"solid\",\n        borderBottomColor: theme.palette.primary.main,\n        borderBottomWidth: \"2px\",\n        width: \"4em\",\n    },\n}))(TextInput);\n\nconst useFirstTokenStyle = {\n    dragOver: makeStyles(\n        dragOverChordLyricStyle({\n            outline: (theme: Theme) => ({\n                borderColor: red[300],\n                color: red[300],\n            }),\n            customLyricClassSelector: firstTokenClassName,\n            customChordSymbolClassSelector: blockChordSymbolClassName,\n            customChordTargetClassSelector: blockChordTargetClassName,\n        })\n    ),\n    hoverable: makeStyles(\n        hoverChordLyricStyle({\n            outline: (theme: Theme) => ({\n                color: theme.palette.primary.dark,\n            }),\n            customLyricClassSelector: firstTokenClassName,\n            customChordSymbolClassSelector: blockChordSymbolClassName,\n            customChordTargetClassSelector: blockChordTargetClassName,\n        })\n    ),\n};\n\nconst useNormalTokenStyle = {\n    dragOver: makeStyles(dragOverChordLyricStyle()),\n    hoverable: makeStyles(hoverChordLyricStyle()),\n};\n\nexport interface BlockProps extends DataTestID {\n    chordBlock: ChordBlock;\n    songDispatch: React.Dispatch<ChordSongAction>;\n\n    onChordChange: (id: IDable<ChordBlock>, newChord: string) => void;\n    onBlockSplit: (id: IDable<ChordBlock>, splitIndex: number) => void;\n}\n\nconst Block: React.FC<BlockProps> = (props: BlockProps): JSX.Element => {\n    const chordTokenStyle = {\n        hoverable: useFirstTokenStyle.hoverable(),\n        dragOver: useFirstTokenStyle.dragOver(),\n    };\n\n    const chordlessTokenStyle = {\n        hoverable: useNormalTokenStyle.hoverable(),\n        dragOver: useNormalTokenStyle.dragOver(),\n    };\n    const { editing, startEdit, finishEdit } = useEditingState();\n\n    const [gridClassName, onChordDragOver, onLyricDragOver] =\n        useChordTokenDragState(\n            chordTokenStyle.hoverable.root,\n            chordTokenStyle.dragOver.root\n        );\n\n    let lyricTokens: List<Lyric> = props.chordBlock.lyricTokens;\n\n    if (lyricTokens.size === 0) {\n        const whitespaceLyric = new Lyric(inflatingWhitespace());\n        lyricTokens = List([whitespaceLyric]);\n    }\n\n    const clickHandler: (\n        tokenIndex: number\n    ) => (event: React.MouseEvent<HTMLSpanElement>) => void = (\n        tokenIndex: number\n    ) => {\n        return (event: React.MouseEvent<HTMLSpanElement>) => {\n            // block splitting happens after the first token\n            // as first token is already aligned with the current chord\n            if (tokenIndex !== 0) {\n                props.onBlockSplit(props.chordBlock, tokenIndex);\n            }\n\n            startEdit();\n\n            event.stopPropagation();\n        };\n    };\n\n    const onDrop = (params: {\n        chord: string;\n        sourceBlockID: IDable<ChordBlock>;\n        destinationBlockID: IDable<ChordBlock>;\n        splitIndex: number;\n        dropType: \"move\" | \"copy\";\n    }) => {\n        props.songDispatch({\n            type: \"drag-and-drop-chord\",\n            sourceBlockID: params.sourceBlockID,\n            newChord: params.chord,\n            dropType: params.dropType,\n            destinationBlockID: params.destinationBlockID,\n            splitIndex: params.splitIndex,\n        });\n    };\n\n    const endEdit = (newChord: string) => {\n        props.onChordChange?.(props.chordBlock, newChord);\n\n        finishEdit();\n    };\n\n    const makeFirstToken = (lyric: Lyric): React.ReactElement => {\n        const blockHasChord = props.chordBlock.chord !== \"\";\n        if (!blockHasChord) {\n            return makeChordlessToken(lyric, 0);\n        }\n\n        return (\n            <ChordTokenDroppable\n                key={0}\n                blockID={props.chordBlock}\n                onDragOver={onLyricDragOver}\n            >\n                <Token index={0}>{lyric}</Token>\n            </ChordTokenDroppable>\n        );\n    };\n\n    const makeChordlessToken = (\n        lyric: Lyric,\n        index: number\n    ): React.ReactElement => {\n        const invisibleTargetOption = {\n            onClick: clickHandler(index),\n        };\n\n        return (\n            <ChordlessTokenDroppable\n                key={index}\n                blockID={props.chordBlock}\n                tokenIndex={index}\n                hoverableClassName={chordlessTokenStyle.hoverable.root}\n                dragOverClassName={chordlessTokenStyle.dragOver.root}\n            >\n                <Token index={index} invisibleTarget={invisibleTargetOption}>\n                    {lyric}\n                </Token>\n            </ChordlessTokenDroppable>\n        );\n    };\n\n    const firstLyricToken = lyricTokens.get(0);\n    if (firstLyricToken === undefined) {\n        throw new Error(\"Lyric tokens list guaranteed at least one token\");\n    }\n\n    const subsequentLyricTokens = lyricTokens.slice(1);\n\n    const firstLyricBlock = makeFirstToken(firstLyricToken);\n    const subsequentLyricBlocks = subsequentLyricTokens.map(\n        (lyricToken: Lyric, index: number) =>\n            makeChordlessToken(lyricToken, index + 1)\n    );\n\n    const lyricBlocks = subsequentLyricBlocks.unshift(firstLyricBlock);\n\n    const chordRow: React.ReactElement = (() => {\n        if (editing) {\n            return (\n                <Box data-testid=\"ChordEdit\">\n                    <ChordInput\n                        value={props.chordBlock.chord}\n                        variant=\"filled\"\n                        typographyVariant={lyricTypographyVariant}\n                        onFinish={endEdit}\n                    />\n                </Box>\n            );\n        }\n\n        if (props.chordBlock.chord === \"\") {\n            return <ChordSymbol>{props.chordBlock.chord}</ChordSymbol>;\n        }\n\n        return (\n            <DraggableChordSymbol\n                chordBlockID={props.chordBlock}\n                onDrop={onDrop}\n                className={clsx(\n                    chordSymbolClassName,\n                    blockChordSymbolClassName\n                )}\n            >\n                {props.chordBlock.chord}\n            </DraggableChordSymbol>\n        );\n    })();\n\n    return (\n        <Box display=\"inline-block\">\n            <Grid\n                container\n                direction=\"column\"\n                data-testid={props[\"data-testid\"]}\n                className={gridClassName}\n            >\n                <Grid\n                    className={clsx(\n                        chordTargetClassName,\n                        blockChordTargetClassName\n                    )}\n                    onClick={clickHandler(0)}\n                    item\n                >\n                    <ChordTokenDroppable\n                        blockID={props.chordBlock}\n                        onDragOver={onChordDragOver}\n                    >\n                        {chordRow}\n                    </ChordTokenDroppable>\n                </Grid>\n                <Grid item data-testid=\"Lyric\">\n                    {lyricBlocks}\n                </Grid>\n            </Grid>\n        </Box>\n    );\n};\n\nexport default Block;\n","import {\n    Button as UnstyledButton,\n    ButtonGroup,\n    Theme,\n    Tooltip as UnstyledTooltip,\n    withStyles,\n} from \"@material-ui/core\";\nimport React from \"react\";\nimport { DataTestID } from \"../../common/DataTestID\";\n\nconst Button = withStyles((theme: Theme) => ({\n    contained: {\n        backgroundColor: \"transparent\",\n        \"&:hover\": {\n            backgroundColor: theme.palette.primary.dark,\n        },\n    },\n}))(UnstyledButton);\n\nconst Tooltip = withStyles({\n    tooltip: {\n        padding: 0,\n        background: \"transparent\",\n        margin: 0,\n    },\n})(UnstyledTooltip);\n\nexport interface MenuItem extends DataTestID {\n    icon: React.ReactElement;\n    onClick?: (event: React.MouseEvent<HTMLButtonElement, MouseEvent>) => void;\n}\n\nexport interface WithHoverMenuProps {\n    children: React.ReactElement;\n    menuItems: MenuItem[];\n}\n\nconst WithHoverMenu: React.FC<WithHoverMenuProps> = (\n    props: WithHoverMenuProps\n): JSX.Element => {\n    const hoverMenu = (\n        <ButtonGroup orientation=\"vertical\" variant=\"text\">\n            {props.menuItems.map((menuItem: MenuItem, index: number) => {\n                return (\n                    <Button\n                        key={index}\n                        onClick={menuItem.onClick}\n                        data-testid={menuItem[\"data-testid\"]}\n                    >\n                        {menuItem.icon}\n                    </Button>\n                );\n            })}\n        </ButtonGroup>\n    );\n\n    return (\n        <Tooltip placement=\"right\" title={hoverMenu} interactive>\n            {props.children}\n        </Tooltip>\n    );\n};\n\nexport default WithHoverMenu;\n","export const contentEditableElement = (\n    contentEditableRef: React.RefObject<HTMLSpanElement>\n): HTMLSpanElement => {\n    if (contentEditableRef.current === null) {\n        throw new Error(\"unexpected for ref to be null\");\n    }\n\n    return contentEditableRef.current;\n};\n\nexport const selectionRange = (\n    ref: React.RefObject<HTMLSpanElement>\n): Range | null => {\n    const node = contentEditableElement(ref);\n\n    const selection = window.getSelection();\n    if (selection === null || selection.rangeCount === 0) {\n        return null;\n    }\n\n    const range = selection.getRangeAt(0);\n    if (\n        range === null ||\n        !node.contains(range.startContainer) ||\n        !node.contains(range.endContainer)\n    ) {\n        return null;\n    }\n\n    return range;\n};\n\nexport const isSelectionAtBeginning = (\n    ref: React.RefObject<HTMLSpanElement>\n): boolean => {\n    const range: Range | null = selectionRange(ref);\n    if (range === null) {\n        return false;\n    }\n\n    if (!range.collapsed) {\n        return false;\n    }\n\n    const elem = contentEditableElement(ref);\n    if (range.startContainer === elem && range.startOffset === 0) {\n        return true;\n    }\n\n    if (elem.firstChild !== null) {\n        if (\n            range.startContainer === elem.firstChild &&\n            range.startOffset === 0\n        ) {\n            return true;\n        }\n    }\n\n    return false;\n};\n\nexport const splitContentBySelection = (\n    ref: React.RefObject<HTMLSpanElement>\n): [Range, Range] => {\n    const currentRange: Range | null = selectionRange(ref);\n    const elem = contentEditableElement(ref);\n\n    const beforeRange: Range = document.createRange();\n    const afterRange: Range = document.createRange();\n\n    if (currentRange !== null) {\n        beforeRange.setStart(elem, 0);\n        beforeRange.setEnd(\n            currentRange.startContainer,\n            currentRange.startOffset\n        );\n        afterRange.setStart(currentRange.endContainer, currentRange.endOffset);\n        afterRange.setEnd(elem, elem.childNodes.length);\n    } else {\n        beforeRange.selectNodeContents(elem);\n        afterRange.setStart(beforeRange.endContainer, beforeRange.endOffset);\n        afterRange.setEnd(beforeRange.endContainer, beforeRange.endOffset);\n    }\n\n    return [beforeRange, afterRange];\n};\n\nexport const insertNodeAtSelection = (\n    ref: React.RefObject<HTMLSpanElement>,\n    node: Node\n): boolean => {\n    const elem = contentEditableElement(ref);\n    const range = selectionRange(ref);\n    if (range === null) {\n        return false;\n    }\n\n    range.deleteContents();\n    range.insertNode(node);\n    range.collapse(false);\n    elem.normalize();\n    return true;\n};\n\nexport const childIndex = (parent: Node, child: Node): number | null => {\n    const childNodes = parent.childNodes;\n    for (let i = 0; i < childNodes.length; i++) {\n        if (child === childNodes.item(i)) {\n            return i;\n        }\n    }\n\n    return null;\n};\n\nexport const nodeBeforeSelection = (\n    ref: React.RefObject<HTMLSpanElement>\n): Node | null => {\n    const elem = contentEditableElement(ref);\n    const range = selectionRange(ref);\n    if (range === null) {\n        return null;\n    }\n\n    let targetNodeIndex: number;\n    if (range.startContainer === elem) {\n        if (range.startOffset === 0) {\n            return null;\n        }\n\n        targetNodeIndex = range.startOffset - 1;\n    } else {\n        // we'd like to step outside of the childnode\n        // startOffset of 0 is the only condition we are looking for\n        if (range.startOffset !== 0) {\n            return null;\n        }\n\n        const currNodeIndex = childIndex(elem, range.startContainer);\n        if (currNodeIndex === null || currNodeIndex === 0) {\n            return null;\n        }\n\n        targetNodeIndex = currNodeIndex - 1;\n    }\n\n    return elem.childNodes.item(targetNodeIndex);\n};\n\nexport const nodeAfterSelection = (\n    ref: React.RefObject<HTMLSpanElement>\n): Node | null => {\n    const elem = contentEditableElement(ref);\n    const range = selectionRange(ref);\n    if (range === null) {\n        return null;\n    }\n\n    const childCount = elem.childNodes.length;\n    let targetNodeIndex: number;\n    if (range.endContainer === elem) {\n        if (range.endOffset === childCount) {\n            return null;\n        }\n\n        targetNodeIndex = range.endOffset;\n    } else {\n        if (range.endContainer.nodeType === range.endContainer.TEXT_NODE) {\n            const textNode = range.endContainer as Text;\n            if (range.endOffset !== textNode.length) {\n                return null;\n            }\n        }\n\n        const currNodeIndex = childIndex(elem, range.endContainer);\n        if (currNodeIndex === null || currNodeIndex === childCount) {\n            return null;\n        }\n\n        targetNodeIndex = currNodeIndex + 1;\n    }\n\n    return elem.childNodes.item(targetNodeIndex);\n};\n","import { PlainFn } from \"../../../common/PlainFn\";\nimport {\n    DomLyricTabFn,\n    lyricTabTypeOfDOMNode,\n    SizedTab,\n    useDomLyricTab,\n} from \"../../lyrics/Tab\";\nimport {\n    childIndex,\n    contentEditableElement,\n    insertNodeAtSelection,\n    isSelectionAtBeginning,\n    nodeAfterSelection,\n    nodeBeforeSelection,\n    selectionRange,\n} from \"./SelectionUtils\";\n\ntype ContentEditableElement = HTMLSpanElement;\ntype HandlerFn = (\n    event: React.KeyboardEvent<ContentEditableElement>\n) => boolean;\n\nconst enterHandler = (callback: PlainFn): HandlerFn => {\n    return (event: React.KeyboardEvent<ContentEditableElement>): boolean => {\n        if (event.key !== \"Enter\") {\n            return false;\n        }\n\n        callback();\n        return true;\n    };\n};\n\nconst specialBackspaceHandler = (\n    ref: React.RefObject<ContentEditableElement>,\n    callback: PlainFn\n): HandlerFn => {\n    return (event: React.KeyboardEvent<ContentEditableElement>): boolean => {\n        const specialBackspace: boolean =\n            event.key === \"Backspace\" && (event.metaKey || event.ctrlKey);\n        if (!specialBackspace) {\n            return false;\n        }\n\n        if (!isSelectionAtBeginning(ref)) {\n            return false;\n        }\n\n        callback();\n        return true;\n    };\n};\n\nconst specialEnterHandler = (\n    ref: React.RefObject<ContentEditableElement>,\n    callback: (splitIndex: number) => void\n): HandlerFn => {\n    return (event: React.KeyboardEvent<ContentEditableElement>): boolean => {\n        const specialEnter: boolean =\n            event.key === \"Enter\" && (event.metaKey || event.ctrlKey);\n        if (!specialEnter) {\n            return false;\n        }\n\n        const range = selectionRange(ref);\n        if (range === null) {\n            return false;\n        }\n\n        callback(range.startOffset);\n\n        return true;\n    };\n};\n\nconst tabHandler = (\n    ref: React.RefObject<ContentEditableElement>,\n    domLyricTab: DomLyricTabFn\n): HandlerFn => {\n    return (event: React.KeyboardEvent<ContentEditableElement>): boolean => {\n        let sizedTab: SizedTab;\n\n        if (event.key === \"Tab\" && !event.shiftKey) {\n            sizedTab = SizedTab.MediumTab;\n        } else if (event.key === \"Tab\" && event.shiftKey) {\n            sizedTab = SizedTab.LargeTab;\n        } else if (event.key === \" \" && event.shiftKey) {\n            sizedTab = SizedTab.SmallTab;\n        } else {\n            return false;\n        }\n\n        const domNode = domLyricTab(sizedTab);\n        return insertNodeAtSelection(ref, domNode);\n    };\n};\n\nconst specialStylingKeysHandler = (): HandlerFn => {\n    return (event: React.KeyboardEvent<ContentEditableElement>): boolean => {\n        if (!event.metaKey && !event.ctrlKey) {\n            return false;\n        }\n\n        // prevent bold, underline, or italics commands\n        return (\n            event.key === \"b\" ||\n            event.key === \"B\" ||\n            event.key === \"u\" ||\n            event.key === \"U\" ||\n            event.key === \"i\" ||\n            event.key === \"I\"\n        );\n    };\n};\n\nconst backspaceHandler = (ref: React.RefObject<ContentEditableElement>) => {\n    return (event: React.KeyboardEvent<ContentEditableElement>): boolean => {\n        if (event.key !== \"Backspace\") {\n            return false;\n        }\n\n        const node: Node | null = nodeBeforeSelection(ref);\n\n        if (node === null || lyricTabTypeOfDOMNode(node) === null) {\n            return false;\n        }\n\n        const parent = node.parentElement;\n        if (parent === null) {\n            return false;\n        }\n\n        parent.removeChild(node);\n        return true;\n    };\n};\n\nconst directionKeyHandler = (ref: React.RefObject<ContentEditableElement>) => {\n    return (event: React.KeyboardEvent<ContentEditableElement>): boolean => {\n        const elem = contentEditableElement(ref);\n        const selection = window.getSelection();\n\n        if (selection === null) {\n            return false;\n        }\n\n        if (event.shiftKey || event.metaKey || event.ctrlKey) {\n            return false;\n        }\n\n        if (event.key !== \"ArrowLeft\" && event.key !== \"ArrowRight\") {\n            return false;\n        }\n\n        let nodeIndex: number;\n\n        if (event.key === \"ArrowLeft\") {\n            const node: Node | null = nodeBeforeSelection(ref);\n            if (node === null || lyricTabTypeOfDOMNode(node) === null) {\n                return false;\n            }\n\n            const childNodeIndex = childIndex(elem, node);\n            if (childNodeIndex === null) {\n                console.error(\n                    \"Unexpected - node cannot be found inside contenteditable element\"\n                );\n                return false;\n            }\n\n            // navigate to before this node by setting the selection offset to this node index\n\n            nodeIndex = childNodeIndex;\n        } else {\n            // ArrowRight\n            const node: Node | null = nodeAfterSelection(ref);\n            if (node === null || lyricTabTypeOfDOMNode(node) === null) {\n                return false;\n            }\n\n            const childNodeIndex = childIndex(elem, node);\n            if (childNodeIndex === null) {\n                console.error(\n                    \"Unexpected - node cannot be found inside contenteditable element\"\n                );\n                return false;\n            }\n\n            // navigate to before this node by setting the selection offset to this node index\n            nodeIndex = childNodeIndex + 1;\n        }\n\n        selection.setBaseAndExtent(elem, nodeIndex, elem, nodeIndex);\n\n        return true;\n    };\n};\n\nexport interface KeyDownHandlerProps {\n    contentEditableRef: React.RefObject<ContentEditableElement>;\n    enterCallback: PlainFn;\n    specialBackspaceCallback: PlainFn;\n    specialEnterCallback: (splitIndex: number) => void;\n}\n\nexport const useKeyDownHandler = (props: KeyDownHandlerProps) => {\n    const domLyricTab = useDomLyricTab();\n\n    const handlers: HandlerFn[] = [\n        specialEnterHandler(\n            props.contentEditableRef,\n            props.specialEnterCallback\n        ),\n        specialBackspaceHandler(\n            props.contentEditableRef,\n            props.specialBackspaceCallback\n        ),\n        tabHandler(props.contentEditableRef, domLyricTab),\n        enterHandler(props.enterCallback),\n        backspaceHandler(props.contentEditableRef),\n        directionKeyHandler(props.contentEditableRef),\n        specialStylingKeysHandler(),\n    ];\n\n    return (event: React.KeyboardEvent<ContentEditableElement>) => {\n        for (const handler of handlers) {\n            const handled: boolean = handler(event);\n            if (handled) {\n                event.preventDefault();\n                return;\n            }\n        }\n    };\n};\n","import { Lyric } from \"../../../common/ChordModel/Lyric\";\nimport { serializeLyrics } from \"../../lyrics/Serialization\";\nimport {\n    insertNodeAtSelection,\n    splitContentBySelection,\n} from \"./SelectionUtils\";\n\ntype HandlerFn = (event: React.ClipboardEvent<HTMLDivElement>) => boolean;\n\nconst serializedLyricsFromRange = (range: Range): Lyric => {\n    const documentFragment = range.cloneContents();\n    return serializeLyrics(documentFragment.childNodes);\n};\n\nconst composeMultilinePaste = (\n    ref: React.RefObject<HTMLSpanElement>,\n    pasteContent: string[]\n): [Lyric, Lyric[]] => {\n    const [beforeSelection, afterSelection] = splitContentBySelection(ref);\n\n    let serializedLyricsForThisLine: Lyric =\n        serializedLyricsFromRange(beforeSelection);\n\n    serializedLyricsForThisLine = serializedLyricsForThisLine.append(\n        pasteContent[0]\n    );\n\n    const newPasteLines = pasteContent.slice(1);\n    const remainingSerializedLyrics: Lyric[] = newPasteLines.map(\n        (line: string): Lyric => {\n            return new Lyric(line);\n        }\n    );\n\n    const lastIndex = remainingSerializedLyrics.length - 1;\n    const lastLyric = remainingSerializedLyrics[lastIndex].append(\n        serializedLyricsFromRange(afterSelection)\n    );\n    remainingSerializedLyrics[lastIndex] = lastLyric;\n\n    return [serializedLyricsForThisLine, remainingSerializedLyrics];\n};\n\nconst handlePlainTextPaste = (\n    ref: React.RefObject<HTMLSpanElement>,\n    callback: (firstLine: Lyric, restOfLines: Lyric[]) => void\n): HandlerFn => {\n    return (event: React.ClipboardEvent<HTMLDivElement>): boolean => {\n        const payload = event.clipboardData.getData(\"text/plain\");\n\n        if (payload === \"\") {\n            return false;\n        }\n\n        // handling both Windows + Mac\n        let linesOfText: string[] = payload.split(\"\\r\\n\");\n        linesOfText = linesOfText.flatMap((line: string) => line.split(\"\\n\"));\n\n        if (linesOfText.length === 0) {\n            return false;\n        }\n\n        if (linesOfText.length === 1) {\n            return insertNodeAtSelection(\n                ref,\n                document.createTextNode(linesOfText[0])\n            );\n        }\n\n        const [newValue, newPasteLines] = composeMultilinePaste(\n            ref,\n            linesOfText\n        );\n\n        callback(newValue, newPasteLines);\n\n        return true;\n    };\n};\n\nconst handleJSONPaste = (callback: (payload: string) => boolean): HandlerFn => {\n    return (event: React.ClipboardEvent<HTMLDivElement>): boolean => {\n        const payload = event.clipboardData.getData(\"application/json\");\n\n        if (payload === \"\") {\n            return false;\n        }\n\n        return callback(payload);\n    };\n};\n\nexport interface PasteHandlerProps {\n    contentEditableRef: React.RefObject<HTMLSpanElement>;\n    pastePlainTextCallback: (firstLine: Lyric, restOfLines: Lyric[]) => void;\n    pasteJSONCallback: (payload: string) => boolean;\n}\n\nexport const usePasteHandler = (props: PasteHandlerProps) => {\n    const handlers: HandlerFn[] = [\n        handleJSONPaste(props.pasteJSONCallback),\n        handlePlainTextPaste(\n            props.contentEditableRef,\n            props.pastePlainTextCallback\n        ),\n    ];\n\n    return (event: React.ClipboardEvent<HTMLDivElement>) => {\n        for (const handler of handlers) {\n            const handled: boolean = handler(event);\n            if (handled) {\n                event.preventDefault();\n                return;\n            }\n        }\n    };\n};\n","import { useEffect } from \"react\";\nimport { lyricTabTypeOfDOMNode } from \"../../lyrics/Tab\";\nimport { contentEditableElement } from \"./SelectionUtils\";\n\ntype HandlerFn = (selection: Selection) => boolean;\n\nexport const useFocusAndPlaceCaretEffect = (\n    ref: React.RefObject<HTMLSpanElement>\n): void => {\n    useEffect(() => {\n        const elem = contentEditableElement(ref);\n        elem.focus();\n\n        const selection = window.getSelection();\n        if (selection === null) {\n            return;\n        }\n\n        const newRange = document.createRange();\n        newRange.selectNodeContents(elem);\n        newRange.collapse(false);\n\n        selection.removeAllRanges();\n        selection.addRange(newRange);\n    });\n};\n\nconst handleSelectOpaqueBlock = (selection: Selection): boolean => {\n    //todo, handle non collapsed selections\n    if (!selection.isCollapsed) {\n        return false;\n    }\n\n    const range = selection.getRangeAt(0);\n    // not embedded in a non contenteditable\n    if (lyricTabTypeOfDOMNode(range.endContainer) === null) {\n        return false;\n    }\n\n    range.setStartAfter(range.endContainer);\n    range.setEndAfter(range.endContainer);\n    range.collapse(true);\n    return true;\n};\n\nconst handlers: HandlerFn[] = [handleSelectOpaqueBlock];\n\nconst handleSelectionChange = (event: Event) => {\n    const selection = document.getSelection();\n    if (selection === null || selection.rangeCount !== 1) {\n        return;\n    }\n\n    for (const handler of handlers) {\n        const handled = handler(selection);\n        if (handled) {\n            event.preventDefault();\n            return;\n        }\n    }\n};\n\nexport const useSelectionChangeEffect = () => {\n    useEffect(() => {\n        document.addEventListener(\"selectionchange\", handleSelectionChange);\n\n        return () =>\n            document.removeEventListener(\n                \"selectionchange\",\n                handleSelectionChange\n            );\n    });\n};\n","import { makeStyles, Typography, TypographyVariant } from \"@material-ui/core\";\nimport grey from \"@material-ui/core/colors/grey\";\nimport { StyledComponentProps, withStyles } from \"@material-ui/styles\";\nimport React from \"react\";\nimport { Lyric } from \"../../../common/ChordModel/Lyric\";\nimport { PlainFn } from \"../../../common/PlainFn\";\nimport { deserializeLyrics, serializeLyrics } from \"../../lyrics/Serialization\";\nimport { contentEditableElement } from \"./SelectionUtils\";\nimport { KeyDownHandlerProps, useKeyDownHandler } from \"./useKeyHandler\";\nimport { PasteHandlerProps, usePasteHandler } from \"./usePasteHandler\";\nimport {\n    useFocusAndPlaceCaretEffect,\n    useSelectionChangeEffect,\n} from \"./useSelectionHandler\";\n\nconst InputTypography = withStyles({\n    root: {\n        width: \"100%\",\n        backgroundColor: grey[200],\n        whiteSpace: \"pre\",\n        display: \"inline-block\",\n    },\n})(Typography);\n\nconst useContentEditableStyle = makeStyles({\n    root: {\n        display: \"inline-block\",\n        width: \"100%\",\n        pointerEvents: \"auto\",\n        userSelect: \"text\",\n        outline: \"none\",\n        wordSpacing: \".15em\",\n        // this prevent the span height from collapsing if there's no content\n        \"&:empty:before\": {\n            content: '\"\\\\a0\"',\n        },\n    },\n});\n\ninterface LyricInputProps extends StyledComponentProps {\n    children: Lyric;\n    onFinish: (newValue: Lyric) => void;\n    onSpecialBackspace: PlainFn;\n    onSpecialEnter: (splitIndex: number) => void;\n    onLyricOverflow: (overflowContent: Lyric[]) => void;\n    onJSONPaste: (jsonStr: string) => [boolean, PlainFn | null];\n    variant?: TypographyVariant;\n}\n\nconst LyricInput: React.FC<LyricInputProps> = (\n    props: LyricInputProps\n): JSX.Element => {\n    const contentEditableRef: React.RefObject<HTMLSpanElement> =\n        React.createRef();\n\n    const value = (): Lyric => {\n        const elem = contentEditableElement(contentEditableRef);\n        if (elem.textContent === null) {\n            return new Lyric(\"\");\n        }\n\n        return serializeLyrics(elem.childNodes);\n    };\n\n    const finish = (newValue: Lyric) => {\n        props.onFinish(newValue);\n    };\n\n    const keyDownHandlerProps: KeyDownHandlerProps = {\n        contentEditableRef: contentEditableRef,\n        enterCallback: () => {\n            finish(value());\n        },\n        specialBackspaceCallback: () => {\n            props.onSpecialBackspace();\n        },\n        specialEnterCallback: (splitIndex: number) => {\n            finish(value());\n            props.onSpecialEnter(splitIndex);\n        },\n    };\n\n    const handleKeyDown = useKeyDownHandler(keyDownHandlerProps);\n\n    const pasteHandlerProps: PasteHandlerProps = {\n        contentEditableRef: contentEditableRef,\n        pasteJSONCallback: (payload: string): boolean => {\n            const [canHandle, executePaste] = props.onJSONPaste(payload);\n            if (canHandle) {\n                finish(value());\n                executePaste?.();\n            }\n\n            return canHandle;\n        },\n        pastePlainTextCallback: (firstLine: Lyric, restOfLines: Lyric[]) => {\n            finish(firstLine);\n            props.onLyricOverflow(restOfLines);\n        },\n    };\n\n    const handlePaste = usePasteHandler(pasteHandlerProps);\n\n    const handleBlur = () => {\n        finish(value());\n    };\n\n    const contentEditableStyle = useContentEditableStyle();\n    const lyricContent = deserializeLyrics(props.children, true);\n\n    useFocusAndPlaceCaretEffect(contentEditableRef);\n    useSelectionChangeEffect();\n\n    return (\n        <InputTypography\n            classes={props.classes}\n            variant={props.variant}\n            display=\"inline\"\n            data-testid=\"LyricInput\"\n        >\n            <span\n                contentEditable\n                className={contentEditableStyle.root}\n                ref={contentEditableRef}\n                data-testid=\"InnerInput\"\n                onBlur={handleBlur}\n                onKeyDown={handleKeyDown}\n                onPaste={handlePaste}\n                suppressContentEditableWarning\n            >\n                {lyricContent}\n            </span>\n        </InputTypography>\n    );\n};\n\nexport default LyricInput;\n","import { Box, Theme, withStyles } from \"@material-ui/core\";\nimport { isLeft } from \"fp-ts/lib/Either\";\nimport { useSnackbar } from \"notistack\";\nimport React, { useMemo } from \"react\";\nimport { ChordLine } from \"../../common/ChordModel/ChordLine\";\nimport { Lyric } from \"../../common/ChordModel/Lyric\";\nimport { PlainFn } from \"../../common/PlainFn\";\nimport { lyricStyle, lyricTypographyVariant } from \"../display/Lyric\";\nimport { ChordSongAction } from \"../reducer/reducer\";\nimport { deserializeCopiedChordLines } from \"./CopyAndPaste\";\nimport { useEditingState } from \"./InteractionContext\";\nimport UnstyledLyricInput from \"./lyric_input/LyricInput\";\n\nconst LyricInput = withStyles((theme: Theme) => ({\n    root: {\n        ...lyricStyle.root,\n        borderBottom: \"solid\",\n        borderBottomColor: theme.palette.secondary.main,\n        borderBottomWidth: \"2px\",\n    },\n}))(UnstyledLyricInput);\n\ninterface WithLyricInputProps {\n    children: (handleEdit: PlainFn) => React.ReactElement;\n    chordLine: ChordLine;\n    songDispatch: React.Dispatch<ChordSongAction>;\n}\n\n// this component is inherently quite coupled with Line & friends\n// however, this is a good opportunity to separate concerns and organize functionality\nconst WithLyricInput: React.FC<WithLyricInputProps> = (\n    props: WithLyricInputProps\n): JSX.Element => {\n    const { editing, startEdit, finishEdit } = useEditingState();\n    const { songDispatch, chordLine } = props;\n    const { enqueueSnackbar } = useSnackbar();\n\n    const handlers = useMemo(\n        () => ({\n            lyricEdit: (newLyric: Lyric) => {\n                finishEdit();\n\n                songDispatch({\n                    type: \"replace-line-lyrics\",\n                    line: chordLine,\n                    lineID: chordLine,\n                    newLyric: newLyric,\n                });\n            },\n\n            lyricPasteOverflow: (overflowContent: Lyric[]) => {\n                songDispatch({\n                    type: \"insert-overflow-lyrics\",\n                    insertionLineID: chordLine,\n                    overflowLyrics: overflowContent,\n                });\n                finishEdit();\n            },\n            jsonPaste: (jsonStr: string): [boolean, PlainFn | null] => {\n                const deserializedCopyResult =\n                    deserializeCopiedChordLines(jsonStr);\n                // not actually a Chord Paper line payload, don't handle it\n                if (deserializedCopyResult === null) {\n                    return [false, null];\n                }\n\n                if (isLeft(deserializedCopyResult)) {\n                    const errorMsg =\n                        \"Failed to paste copied lines: \" +\n                        deserializedCopyResult.left.message;\n                    enqueueSnackbar(errorMsg, { variant: \"error\" });\n                    return [true, null];\n                }\n\n                const insertLines = () =>\n                    songDispatch({\n                        type: \"batch-insert-lines\",\n                        insertLineID: chordLine,\n                        copiedLines: deserializedCopyResult.right,\n                    });\n\n                return [true, insertLines];\n            },\n\n            specialBackspace: () => {\n                songDispatch({\n                    type: \"merge-lines\",\n                    latterLineID: chordLine,\n                });\n                finishEdit();\n            },\n            specialEnter: (splitIndex: number) => {\n                songDispatch({\n                    type: \"split-line\",\n                    lineID: chordLine,\n                    splitIndex: splitIndex,\n                });\n\n                finishEdit();\n            },\n        }),\n        [chordLine, songDispatch, finishEdit, enqueueSnackbar]\n    );\n\n    const lineElement: React.ReactElement = props.children(startEdit);\n\n    if (!editing) {\n        return lineElement;\n    }\n\n    // using a css trick to overlay the lyrics edit input over\n    // the noneditable lyrics line so chords are still showing\n    return (\n        <>\n            {lineElement}\n            <Box position=\"absolute\" left=\"0\" bottom=\"2px\" width=\"100%\">\n                <LyricInput\n                    variant={lyricTypographyVariant}\n                    onFinish={handlers.lyricEdit}\n                    onJSONPaste={handlers.jsonPaste}\n                    onLyricOverflow={handlers.lyricPasteOverflow}\n                    onSpecialBackspace={handlers.specialBackspace}\n                    onSpecialEnter={handlers.specialEnter}\n                >\n                    {props.chordLine.lyrics}\n                </LyricInput>\n            </Box>\n        </>\n    );\n};\n\nexport default WithLyricInput;\n","import { createStyles } from \"@material-ui/core\";\nimport blueGrey from \"@material-ui/core/colors/blueGrey\";\n\nexport const sectionLabelStyle = createStyles({\n    root: {\n        borderColor: blueGrey[500],\n        borderStyle: \"solid\",\n        borderRadius: \"0.3em\",\n        borderWidth: \"0.075em\",\n        color: blueGrey[500],\n        display: \"inline-block\",\n    },\n});\n\nexport const sectionTypographyVariant: \"body2\" = \"body2\";\n","import { Box, Typography, TypographyProps } from \"@material-ui/core\";\nimport grey from \"@material-ui/core/colors/grey\";\nimport { withStyles } from \"@material-ui/styles\";\nimport React, { useState } from \"react\";\nimport { DataTestID } from \"../../common/DataTestID\";\nimport { inflateIfEmpty } from \"../../common/Whitespace\";\nimport TextInput from \"./TextInput\";\nimport { PlainFn } from \"../../common/PlainFn\";\n\nexport interface EditControl {\n    editing: boolean;\n    onStartEdit: PlainFn;\n    onEndEdit: PlainFn;\n}\n\ninterface EditableTypographyProps extends DataTestID, TypographyProps {\n    children?: never;\n    value: string;\n    // provide this if you want to provide explicit control over the editability\n    // of the field. this means the parent must manage this component's editing state\n    editControl?: EditControl;\n\n    onValueChange?: (newValue: string) => void;\n    placeholder?: string;\n}\n\nconst PlaceholderTypography = withStyles({\n    root: {\n        color: grey[400],\n    },\n})(Typography);\n\nconst EditableTypography: React.FC<EditableTypographyProps> = (\n    props: EditableTypographyProps\n): JSX.Element => {\n    const [editingState, setEditingState] = useState(false);\n\n    const editing: boolean =\n        props.editControl !== undefined\n            ? props.editControl.editing\n            : editingState;\n\n    const startEdit = () => {\n        if (props.editControl !== undefined) {\n            props.editControl.onStartEdit();\n        } else {\n            setEditingState(true);\n        }\n    };\n\n    const finishEdit = (newValue: string) => {\n        if (props.editControl !== undefined) {\n            props.editControl.onEndEdit();\n        } else {\n            setEditingState(false);\n        }\n\n        if (props.onValueChange) {\n            props.onValueChange(newValue);\n        }\n    };\n\n    const nonEditableLine = (): React.ReactElement => {\n        const {\n            value,\n            placeholder,\n            onValueChange,\n            editControl,\n            ...typographyProps\n        } = props;\n\n        if (props.value === \"\" && props.placeholder !== undefined) {\n            return (\n                <PlaceholderTypography {...typographyProps} onClick={startEdit}>\n                    {props.placeholder}\n                </PlaceholderTypography>\n            );\n        }\n\n        return (\n            <Typography {...typographyProps} onClick={startEdit}>\n                {inflateIfEmpty(props.value)}\n            </Typography>\n        );\n    };\n\n    const editableLine = (): React.ReactElement => {\n        if (props.variant === \"inherit\" || props.variant === \"srOnly\") {\n            throw new Error(\"can't have these variant types\");\n        }\n\n        return (\n            <TextInput\n                value={props.value}\n                variant=\"filled\"\n                typographyVariant={props.variant}\n                onFinish={finishEdit}\n                data-testid={\"EditableLine\"}\n            />\n        );\n    };\n\n    const elem: React.ReactElement = editing\n        ? editableLine()\n        : nonEditableLine();\n\n    return <Box>{elem}</Box>;\n};\n\nexport default EditableTypography;\n","import React, { createRef, useRef } from \"react\";\n\nexport type GetPlayerTimeFn = () => number;\ntype GetPlayerTimeFnRef = React.MutableRefObject<GetPlayerTimeFn | null>;\n\nexport const PlayerTimeContext = React.createContext<GetPlayerTimeFnRef>(\n    createRef()\n);\n\ninterface PlayerTimeProviderProps {\n    children: React.ReactNode;\n}\n\nconst PlayerTimeProvider: React.FC<PlayerTimeProviderProps> = (\n    props: PlayerTimeProviderProps\n) => {\n    const getPlayerTimeRef: GetPlayerTimeFnRef = useRef<GetPlayerTimeFn | null>(\n        null\n    );\n\n    return (\n        <PlayerTimeContext.Provider value={getPlayerTimeRef}>\n            {props.children}\n        </PlayerTimeContext.Provider>\n    );\n};\n\nexport default PlayerTimeProvider;\n","import { Box, Theme, TypographyVariant } from \"@material-ui/core\";\nimport { blueGrey, grey } from \"@material-ui/core/colors\";\nimport { withStyles } from \"@material-ui/styles\";\nimport React from \"react\";\n\nexport const roundedTopCornersStyle = (theme: Theme) => ({\n    borderTopLeftRadius: theme.spacing(1.5),\n    borderTopRightRadius: theme.spacing(1.5),\n});\n\nexport const roundedCornersStyle = (theme: Theme) => ({\n    borderRadius: theme.spacing(1.5),\n});\n\nexport const controlPaneStyle = {\n    backgroundColor: blueGrey[50],\n    display: \"flex\",\n    alignItems: \"center\",\n};\n\n// pretty wild stuff, but I've come across some circumstances where I want\n// to provide a min width to an element so that its surrounding elements\n// do not shift\n//\n// flexbox was considered but it required some magic guess of the container's\n// width, which is just as uneducated as any other guess\n//\n// suppose you have a box that contains a number that's unlikely go to beyond\n// 200 - and suppose 200 is the largest width that the value can be\n// (e.g. perhaps in some fonts 199 is wider, then you'd use that)\n// then minWidthOf(theme, \"body\", \"200\") would return a size to use as the minWidth\n// so that the range of values will not change the size of the container\n// or move its surrounding elements\nexport const widthOfString = (\n    theme: Theme,\n    typographyVariant: TypographyVariant,\n    phattestString: string\n): string | undefined => {\n    const typography = theme.typography[typographyVariant];\n\n    const font: string | undefined = (() => {\n        if (typography.fontFamily === undefined) {\n            return undefined;\n        }\n\n        if (typography.fontSize === undefined) {\n            return undefined;\n        }\n\n        return `${typography.fontSize} ${typography.fontFamily}`;\n    })();\n\n    if (font === undefined) {\n        return undefined;\n    }\n\n    const canvas = document.createElement(\"canvas\");\n    const canvasContext = canvas.getContext(\"2d\");\n    if (canvasContext === null) {\n        return undefined;\n    }\n\n    canvasContext.font = font;\n    const measurement = canvasContext.measureText(phattestString);\n    return `${measurement.width}px`;\n};\n\nexport const greyTextColour = grey[700];\n\nconst BottomRightBox = withStyles((theme: Theme) => ({\n    root: {\n        position: \"fixed\",\n        bottom: 0,\n        right: theme.spacing(2),\n        ...roundedTopCornersStyle(theme),\n    },\n}))(Box);\n\nexport const withBottomRightBox = (children: React.ReactElement) => (\n    <BottomRightBox boxShadow={4}>{children}</BottomRightBox>\n);\n\nconst BottomLeftBox = withStyles((theme: Theme) => ({\n    root: {\n        position: \"fixed\",\n        bottom: 0,\n        left: theme.spacing(2),\n        ...roundedTopCornersStyle(theme),\n    },\n}))(Box);\n\nexport const withBottomLeftBox = (children: React.ReactElement) => (\n    <BottomLeftBox boxShadow={4}>{children}</BottomLeftBox>\n);\n\nexport const TitleBar = withStyles((theme: Theme) => ({\n    root: {\n        width: \"100%\",\n        display: \"flex\",\n        justifyContent: \"space-between\",\n        alignItems: \"center\",\n        ...roundedTopCornersStyle(theme),\n    },\n}))(Box);\n","import { IconButton, InputAdornment, Theme } from \"@material-ui/core\";\nimport SlowMotionVideoIcon from \"@material-ui/icons/SlowMotionVideo\";\nimport { StyledComponentProps, withStyles } from \"@material-ui/styles\";\nimport { Duration } from \"luxon\";\nimport React, { useContext, useRef, useState } from \"react\";\nimport { PlayerTimeContext } from \"../PlayerTimeContext\";\nimport { widthOfString } from \"../track_player/common\";\nimport UnstyledControlledTextInput from \"./ControlledTextInput\";\n\ninterface TimeInputProps extends StyledComponentProps {\n    seconds: number | null;\n    onFinish?: (newSeconds: number | null) => void;\n}\n\nconst ControlledTextInput = withStyles((theme: Theme) => ({\n    root: {\n        textAlign: \"right\",\n        width: widthOfString(theme, \"body1\", \"00:00\"),\n    },\n}))(UnstyledControlledTextInput);\n\nconst TimeInput: React.FC<TimeInputProps> = (\n    props: TimeInputProps\n): JSX.Element => {\n    const secondsToString = (seconds: number | null): string => {\n        if (seconds === null) {\n            return \"\";\n        }\n\n        const duration = Duration.fromMillis(seconds * 1000);\n        return duration.toFormat(\"mss\");\n    };\n\n    const initialValue: string = secondsToString(props.seconds);\n    const [value, setValue] = useState<string>(initialValue);\n    const inputBoxRef = useRef<any>(null); // pretty awful but this is the type from TextFieldProps\n\n    const getPlayerTimeRef = useContext(PlayerTimeContext);\n\n    const decomposeTimeString = (timeString: string): [number, number] => {\n        const numericValue = Number(timeString);\n\n        const secondsPart = numericValue % 100;\n        const minutesPart = Math.floor(numericValue / 100);\n        return [minutesPart, secondsPart];\n    };\n\n    const validateTimeValue = (time: string): boolean => {\n        if (time === \"\") {\n            return true;\n        }\n\n        const [minutesPart, secondsPart] = decomposeTimeString(time);\n\n        if (isNaN(minutesPart) || isNaN(secondsPart)) {\n            return false;\n        }\n\n        if (secondsPart > 59 || secondsPart < 0) {\n            return false;\n        }\n\n        return true;\n    };\n\n    const sanitizeValue = (newTime: string): string => {\n        let sanitizedValue = newTime.replaceAll(/\\D/g, \"\");\n\n        if (sanitizedValue === \"0\") {\n            return \"000\";\n        }\n\n        if (sanitizedValue === \"00\") {\n            return \"\";\n        }\n\n        sanitizedValue = sanitizedValue.replace(/^0+/, \"\");\n        return sanitizedValue;\n    };\n\n    const handleValueChange = (newTime: string): void => {\n        setValue(sanitizeValue(newTime));\n    };\n\n    const finish = (newTime: string) => {\n        if (newTime === \"\") {\n            props.onFinish?.(null);\n            return;\n        }\n\n        if (!validateTimeValue(newTime)) {\n            return;\n        }\n\n        const [minutes, seconds] = decomposeTimeString(newTime);\n\n        props.onFinish?.(60 * minutes + seconds);\n    };\n\n    const handleCurrentTimeButton = () => {\n        const currentGetPlayerTime = getPlayerTimeRef.current;\n        if (currentGetPlayerTime === null) {\n            return;\n        }\n\n        const playerTimeSeconds: number = currentGetPlayerTime();\n        const newValue = secondsToString(playerTimeSeconds);\n        setValue(newValue);\n        finish(newValue);\n\n        // put the focus back into the input box\n        if (\n            inputBoxRef.current !== null &&\n            inputBoxRef.current.focus !== undefined &&\n            inputBoxRef.current.focus !== null\n        ) {\n            inputBoxRef.current.focus();\n        }\n    };\n\n    const buttonAdornment = (\n        <InputAdornment position=\"start\">\n            <IconButton edge=\"start\" onClick={handleCurrentTimeButton}>\n                <SlowMotionVideoIcon />\n            </IconButton>\n        </InputAdornment>\n    );\n\n    const formatValue = (timeString: string): string => {\n        if (timeString === \"\") {\n            return \"\";\n        }\n\n        if (timeString.length === 1) {\n            return \"0:0\" + timeString;\n        }\n\n        if (timeString.length === 2) {\n            return \"0:\" + timeString;\n        }\n\n        const colonIndex = timeString.length - 2;\n        const minutesPart = timeString.substring(0, colonIndex);\n        const secondsPart = timeString.substring(colonIndex);\n        return minutesPart + \":\" + secondsPart;\n    };\n\n    const formattedValue = formatValue(value);\n    const error = !validateTimeValue(value);\n\n    return (\n        <ControlledTextInput\n            placeholder=\"0:00\"\n            value={formattedValue}\n            onValueChange={handleValueChange}\n            variant=\"standard\"\n            typographyVariant=\"body1\"\n            onFinish={() => finish(value)}\n            paddingSpacing={0.5}\n            error={error}\n            InputProps={{\n                startAdornment: buttonAdornment,\n                disableUnderline: !error,\n            }}\n            inputRef={inputBoxRef}\n        />\n    );\n};\n\nexport default TimeInput;\n","import { Box, Theme, Tooltip as UnstyledTooltip } from \"@material-ui/core\";\nimport { withStyles } from \"@material-ui/styles\";\nimport React, { useCallback } from \"react\";\nimport { ChordLine } from \"../../common/ChordModel/ChordLine\";\nimport { DataTestID } from \"../../common/DataTestID\";\nimport { PlainFn } from \"../../common/PlainFn\";\nimport {\n    sectionLabelStyle,\n    sectionTypographyVariant,\n} from \"../display/SectionLabel\";\nimport { ChordSongAction } from \"../reducer/reducer\";\nimport UnstyledEditableTypography, { EditControl } from \"./EditableTypography\";\nimport { useEditingState } from \"./InteractionContext\";\nimport TimeInput from \"./TimeInput\";\n\nconst EditableTypography = withStyles(sectionLabelStyle)(\n    UnstyledEditableTypography\n);\n\nconst Tooltip = withStyles((theme: Theme) => ({\n    tooltip: {\n        background: \"white\",\n        boxShadow: theme.shadows[2],\n    },\n}))(UnstyledTooltip);\n\nexport interface MenuItem extends DataTestID {\n    icon: React.ReactElement;\n    onClick?: (event: React.MouseEvent<HTMLButtonElement, MouseEvent>) => void;\n}\n\nexport interface WithSectionProps {\n    chordLine: ChordLine;\n    songDispatch: React.Dispatch<ChordSongAction>;\n    children: (editLabel: PlainFn) => React.ReactElement;\n}\n\nconst WithSection: React.FC<WithSectionProps> = (\n    props: WithSectionProps\n): JSX.Element => {\n    const { editing, startEdit, finishEdit } = useEditingState();\n\n    const editControl: EditControl = {\n        editing: editing,\n        onStartEdit: startEdit,\n        onEndEdit: finishEdit,\n    };\n\n    const { chordLine, songDispatch } = props;\n\n    const handleLabelChange = useCallback(\n        (newValue: string) => {\n            songDispatch({\n                type: \"set-section\",\n                lineID: chordLine,\n                label: newValue,\n            });\n        },\n        [chordLine, songDispatch]\n    );\n\n    const handleTimeChange = useCallback(\n        (newValue: number | null) => {\n            songDispatch({\n                type: \"set-section\",\n                lineID: chordLine,\n                time: newValue,\n            });\n        },\n        [chordLine, songDispatch]\n    );\n\n    const childElement: React.ReactElement = props.children(startEdit);\n    const section = props.chordLine.section;\n\n    if (!editing && section === undefined) {\n        return childElement;\n    }\n\n    const label: string = section?.name ?? \"\";\n\n    const timeInput = (() => {\n        const time: number | null =\n            section?.type === \"time\" ? section.time : null;\n\n        return <TimeInput seconds={time} onFinish={handleTimeChange} />;\n    })();\n\n    // prevent tooltip from stealing focus from the editable textfield\n    const disableTooltipFocus = editing;\n\n    return (\n        <>\n            <Box>\n                <Tooltip\n                    arrow\n                    placement=\"left\"\n                    interactive\n                    title={timeInput}\n                    disableFocusListener={disableTooltipFocus}\n                >\n                    <span>\n                        <EditableTypography\n                            value={label}\n                            variant={sectionTypographyVariant}\n                            data-testid=\"EditLabel\"\n                            editControl={editControl}\n                            onValueChange={handleLabelChange}\n                        />\n                    </span>\n                </Tooltip>\n            </Box>\n            {childElement}\n        </>\n    );\n};\n\nexport default WithSection;\n","import { Box, Slide, withStyles } from \"@material-ui/core\";\nimport grey from \"@material-ui/core/colors/grey\";\nimport red from \"@material-ui/core/colors/red\";\nimport UnstyledBackspaceIcon from \"@material-ui/icons/Backspace\";\nimport ChatBubbleIcon from \"@material-ui/icons/ChatBubbleOutline\";\nimport { List } from \"immutable\";\nimport React, { useMemo, useState } from \"react\";\nimport { ChordBlock } from \"../../common/ChordModel/ChordBlock\";\nimport { ChordLine } from \"../../common/ChordModel/ChordLine\";\nimport { Collection, IDable } from \"../../common/ChordModel/Collection\";\nimport { Lyric } from \"../../common/ChordModel/Lyric\";\nimport { DataTestID } from \"../../common/DataTestID\";\nimport { PlainFn } from \"../../common/PlainFn\";\nimport { ChordSongAction } from \"../reducer/reducer\";\nimport Block from \"./Block\";\nimport WithHoverMenu, { MenuItem } from \"./WithHoverMenu\";\nimport WithLyricInput from \"./WithLyricInput\";\nimport WithSection from \"./WithSection\";\n\nconst AtomicSelectionBox = withStyles({\n    root: {\n        userSelect: \"all\",\n    },\n})(Box);\n\nconst BackspaceIcon = withStyles({\n    root: {\n        color: red[300],\n    },\n})(UnstyledBackspaceIcon);\n\nconst HighlightableBox = withStyles({\n    root: {\n        \"&:hover\": {\n            backgroundColor: grey[100],\n        },\n        whiteSpace: \"nowrap\",\n        overflow: \"hidden\",\n        textOverflow: \"ellipsis\",\n    },\n})(Box);\n\ninterface LineProps extends DataTestID {\n    chordLine: ChordLine;\n    songDispatch: React.Dispatch<ChordSongAction>;\n    \"data-lineid\": string;\n}\n\nconst Line: React.FC<LineProps> = (props: LineProps): JSX.Element => {\n    const [removing, setRemoving] = useState(false);\n    const { chordLine, songDispatch } = props;\n\n    const handlers = useMemo(\n        () => ({\n            chordChange: (blockID: IDable<ChordBlock>, newChord: string) => {\n                songDispatch({\n                    type: \"set-chord\",\n                    lineID: chordLine,\n                    blockID: blockID,\n                    newChord: newChord,\n                });\n            },\n            blockSplit: (blockID: IDable<ChordBlock>, splitIndex: number) => {\n                songDispatch({\n                    type: \"split-block\",\n                    lineID: chordLine,\n                    blockID: blockID,\n                    splitIndex: splitIndex,\n                });\n            },\n\n            startRemove: () => {\n                setRemoving(true);\n            },\n\n            remove: () => {\n                songDispatch({\n                    type: \"remove-line\",\n                    lineID: chordLine,\n                });\n            },\n        }),\n        [chordLine, songDispatch]\n    );\n\n    let chordBlocks: Collection<ChordBlock> = props.chordLine.chordBlocks;\n    if (chordBlocks.length === 0) {\n        chordBlocks = new Collection([\n            new ChordBlock({\n                chord: \"\",\n                lyric: new Lyric(\"\"),\n            }),\n        ]);\n    }\n\n    const blocks: List<React.ReactElement> = chordBlocks.list.map(\n        (chordBlock: ChordBlock): React.ReactElement => (\n            <Block\n                key={chordBlock.id}\n                chordBlock={chordBlock}\n                songDispatch={songDispatch}\n                onChordChange={handlers.chordChange}\n                onBlockSplit={handlers.blockSplit}\n                data-testid=\"Block\"\n            ></Block>\n        )\n    );\n\n    const basicLine = (startEdit: PlainFn) => (\n        <HighlightableBox data-testid=\"NoneditableLine\" onClick={startEdit}>\n            {blocks}\n        </HighlightableBox>\n    );\n\n    const withHoverMenu = (startEdit: PlainFn, menuItems: MenuItem[]) => (\n        <WithHoverMenu menuItems={menuItems}>\n            {basicLine(startEdit)}\n        </WithHoverMenu>\n    );\n\n    const withLyricInput = (menuItems: MenuItem[]) => (\n        <WithLyricInput chordLine={chordLine} songDispatch={songDispatch}>\n            {(startEdit: PlainFn) => withHoverMenu(startEdit, menuItems)}\n        </WithLyricInput>\n    );\n\n    const withSection = (\n        <WithSection chordLine={chordLine} songDispatch={songDispatch}>\n            {(editLabel: PlainFn) => {\n                const menuItems: MenuItem[] = [\n                    {\n                        onClick: editLabel,\n                        icon: <ChatBubbleIcon />,\n                        \"data-testid\": \"EditLabel\",\n                    },\n                    {\n                        onClick: handlers.startRemove,\n                        icon: <BackspaceIcon />,\n                        \"data-testid\": \"RemoveButton\",\n                    },\n                ];\n\n                return withLyricInput(menuItems);\n            }}\n        </WithSection>\n    );\n\n    const lineContent: React.ReactElement = withSection;\n    const yeetDirection = removing ? \"up\" : \"down\";\n\n    return (\n        <Slide\n            direction={yeetDirection}\n            in={!removing}\n            timeout={250}\n            onExited={handlers.remove}\n        >\n            <AtomicSelectionBox>\n                <Box\n                    borderBottom={1}\n                    width=\"100%\"\n                    position=\"relative\"\n                    data-lineid={props[\"data-lineid\"]}\n                    data-testid={props[\"data-testid\"]}\n                >\n                    {lineContent}\n                </Box>\n            </AtomicSelectionBox>\n        </Slide>\n    );\n};\n\nexport default React.memo(Line);\n","import {\n    Button,\n    Divider as UnstyledDivider,\n    Grid,\n    Theme,\n    Tooltip as UnstyledTooltip,\n} from \"@material-ui/core\";\nimport UnstyledAddCircleOutlineIcon from \"@material-ui/icons/AddCircleOutline\";\nimport { useTheme, withStyles } from \"@material-ui/styles\";\nimport React from \"react\";\nimport { ChordLine } from \"../../common/ChordModel/ChordLine\";\nimport { IDable } from \"../../common/ChordModel/Collection\";\nimport { DataTestID } from \"../../common/DataTestID\";\nimport { ChordSongAction } from \"../reducer/reducer\";\n\nconst HighlightableGrid = withStyles({\n    root: {\n        \"&:hover .MuiDivider-root\": {\n            backgroundColor: \"rgba(0, 0, 0, 0.25)\",\n        },\n    },\n})(Grid);\n\nconst Tooltip = withStyles({\n    tooltip: {\n        padding: 0,\n        background: \"transparent\",\n        margin: 0,\n    },\n})(UnstyledTooltip);\n\nconst Divider = withStyles({\n    root: {\n        width: \"100%\",\n        backgroundColor: \"transparent\",\n    },\n})(UnstyledDivider);\n\nconst AddCircleOutlineIcon = withStyles((theme: Theme) => ({\n    root: {\n        color: theme.palette.secondary.light,\n    },\n}))(UnstyledAddCircleOutlineIcon);\n\ninterface NewLineProps extends DataTestID {\n    lineID: IDable<ChordLine> | \"beginning\";\n    songDispatch: React.Dispatch<ChordSongAction>;\n}\n\nconst NewLine: React.FC<NewLineProps> = (props: NewLineProps): JSX.Element => {\n    const theme: Theme = useTheme();\n\n    const handleAddLine = () => {\n        props.songDispatch({\n            type: \"add-line\",\n            lineID: props.lineID,\n        });\n    };\n\n    const hoverMenu = (): React.ReactElement => {\n        return (\n            <Button data-testid={\"AddButton\"} onClick={handleAddLine}>\n                <AddCircleOutlineIcon />\n            </Button>\n        );\n    };\n\n    return (\n        <Tooltip title={hoverMenu()} interactive placement=\"right\">\n            <HighlightableGrid\n                container\n                direction=\"column\"\n                justify=\"center\"\n                onClick={handleAddLine}\n                data-testid={props[\"data-testid\"]}\n                style={{\n                    minHeight: theme.spacing(3),\n                }}\n            >\n                <Divider />\n            </HighlightableGrid>\n        </Tooltip>\n    );\n};\n\nexport default React.memo(NewLine);\n","import { ChordSongAction } from \"../reducer/reducer\";\n\nexport const handleUndoRedo = (\n    event: KeyboardEvent,\n    songDispatch: React.Dispatch<ChordSongAction>\n): boolean => {\n    const isSpecialKey = event.metaKey || event.ctrlKey;\n    if (event.key !== \"z\" || !isSpecialKey) {\n        return false;\n    }\n\n    if (event.shiftKey) {\n        songDispatch({ type: \"redo\" });\n    } else {\n        songDispatch({ type: \"undo\" });\n    }\n\n    return true;\n};\n","import {\n    Grid,\n    makeStyles,\n    Paper as UnstyledPaper,\n    withStyles,\n} from \"@material-ui/core\";\nimport { List } from \"immutable\";\nimport React, { useMemo, useState } from \"react\";\nimport { useEffect } from \"react\";\nimport { ChordLine } from \"../../common/ChordModel/ChordLine\";\nimport { ChordSong } from \"../../common/ChordModel/ChordSong\";\nimport { useRegisterKeyListener } from \"../GlobalKeyListener\";\nimport { ChordSongAction } from \"../reducer/reducer\";\nimport { handleBatchLineDelete } from \"./BatchDelete\";\nimport { useLineCopyHandler } from \"./CopyAndPaste\";\nimport { InteractionContext, InteractionSetter } from \"./InteractionContext\";\nimport Line from \"./Line\";\nimport NewLine from \"./NewLine\";\nimport { handleUndoRedo } from \"./Undo\";\n\nconst useUninteractiveStyle = makeStyles({\n    root: {\n        pointerEvents: \"none\",\n    },\n});\n\nconst Paper = withStyles({\n    root: {\n        width: \"auto\",\n    },\n})(UnstyledPaper);\n\ntype KeyDownHandler = (\n    event: KeyboardEvent,\n    songDispatch: React.Dispatch<ChordSongAction>\n) => boolean;\n\ninterface ChordPaperBodyProps {\n    song: ChordSong;\n    songDispatch: React.Dispatch<ChordSongAction>;\n}\n\nconst ChordPaperBody: React.FC<ChordPaperBodyProps> = (\n    props: ChordPaperBodyProps\n): React.ReactElement => {\n    const [interacting, setInteracting] = useState(false);\n    const handleCopy = useLineCopyHandler(props.song);\n    const [addKeyListener, removeKeyListener] = useRegisterKeyListener();\n\n    const songDispatch = props.songDispatch;\n\n    const interactionContextValue: InteractionSetter = useMemo(\n        () => ({\n            startInteraction: () => {\n                setTimeout(() => {\n                    setInteracting(true);\n                });\n            },\n            endInteraction: () => {\n                setTimeout(() => {\n                    setInteracting(false);\n                });\n            },\n        }),\n        []\n    );\n\n    const uninteractiveStyle = useUninteractiveStyle();\n    // prevent other interactions if currently interacting\n    const allowInteraction: boolean = !interacting;\n\n    useEffect(() => {\n        const handleKeyDown = (event: KeyboardEvent): void => {\n            if (!allowInteraction) {\n                return;\n            }\n\n            const handlers: KeyDownHandler[] = [\n                handleBatchLineDelete,\n                handleUndoRedo,\n            ];\n\n            for (const handler of handlers) {\n                const handled = handler(event, songDispatch);\n                if (handled) {\n                    event.preventDefault();\n                    return;\n                }\n            }\n        };\n\n        addKeyListener(handleKeyDown);\n\n        return () => removeKeyListener(handleKeyDown);\n    }, [allowInteraction, addKeyListener, removeKeyListener, songDispatch]);\n\n    const lines: List<JSX.Element> = (() => {\n        let lines = props.song.chordLines.list.flatMap((line: ChordLine) => {\n            return [\n                <Line\n                    key={line.id}\n                    chordLine={line}\n                    songDispatch={songDispatch}\n                    data-lineid={line.id}\n                    data-testid=\"Line\"\n                />,\n                <NewLine\n                    key={\"NewLine-\" + line.id}\n                    lineID={line}\n                    songDispatch={songDispatch}\n                    data-testid=\"NewLine\"\n                />,\n            ];\n        });\n\n        const firstNewLine = (\n            <NewLine\n                key={\"NewLine-Top\"}\n                lineID=\"beginning\"\n                songDispatch={songDispatch}\n                data-testid=\"NewLine-Top\"\n            />\n        );\n\n        lines = lines.splice(0, 0, firstNewLine);\n\n        return lines;\n    })();\n\n    const paperClassName = allowInteraction\n        ? undefined\n        : uninteractiveStyle.root;\n\n    return (\n        <InteractionContext.Provider value={interactionContextValue}>\n            <Paper\n                onCopy={allowInteraction ? handleCopy : undefined}\n                className={paperClassName}\n                elevation={0}\n                tabIndex={0}\n            >\n                <Grid container justify=\"center\">\n                    <Grid item xs={10}>\n                        {lines}\n                    </Grid>\n                </Grid>\n            </Paper>\n        </InteractionContext.Provider>\n    );\n};\n\nexport default ChordPaperBody;\n","import { List, Record } from \"immutable\";\nimport { useCallback, useReducer } from \"react\";\nimport { ChordBlock } from \"../../common/ChordModel/ChordBlock\";\nimport { ChordLine } from \"../../common/ChordModel/ChordLine\";\nimport { ChordSong } from \"../../common/ChordModel/ChordSong\";\nimport { IDable } from \"../../common/ChordModel/Collection\";\nimport { Lyric } from \"../../common/ChordModel/Lyric\";\nimport { Note } from \"../../common/music/foundation/Note\";\n\ntype ReplaceSong = {\n    type: \"replace-song\";\n    newSong: ChordSong;\n};\n\ntype Undo = {\n    type: \"undo\";\n};\n\ntype Redo = {\n    type: \"redo\";\n};\n\ntype SetHeader = {\n    type: \"set-header\";\n    title?: string;\n    composedBy?: string;\n    performedBy?: string;\n};\n\ntype SetLastSavedAt = {\n    type: \"set-last-saved-at\";\n    lastSavedAt: Date | null;\n};\n\ntype Transpose = {\n    type: \"transpose\";\n    originalKey: Note;\n    transposeKey: Note;\n};\n\ntype AddLine = {\n    type: \"add-line\";\n    lineID: IDable<ChordLine> | \"beginning\";\n};\n\ntype RemoveLine = {\n    type: \"remove-line\";\n    lineID: IDable<ChordLine>;\n};\n\ntype BatchInsertLines = {\n    type: \"batch-insert-lines\";\n    insertLineID: IDable<ChordLine>;\n    copiedLines: ChordLine[];\n};\n\ntype BatchRemoveLines = {\n    type: \"batch-remove-lines\";\n    lineIDs: IDable<ChordLine>[];\n};\n\ntype SplitLine = {\n    type: \"split-line\";\n    lineID: IDable<ChordLine>;\n    splitIndex: number;\n};\n\ntype MergeLines = {\n    type: \"merge-lines\";\n    latterLineID: IDable<ChordLine>;\n};\n\ntype InsertOverflowLyrics = {\n    type: \"insert-overflow-lyrics\";\n    insertionLineID: IDable<ChordLine>;\n    overflowLyrics: Lyric[];\n};\n\ntype ReplaceLineLyrics = {\n    type: \"replace-line-lyrics\";\n    line: ChordLine;\n    lineID: IDable<ChordLine>;\n    newLyric: Lyric;\n};\n\ntype SetChord = {\n    type: \"set-chord\";\n    lineID: IDable<ChordLine>;\n    blockID: IDable<ChordBlock>;\n    newChord: string;\n};\n\ntype SplitBlock = {\n    type: \"split-block\";\n    lineID: IDable<ChordLine>;\n    blockID: IDable<ChordBlock>;\n    splitIndex: number;\n};\n\ntype DragAndDropChord = {\n    type: \"drag-and-drop-chord\";\n    sourceBlockID: IDable<ChordBlock>;\n    newChord: string;\n    destinationBlockID: IDable<ChordBlock>;\n    splitIndex: number;\n    dropType: \"move\" | \"copy\";\n};\n\ntype SetSection = {\n    type: \"set-section\";\n    lineID: IDable<ChordLine>;\n    label?: string;\n    time?: number | null;\n};\n\nexport type ChordSongAction =\n    | ReplaceSong\n    | Undo\n    | Redo\n    | SetHeader\n    | SetLastSavedAt\n    | AddLine\n    | RemoveLine\n    | BatchInsertLines\n    | BatchRemoveLines\n    | SplitLine\n    | MergeLines\n    | InsertOverflowLyrics\n    | ReplaceLineLyrics\n    | DragAndDropChord\n    | SetChord\n    | SplitBlock\n    | SetSection\n    | Transpose;\n\nexport type ChordSongActionWithoutUndo = Exclude<\n    ChordSongAction,\n    Undo | Redo | SetLastSavedAt\n>;\n\ntype ChordPaperStateType = {\n    undoStack: List<ChordSong>;\n    currentSongIndex: number;\n    lastSavedAt: Date | null;\n};\n\nconst ChordPaperStateConstructor = Record<ChordPaperStateType>({\n    undoStack: List(),\n    currentSongIndex: -1,\n    lastSavedAt: null,\n});\n\ntype ChordPaperState = ReturnType<typeof ChordPaperStateConstructor>;\n\nconst getCurrentSong = (state: ChordPaperState): ChordSong => {\n    const currentSong: ChordSong | undefined = state.undoStack.get(\n        state.currentSongIndex\n    );\n\n    if (currentSong === undefined) {\n        throw new Error(\n            \"Invalid state: no valid entry found in undo stack for current state\"\n        );\n    }\n\n    return currentSong.set(\"lastSavedAt\", state.lastSavedAt);\n};\n\n// the separation between these two reducer functions is that\n// most operations don't need to understand then undo stack, only\n// undo and redo operations require it, so splitting these keeps each\n// easier to manage\nconst chordSongReducer = (\n    state: ChordPaperState,\n    action: ChordSongAction\n): ChordPaperState => {\n    switch (action.type) {\n        case \"undo\": {\n            if (state.currentSongIndex === 0) {\n                return state;\n            }\n\n            state = state.update(\"currentSongIndex\", (index) => index - 1);\n            return state;\n        }\n\n        case \"redo\": {\n            const lastIndex = state.undoStack.size - 1;\n\n            if (state.currentSongIndex === lastIndex) {\n                return state;\n            }\n\n            state = state.update(\"currentSongIndex\", (index) => index + 1);\n            return state;\n        }\n\n        case \"set-last-saved-at\": {\n            return state.set(\"lastSavedAt\", action.lastSavedAt);\n        }\n\n        default: {\n            const currentSong = getCurrentSong(state);\n            const newSong = chordSongReducerWithoutUndo(currentSong, action);\n            const currentSongIndex = state.currentSongIndex;\n\n            const blowAwayRedoStack = (\n                list: List<ChordSong>\n            ): List<ChordSong> => {\n                return list.slice(0, currentSongIndex + 1);\n            };\n\n            state = state.update(\"undoStack\", (list) => {\n                list = blowAwayRedoStack(list);\n                list = list.push(newSong);\n                return list;\n            });\n\n            state = state.update(\"currentSongIndex\", (index) => index + 1);\n\n            return state;\n        }\n    }\n};\n\nconst chordSongReducerWithoutUndo = (\n    song: ChordSong,\n    action: ChordSongActionWithoutUndo\n): ChordSong => {\n    switch (action.type) {\n        case \"replace-song\": {\n            return action.newSong;\n        }\n\n        case \"set-header\": {\n            if (action.title !== undefined) {\n                const title: string = action.title;\n                song = song.update(\"metadata\", (metadata) => ({\n                    ...metadata,\n                    title: title,\n                }));\n            }\n\n            if (action.composedBy !== undefined) {\n                const composedBy: string = action.composedBy;\n                song = song.update(\"metadata\", (metadata) => ({\n                    ...metadata,\n                    composedBy: composedBy,\n                }));\n            }\n\n            if (action.performedBy !== undefined) {\n                const performedBy: string = action.performedBy;\n                song = song.update(\"metadata\", (metadata) => ({\n                    ...metadata,\n                    performedBy: performedBy,\n                }));\n            }\n\n            return song;\n        }\n\n        case \"add-line\": {\n            if (action.lineID === \"beginning\") {\n                return song.addBeginning(new ChordLine({}));\n            }\n            return song.addAfter(action.lineID, new ChordLine({}));\n        }\n\n        case \"remove-line\": {\n            return song.removeElement(action.lineID);\n        }\n\n        case \"split-line\": {\n            const [newSong, splitted] = song.splitLine(\n                action.lineID,\n                action.splitIndex\n            );\n            if (!splitted) {\n                return song;\n            }\n\n            return newSong;\n        }\n\n        case \"merge-lines\": {\n            const [newSong, merged] = song.mergeLineWithPrevious(\n                action.latterLineID\n            );\n            if (!merged) {\n                return song;\n            }\n\n            return newSong;\n        }\n\n        case \"batch-insert-lines\": {\n            const currLine: ChordLine = song.get(action.insertLineID);\n\n            song = song.addAfter(action.insertLineID, ...action.copiedLines);\n\n            // if the line is empty, the user was probably trying to paste into the current line, and not the next\n            // so just remove the current line to simulate that\n            if (currLine.isEmpty()) {\n                song = song.removeElement(action.insertLineID);\n            }\n\n            return song;\n        }\n\n        case \"batch-remove-lines\": {\n            return song.removeMultipleElements(action.lineIDs);\n        }\n\n        case \"replace-line-lyrics\": {\n            return song.replaceElement(action.lineID, (line) => {\n                return line.replaceLyrics(action.newLyric);\n            });\n        }\n\n        case \"insert-overflow-lyrics\": {\n            const newChordLines: ChordLine[] = action.overflowLyrics.map(\n                (newLyricLine: Lyric) => ChordLine.fromLyrics(newLyricLine)\n            );\n            return song.addAfter(action.insertionLineID, ...newChordLines);\n        }\n\n        case \"set-chord\": {\n            return song.replaceElement(action.lineID, (line) => {\n                return line.setChord(action.blockID, action.newChord);\n            });\n        }\n\n        case \"split-block\": {\n            return song.replaceElement(action.lineID, (line) => {\n                return line.splitBlock(action.blockID, action.splitIndex);\n            });\n        }\n\n        case \"drag-and-drop-chord\": {\n            let sourceLine = song.findLineWithBlock(action.sourceBlockID);\n\n            let destinationLine = song.findLineWithBlock(\n                action.destinationBlockID\n            );\n\n            const sameLine = sourceLine === destinationLine;\n            const syncSameLines = (newLine: ChordLine) => {\n                if (sameLine) {\n                    sourceLine = newLine;\n                    destinationLine = newLine;\n                }\n            };\n\n            if (action.dropType === \"move\") {\n                // clearing the source block first allows handling of when the chord\n                // is dropped onto another token in the same block without special cases\n                sourceLine = sourceLine.replaceElement(\n                    action.sourceBlockID,\n                    (block) => block.set(\"chord\", \"\")\n                );\n\n                syncSameLines(sourceLine);\n            }\n\n            if (action.splitIndex !== 0) {\n                destinationLine = destinationLine.splitBlock(\n                    action.destinationBlockID,\n                    action.splitIndex\n                );\n\n                syncSameLines(destinationLine);\n            }\n\n            destinationLine = destinationLine.replaceElement(\n                action.destinationBlockID,\n                (block) => {\n                    return block.set(\"chord\", action.newChord);\n                }\n            );\n\n            syncSameLines(destinationLine);\n\n            if (sameLine) {\n                sourceLine = sourceLine.normalizeBlocks();\n                syncSameLines(sourceLine);\n            } else {\n                sourceLine = sourceLine.normalizeBlocks();\n                destinationLine = destinationLine.normalizeBlocks();\n            }\n\n            song = song.replaceElement(sourceLine, () => sourceLine);\n            song = song.replaceElement(destinationLine, () => destinationLine);\n\n            return song;\n        }\n\n        case \"set-section\": {\n            const updateName = (line: ChordLine): ChordLine => {\n                if (action.label !== undefined) {\n                    [line] = line.setSectionName(action.label);\n                }\n\n                return line;\n            };\n\n            const updateTime = (line: ChordLine): ChordLine => {\n                if (action.time !== undefined) {\n                    [line] = line.setSectionTime(action.time);\n                }\n\n                return line;\n            };\n\n            return song.updateCollection((elements) => {\n                return elements.replace(action.lineID, (line) => {\n                    line = updateName(line);\n                    line = updateTime(line);\n                    return line;\n                });\n            });\n        }\n\n        case \"transpose\": {\n            return song.transpose(action.originalKey, action.transposeKey);\n        }\n    }\n};\n\nexport const useChordSongReducer = (\n    initialSong: ChordSong,\n    onChange?: (newSong: ChordSong, action: ChordSongAction) => void\n): [ChordSong, React.Dispatch<ChordSongAction>] => {\n    const reducerWithChangeCallback = useCallback(\n        (state: ChordPaperState, action: ChordSongAction): ChordPaperState => {\n            const newState = chordSongReducer(state, action);\n            const newSong = getCurrentSong(state);\n\n            onChange?.(newSong, action);\n\n            return newState;\n        },\n        [onChange]\n    );\n\n    const initialState = ChordPaperStateConstructor({\n        undoStack: List([initialSong]),\n        currentSongIndex: 0,\n        lastSavedAt: initialSong.lastSavedAt,\n    });\n\n    const [state, dispatch] = useReducer(\n        reducerWithChangeCallback,\n        initialState\n    );\n\n    const currentSong = getCurrentSong(state);\n\n    return [currentSong, dispatch];\n};\n","import {\n    Badge as UnstyledBadge,\n    Paper,\n    Theme,\n    withStyles,\n} from \"@material-ui/core\";\nimport UnstyledCheckCircleIcon from \"@material-ui/icons/CheckCircle\";\nimport React, { useEffect, useState } from \"react\";\nimport { ChordSong } from \"../../common/ChordModel/ChordSong\";\nimport ChordPaperBody from \"../edit/ChordPaperBody\";\nimport { useChordSongReducer } from \"../reducer/reducer\";\n\nconst CheckCircleIcon = withStyles((theme: Theme) => ({\n    root: {\n        color: theme.palette.success.main,\n    },\n}))(UnstyledCheckCircleIcon);\n\nconst Badge = withStyles({\n    root: {\n        display: \"inherit\",\n    },\n})(UnstyledBadge);\n\ninterface PlaygroundProps {\n    initialSong: ChordSong;\n    expectedSong?: ChordSong;\n}\n\nconst Playground: React.FC<PlaygroundProps> = (\n    props: PlaygroundProps\n): JSX.Element => {\n    const [song, songDispatch] = useChordSongReducer(props.initialSong);\n\n    const [finish, setFinish] = useState(false);\n\n    const { expectedSong } = props;\n\n    useEffect(() => {\n        // don't undo the green check if it's already been passing\n        if (finish) {\n            return;\n        }\n\n        if (expectedSong !== undefined && expectedSong.contentEquals(song)) {\n            setFinish(true);\n        }\n    }, [song, expectedSong, finish, setFinish]);\n\n    return (\n        <Badge badgeContent={<CheckCircleIcon />} invisible={!finish}>\n            <Paper elevation={1}>\n                <ChordPaperBody song={song} songDispatch={songDispatch} />\n            </Paper>\n        </Badge>\n    );\n};\n\nexport default Playground;\n","import { Typography } from \"@material-ui/core\";\nimport React from \"react\";\nimport { ChordBlock } from \"../../common/ChordModel/ChordBlock\";\nimport { ChordLine } from \"../../common/ChordModel/ChordLine\";\nimport { ChordSong } from \"../../common/ChordModel/ChordSong\";\nimport { Lyric } from \"../../common/ChordModel/Lyric\";\nimport { ChordTypography, LineBreak, LyricsTypography } from \"./Common\";\nimport Playground from \"./Playground\";\n\nconst AddChord: React.FC<{}> = (): JSX.Element => {\n    const initialSong = new ChordSong({\n        lines: [\n            new ChordLine({\n                blocks: [\n                    new ChordBlock({\n                        chord: \"C^\",\n                        lyric: new Lyric(\"Why do birds suddenly appear?\"),\n                    }),\n                ],\n            }),\n        ],\n    });\n\n    const expectedSong = new ChordSong({\n        lines: [\n            new ChordLine({\n                blocks: [\n                    new ChordBlock({\n                        chord: \"C^\",\n                        lyric: new Lyric(\"Why do birds suddenly \"),\n                    }),\n                    new ChordBlock({\n                        chord: \"B7\",\n                        lyric: new Lyric(\"appear?\"),\n                    }),\n                ],\n            }),\n        ],\n    });\n\n    return (\n        <>\n            <Typography variant=\"h5\">Adding Chords</Typography>\n            <LineBreak />\n            <Typography>\n                Add a chord by hovering above a word, and clicking the outlined\n                box. Let's add{\" \"}\n                <ChordTypography display=\"inline\">B7</ChordTypography> back\n                above{\" \"}\n                <LyricsTypography display=\"inline\">appear</LyricsTypography>.\n            </Typography>\n            <LineBreak />\n            <Typography>Try it!</Typography>\n            <Playground initialSong={initialSong} expectedSong={expectedSong} />\n        </>\n    );\n};\n\nexport default AddChord;\n","import { Typography } from \"@material-ui/core\";\nimport React from \"react\";\nimport { ChordBlock } from \"../../common/ChordModel/ChordBlock\";\nimport { ChordLine } from \"../../common/ChordModel/ChordLine\";\nimport { ChordSong } from \"../../common/ChordModel/ChordSong\";\nimport { Lyric } from \"../../common/ChordModel/Lyric\";\nimport { LineBreak, LyricsTypography } from \"./Common\";\nimport Playground from \"./Playground\";\n\nconst AddLine: React.FC<{}> = (): JSX.Element => {\n    const initialSong = new ChordSong({\n        lines: [\n            new ChordLine({\n                blocks: [\n                    new ChordBlock({\n                        chord: \"C^\",\n                        lyric: new Lyric(\"Why do birds suddenly ap-\"),\n                    }),\n                    new ChordBlock({\n                        chord: \"B7sus4\",\n                        lyric: new Lyric(\"pear?\"),\n                    }),\n                    new ChordBlock({ chord: \"B7\", lyric: new Lyric(\"\\ue200\") }),\n                ],\n            }),\n        ],\n    });\n\n    const expectedSong = new ChordSong({\n        lines: [\n            new ChordLine({\n                blocks: [\n                    new ChordBlock({\n                        chord: \"C^\",\n                        lyric: new Lyric(\"Why do birds suddenly ap-\"),\n                    }),\n                    new ChordBlock({\n                        chord: \"B7sus4\",\n                        lyric: new Lyric(\"pear?\"),\n                    }),\n                    new ChordBlock({ chord: \"B7\", lyric: new Lyric(\"\\ue200\") }),\n                ],\n            }),\n            new ChordLine({\n                blocks: [\n                    new ChordBlock({\n                        chord: \"\",\n                        lyric: new Lyric(\"Every time you are near\"),\n                    }),\n                ],\n            }),\n        ],\n    });\n\n    return (\n        <>\n            <Typography variant=\"h5\">Adding New Lines</Typography>\n            <LineBreak />\n            <Typography>\n                You can add more lines by hovering below (or above) and existing\n                line, and clicking the gray line or the add icon to the right.\n            </Typography>\n            <Typography>Let's add a line, and change the lyrics to:</Typography>\n            <LyricsTypography>Why do birds suddenly ap-pear?</LyricsTypography>\n            <LyricsTypography>Every time you are near</LyricsTypography>\n            <LineBreak />\n            <Typography>Try it!</Typography>\n            <Playground initialSong={initialSong} expectedSong={expectedSong} />\n        </>\n    );\n};\n\nexport default AddLine;\n","import React from \"react\";\nimport { Typography } from \"@material-ui/core\";\nimport Playground from \"./Playground\";\nimport { ChordSong } from \"../../common/ChordModel/ChordSong\";\nimport { ChordLine } from \"../../common/ChordModel/ChordLine\";\nimport { ChordBlock } from \"../../common/ChordModel/ChordBlock\";\nimport { LineBreak, LyricsTypography, ChordTypography } from \"./Common\";\nimport { Lyric } from \"../../common/ChordModel/Lyric\";\n\nconst ChordPositioning: React.FC<{}> = (): JSX.Element => {\n    const initialSong = new ChordSong({\n        lines: [\n            new ChordLine({\n                blocks: [\n                    new ChordBlock({\n                        chord: \"C^\",\n                        lyric: new Lyric(\"Why do birds suddenly \"),\n                    }),\n                    new ChordBlock({\n                        chord: \"\",\n                        lyric: new Lyric(\"appear?\"),\n                    }),\n                ],\n            }),\n        ],\n    });\n\n    const example = new ChordSong({\n        lines: [\n            new ChordLine({\n                blocks: [\n                    new ChordBlock({\n                        chord: \"C^\",\n                        lyric: new Lyric(\"Why do birds suddenly\"),\n                    }),\n                    new ChordBlock({\n                        chord: \"F#7\",\n                        lyric: new Lyric(\" ap-\"),\n                    }),\n                    new ChordBlock({\n                        chord: \"B7sus4\",\n                        lyric: new Lyric(\"pear?\"),\n                    }),\n                    new ChordBlock({ chord: \"B7\", lyric: new Lyric(\"\\ue200\") }),\n                ],\n            }),\n        ],\n    });\n\n    const expectedSong = new ChordSong({\n        lines: [\n            new ChordLine({\n                blocks: [\n                    new ChordBlock({\n                        chord: \"C^\",\n                        lyric: new Lyric(\"Why do birds suddenly\"),\n                    }),\n                    new ChordBlock({\n                        chord: \"F#7\",\n                        lyric: new Lyric(\" ap-\"),\n                    }),\n                    new ChordBlock({\n                        chord: \"B7sus4\",\n                        lyric: new Lyric(\"pear?\"),\n                    }),\n                    new ChordBlock({ chord: \"B7\", lyric: new Lyric(\"\\ue200\") }),\n                ],\n            }),\n        ],\n    });\n\n    return (\n        <>\n            <Typography variant=\"h5\">Chord Positioning</Typography>\n            <LineBreak />\n            <Typography>\n                Sometimes you want to emphasize a chord landing on a specific\n                syllable or between words. Without the overhead of standard\n                notation, we can do this by breaking up lyrics and annotating\n                spaces.\n            </Typography>\n            <LineBreak />\n\n            <Typography>Let's change the lyrics to:</Typography>\n            <LyricsTypography>Why do birds suddenly ap-pear?</LyricsTypography>\n            <Typography>\n                And add a tab after the{\" \"}\n                <LyricsTypography display=\"inline\">?</LyricsTypography>\n            </Typography>\n            <Typography>\n                Then add the chord{\" \"}\n                <ChordTypography display=\"inline\">F#7</ChordTypography> to the\n                space before{\" \"}\n                <LyricsTypography display=\"inline\">ap-</LyricsTypography>\n            </Typography>\n            <Typography>\n                Add the chord{\" \"}\n                <ChordTypography display=\"inline\">B7sus4</ChordTypography> to{\" \"}\n                <LyricsTypography display=\"inline\">pear</LyricsTypography>\n            </Typography>\n            <Typography>\n                Add the chord{\" \"}\n                <ChordTypography display=\"inline\">B7</ChordTypography> to the\n                tabbed space after{\" \"}\n            </Typography>\n            <Typography>It should look like this:</Typography>\n            <Playground initialSong={example} />\n            <LineBreak />\n            <Typography>Try it!</Typography>\n            <Playground initialSong={initialSong} expectedSong={expectedSong} />\n        </>\n    );\n};\n\nexport default ChordPositioning;\n","import { Typography } from \"@material-ui/core\";\nimport React from \"react\";\nimport { ChordBlock } from \"../../common/ChordModel/ChordBlock\";\nimport { ChordLine } from \"../../common/ChordModel/ChordLine\";\nimport { ChordSong } from \"../../common/ChordModel/ChordSong\";\nimport { Lyric } from \"../../common/ChordModel/Lyric\";\nimport { LineBreak, LyricsTypography } from \"./Common\";\nimport Playground from \"./Playground\";\n\nconst CopyAndPaste: React.FC<{}> = (): JSX.Element => {\n    const initialSong = new ChordSong({\n        lines: [\n            new ChordLine({\n                blocks: [\n                    new ChordBlock({\n                        chord: \"\",\n                        lyric: new Lyric(\"But I'm a \"),\n                    }),\n                    new ChordBlock({\n                        chord: \"G\",\n                        lyric: new Lyric(\"creep, I'm a \"),\n                    }),\n                    new ChordBlock({\n                        chord: \"B7\",\n                        lyric: new Lyric(\"weirdo\"),\n                    }),\n                ],\n            }),\n            new ChordLine({\n                blocks: [\n                    new ChordBlock({\n                        chord: \"\",\n                        lyric: new Lyric(\"What the hell am doing \"),\n                    }),\n                    new ChordBlock({\n                        chord: \"C\",\n                        lyric: new Lyric(\"here? I don't be-\"),\n                    }),\n                    new ChordBlock({\n                        chord: \"Cm\",\n                        lyric: new Lyric(\"long here\"),\n                    }),\n                ],\n            }),\n            new ChordLine({\n                blocks: [\n                    new ChordBlock({\n                        chord: \"\",\n                        lyric: new Lyric(\"I don't care if it \"),\n                    }),\n                    new ChordBlock({\n                        chord: \"G\",\n                        lyric: new Lyric(\"hurts, I wanna have con-\"),\n                    }),\n                    new ChordBlock({ chord: \"B7\", lyric: new Lyric(\"trol\") }),\n                ],\n            }),\n            new ChordLine({\n                blocks: [\n                    new ChordBlock({\n                        chord: \"\",\n                        lyric: new Lyric(\"I want a perfect \"),\n                    }),\n                    new ChordBlock({\n                        chord: \"C\",\n                        lyric: new Lyric(\"body, I want a perfect \"),\n                    }),\n                    new ChordBlock({ chord: \"Cm\", lyric: new Lyric(\"soul\") }),\n                ],\n            }),\n            new ChordLine({\n                blocks: [\n                    new ChordBlock({\n                        chord: \"\",\n                        lyric: new Lyric(\"I want you to \"),\n                    }),\n                    new ChordBlock({\n                        chord: \"G\",\n                        lyric: new Lyric(\"notice when I'm not a-\"),\n                    }),\n                    new ChordBlock({\n                        chord: \"B7\",\n                        lyric: new Lyric(\"round\"),\n                    }),\n                ],\n            }),\n            new ChordLine({\n                blocks: [\n                    new ChordBlock({\n                        chord: \"\",\n                        lyric: new Lyric(\"You're so fucking \"),\n                    }),\n                    new ChordBlock({\n                        chord: \"C\",\n                        lyric: new Lyric(\"special, I wish I was \"),\n                    }),\n                    new ChordBlock({\n                        chord: \"Cm\",\n                        lyric: new Lyric(\"special\"),\n                    }),\n                ],\n            }),\n        ],\n    });\n\n    const expectedSong = new ChordSong({\n        lines: [\n            new ChordLine({\n                blocks: [\n                    new ChordBlock({\n                        chord: \"\",\n                        lyric: new Lyric(\"But I'm a \"),\n                    }),\n                    new ChordBlock({\n                        chord: \"G\",\n                        lyric: new Lyric(\"creep, I'm a \"),\n                    }),\n                    new ChordBlock({\n                        chord: \"B7\",\n                        lyric: new Lyric(\"weirdo\"),\n                    }),\n                ],\n            }),\n            new ChordLine({\n                blocks: [\n                    new ChordBlock({\n                        chord: \"\",\n                        lyric: new Lyric(\"What the hell am doing \"),\n                    }),\n                    new ChordBlock({\n                        chord: \"C\",\n                        lyric: new Lyric(\"here? I don't be-\"),\n                    }),\n                    new ChordBlock({\n                        chord: \"Cm\",\n                        lyric: new Lyric(\"long here\"),\n                    }),\n                ],\n            }),\n            new ChordLine({\n                blocks: [\n                    new ChordBlock({\n                        chord: \"\",\n                        lyric: new Lyric(\"I don't care if it \"),\n                    }),\n                    new ChordBlock({\n                        chord: \"G\",\n                        lyric: new Lyric(\"hurts, I wanna have con-\"),\n                    }),\n                    new ChordBlock({ chord: \"B7\", lyric: new Lyric(\"trol\") }),\n                ],\n            }),\n            new ChordLine({\n                blocks: [\n                    new ChordBlock({\n                        chord: \"\",\n                        lyric: new Lyric(\"I want a perfect \"),\n                    }),\n                    new ChordBlock({\n                        chord: \"C\",\n                        lyric: new Lyric(\"body, I want a perfect \"),\n                    }),\n                    new ChordBlock({ chord: \"Cm\", lyric: new Lyric(\"soul\") }),\n                ],\n            }),\n            new ChordLine({\n                blocks: [\n                    new ChordBlock({\n                        chord: \"\",\n                        lyric: new Lyric(\"I want you to \"),\n                    }),\n                    new ChordBlock({\n                        chord: \"G\",\n                        lyric: new Lyric(\"notice when I'm not a-\"),\n                    }),\n                    new ChordBlock({\n                        chord: \"B7\",\n                        lyric: new Lyric(\"round\"),\n                    }),\n                ],\n            }),\n            new ChordLine({\n                blocks: [\n                    new ChordBlock({\n                        chord: \"\",\n                        lyric: new Lyric(\"You're so fucking \"),\n                    }),\n                    new ChordBlock({\n                        chord: \"C\",\n                        lyric: new Lyric(\"special, I wish I was \"),\n                    }),\n                    new ChordBlock({\n                        chord: \"Cm\",\n                        lyric: new Lyric(\"special\"),\n                    }),\n                ],\n            }),\n            new ChordLine({\n                blocks: [\n                    new ChordBlock({\n                        chord: \"\",\n                        lyric: new Lyric(\"But I'm a \"),\n                    }),\n                    new ChordBlock({\n                        chord: \"G\",\n                        lyric: new Lyric(\"creep, I'm a \"),\n                    }),\n                    new ChordBlock({\n                        chord: \"B7\",\n                        lyric: new Lyric(\"weirdo\"),\n                    }),\n                ],\n            }),\n            new ChordLine({\n                blocks: [\n                    new ChordBlock({\n                        chord: \"\",\n                        lyric: new Lyric(\"What the hell am doing \"),\n                    }),\n                    new ChordBlock({\n                        chord: \"C\",\n                        lyric: new Lyric(\"here? I don't be-\"),\n                    }),\n                    new ChordBlock({\n                        chord: \"Cm\",\n                        lyric: new Lyric(\"long here\"),\n                    }),\n                ],\n            }),\n        ],\n    });\n\n    return (\n        <>\n            <Typography variant=\"h5\">Copying and Pasting Lines</Typography>\n            <LineBreak />\n            <Typography>\n                Sometimes you want to just repeat what's on the page without\n                entering it all over again - choruses with the same lyrics,\n                repeating instrumental sections. You can do this by copying and\n                pasting entire lines that you've already written out.\n            </Typography>\n            <LineBreak />\n            <Typography>\n                The easiest way to copy is to drag down from some empty space on\n                the left of the line you wish to start copying from, then\n                pressing (CTRL or CMD) + C, or right click {\"->\"} copy.\n            </Typography>\n            <LineBreak />\n            <Typography>\n                To paste, click to edit a lyric line, and press (CTRL or CMD) +\n                V, or right click {\"->\"} paste.\n            </Typography>\n            <LineBreak />\n            <Typography>\n                Note that there's no partial copy - if any part of the line is\n                selected during the copy, the whole line is copied.\n            </Typography>\n            <LineBreak />\n            <Typography>\n                If you have trouble selecting a line, try dragging your cursor\n                starting further left and above the line.\n            </Typography>\n            <LineBreak />\n            <Typography>\n                Let's try copying and pasting the repeated chorus:\n            </Typography>\n            <LyricsTypography variantMapping={{ body1: \"div\" }}>\n                But I'm a creep, I'm a weirdo\n            </LyricsTypography>\n            <LyricsTypography variantMapping={{ body1: \"div\" }}>\n                What the hell am I doing here? I don't belong here.\n            </LyricsTypography>\n            <LineBreak />\n            <Typography>\n                Copy those two lines, add a new line at the bottom, and paste it\n                there.\n            </Typography>\n\n            <LineBreak />\n            <Typography>Try it!</Typography>\n            <Playground initialSong={initialSong} expectedSong={expectedSong} />\n        </>\n    );\n};\n\nexport default CopyAndPaste;\n","import { Typography } from \"@material-ui/core\";\nimport React from \"react\";\nimport { ChordBlock } from \"../../common/ChordModel/ChordBlock\";\nimport { ChordLine } from \"../../common/ChordModel/ChordLine\";\nimport { ChordSong } from \"../../common/ChordModel/ChordSong\";\nimport { Lyric } from \"../../common/ChordModel/Lyric\";\nimport { ChordTypography, LineBreak, LyricsTypography } from \"./Common\";\nimport Playground from \"./Playground\";\n\nconst DragAndDropChord: React.FC<{}> = (): JSX.Element => {\n    const initialSong = new ChordSong({\n        lines: [\n            new ChordLine({\n                blocks: [\n                    new ChordBlock({\n                        chord: \"C^\",\n                        lyric: new Lyric(\"Why do birds \"),\n                    }),\n                    new ChordBlock({\n                        chord: \"B7\",\n                        lyric: new Lyric(\"suddenly appear?\"),\n                    }),\n                ],\n            }),\n        ],\n    });\n\n    const expectedSong = new ChordSong({\n        lines: [\n            new ChordLine({\n                blocks: [\n                    new ChordBlock({\n                        chord: \"C^\",\n                        lyric: new Lyric(\"Why do birds suddenly \"),\n                    }),\n                    new ChordBlock({\n                        chord: \"B7\",\n                        lyric: new Lyric(\"appear?\"),\n                    }),\n                ],\n            }),\n        ],\n    });\n\n    return (\n        <>\n            <Typography variant=\"h5\">Dragging and Dropping Chords</Typography>\n            <LineBreak />\n            <Typography>\n                It's also possible to drag and drop chords onto different parts\n                of the line when its initial placement wasn't quite correct.\n                Just drag a chord and drop it to the space above or on another\n                lyric.\n            </Typography>\n            <LineBreak />\n            <Typography>\n                If you hold CTRL/CMD/ALT/Option while dragging and dropping, the\n                chord will be copied instead of moved over.\n            </Typography>\n            <LineBreak />\n            <Typography>\n                Let's move the{\" \"}\n                <ChordTypography display=\"inline\">B7</ChordTypography> above{\" \"}\n                <LyricsTypography display=\"inline\">suddenly</LyricsTypography>{\" \"}\n                to above{\" \"}\n                <LyricsTypography display=\"inline\">appear</LyricsTypography>.\n            </Typography>\n            <LineBreak />\n            <Typography>Try it!</Typography>\n            <Playground initialSong={initialSong} expectedSong={expectedSong} />\n        </>\n    );\n};\n\nexport default DragAndDropChord;\n","import { Typography } from \"@material-ui/core\";\nimport React from \"react\";\nimport { ChordBlock } from \"../../common/ChordModel/ChordBlock\";\nimport { ChordLine } from \"../../common/ChordModel/ChordLine\";\nimport { ChordSong } from \"../../common/ChordModel/ChordSong\";\nimport { Lyric } from \"../../common/ChordModel/Lyric\";\nimport { ChordTypography, LineBreak, LyricsTypography } from \"./Common\";\nimport Playground from \"./Playground\";\n\nconst EditChord: React.FC<{}> = (): JSX.Element => {\n    const initialSong = new ChordSong({\n        lines: [\n            new ChordLine({\n                blocks: [\n                    new ChordBlock({\n                        chord: \"C^\",\n                        lyric: new Lyric(\"Why do birds suddenly \"),\n                    }),\n                    new ChordBlock({\n                        chord: \"Bm\",\n                        lyric: new Lyric(\"appear?\"),\n                    }),\n                ],\n            }),\n        ],\n    });\n\n    const expectedSong = new ChordSong({\n        lines: [\n            new ChordLine({\n                blocks: [\n                    new ChordBlock({\n                        chord: \"C^\",\n                        lyric: new Lyric(\"Why do birds suddenly \"),\n                    }),\n                    new ChordBlock({\n                        chord: \"B7\",\n                        lyric: new Lyric(\"appear?\"),\n                    }),\n                ],\n            }),\n        ],\n    });\n\n    return (\n        <>\n            <Typography variant=\"h5\">Editing Chords</Typography>\n            <LineBreak />\n            <Typography>\n                Click on a chord to change it, then press enter to commit your\n                changes. Let's change the chord above{\" \"}\n                <LyricsTypography display=\"inline\">appear</LyricsTypography>{\" \"}\n                from <ChordTypography display=\"inline\">Bm</ChordTypography> to{\" \"}\n                <ChordTypography display=\"inline\">B7</ChordTypography>.\n            </Typography>\n            <LineBreak />\n            <Typography>Try it!</Typography>\n            <Playground initialSong={initialSong} expectedSong={expectedSong} />\n        </>\n    );\n};\n\nexport default EditChord;\n","import { Typography } from \"@material-ui/core\";\nimport React from \"react\";\nimport { ChordBlock } from \"../../common/ChordModel/ChordBlock\";\nimport { ChordLine } from \"../../common/ChordModel/ChordLine\";\nimport { ChordSong } from \"../../common/ChordModel/ChordSong\";\nimport { Lyric } from \"../../common/ChordModel/Lyric\";\nimport { LineBreak, LyricsTypography } from \"./Common\";\nimport Playground from \"./Playground\";\n\nconst EditLyrics: React.FC<{}> = (): JSX.Element => {\n    const initialSong = new ChordSong({\n        lines: [\n            new ChordLine({\n                blocks: [\n                    new ChordBlock({\n                        chord: \"C^\",\n                        lyric: new Lyric(\"Why do birds suddenly \"),\n                    }),\n                    new ChordBlock({\n                        chord: \"B7\",\n                        lyric: new Lyric(\"appear?\"),\n                    }),\n                ],\n            }),\n        ],\n    });\n\n    const expectedSong = new ChordSong({\n        lines: [\n            new ChordLine({\n                blocks: [\n                    new ChordBlock({\n                        chord: \"C^\",\n                        lyric: new Lyric(\"Why oh why do birds suddenly \"),\n                    }),\n                    new ChordBlock({\n                        chord: \"B7\",\n                        lyric: new Lyric(\"appear?\"),\n                    }),\n                ],\n            }),\n        ],\n    });\n\n    return (\n        <>\n            <Typography variant=\"h5\">Editing Lyrics</Typography>\n            <LineBreak />\n            <Typography>\n                You can edit the lyrics by clicking anywhere along the lyrics.\n                Finish editing lyrics by pressing enter or clicking outside the\n                text edit box. Chord Paper will move chords along with lyrics\n                when you edit them. Let's change the lyrics to:\n            </Typography>\n            <LyricsTypography>\n                Why oh why do birds suddenly appear?\n            </LyricsTypography>\n            <LineBreak />\n            <Typography>Try it!</Typography>\n            <Playground initialSong={initialSong} expectedSong={expectedSong} />\n        </>\n    );\n};\n\nexport default EditLyrics;\n","import { Typography } from \"@material-ui/core\";\nimport React from \"react\";\nimport { ChordBlock } from \"../../common/ChordModel/ChordBlock\";\nimport { ChordLine } from \"../../common/ChordModel/ChordLine\";\nimport { ChordSong } from \"../../common/ChordModel/ChordSong\";\nimport { Lyric } from \"../../common/ChordModel/Lyric\";\nimport { ChordTypography, LineBreak, LyricsTypography } from \"./Common\";\nimport Playground from \"./Playground\";\n\nconst Instrumental: React.FC<{}> = (): JSX.Element => {\n    const tabExample = new ChordSong({\n        lines: [\n            new ChordLine({\n                blocks: [\n                    new ChordBlock({ chord: \"Bm\", lyric: new Lyric(\"\\ue200\") }),\n                    new ChordBlock({ chord: \"A\", lyric: new Lyric(\"\\ue200\") }),\n                    new ChordBlock({ chord: \"E\", lyric: new Lyric(\"\\ue400\") }),\n                ],\n            }),\n        ],\n    });\n\n    const initialSong = new ChordSong({});\n\n    const expectedSong = new ChordSong({\n        lines: [\n            new ChordLine({\n                blocks: [\n                    new ChordBlock({ chord: \"Bm\", lyric: new Lyric(\"\\ue200\") }),\n                    new ChordBlock({ chord: \"A\", lyric: new Lyric(\"\\ue200\") }),\n                    new ChordBlock({ chord: \"E\", lyric: new Lyric(\"\\ue400\") }),\n                ],\n            }),\n        ],\n    });\n\n    return (\n        <>\n            <Typography variant=\"h5\">Instrumental Sections</Typography>\n            <LineBreak />\n            <Typography>\n                In addition to putting chords over lyrics, you can also put them\n                in the spaces between lyrics. When there are no lyrics around\n                the harmony, you can use tabs to create spacing in the lyrics\n                for placing chords.\n            </Typography>\n            <LineBreak />\n            <Typography>\n                You can do this by hitting{\" \"}\n                <LyricsTypography display=\"inline\">tab</LyricsTypography> when\n                editting lyrics, for a normal sized tab, or{\" \"}\n                <LyricsTypography display=\"inline\">\n                    SHIFT + space\n                </LyricsTypography>{\" \"}\n                for a small sized tab, or{\" \"}\n                <LyricsTypography display=\"inline\">\n                    SHIFT + tab\n                </LyricsTypography>{\" \"}\n                for a large sized tab.\n            </Typography>\n            <Playground initialSong={tabExample} />\n            <LineBreak />\n            <Typography>\n                Let's replicate the example from above using{\" \"}\n                <LyricsTypography display=\"inline\">tab</LyricsTypography>s.\n                Start by editing the lyrics. Insert two normal sized tabs with\n                the <LyricsTypography display=\"inline\">tab</LyricsTypography>{\" \"}\n                key, and a large sized tab using{\" \"}\n                <LyricsTypography display=\"inline\">\n                    SHIFT + tab\n                </LyricsTypography>{\" \"}\n                key. Then add{\" \"}\n                <ChordTypography display=\"inline\">Bm</ChordTypography>,{\" \"}\n                <ChordTypography display=\"inline\">A</ChordTypography>,{\" \"}\n                <ChordTypography display=\"inline\">E</ChordTypography>,{\" \"}\n                respectively to each tab.\n            </Typography>\n            <LineBreak />\n            <Typography>Try it!</Typography>\n            <Playground initialSong={initialSong} expectedSong={expectedSong} />\n        </>\n    );\n};\n\nexport default Instrumental;\n","import { Typography } from \"@material-ui/core\";\nimport React from \"react\";\nimport { ChordBlock } from \"../../common/ChordModel/ChordBlock\";\nimport { ChordLine } from \"../../common/ChordModel/ChordLine\";\nimport { ChordSong } from \"../../common/ChordModel/ChordSong\";\nimport { Lyric } from \"../../common/ChordModel/Lyric\";\nimport { LineBreak } from \"./Common\";\nimport Playground from \"./Playground\";\n\nconst MergeLine: React.FC<{}> = (): JSX.Element => {\n    const initialSong = new ChordSong({\n        lines: [\n            new ChordLine({\n                blocks: [\n                    new ChordBlock({\n                        chord: \"C^\",\n                        lyric: new Lyric(\"Why do birds\"),\n                    }),\n                ],\n            }),\n            new ChordLine({\n                blocks: [\n                    new ChordBlock({\n                        chord: \"\",\n                        lyric: new Lyric(\"suddenly \"),\n                    }),\n                    new ChordBlock({\n                        chord: \"B7\",\n                        lyric: new Lyric(\"appear?\"),\n                    }),\n                ],\n            }),\n        ],\n    });\n\n    const expectedSong = new ChordSong({\n        lines: [\n            new ChordLine({\n                blocks: [\n                    new ChordBlock({\n                        chord: \"C^\",\n                        lyric: new Lyric(\"Why do birds suddenly \"),\n                    }),\n                    new ChordBlock({\n                        chord: \"B7\",\n                        lyric: new Lyric(\"appear?\"),\n                    }),\n                ],\n            }),\n        ],\n    });\n\n    return (\n        <>\n            <Typography variant=\"h5\">Merging Lines</Typography>\n            <LineBreak />\n            <Typography>\n                Sometimes the lyrics that we paste in is not the division we\n                want. Let's merge the two lines. Click into the second line,\n                move the cursor to the beginning of the line, and press\n            </Typography>\n            <Typography>\n                (CTRL+Backspace : Windows | CMD+Backspace : Mac)\n            </Typography>\n            <LineBreak />\n            <Typography>Try it!</Typography>\n            <Playground initialSong={initialSong} expectedSong={expectedSong} />\n        </>\n    );\n};\n\nexport default MergeLine;\n","import { Typography } from \"@material-ui/core\";\nimport React from \"react\";\nimport { ChordBlock } from \"../../common/ChordModel/ChordBlock\";\nimport { ChordLine } from \"../../common/ChordModel/ChordLine\";\nimport { ChordSong } from \"../../common/ChordModel/ChordSong\";\nimport { Lyric } from \"../../common/ChordModel/Lyric\";\nimport { LineBreak, LyricsTypography } from \"./Common\";\nimport Playground from \"./Playground\";\n\nconst PasteLyrics: React.FC<{}> = (): JSX.Element => {\n    const initialSong = new ChordSong({\n        lines: [\n            new ChordLine({\n                blocks: [\n                    new ChordBlock({\n                        chord: \"C^\",\n                        lyric: new Lyric(\"Why do birds suddenly ap-\"),\n                    }),\n                    new ChordBlock({\n                        chord: \"B7sus4\",\n                        lyric: new Lyric(\"pear?\"),\n                    }),\n                    new ChordBlock({ chord: \"B7\", lyric: new Lyric(\"\\ue200\") }),\n                ],\n            }),\n            new ChordLine({}),\n        ],\n    });\n\n    const expectedSong = new ChordSong({\n        lines: [\n            new ChordLine({\n                blocks: [\n                    new ChordBlock({\n                        chord: \"C^\",\n                        lyric: new Lyric(\"Why do birds suddenly ap-\"),\n                    }),\n                    new ChordBlock({\n                        chord: \"B7sus4\",\n                        lyric: new Lyric(\"pear?\"),\n                    }),\n                    new ChordBlock({ chord: \"B7\", lyric: new Lyric(\"\\ue200\") }),\n                ],\n            }),\n            new ChordLine({\n                blocks: [\n                    new ChordBlock({\n                        chord: \"\",\n                        lyric: new Lyric(\"Every time you are near\"),\n                    }),\n                ],\n            }),\n            new ChordLine({\n                blocks: [\n                    new ChordBlock({\n                        chord: \"\",\n                        lyric: new Lyric(\"Just like me, they long to be\"),\n                    }),\n                ],\n            }),\n            new ChordLine({\n                blocks: [\n                    new ChordBlock({\n                        chord: \"\",\n                        lyric: new Lyric(\"Close to you\"),\n                    }),\n                ],\n            }),\n        ],\n    });\n\n    return (\n        <>\n            <Typography variant=\"h5\">Pasting Lyrics</Typography>\n            <LineBreak />\n            <Typography>\n                It would be annoying to have to type out the lyrics. But we can\n                paste it in! Copy these lyrics, click into the second line, and\n                paste:\n            </Typography>\n            <LyricsTypography variantMapping={{ body1: \"div\" }}>\n                Every time you are near\n            </LyricsTypography>\n            <LyricsTypography variantMapping={{ body1: \"div\" }}>\n                Just like me, they long to be\n            </LyricsTypography>\n            <LyricsTypography variantMapping={{ body1: \"div\" }}>\n                Close to you\n            </LyricsTypography>\n\n            <LineBreak />\n            <Typography>Try it!</Typography>\n            <Playground initialSong={initialSong} expectedSong={expectedSong} />\n        </>\n    );\n};\n\nexport default PasteLyrics;\n","import { Typography } from \"@material-ui/core\";\nimport React from \"react\";\nimport { ChordBlock } from \"../../common/ChordModel/ChordBlock\";\nimport { ChordLine } from \"../../common/ChordModel/ChordLine\";\nimport { ChordSong } from \"../../common/ChordModel/ChordSong\";\nimport { Lyric } from \"../../common/ChordModel/Lyric\";\nimport { ChordTypography, LineBreak } from \"./Common\";\nimport Playground from \"./Playground\";\n\nconst RemoveChord: React.FC<{}> = (): JSX.Element => {\n    const initialSong = new ChordSong({\n        lines: [\n            new ChordLine({\n                blocks: [\n                    new ChordBlock({\n                        chord: \"C^\",\n                        lyric: new Lyric(\"Why do birds suddenly \"),\n                    }),\n                    new ChordBlock({\n                        chord: \"B7\",\n                        lyric: new Lyric(\"appear?\"),\n                    }),\n                ],\n            }),\n        ],\n    });\n\n    const expectedSong = new ChordSong({\n        lines: [\n            new ChordLine({\n                blocks: [\n                    new ChordBlock({\n                        chord: \"C^\",\n                        lyric: new Lyric(\"Why do birds suddenly appear?\"),\n                    }),\n                ],\n            }),\n        ],\n    });\n\n    return (\n        <>\n            <Typography variant=\"h5\">Removing Chords</Typography>\n            <LineBreak />\n            <Typography>\n                Simply remove all the chord text when editing to clear the\n                chord. Let's remove the{\" \"}\n                <ChordTypography display=\"inline\">B7</ChordTypography>.\n            </Typography>\n            <LineBreak />\n            <Typography>Try it!</Typography>\n            <Playground initialSong={initialSong} expectedSong={expectedSong} />\n        </>\n    );\n};\n\nexport default RemoveChord;\n","import { Typography, withStyles } from \"@material-ui/core\";\nimport red from \"@material-ui/core/colors/red\";\nimport UnstyledBackspaceIcon from \"@material-ui/icons/Backspace\";\nimport React from \"react\";\nimport { ChordBlock } from \"../../common/ChordModel/ChordBlock\";\nimport { ChordLine } from \"../../common/ChordModel/ChordLine\";\nimport { ChordSong } from \"../../common/ChordModel/ChordSong\";\nimport { Lyric } from \"../../common/ChordModel/Lyric\";\nimport { LineBreak } from \"./Common\";\nimport Playground from \"./Playground\";\n\nconst BackspaceIcon = withStyles({\n    root: {\n        color: red[300],\n    },\n})(UnstyledBackspaceIcon);\n\nconst RemoveLine: React.FC<{}> = (): JSX.Element => {\n    const initialSong = new ChordSong({\n        lines: [\n            new ChordLine({\n                blocks: [\n                    new ChordBlock({\n                        chord: \"C^\",\n                        lyric: new Lyric(\"Why do birds suddenly ap-\"),\n                    }),\n                    new ChordBlock({\n                        chord: \"B7sus4\",\n                        lyric: new Lyric(\"pear?\"),\n                    }),\n                    new ChordBlock({ chord: \"B7\", lyric: new Lyric(\"\\ue200\") }),\n                ],\n            }),\n            new ChordLine({\n                blocks: [\n                    new ChordBlock({\n                        chord: \"\",\n                        lyric: new Lyric(\"Every time you are near\"),\n                    }),\n                ],\n            }),\n        ],\n    });\n\n    const expectedSong = new ChordSong({\n        lines: [\n            new ChordLine({\n                blocks: [\n                    new ChordBlock({\n                        chord: \"C^\",\n                        lyric: new Lyric(\"Why do birds suddenly ap-\"),\n                    }),\n                    new ChordBlock({\n                        chord: \"B7sus4\",\n                        lyric: new Lyric(\"pear?\"),\n                    }),\n                    new ChordBlock({ chord: \"B7\", lyric: new Lyric(\"\\ue200\") }),\n                ],\n            }),\n        ],\n    });\n\n    return (\n        <>\n            <Typography variant=\"h5\">Removing Lines</Typography>\n            <LineBreak />\n            <Typography>\n                Similarly, you can remove a line by hovering over the line, and\n                clicking the <BackspaceIcon /> icon to the right. Let's remove\n                the second line of lyrics.\n            </Typography>\n            <LineBreak />\n            <Typography>Try it!</Typography>\n            <Playground initialSong={initialSong} expectedSong={expectedSong} />\n        </>\n    );\n};\n\nexport default RemoveLine;\n","import { Typography } from \"@material-ui/core\";\nimport React from \"react\";\nimport { LineBreak } from \"./Common\";\n\nconst Header = () => {\n    return <Typography variant=\"h5\">Learning Chord Paper</Typography>;\n};\n\nconst Preamble = () => {\n    return (\n        <>\n            <Typography>\n                Chord Paper aims to be as intuitive and handy as possible, but\n                there could still be features that aren't obvious as we work out\n                the kinks. Let's walk through the basics together by making some\n                changes to chords and lyrics!\n            </Typography>\n            <LineBreak />\n            <Typography>\n                Since Chord Paper is still in early stages, some of these could\n                change in the future.\n            </Typography>\n        </>\n    );\n};\n\nconst Starting: React.FC<{}> = (): JSX.Element => {\n    return (\n        <>\n            <Header />\n            <LineBreak />\n            <Preamble />\n        </>\n    );\n};\n\nexport default Starting;\n","import { Typography, withStyles } from \"@material-ui/core\";\nimport ChatBubbleIcon from \"@material-ui/icons/ChatBubbleOutline\";\nimport React from \"react\";\nimport { ChordBlock } from \"../../common/ChordModel/ChordBlock\";\nimport { ChordLine } from \"../../common/ChordModel/ChordLine\";\nimport { ChordSong } from \"../../common/ChordModel/ChordSong\";\nimport { Lyric } from \"../../common/ChordModel/Lyric\";\nimport { sectionLabelStyle } from \"../display/SectionLabel\";\nimport { LineBreak } from \"./Common\";\nimport Playground from \"./Playground\";\n\nconst LabelTypography = withStyles(sectionLabelStyle)(Typography);\n\nconst Labels: React.FC<{}> = (): JSX.Element => {\n    const initialSong = new ChordSong({\n        lines: [\n            new ChordLine({\n                blocks: [\n                    new ChordBlock({\n                        chord: \"C^\",\n                        lyric: new Lyric(\"Why do birds suddenly ap-\"),\n                    }),\n                    new ChordBlock({\n                        chord: \"B7sus4\",\n                        lyric: new Lyric(\"pear?\"),\n                    }),\n                    new ChordBlock({ chord: \"B7\", lyric: new Lyric(\"\\ue200\") }),\n                ],\n            }),\n            new ChordLine({\n                blocks: [\n                    new ChordBlock({\n                        chord: \"\",\n                        lyric: new Lyric(\"Every time you are near\"),\n                    }),\n                ],\n            }),\n        ],\n    });\n\n    const expectedSong = new ChordSong({\n        lines: [\n            new ChordLine({\n                blocks: [\n                    new ChordBlock({\n                        chord: \"C^\",\n                        lyric: new Lyric(\"Why do birds suddenly ap-\"),\n                    }),\n                    new ChordBlock({\n                        chord: \"B7sus4\",\n                        lyric: new Lyric(\"pear?\"),\n                    }),\n                    new ChordBlock({\n                        chord: \"B7\",\n                        lyric: new Lyric(\"\\ue200\"),\n                    }),\n                ],\n                section: {\n                    type: \"label\",\n                    name: \"Verse\",\n                },\n            }),\n            new ChordLine({\n                blocks: [\n                    new ChordBlock({\n                        chord: \"\",\n                        lyric: new Lyric(\"Every time you are near\"),\n                    }),\n                ],\n            }),\n        ],\n    });\n\n    return (\n        <>\n            <Typography variant=\"h5\">Labels</Typography>\n            <LineBreak />\n            <Typography>\n                It's common to label sections to navigate easily within the\n                song. For example, some common labels are \"Verse\", \"Chorus\",\n                \"Bridge\", or more simplified markers like \"A\", \"B\", etc.\n            </Typography>\n            <LineBreak />\n            <Typography>\n                Add a label to a line by hovering over the line, and then\n                clicking the <ChatBubbleIcon /> icon to insert a label for that\n                line. Let's add{\" \"}\n                <LabelTypography display=\"inline\">Verse</LabelTypography> to the\n                first line.\n            </Typography>\n            <LineBreak />\n            <Typography>Try it!</Typography>\n            <Playground initialSong={initialSong} expectedSong={expectedSong} />\n        </>\n    );\n};\n\nexport default Labels;\n","import { Typography } from \"@material-ui/core\";\nimport PlayIcon from \"@material-ui/icons/PlayArrow\";\nimport React from \"react\";\nimport { LineBreak } from \"./Common\";\n\nconst PlayMode: React.FC<{}> = (): JSX.Element => {\n    return (\n        <>\n            <Typography variant=\"h5\">Play Mode</Typography>\n            <LineBreak />\n            <Typography>\n                Play mode is where you focus on playing the song rather than\n                writing or transcribing it. The chords and lyrics are laid out\n                for ease of reading while playing through.\n            </Typography>\n            <LineBreak />\n            <Typography>\n                To go forward a page, left click anywhere on the page, or tap\n                any button except the buttons that go back a page.\n            </Typography>\n            <LineBreak />\n            <Typography>\n                To go back a page, right click anywhere on the page, or tap\n                left, up, or backspace.\n            </Typography>\n            <LineBreak />\n            <Typography>\n                Try this by going into your own song or the demo song, hovering\n                over the menu icon on the bottom right, and clicking the{\" \"}\n                <PlayIcon /> icon.\n            </Typography>\n        </>\n    );\n};\n\nexport default PlayMode;\n","import { Typography } from \"@material-ui/core\";\nimport React from \"react\";\nimport { ChordBlock } from \"../../common/ChordModel/ChordBlock\";\nimport { ChordLine } from \"../../common/ChordModel/ChordLine\";\nimport { ChordSong } from \"../../common/ChordModel/ChordSong\";\nimport { Lyric } from \"../../common/ChordModel/Lyric\";\nimport { LineBreak, LyricsTypography } from \"./Common\";\nimport Playground from \"./Playground\";\n\nconst SplitLine: React.FC<{}> = (): JSX.Element => {\n    const initialSong = new ChordSong({\n        lines: [\n            new ChordLine({\n                blocks: [\n                    new ChordBlock({\n                        chord: \"C^\",\n                        lyric: new Lyric(\"Why do birds suddenly ap-\"),\n                    }),\n\n                    new ChordBlock({\n                        chord: \"B7sus4\",\n                        lyric: new Lyric(\"pear? Every \"),\n                    }),\n                    new ChordBlock({\n                        chord: \"B7\",\n                        lyric: new Lyric(\"time you are near\"),\n                    }),\n                ],\n            }),\n        ],\n    });\n\n    const expectedSong = new ChordSong({\n        lines: [\n            new ChordLine({\n                blocks: [\n                    new ChordBlock({\n                        chord: \"C^\",\n                        lyric: new Lyric(\"Why do birds suddenly ap-\"),\n                    }),\n\n                    new ChordBlock({\n                        chord: \"B7sus4\",\n                        lyric: new Lyric(\"pear? \"),\n                    }),\n                ],\n            }),\n            new ChordLine({\n                blocks: [\n                    new ChordBlock({\n                        chord: \"\",\n                        lyric: new Lyric(\"Every \"),\n                    }),\n                    new ChordBlock({\n                        chord: \"B7\",\n                        lyric: new Lyric(\"time you are near\"),\n                    }),\n                ],\n            }),\n        ],\n    });\n\n    return (\n        <>\n            <Typography variant=\"h5\">Splitting Lines</Typography>\n            <LineBreak />\n            <Typography>\n                Similarly, we can split lines that may be too long for our chart\n                into two lines. Move the cursor to where you want the line to\n                split, and press\n            </Typography>\n            <Typography>(CTRL+Enter : Windows | CMD+Enter : Mac)</Typography>\n            <LineBreak />\n            <Typography>\n                Right now, chords won't move to the subsequent line - only\n                lyrics will. This can be worked around by dragging and dropping\n                chords after until the feature is cleaned up.\n            </Typography>\n            <LineBreak />\n            <Typography>\n                Let's break the one long line of lyrics up, so that it looks\n                like:\n            </Typography>\n            <LyricsTypography>Why do birds suddenly appear?</LyricsTypography>\n            <LyricsTypography>Every time you are near</LyricsTypography>\n            <LineBreak />\n            <Typography>Try it!</Typography>\n            <Playground initialSong={initialSong} expectedSong={expectedSong} />\n        </>\n    );\n};\n\nexport default SplitLine;\n","import { Typography } from \"@material-ui/core\";\nimport CloudUploadIcon from \"@material-ui/icons/CloudUpload\";\nimport React from \"react\";\nimport { LineBreak } from \"./Common\";\n\nconst Saving: React.FC<{}> = (): JSX.Element => {\n    return (\n        <>\n            <Typography variant=\"h5\">Saving and Loading</Typography>\n            <LineBreak />\n            <Typography>\n                You can save and load your songs if you have logged in. When you\n                want to save your song to the cloud, hover to the bottom right\n                menu and click <CloudUploadIcon /> to commit the song. After the\n                song is saved once, it will continue to save any changes\n                automatically.\n            </Typography>\n            <LineBreak />\n            <Typography>\n                If you don't want to sign in or save your songs to the cloud, I\n                get it. You can also reveal (offline) Save and Load menu icons\n                in the bottom right menu by entering the Konami code to save and\n                load the files striaght to your computer.\n            </Typography>\n        </>\n    );\n};\n\nexport default Saving;\n","import { Typography } from \"@material-ui/core\";\nimport React from \"react\";\nimport { ChordBlock } from \"../../common/ChordModel/ChordBlock\";\nimport { ChordLine } from \"../../common/ChordModel/ChordLine\";\nimport { ChordSong } from \"../../common/ChordModel/ChordSong\";\nimport { Lyric } from \"../../common/ChordModel/Lyric\";\nimport { LineBreak } from \"./Common\";\nimport Playground from \"./Playground\";\n\nconst RemoveMultipleLines: React.FC<{}> = (): JSX.Element => {\n    const initialSong = new ChordSong({\n        lines: [\n            new ChordLine({\n                blocks: [\n                    new ChordBlock({\n                        chord: \"C^\",\n                        lyric: new Lyric(\"Why do birds suddenly ap-\"),\n                    }),\n                    new ChordBlock({\n                        chord: \"B7sus4\",\n                        lyric: new Lyric(\"pear?\"),\n                    }),\n                    new ChordBlock({ chord: \"B7\", lyric: new Lyric(\"\\ue200\") }),\n                ],\n            }),\n            new ChordLine({\n                blocks: [\n                    new ChordBlock({\n                        chord: \"\",\n                        lyric: new Lyric(\"Every \"),\n                    }),\n                    new ChordBlock({\n                        chord: \"Bm7\",\n                        lyric: new Lyric(\"time you are \"),\n                    }),\n                    new ChordBlock({\n                        chord: \"Em7\",\n                        lyric: new Lyric(\"near\"),\n                    }),\n                ],\n            }),\n            new ChordLine({\n                blocks: [\n                    new ChordBlock({\n                        chord: \"Am7\",\n                        lyric: new Lyric(\"Just like me, \"),\n                    }),\n                    new ChordBlock({\n                        chord: \"D7\",\n                        lyric: new Lyric(\"they long to be\"),\n                    }),\n                ],\n            }),\n            new ChordLine({\n                blocks: [\n                    new ChordBlock({\n                        chord: \"G^\",\n                        lyric: new Lyric(\"Close to you\"),\n                    }),\n                ],\n            }),\n        ],\n    });\n\n    const expectedSong = new ChordSong({\n        lines: [\n            new ChordLine({\n                blocks: [\n                    new ChordBlock({\n                        chord: \"C^\",\n                        lyric: new Lyric(\"Why do birds suddenly ap-\"),\n                    }),\n                    new ChordBlock({\n                        chord: \"B7sus4\",\n                        lyric: new Lyric(\"pear?\"),\n                    }),\n                    new ChordBlock({ chord: \"B7\", lyric: new Lyric(\"\\ue200\") }),\n                ],\n            }),\n        ],\n    });\n\n    return (\n        <>\n            <Typography variant=\"h5\">Removing Multiple Lines</Typography>\n            <LineBreak />\n            <Typography>\n                You can remove multiple lines at once by dragging and selecting\n                over multiple lines, and then pressing Backspace/Delete.\n            </Typography>\n            <LineBreak />\n            <Typography>Let's remove the last three lines.</Typography>\n            <Typography>Try it!</Typography>\n            <Playground initialSong={initialSong} expectedSong={expectedSong} />\n        </>\n    );\n};\n\nexport default RemoveMultipleLines;\n","import { SvgIcon, SvgIconProps } from \"@material-ui/core\";\nimport React from \"react\";\n\nconst BeginningIcon: React.FC<SvgIconProps> = (props: SvgIconProps) => {\n    return (\n        <SvgIcon {...props}>\n            <path d=\"M6 6h2v12h-2z m1.5 6l8 6V6z m7 0 l8 6V6z\" />\n        </SvgIcon>\n    );\n};\n\nexport default BeginningIcon;\n","import { SvgIcon, SvgIconProps } from \"@material-ui/core\";\nimport React from \"react\";\n\nconst ForwardIcon: React.FC<SvgIconProps> = (props: SvgIconProps) => {\n    return (\n        <SvgIcon {...props}>\n            <path d=\"M18,13c0,3.31-2.69,6-6,6s-6-2.69-6-6s2.69-6,6-6v4l5-5l-5-5v4c-4.42,0-8,3.58-8,8c0,4.42,3.58,8,8,8c4.42,0,8-3.58,8-8 H18z\" />\n        </SvgIcon>\n    );\n};\n\nexport default ForwardIcon;\n","import { Button as UnstyledButton, Theme, Tooltip } from \"@material-ui/core\";\nimport { ButtonProps } from \"@material-ui/core/Button\";\nimport DecreaseIcon from \"@material-ui/icons/ArrowDropDown\";\nimport IncreaseIcon from \"@material-ui/icons/ArrowDropUp\";\nimport PauseIcon from \"@material-ui/icons/Pause\";\nimport PlayIcon from \"@material-ui/icons/PlayArrow\";\nimport JumpBackIcon from \"@material-ui/icons/Replay\";\nimport SkipForwardIcon from \"@material-ui/icons/SkipNext\";\nimport SkipBackIcon from \"@material-ui/icons/SkipPrevious\";\nimport { withStyles } from \"@material-ui/styles\";\nimport React from \"react\";\nimport BeginningIcon from \"./BeginningIcon\";\nimport { roundedCornersStyle } from \"../common\";\nimport JumpForwardIcon from \"./ForwardIcon\";\n\nconst Button = withStyles((theme: Theme) => ({\n    root: {\n        minWidth: 0,\n        ...roundedCornersStyle(theme),\n    },\n}))(UnstyledButton);\n\nconst PrimaryButton = withStyles((theme: Theme) => ({\n    root: {\n        color: theme.palette.primary.main,\n    },\n}))(Button);\n\nconst SecondaryButton = withStyles((theme: Theme) => ({\n    root: {\n        color: theme.palette.secondary.main,\n    },\n}))(Button);\n\nconst makeControlButton = (\n    child: React.ReactElement,\n    key: string,\n    tooltipMsg: string,\n    color: \"primary\" | \"secondary\"\n): React.FC<ButtonProps> => {\n    const ColoredButton = color === \"primary\" ? PrimaryButton : SecondaryButton;\n\n    // the keyboard usage of the player collides with any keyboard triggers of control buttons\n    // so disable them entirely, which may happen through keyups\n    const preventKeyInvocation = (\n        event: React.KeyboardEvent<HTMLButtonElement>\n    ) => {\n        event.preventDefault();\n    };\n\n    return (props: ButtonProps) => (\n        <Tooltip key={key} title={tooltipMsg}>\n            <span>\n                <ColoredButton\n                    {...props}\n                    onKeyUp={preventKeyInvocation}\n                    size=\"large\"\n                >\n                    {child}\n                </ColoredButton>\n            </span>\n        </Tooltip>\n    );\n};\n\nexport const ControlButton = {\n    Play: makeControlButton(\n        <PlayIcon />,\n        \"play-button\",\n        \"Play the damn song\",\n        \"primary\"\n    ),\n    Pause: makeControlButton(\n        <PauseIcon />,\n        \"pause-button\",\n        \"Pause\",\n        \"secondary\"\n    ),\n    JumpBack: makeControlButton(\n        <JumpBackIcon />,\n        \"jump-back-buttonn\",\n        \"Jump Back\",\n        \"primary\"\n    ),\n    JumpForward: makeControlButton(\n        <JumpForwardIcon />,\n        \"jump-forward-button\",\n        \"Jump Forward\",\n        \"primary\"\n    ),\n    SkipBack: makeControlButton(\n        <SkipBackIcon />,\n        \"skip-back-button\",\n        \"Go back a section\",\n        \"primary\"\n    ),\n    SkipForward: makeControlButton(\n        <SkipForwardIcon />,\n        \"skip-back-button\",\n        \"Go forward a section\",\n        \"primary\"\n    ),\n    Beginning: makeControlButton(\n        <BeginningIcon />,\n        \"beginning-button\",\n        \"Go to Beginning\",\n        \"primary\"\n    ),\n    DecreasePlayrate: makeControlButton(\n        <DecreaseIcon />,\n        \"decrease-playrate-button\",\n        \"Play slower\",\n        \"primary\"\n    ),\n    IncreasePlayrate: makeControlButton(\n        <IncreaseIcon />,\n        \"increase-playrate-button\",\n        \"Play faster\",\n        \"primary\"\n    ),\n    TransposeDown: makeControlButton(\n        <DecreaseIcon />,\n        \"transpose-down-button\",\n        \"Transpose down half step\",\n        \"primary\"\n    ),\n    TransposeUp: makeControlButton(\n        <IncreaseIcon />,\n        \"transpose-up-button\",\n        \"Transpose up half step\",\n        \"primary\"\n    ),\n};\n","import { Box, Divider, Theme } from \"@material-ui/core\";\nimport { StyledComponentProps, withStyles } from \"@material-ui/styles\";\nimport React from \"react\";\n\nexport const ControlGroupBox = withStyles({\n    root: {\n        display: \"flex\",\n        alignContent: \"center\",\n        flexShrink: 0,\n        flexGrow: 0,\n    },\n})(Box);\n\nexport const VerticalMiddleDivider = withStyles((theme: Theme) => ({\n    root: {\n        marginLeft: 0,\n        marginRight: 0,\n        marginTop: theme.spacing(1.5),\n        marginBottom: theme.spacing(1.5),\n    },\n}))(Divider);\n\ninterface ControlGroupProps extends StyledComponentProps {\n    children: React.ReactNode[];\n    dividers: \"left\" | \"right\";\n    edgeDivider?: boolean;\n}\n\nconst ControlGroup: React.FC<ControlGroupProps> = (\n    props: ControlGroupProps\n): JSX.Element => {\n    const isRealNode = (node: React.ReactNode): boolean => {\n        return node !== null && node !== undefined;\n    };\n\n    const realContents: React.ReactNode[] = props.children.filter(isRealNode);\n\n    const contents: React.ReactElement[] = realContents.map(\n        (child: React.ReactNode, index: number) => {\n            const isEdge =\n                (props.dividers === \"left\" && index === 0) ||\n                (props.dividers === \"right\" &&\n                    index === realContents.length - 1);\n\n            if (props.edgeDivider !== true && isEdge) {\n                return <React.Fragment key={index}>{child}</React.Fragment>;\n            }\n\n            const divider = (\n                <VerticalMiddleDivider\n                    key={`divider-${index}`}\n                    orientation=\"vertical\"\n                    flexItem\n                />\n            );\n\n            const content: React.ReactNode[] =\n                props.dividers === \"right\"\n                    ? [child, divider]\n                    : [divider, child];\n\n            return <React.Fragment key={index}>{content}</React.Fragment>;\n        }\n    );\n\n    return (\n        <ControlGroupBox classes={props.classes}>{contents}</ControlGroupBox>\n    );\n};\n\nexport default ControlGroup;\n","import { Box, Theme, Tooltip, Typography } from \"@material-ui/core\";\nimport { withStyles } from \"@material-ui/styles\";\nimport React from \"react\";\nimport { greyTextColour, widthOfString } from \"../common\";\nimport { ControlButton } from \"./ControlButton\";\nimport { ControlGroupBox } from \"./ControlGroup\";\n\nconst PlayrateBox = withStyles({\n    root: {\n        justifyContent: \"space-between\",\n    },\n})(ControlGroupBox);\n\nconst PercentageDisplay = withStyles((theme: Theme) => {\n    return {\n        root: {\n            color: greyTextColour,\n            minWidth: widthOfString(theme, \"h6\", \"200%\"),\n            display: \"flex\",\n            justifyContent: \"center\",\n        },\n    };\n})(Typography);\n\ninterface PlayrateControlProps {\n    playratePercentage: number;\n    onChange: (newPlayratePercentage: number) => void;\n}\n\nconst PlayrateControl: React.FC<PlayrateControlProps> = (\n    props: PlayrateControlProps\n): JSX.Element => {\n    const playrate = Math.round(props.playratePercentage);\n    const interval = 5;\n    const percentage: string = `${playrate}%`;\n\n    const onDecrease = () => props.onChange(playrate - interval);\n    const onIncrease = () => props.onChange(playrate + interval);\n\n    const decreaseDisabled = playrate - interval < 50;\n    const increaseDisabled = playrate + interval > 100;\n\n    return (\n        <PlayrateBox>\n            <ControlButton.DecreasePlayrate\n                onClick={onDecrease}\n                disabled={decreaseDisabled}\n            />\n            <Tooltip title=\"Playback speed\">\n                <PercentageDisplay variant=\"h6\">\n                    <Box>{percentage}</Box>\n                </PercentageDisplay>\n            </Tooltip>\n\n            <ControlButton.IncreasePlayrate\n                onClick={onIncrease}\n                disabled={increaseDisabled}\n            />\n        </PlayrateBox>\n    );\n};\n\nexport default PlayrateControl;\n","import { Box, Theme, Typography } from \"@material-ui/core\";\nimport { withStyles } from \"@material-ui/styles\";\nimport React from \"react\";\nimport { greyTextColour } from \"../common\";\n\nconst SectionLabelBox = withStyles((theme: Theme) => ({\n    root: {\n        marginLeft: theme.spacing(1.5),\n        marginRight: theme.spacing(1.5),\n        color: greyTextColour,\n        flexShrink: 1,\n        flexGrow: 1,\n        display: \"flex\",\n        justifyContent: \"center\",\n    },\n}))(Box);\n\ninterface SectionLabelProps {\n    value: string;\n}\n\nconst SectionLabel: React.FC<SectionLabelProps> = (\n    props: SectionLabelProps\n) => {\n    if (props.value === \"\") {\n        return null;\n    }\n\n    return (\n        <SectionLabelBox>\n            <Typography variant=\"body1\">{props.value}</Typography>\n        </SectionLabelBox>\n    );\n};\n\nexport default SectionLabel;\n","import { Box, Theme, Tooltip, Typography } from \"@material-ui/core\";\nimport { withStyles } from \"@material-ui/styles\";\nimport React from \"react\";\nimport { greyTextColour } from \"../common\";\nimport { ControlButton } from \"./ControlButton\";\nimport { ControlGroupBox } from \"./ControlGroup\";\n\nconst TransposeBox = withStyles({\n    root: {\n        justifyContent: \"space-between\",\n    },\n})(ControlGroupBox);\n\nconst TransposeDisplay = withStyles((theme: Theme) => {\n    return {\n        root: {\n            color: greyTextColour,\n            display: \"flex\",\n            justifyContent: \"center\",\n        },\n    };\n})(Typography);\n\ninterface TransposeControlProps {\n    transposeLevel: number;\n    onChange: (newTransposeLevel: number) => void;\n}\n\nconst TransposeControl: React.FC<TransposeControlProps> = (\n    props: TransposeControlProps\n): JSX.Element => {\n    const playrate = Math.round(props.transposeLevel);\n    const interval = 1;\n\n    const onDecrease = () => props.onChange(playrate - interval);\n    const onIncrease = () => props.onChange(playrate + interval);\n\n    const decreaseDisabled = playrate - interval < -12;\n    const increaseDisabled = playrate + interval > 12;\n\n    const transposeText: string = (() => {\n        if (props.transposeLevel > 0) {\n            return `${props.transposeLevel}`;\n        }\n\n        if (props.transposeLevel < 0) {\n            return `${-props.transposeLevel}`;\n        }\n\n        return \"0\";\n    })();\n\n    return (\n        <TransposeBox>\n            <ControlButton.TransposeDown\n                onClick={onDecrease}\n                disabled={decreaseDisabled}\n            />\n            <Tooltip title=\"Transposition\">\n                <TransposeDisplay variant=\"h6\">\n                    <Box>{transposeText}</Box>\n                </TransposeDisplay>\n            </Tooltip>\n            <ControlButton.TransposeUp\n                onClick={onIncrease}\n                disabled={increaseDisabled}\n            />\n        </TransposeBox>\n    );\n};\n\nexport default TransposeControl;\n","import { Box, Theme } from \"@material-ui/core\";\nimport { withStyles } from \"@material-ui/styles\";\nimport React, { useEffect } from \"react\";\nimport { PlainFn } from \"../../../common/PlainFn\";\nimport { useRegisterTopKeyListener } from \"../../GlobalKeyListener\";\nimport { controlPaneStyle } from \"../common\";\nimport { ControlButton } from \"./ControlButton\";\nimport ControlGroup from \"./ControlGroup\";\nimport PlayrateControl from \"./PlayrateControl\";\nimport SectionLabel from \"./SectionLabel\";\nimport TransposeControl from \"./TransposeControl\";\nimport { ButtonActionAndState } from \"./usePlayerControls\";\n\ninterface ControlPaneProps {\n    show: boolean;\n    playing: boolean;\n    onTogglePlay: PlainFn;\n    onJumpBack: PlainFn;\n    onJumpForward: PlainFn;\n    onGoToBeginning: PlainFn;\n    onSkipBack: ButtonActionAndState;\n    onSkipForward: ButtonActionAndState;\n    playrate: {\n        percentage: number;\n        onChange: (newPercentage: number) => void;\n    };\n    transpose?: {\n        level: number;\n        onChange: (newLevel: number) => void;\n    };\n    sectionLabel: string;\n}\n\nconst RightJustifiedControlGroup = withStyles({\n    root: {\n        marginLeft: \"auto\",\n    },\n})(ControlGroup);\n\nexport const ControlPaneBox = withStyles((theme: Theme) => {\n    const buttonHeight = theme.spacing(5);\n    return {\n        root: {\n            ...controlPaneStyle,\n            justifyContent: \"space-between\",\n            // these series of CSS allows flex items\n            // to be \"pushed off\" when they run out of space\n            flexWrap: \"wrap\",\n            overflow: \"hidden\",\n            maxHeight: buttonHeight,\n        },\n    };\n})(Box);\n\nconst ControlPane: React.FC<ControlPaneProps> = (\n    props: ControlPaneProps\n): JSX.Element => {\n    const [addTopKeyListener, removeKeyListener] = useRegisterTopKeyListener();\n\n    const playPauseButton = props.playing ? (\n        <ControlButton.Pause onClick={props.onTogglePlay} />\n    ) : (\n        <ControlButton.Play onClick={props.onTogglePlay} />\n    );\n\n    useEffect(() => {\n        if (!props.show) {\n            return;\n        }\n\n        const handleKey = (event: KeyboardEvent) => {\n            switch (event.code) {\n                case \"Space\": {\n                    props.onTogglePlay();\n                    event.preventDefault();\n\n                    break;\n                }\n                case \"ArrowLeft\": {\n                    if (event.ctrlKey || event.metaKey) {\n                        props.onSkipBack.action();\n                    } else {\n                        props.onJumpBack();\n                    }\n\n                    event.preventDefault();\n                    break;\n                }\n                case \"ArrowRight\": {\n                    if (event.ctrlKey || event.metaKey) {\n                        props.onSkipForward.action();\n                    } else {\n                        props.onJumpForward();\n                    }\n\n                    event.preventDefault();\n                    return;\n                }\n            }\n        };\n\n        addTopKeyListener(handleKey);\n        return () => {\n            removeKeyListener(handleKey);\n        };\n    }, [props, addTopKeyListener, removeKeyListener]);\n\n    const transposeControl: JSX.Element | null = (() => {\n        if (props.transpose === undefined) {\n            return null;\n        }\n\n        return (\n            <ControlGroup dividers=\"left\" edgeDivider>\n                {[\n                    <TransposeControl\n                        key=\"transpose-control\"\n                        transposeLevel={props.transpose.level}\n                        onChange={props.transpose.onChange}\n                    />,\n                ]}\n            </ControlGroup>\n        );\n    })();\n\n    return (\n        <ControlPaneBox>\n            <ControlGroup dividers=\"right\">\n                <ControlButton.Beginning onClick={props.onGoToBeginning} />\n                <ControlButton.SkipBack\n                    disabled={!props.onSkipBack.enabled}\n                    onClick={props.onSkipBack.action}\n                />\n                <ControlButton.JumpBack onClick={props.onJumpBack} />\n                {playPauseButton}\n                <ControlButton.JumpForward onClick={props.onJumpForward} />\n                <ControlButton.SkipForward\n                    disabled={!props.onSkipForward.enabled}\n                    onClick={props.onSkipForward.action}\n                />\n            </ControlGroup>\n            <SectionLabel value={props.sectionLabel} />\n            <RightJustifiedControlGroup dividers=\"left\">\n                {[\n                    <PlayrateControl\n                        key=\"playrate-control\"\n                        playratePercentage={props.playrate.percentage}\n                        onChange={props.playrate.onChange}\n                    />,\n                ]}\n            </RightJustifiedControlGroup>\n            {transposeControl}\n        </ControlPaneBox>\n    );\n};\n\nexport default ControlPane;\n","import {\n    Box,\n    Button as UnstyledButton,\n    Grid,\n    Slider,\n    Theme,\n    Typography,\n} from \"@material-ui/core\";\nimport {\n    blueGrey,\n    grey,\n    lightBlue,\n    lightGreen,\n    pink,\n    purple,\n    yellow,\n} from \"@material-ui/core/colors\";\nimport { withStyles } from \"@material-ui/styles\";\nimport React from \"react\";\n\nconst FullSizedBox = withStyles((theme: Theme) => ({\n    root: {\n        width: \"100%\",\n        paddingLeft: theme.spacing(1.5),\n        paddingRight: theme.spacing(1.5),\n    },\n}))(Box);\n\nconst VolumeSlider = withStyles({\n    root: {\n        color: blueGrey[400],\n    },\n})(Slider);\n\nconst withColoredButtonStyle = (color: string) => {\n    return withStyles((theme: Theme) => ({\n        root: {\n            backgroundColor: color,\n            width: \"100%\",\n            height: \"100%\",\n            color: grey[700],\n            padding: theme.spacing(0.5),\n            textTransform: \"none\",\n            \"&:hover\": {\n                opacity: 0.6,\n                backgroundColor: color,\n            },\n        },\n    }));\n};\n\nconst DisabledButton = withColoredButtonStyle(grey[300])(UnstyledButton);\n\nconst ColouredButtons = {\n    white: withColoredButtonStyle(\"white\")(UnstyledButton),\n    pink: withColoredButtonStyle(pink[200])(UnstyledButton),\n    yellow: withColoredButtonStyle(yellow[200])(UnstyledButton),\n    purple: withColoredButtonStyle(purple[100])(UnstyledButton),\n    lightBlue: withColoredButtonStyle(lightBlue[200])(UnstyledButton),\n    lightGreen: withColoredButtonStyle(lightGreen[100])(UnstyledButton),\n};\n\nexport type ControlPaneButtonColour = keyof typeof ColouredButtons;\n\nexport interface StemControl<StemKey extends string> {\n    label: StemKey;\n    buttonColour: ControlPaneButtonColour;\n\n    enabled: boolean;\n    onEnabledChanged: (newEnabled: boolean) => void;\n    volume: number;\n    onVolumeChanged: (newVolume: number) => void;\n}\n\n// T is a stem key, e.g. \"bass\" | \"drums\"\ntype StemTrackControlPaneProps<StemKey extends string> = {\n    stemControls: StemControl<StemKey>[];\n};\n\nconst StemTrackControlPane = <StemKey extends string>(\n    props: StemTrackControlPaneProps<StemKey>\n): JSX.Element => {\n    const makeButton = <StemKey extends string>(\n        stemButton: StemControl<StemKey>\n    ) => {\n        const RenderedButton = stemButton.enabled\n            ? ColouredButtons[stemButton.buttonColour]\n            : DisabledButton;\n\n        const handleClick = () => {\n            stemButton.onEnabledChanged(!stemButton.enabled);\n        };\n\n        const preventClickBubble = (event: React.ChangeEvent<{}>) => {\n            event.preventDefault();\n            event.stopPropagation();\n        };\n\n        const handleVolumeChange = (\n            _event: React.ChangeEvent<{}>,\n            value: number | number[]\n        ) => {\n            if (typeof value !== \"number\") {\n                return;\n            }\n\n            stemButton.onVolumeChanged(value);\n        };\n\n        return (\n            <Grid key={stemButton.label} item xs>\n                <RenderedButton variant=\"contained\" onClick={handleClick}>\n                    <FullSizedBox>\n                        <Typography variant=\"body1\">\n                            {stemButton.label}\n                        </Typography>\n\n                        <Box onClick={preventClickBubble}>\n                            <VolumeSlider\n                                value={stemButton.volume}\n                                onChange={handleVolumeChange}\n                                min={0}\n                                max={200}\n                                step={10}\n                                valueLabelDisplay=\"auto\"\n                            />\n                        </Box>\n                    </FullSizedBox>\n                </RenderedButton>\n            </Grid>\n        );\n    };\n\n    const buttons = props.stemControls.map(makeButton);\n\n    return <Grid container>{buttons}</Grid>;\n};\n\nexport default StemTrackControlPane;\n","import { Typography } from \"@material-ui/core\";\nimport RadioIcon from \"@material-ui/icons/Radio\";\nimport { withStyles } from \"@material-ui/styles\";\nimport React from \"react\";\nimport { noopFn } from \"../../common/PlainFn\";\nimport { ControlButton } from \"../track_player/internal_player/ControlButton\";\nimport { ControlPaneBox } from \"../track_player/internal_player/ControlPane\";\nimport PlayrateControl from \"../track_player/internal_player/PlayrateControl\";\nimport StemTrackControlPane, {\n    ControlPaneButtonColour,\n    StemControl,\n} from \"../track_player/internal_player/stem/StemTrackControlPane\";\nimport TransposeControl from \"../track_player/internal_player/TransposeControl\";\nimport { LineBreak } from \"./Common\";\n\nconst SmallControlPaneBox = withStyles({\n    root: {\n        width: \"min-content\",\n    },\n})(ControlPaneBox);\n\nconst TrackPlayer: React.FC<{}> = (): JSX.Element => {\n    const makeStemControl = <\n        StemKey extends \"vocals\" | \"other\" | \"bass\" | \"drums\"\n    >(\n        label: StemKey,\n        buttonColour: ControlPaneButtonColour\n    ): StemControl<\"vocals\" | \"other\" | \"bass\" | \"drums\"> => {\n        return {\n            label: label,\n            buttonColour: buttonColour,\n            enabled: true,\n            onEnabledChanged: noopFn,\n            volume: 100,\n            onVolumeChanged: noopFn,\n        };\n    };\n\n    const stemControls = [\n        makeStemControl(\"vocals\", \"lightBlue\"),\n        makeStemControl(\"other\", \"purple\"),\n        makeStemControl(\"bass\", \"pink\"),\n        makeStemControl(\"drums\", \"yellow\"),\n    ];\n\n    return (\n        <>\n            <Typography variant=\"h5\">Track Player</Typography>\n            <LineBreak />\n            <Typography>\n                The track player is an integrated audio player which helps with\n                your transcription, or aids with your jam. The track player is\n                available once a song is saved. Once the song is saved, click\n                the <RadioIcon /> on the bottom right to bring up the player.\n                This is available in both edit or play mode.\n            </Typography>\n            <LineBreak />\n            <Typography variant=\"h6\">Adding a track</Typography>\n            <Typography>\n                The track player requires at least one track to play. If you add\n                a new track, several options of track types will be presented.\n            </Typography>\n            <LineBreak />\n            <Typography>\n                A single track is the most basic track type. The URL can be a\n                Youtube URL, or a link to an mp3, or another media reference,\n                etc.\n            </Typography>\n            <LineBreak />\n            <Typography>\n                2/4/5 stem tracks allow independent control of each stem (e.g.\n                drums, vocals). The URLs are expected to point to an audio file.\n                One way to create these stem files is to use Spleeter.\n            </Typography>\n            <LineBreak />\n            <Typography>\n                The \"Split into 2/4/5 stem\" tracks will take an audio track and\n                turn them into stems. This is the easiest way to get stem\n                tracks. For the URL, a Youtube URL or mp3 would work well.\n            </Typography>\n            <LineBreak />\n            <Typography variant=\"h6\">Transport</Typography>\n            <Typography>\n                In addition to the native player controls, there are also some\n                transport buttons here the bottom:\n            </Typography>\n            <Typography>\n                <ControlButton.Play />: Plays the song\n            </Typography>\n            <Typography>\n                <ControlButton.Pause />: Pauses the song\n            </Typography>\n            <Typography>\n                <ControlButton.JumpBack />: Jumps back 5 seconds\n            </Typography>\n            <Typography>\n                <ControlButton.JumpForward />: Jumps forward 5 seconds\n            </Typography>\n            <Typography>\n                <ControlButton.SkipBack />: Jumps back to the previous section\n                (as marked by the section label times)\n            </Typography>\n            <Typography>\n                <ControlButton.SkipForward />: Jumps forward to the next section\n                (as marked by the section label times)\n            </Typography>\n            <Typography>\n                <ControlButton.Beginning />: Jumps back to the beginning of the\n                song\n            </Typography>\n            <LineBreak />\n            <Typography variant=\"h6\">Speed</Typography>\n            <Typography>\n                On the right, you will see a control like this:\n            </Typography>\n            <SmallControlPaneBox>\n                <PlayrateControl playratePercentage={100} onChange={noopFn} />\n            </SmallControlPaneBox>\n            <Typography>\n                Here, you can slow down the tempo of a track to listen more\n                carefully. This will work with Youtube or mp3 tracks, and may or\n                may not work with tracks from other sources.\n            </Typography>\n            <LineBreak />\n            <Typography variant=\"h6\">Transpose</Typography>\n            <Typography>\n                If you have a stem track, you will also see a control on the\n                right like this:\n            </Typography>\n            <SmallControlPaneBox>\n                <TransposeControl transposeLevel={0} onChange={noopFn} />\n            </SmallControlPaneBox>\n            <Typography>\n                This allows you to transpose the song up or down a desired\n                amount of semitones.\n            </Typography>\n            <LineBreak />\n            <Typography variant=\"h6\">Stems</Typography>\n            <Typography>\n                A stem is a part in the track, such as vocals, guitar, or drums.\n                Once you end up with stem tracks, you will see controls like\n                this:\n            </Typography>\n            <StemTrackControlPane stemControls={stemControls} />\n            <LineBreak />\n            <Typography>\n                The exact stems will vary, but each stem can be muted by\n                clicking on the respective button, or its volume adjusted via\n                the slider.\n            </Typography>\n            <LineBreak />\n            <Typography variant=\"h6\">Keyboard shortcuts</Typography>\n            <Typography>\n                There are keyboard shortcuts for the transport controls, but\n                they vary depending on the player is shown or minimized.\n            </Typography>\n            <LineBreak />\n            <Typography>\n                There are keyboard shortcuts for the transport controls, but\n                they vary depending on the player is shown or minimized.\n            </Typography>\n            <LineBreak />\n            <Typography>When the player is shown:</Typography>\n            <Typography>/: minimize the player</Typography>\n            <Typography>Space: play/pause</Typography>\n            <Typography>Left arrow: jump back 5 seconds</Typography>\n            <Typography>Right arrow: jump forward 5 seconds</Typography>\n            <Typography>\n                CMD/Control + left arrow: jump back one section\n            </Typography>\n            <Typography>\n                CMD/Control + right arrow: jump forward one section\n            </Typography>\n            <LineBreak />\n            <Typography>When the player is minimized:</Typography>\n            <Typography>/: shows the player</Typography>\n            <Typography>CMD/Control + Enter: play/pause</Typography>\n            <Typography>\n                CMD/Control + left arrow: jump back 5 seconds\n            </Typography>\n            <Typography>\n                CMD/Control + right arrow: jump forward 5 seconds\n            </Typography>\n        </>\n    );\n};\n\nexport default TrackPlayer;\n","import { Typography, withStyles } from \"@material-ui/core\";\nimport SlowMotionVideoIcon from \"@material-ui/icons/SlowMotionVideo\";\nimport React, { useContext } from \"react\";\nimport { ChordBlock } from \"../../common/ChordModel/ChordBlock\";\nimport { ChordLine } from \"../../common/ChordModel/ChordLine\";\nimport { ChordSong } from \"../../common/ChordModel/ChordSong\";\nimport { Lyric } from \"../../common/ChordModel/Lyric\";\nimport { sectionLabelStyle } from \"../display/SectionLabel\";\nimport PlayerTimeProvider, { PlayerTimeContext } from \"../PlayerTimeContext\";\nimport { LineBreak } from \"./Common\";\nimport Playground from \"./Playground\";\n\nconst LabelTypography = withStyles(sectionLabelStyle)(Typography);\n\nconst TimeSetter: React.FC<{}> = (): null => {\n    const getPlayerTimeRef = useContext(PlayerTimeContext);\n    getPlayerTimeRef.current = () => 83;\n    return null;\n};\n\nconst TimeLabels: React.FC<{}> = (): JSX.Element => {\n    const initialSong = new ChordSong({\n        lines: [\n            new ChordLine({\n                blocks: [\n                    new ChordBlock({\n                        chord: \"C^\",\n                        lyric: new Lyric(\"Why do birds suddenly ap-\"),\n                    }),\n                    new ChordBlock({\n                        chord: \"B7sus4\",\n                        lyric: new Lyric(\"pear?\"),\n                    }),\n                    new ChordBlock({\n                        chord: \"B7\",\n                        lyric: new Lyric(\"\\ue200\"),\n                    }),\n                ],\n                section: {\n                    type: \"label\",\n                    name: \"Verse\",\n                },\n            }),\n            new ChordLine({\n                blocks: [\n                    new ChordBlock({\n                        chord: \"\",\n                        lyric: new Lyric(\"Every time you are near\"),\n                    }),\n                ],\n            }),\n        ],\n    });\n\n    const expectedSong = new ChordSong({\n        lines: [\n            new ChordLine({\n                blocks: [\n                    new ChordBlock({\n                        chord: \"C^\",\n                        lyric: new Lyric(\"Why do birds suddenly ap-\"),\n                    }),\n                    new ChordBlock({\n                        chord: \"B7sus4\",\n                        lyric: new Lyric(\"pear?\"),\n                    }),\n                    new ChordBlock({\n                        chord: \"B7\",\n                        lyric: new Lyric(\"\\ue200\"),\n                    }),\n                ],\n                section: {\n                    type: \"time\",\n                    name: \"Verse\",\n                    time: 83,\n                },\n            }),\n            new ChordLine({\n                blocks: [\n                    new ChordBlock({\n                        chord: \"\",\n                        lyric: new Lyric(\"Every time you are near\"),\n                    }),\n                ],\n            }),\n        ],\n    });\n\n    return (\n        <>\n            <Typography variant=\"h5\">Labels with Timestamp</Typography>\n            <LineBreak />\n            <Typography>\n                After creating a label, it's possible to annotate each section\n                with the time of recording, e.g. this verse is at 2:10.\n            </Typography>\n            <LineBreak />\n            <Typography>\n                If you hover over the{\" \"}\n                <LabelTypography display=\"inline\">Verse</LabelTypography> label,\n                a floating input will show up. You can enter a time by typing it\n                in, and then pressing enter.\n            </Typography>\n            <LineBreak />\n            <Typography>\n                Alternatively, you can set the time to the current time in the\n                track player (see the Track Player tutorial) by clicking the{\" \"}\n                <SlowMotionVideoIcon /> button.\n            </Typography>\n            <LineBreak />\n            <Typography>\n                In this example, pretend that the current verse starts at time\n                1:23 and that is the current time in the track player. Let's set\n                the time of the label to 1:23.\n            </Typography>\n            <LineBreak />\n            <Typography>Try it!</Typography>\n            <PlayerTimeProvider>\n                <TimeSetter />\n                <Playground\n                    initialSong={initialSong}\n                    expectedSong={expectedSong}\n                />\n            </PlayerTimeProvider>\n        </>\n    );\n};\n\nexport default TimeLabels;\n","import { Fab as UnstyledFab, Paper, Theme } from \"@material-ui/core\";\nimport UnstyledPlayArrowIcon from \"@material-ui/icons/PlayArrow\";\nimport { withStyles } from \"@material-ui/styles\";\nimport React from \"react\";\nimport { Link, Route } from \"react-router-dom\";\nimport ErrorPage from \"./display/ErrorPage\";\nimport AddChord from \"./tutorial/AddChord\";\nimport AddLine from \"./tutorial/AddLine\";\nimport ChordPositioning from \"./tutorial/ChordPositioning\";\nimport CopyAndPaste from \"./tutorial/CopyAndPaste\";\nimport DragAndDropChord from \"./tutorial/DragAndDropChord\";\nimport EditChord from \"./tutorial/EditChord\";\nimport EditLyrics from \"./tutorial/EditLyrics\";\nimport Instrumental from \"./tutorial/Instrumental\";\nimport MergeLine from \"./tutorial/MergeLine\";\nimport PasteLyrics from \"./tutorial/PasteLyrics\";\nimport RemoveChord from \"./tutorial/RemoveChord\";\nimport RemoveLine from \"./tutorial/RemoveLine\";\nimport Starting from \"./tutorial/Start\";\nimport Labels from \"./tutorial/Labels\";\nimport PlayMode from \"./tutorial/PlayMode\";\nimport SplitLine from \"./tutorial/SplitLine\";\nimport Saving from \"./tutorial/Saving\";\nimport RemoveMultipleLines from \"./tutorial/RemoveMultipleLines\";\nimport TrackPlayer from \"./tutorial/TrackPlayer\";\nimport TimeLabels from \"./tutorial/TimeLabels\";\n\ntype ExerciseEntry = {\n    title: string;\n    route: string;\n    component: React.FC<{}>;\n};\n\nexport type ExerciseRoute = {\n    title: string;\n    route: string;\n};\n\nconst allExercises: ExerciseEntry[] = [\n    {\n        title: \"Starting\",\n        route: \"/learn/start\",\n        component: Starting,\n    },\n    {\n        title: \"Edit a Chord\",\n        route: \"/learn/edit-chord\",\n        component: EditChord,\n    },\n    {\n        title: \"Remove a Chord\",\n        route: \"/learn/remove-chord\",\n        component: RemoveChord,\n    },\n    {\n        title: \"Add a Chord\",\n        route: \"/learn/add-chord\",\n        component: AddChord,\n    },\n    {\n        title: \"Drag and Drop Chords\",\n        route: \"/learn/drag-and-drop-chord\",\n        component: DragAndDropChord,\n    },\n    {\n        title: \"Edit Lyrics\",\n        route: \"/learn/edit-lyrics\",\n        component: EditLyrics,\n    },\n    {\n        title: \"Instrumentals\",\n        route: \"/learn/instrumentals\",\n        component: Instrumental,\n    },\n    {\n        title: \"Chord Positioning\",\n        route: \"/learn/chord-positioning\",\n        component: ChordPositioning,\n    },\n    {\n        title: \"Adding New Line\",\n        route: \"/learn/add-line\",\n        component: AddLine,\n    },\n    {\n        title: \"Removing a Line\",\n        route: \"/learn/remove-line\",\n        component: RemoveLine,\n    },\n    {\n        title: \"Pasting Lyrics\",\n        route: \"/learn/paste-lyrics\",\n        component: PasteLyrics,\n    },\n    {\n        title: \"Removing Multiple Lines\",\n        route: \"/learn/remove-multiple-lines\",\n        component: RemoveMultipleLines,\n    },\n    {\n        title: \"Merging Lines\",\n        route: \"/learn/merge-lines\",\n        component: MergeLine,\n    },\n    {\n        title: \"Splitting Lines\",\n        route: \"/learn/split-lines\",\n        component: SplitLine,\n    },\n    {\n        title: \"Copying and Pasting Lines\",\n        route: \"/learn/copy-and-paste\",\n        component: CopyAndPaste,\n    },\n    {\n        title: \"Labels\",\n        route: \"/learn/labels\",\n        component: Labels,\n    },\n    {\n        title: \"Labels with Timestamp\",\n        route: \"/learn/time-labels\",\n        component: TimeLabels,\n    },\n    {\n        title: \"Play Mode\",\n        route: \"/learn/play-mode\",\n        component: PlayMode,\n    },\n    {\n        title: \"Saving and Loading\",\n        route: \"/learn/saving\",\n        component: Saving,\n    },\n    {\n        title: \"Track Player\",\n        route: \"/learn/track-player\",\n        component: TrackPlayer,\n    },\n];\n\nexport const allExerciseRoutes = (): ExerciseRoute[] => {\n    return allExercises.map((entry: ExerciseEntry) => ({\n        title: entry.title,\n        route: entry.route,\n    }));\n};\n\nconst PlayArrowIcon = withStyles({\n    root: {\n        color: \"white\",\n    },\n})(UnstyledPlayArrowIcon);\n\nconst RootPaper = withStyles((theme: Theme) => ({\n    root: {\n        marginTop: theme.spacing(5),\n        marginBottom: theme.spacing(5),\n        padding: theme.spacing(5),\n        minHeight: theme.spacing(46),\n        width: theme.spacing(92),\n        position: \"relative\",\n    },\n}))(Paper);\n\nconst Fab = withStyles((theme: Theme) => ({\n    root: {\n        position: \"absolute\",\n        bottom: theme.spacing(2),\n        right: theme.spacing(2),\n    },\n}))(UnstyledFab);\n\ninterface TutorialProps {\n    route: string;\n}\n\ntype WrapperFn = (child: React.ReactElement) => React.ReactElement;\n\nexport const TutorialSwitches = (\n    wrapperFn: WrapperFn\n): React.ReactElement[] => {\n    return allExercises.map((exerciseEntry: ExerciseEntry) => (\n        <Route key={exerciseEntry.route} exact path={exerciseEntry.route}>\n            {wrapperFn(<Tutorial route={exerciseEntry.route} />)}\n        </Route>\n    ));\n};\n\nconst Tutorial: React.FC<TutorialProps> = (\n    props: TutorialProps\n): JSX.Element => {\n    const matchEntry = (entry: ExerciseEntry): boolean => {\n        return entry.route === props.route;\n    };\n\n    const exerciseEntry: ExerciseEntry | undefined =\n        allExercises.find(matchEntry);\n\n    if (exerciseEntry === undefined) {\n        return <ErrorPage />;\n    }\n\n    const exerciseIndex = allExercises.findIndex(matchEntry);\n\n    let nextButton: React.ReactElement | null = null;\n\n    if (exerciseIndex < allExercises.length - 1) {\n        const nextExercise = allExercises[exerciseIndex + 1];\n        nextButton = (\n            <Link to={nextExercise.route}>\n                <Fab color=\"primary\">\n                    <PlayArrowIcon />\n                </Fab>\n            </Link>\n        );\n    }\n\n    return (\n        <RootPaper>\n            <exerciseEntry.component />\n            {nextButton}\n        </RootPaper>\n    );\n};\n","import {\n    Grid,\n    Paper as UnstyledPaper,\n    StyledComponentProps,\n    Theme,\n    Typography as UnstyledTypography,\n} from \"@material-ui/core\";\nimport grey from \"@material-ui/core/colors/grey\";\nimport { makeStyles, withStyles } from \"@material-ui/styles\";\nimport { isLeft } from \"fp-ts/lib/These\";\nimport { useSnackbar } from \"notistack\";\nimport React, { useEffect, useState } from \"react\";\nimport SigninIcon from \"../../assets/img/google_signin.svg\";\nimport { useErrorMessage } from \"../../common/backend/errors\";\nimport { login } from \"../../common/backend/requests\";\nimport { deserializeUser, User, UserContext } from \"./userContext\";\n\nconst Paper = withStyles({\n    root: {\n        width: \"100%\",\n        cursor: \"pointer\",\n    },\n})(UnstyledPaper);\n\nconst Typography = withStyles((theme: Theme) => ({\n    root: {\n        margin: theme.spacing(2),\n        color: grey[600],\n    },\n}))(UnstyledTypography);\n\nconst googleSignInID = \"google-sign-in\";\nconst googleClientID =\n    \"650853277550-ta69qbfcvdl6tb5ogtnh2d07ae9rcdlf.apps.googleusercontent.com\";\n\nconst useSigninStyles = makeStyles({\n    root: {\n        display: \"inline-block\",\n        objectFit: \"contain\",\n    },\n});\n\ninterface LoginProps extends StyledComponentProps {\n    onUserChanged: (user: User) => void;\n}\n\nconst Login: React.FC<LoginProps> = (props: LoginProps): JSX.Element => {\n    const [gapiLoaded, setGapiLoaded] = useState<boolean>(false);\n    const { enqueueSnackbar } = useSnackbar();\n    const showError = useErrorMessage();\n    const signinStyles = useSigninStyles();\n    const user: User | null = React.useContext(UserContext);\n\n    const userNotSignedIn = (user: User | null): user is null => {\n        return user === null;\n    };\n\n    useEffect(() => {\n        if (gapiLoaded) {\n            return;\n        }\n\n        if (window[\"gapi\"] !== undefined) {\n            setGapiLoaded(true);\n        } else {\n            enqueueSnackbar(\"gapi is not loaded, working offline only\", {\n                variant: \"error\",\n            });\n        }\n    }, [gapiLoaded, enqueueSnackbar]);\n\n    useEffect(() => {\n        if (!gapiLoaded) {\n            return;\n        }\n\n        gapi.load(\"auth2\", () => {\n            const handleGoogleLogin = async (\n                currentUser: gapi.auth2.CurrentUser\n            ) => {\n                const idToken: string = currentUser.get().getAuthResponse()\n                    .id_token;\n\n                let loginResult = await login(idToken);\n\n                if (isLeft(loginResult)) {\n                    await showError(loginResult.left);\n\n                    return;\n                }\n\n                const parsedUser = deserializeUser(\n                    loginResult.right,\n                    currentUser\n                );\n\n                if (parsedUser === null) {\n                    console.error(\n                        \"JSON payload is not a user\",\n                        loginResult.right\n                    );\n                    enqueueSnackbar(\n                        \"Failed to login to backend. Check console for more error details\",\n                        { variant: \"error\" }\n                    );\n\n                    return;\n                }\n\n                props.onUserChanged(parsedUser);\n            };\n\n            if (!userNotSignedIn(user)) {\n                return;\n            }\n\n            const handleAuthInit = (authClient: gapi.auth2.GoogleAuth) => {\n                authClient.attachClickHandler(\n                    document.getElementById(googleSignInID),\n                    {},\n                    () => handleGoogleLogin(authClient.currentUser),\n                    (failureReason: string) => {\n                        console.error(\n                            \"Failed to login to Google\",\n                            failureReason\n                        );\n                    }\n                );\n\n                if (authClient.isSignedIn.get()) {\n                    handleGoogleLogin(authClient.currentUser);\n                }\n            };\n\n            gapi.auth2\n                .init({\n                    client_id: googleClientID,\n                    scope: \"profile email\",\n                })\n                .then(handleAuthInit);\n        });\n    }, [enqueueSnackbar, user, props, gapiLoaded, showError]);\n\n    if (!gapiLoaded) {\n        return <div></div>;\n    }\n\n    const userDescription = (user: User | null): string => {\n        if (userNotSignedIn(user)) {\n            return \"Sign In\";\n        }\n\n        if (user.name === null) {\n            return \"You Logged In But Who Are You???\";\n        }\n\n        return user.name;\n    };\n\n    return (\n        <Paper id={googleSignInID} classes={props.classes}>\n            <Grid container alignItems=\"center\" justify=\"center\">\n                <Grid item>\n                    <img\n                        src={SigninIcon}\n                        alt=\"Google Signin\"\n                        className={signinStyles.root}\n                    />\n                </Grid>\n                <Grid item>\n                    <Typography variant=\"h6\" display=\"inline\">\n                        {userDescription(user)}\n                    </Typography>\n                </Grid>\n            </Grid>\n        </Paper>\n    );\n};\n\nexport default Login;\n","import {\n    Collapse,\n    Divider,\n    Drawer as UnstyledDrawer,\n    Grid,\n    List,\n    ListItem,\n    ListItemIcon,\n    ListItemText,\n    Paper,\n    Theme,\n    Typography,\n} from \"@material-ui/core\";\nimport grey from \"@material-ui/core/colors/grey\";\nimport UnstyledCloseIcon from \"@material-ui/icons/Close\";\nimport ExpandLessIcon from \"@material-ui/icons/ExpandLess\";\nimport ExpandMoreIcon from \"@material-ui/icons/ExpandMore\";\nimport FreeBreakfastIcon from \"@material-ui/icons/FreeBreakfast\";\nimport LibraryMusicIcon from \"@material-ui/icons/LibraryMusic\";\nimport UnstyledMenuIcon from \"@material-ui/icons/Menu\";\nimport MusicNoteIcon from \"@material-ui/icons/MusicNote\";\nimport PetsIcon from \"@material-ui/icons/Pets\";\nimport StoreIcon from \"@material-ui/icons/Store\";\nimport { makeStyles, withStyles } from \"@material-ui/styles\";\nimport React, { useState } from \"react\";\nimport { Link } from \"react-router-dom\";\nimport { demoPath, songPath } from \"../common/paths\";\nimport LoadSongDialog from \"./LoadSongDialog\";\nimport { allExerciseRoutes, ExerciseRoute } from \"./Tutorial\";\nimport Login from \"./user/Login\";\nimport { User, UserContext } from \"./user/userContext\";\n\nconst withPointerStyle = withStyles({\n    root: {\n        cursor: \"pointer\",\n    },\n});\n\nconst MenuIcon = withPointerStyle(UnstyledMenuIcon);\nconst CloseIcon = withPointerStyle(UnstyledCloseIcon);\n\nconst Drawer = withStyles({\n    root: {\n        display: \"flex\",\n        flexDirection: \"column\",\n    },\n})(UnstyledDrawer);\n\nconst VerticalGridItem = withStyles({\n    root: {\n        maxWidth: \"none\",\n    },\n})(Grid);\n\nconst TitleGrid = withStyles((theme: Theme) => ({\n    root: {\n        padding: theme.spacing(3),\n    },\n}))(Grid);\n\nconst TitleName = withStyles({\n    root: {\n        color: grey[600],\n    },\n})(Typography);\n\nconst CollapsedMenuSurface = withStyles({\n    root: {\n        minWidth: \"24px\",\n        height: \"100vh\",\n    },\n})(Paper);\n\nconst FullHeightGrid = withStyles({\n    root: {\n        height: \"100%\",\n        width: \"100%\",\n    },\n})(Grid);\n\nconst useFillerStyle = makeStyles({\n    root: {\n        flexGrow: 1,\n    },\n});\n\ninterface SideMenuProps {\n    onUserChanged: (user: User) => void;\n}\n\nconst SideMenu: React.FC<SideMenuProps> = (\n    props: SideMenuProps\n): JSX.Element => {\n    const user = React.useContext(UserContext);\n    const [expanded, setExpanded] = useState(false);\n    const [showLoadSongsDialog, setShowLoadSongsDialog] = useState(false);\n\n    const [learnSubmenuOpen, setLearnSubMenuOpen] = useState(false);\n    const fillerStyle = useFillerStyle();\n\n    const typographyProps = {\n        variant: \"h6\" as \"h6\",\n    };\n\n    const learnClickHandler = () => {\n        setLearnSubMenuOpen(!learnSubmenuOpen);\n    };\n\n    const tutorialMenu = () => {\n        const exerciseLinks = allExerciseRoutes().map(\n            (exerciseRoute: ExerciseRoute) => {\n                return (\n                    <Link\n                        key={exerciseRoute.route}\n                        to={exerciseRoute.route}\n                        style={linkStyle}\n                    >\n                        <ListItem button>\n                            <ListItemText inset primary={exerciseRoute.title} />\n                        </ListItem>\n                    </Link>\n                );\n            }\n        );\n\n        return (\n            <>\n                <ListItem key=\"Learn\" button onClick={learnClickHandler}>\n                    <ListItemIcon>\n                        <FreeBreakfastIcon />\n                    </ListItemIcon>\n                    <ListItemText\n                        primary=\"Learn\"\n                        primaryTypographyProps={typographyProps}\n                    />\n                    {learnSubmenuOpen ? <ExpandLessIcon /> : <ExpandMoreIcon />}\n                </ListItem>\n                <Collapse in={learnSubmenuOpen} timeout=\"auto\">\n                    <List>{exerciseLinks}</List>\n                </Collapse>\n            </>\n        );\n    };\n\n    const linkStyle = {\n        textDecoration: \"none\",\n        color: \"inherit\",\n    };\n\n    const collapsedMenu = (\n        <Drawer variant=\"persistent\" open={!expanded} anchor=\"left\">\n            <CollapsedMenuSurface>\n                <FullHeightGrid\n                    container\n                    direction=\"column\"\n                    alignContent=\"center\"\n                >\n                    <VerticalGridItem item xs={1}></VerticalGridItem>\n                    <VerticalGridItem item xs={1}>\n                        <MenuIcon onClick={() => setExpanded(true)} />\n                    </VerticalGridItem>\n                    <VerticalGridItem item xs={10}></VerticalGridItem>\n                </FullHeightGrid>\n            </CollapsedMenuSurface>\n        </Drawer>\n    );\n\n    const expandedMenu = (\n        <Drawer variant=\"persistent\" open={expanded} anchor=\"left\">\n            <TitleGrid container alignItems=\"center\" justify=\"space-between\">\n                <Grid item>\n                    <Link\n                        to=\"/\"\n                        style={linkStyle}\n                        data-testid=\"Menu-TitleButton\"\n                    >\n                        <TitleName variant=\"h5\" display=\"inline\">\n                            Chord Paper\n                        </TitleName>\n                    </Link>\n                </Grid>\n                <Grid item>\n                    <CloseIcon onClick={() => setExpanded(false)} />\n                </Grid>\n            </TitleGrid>\n\n            <Divider />\n            <List>\n                <Link\n                    key={songPath.URL()}\n                    to={songPath.URL()}\n                    style={linkStyle}\n                    data-testid=\"Menu-HomeButton\"\n                >\n                    <ListItem key=\"New Song\" button>\n                        <ListItemIcon>\n                            <MusicNoteIcon />\n                        </ListItemIcon>\n                        <ListItemText\n                            primary=\"New Song\"\n                            primaryTypographyProps={typographyProps}\n                        />\n                    </ListItem>\n                </Link>\n                {user !== null && (\n                    <ListItem\n                        key=\"Load Song\"\n                        button\n                        onClick={(event: unknown) =>\n                            setShowLoadSongsDialog(true)\n                        }\n                    >\n                        <ListItemIcon>\n                            <LibraryMusicIcon />\n                        </ListItemIcon>\n                        <ListItemText\n                            primary=\"Load Song\"\n                            primaryTypographyProps={typographyProps}\n                        />\n                    </ListItem>\n                )}\n                <Link\n                    key={demoPath.URL()}\n                    to={demoPath.URL()}\n                    style={linkStyle}\n                    data-testid=\"Menu-DemoButton\"\n                >\n                    <ListItem key=\"Demo\" button>\n                        <ListItemIcon>\n                            <StoreIcon />\n                        </ListItemIcon>\n                        <ListItemText\n                            primary=\"Demo\"\n                            primaryTypographyProps={typographyProps}\n                        />\n                    </ListItem>\n                </Link>\n                {tutorialMenu()}\n                <Link\n                    key=\"/about\"\n                    to=\"/about\"\n                    style={linkStyle}\n                    data-testid=\"Menu-AboutButton\"\n                >\n                    <ListItem key=\"About\" button>\n                        <ListItemIcon>\n                            <PetsIcon />\n                        </ListItemIcon>\n                        <ListItemText\n                            primary=\"About\"\n                            primaryTypographyProps={typographyProps}\n                        />\n                    </ListItem>\n                </Link>\n            </List>\n            <div className={fillerStyle.root} />\n            <Login onUserChanged={props.onUserChanged} />\n        </Drawer>\n    );\n\n    return (\n        <>\n            {collapsedMenu}\n            {expandedMenu}\n            {showLoadSongsDialog && (\n                <LoadSongDialog\n                    open\n                    onClose={() => setShowLoadSongsDialog(false)}\n                />\n            )}\n        </>\n    );\n};\n\nexport default SideMenu;\n","import CircularProgress from \"@material-ui/core/CircularProgress\";\nimport { isLeft } from \"fp-ts/lib/These\";\nimport React, { useState } from \"react\";\nimport { useParams } from \"react-router-dom\";\nimport { getSong } from \"../common/backend/requests\";\nimport { ChordSong } from \"../common/ChordModel/ChordSong\";\nimport { FetchState } from \"../common/fetch\";\nimport ErrorImage from \"./display/ErrorImage\";\n\ninterface IDParams {\n    id: string;\n}\n\ninterface InternalFetcherProps {\n    id: string;\n    children: (song: ChordSong) => JSX.Element;\n}\n\nconst InternalFetcher: React.FC<InternalFetcherProps> = (\n    props: InternalFetcherProps\n): JSX.Element => {\n    const [fetchState, setFetchState] = useState<FetchState<ChordSong>>({\n        state: \"not-started\",\n    });\n\n    const fetchSong = async () => {\n        let fetchResult = await getSong(props.id);\n\n        if (isLeft(fetchResult)) {\n            setFetchState({ state: \"error\", error: fetchResult.left });\n            return;\n        }\n\n        const result = ChordSong.fromJSONObject(fetchResult.right);\n        if (isLeft(result)) {\n            setFetchState({\n                state: \"error\",\n                error: \"Failed to deserialize payload to song\",\n            });\n            return;\n        }\n\n        setFetchState({ state: \"loaded\", item: result.right });\n    };\n\n    switch (fetchState.state) {\n        case \"not-started\": {\n            setFetchState({ state: \"loading\" });\n            fetchSong();\n            return <></>;\n        }\n        case \"error\": {\n            return <ErrorImage error={fetchState.error} />;\n        }\n        case \"loading\": {\n            return <CircularProgress size={200} thickness={1} />;\n        }\n        case \"loaded\": {\n            return props.children(fetchState.item);\n        }\n    }\n};\n\ninterface SongFetcherProps {\n    children: (song: ChordSong) => JSX.Element;\n}\n\nconst SongFetcher: React.FC<SongFetcherProps> = (\n    props: SongFetcherProps\n): JSX.Element => {\n    const { id } = useParams<IDParams>();\n\n    // setting a key to force React to discard the component when the ID changes\n    // so that it does not reuse old fetch state\n    return (\n        <InternalFetcher key={id} id={id}>\n            {props.children}\n        </InternalFetcher>\n    );\n};\n\nexport default SongFetcher;\n","import * as iots from \"io-ts\";\n\nexport const validateValue = (value: string): boolean => {\n    return value.trim() !== \"\";\n};\n\nexport const BaseTrackValidator = iots.type({\n    id: iots.string,\n    label: iots.string,\n});\n","import * as iots from \"io-ts\";\nimport { BaseTrackValidator, validateValue } from \"./BaseTrack\";\nimport { Record } from \"immutable\";\n\nexport const SingleTrackValidator = iots.intersection([\n    BaseTrackValidator,\n    iots.type({\n        track_type: iots.literal(\"single\"),\n        url: iots.string,\n    }),\n]);\n\ntype SingleTrackValidatedFields = iots.TypeOf<typeof SingleTrackValidator>;\nconst DefaultSingleTrackRecord = {\n    id: \"\",\n    track_type: \"single\" as \"single\",\n    label: \"\",\n    url: \"\",\n};\n\nexport class SingleTrack\n    extends Record(DefaultSingleTrackRecord)\n    implements SingleTrackValidatedFields\n{\n    constructor(id: string, label: string, url: string) {\n        super({\n            id: id,\n            track_type: \"single\",\n            label: label,\n            url: url,\n        });\n    }\n\n    static fromValidatedFields(\n        validatedFields: SingleTrackValidatedFields\n    ): SingleTrack {\n        return new SingleTrack(\n            validatedFields.id,\n            validatedFields.label,\n            validatedFields.url\n        );\n    }\n\n    validate(): boolean {\n        return validateValue(this.label) && validateValue(this.url);\n    }\n}\n","import * as iots from \"io-ts\";\nimport { mapObject } from \"../../mapObject\";\nimport { BaseTrackValidator, validateValue } from \"./BaseTrack\";\n\nconst makeStemTrackValidator = <T extends object, S extends string>(\n    emptyKeyMap: T,\n    trackType: S\n) => {\n    const stringTypes = mapObject(emptyKeyMap, () => iots.string);\n\n    return iots.intersection([\n        BaseTrackValidator,\n        iots.type({\n            track_type: iots.literal(trackType),\n            stem_urls: iots.type(stringTypes),\n        }),\n    ]);\n};\n\ntype StemURLs<StemKey extends string> = {\n    [P in StemKey]: string;\n};\n\nexport abstract class StemTrack<StemKey extends string> {\n    readonly id: string;\n    readonly label: string;\n    readonly stem_urls: StemURLs<StemKey>;\n\n    constructor(id: string, label: string, stems_urls: StemURLs<StemKey>) {\n        this.id = id;\n        this.label = label;\n        this.stem_urls = stems_urls;\n    }\n\n    abstract keyObject(): Record<StemKey, undefined>;\n\n    abstract setLabel(newLabel: string): this;\n\n    validate(): boolean {\n        if (!validateValue(this.label)) {\n            return false;\n        }\n\n        let key: StemKey;\n        for (key in this.stem_urls) {\n            if (!validateValue(this.stem_urls[key])) {\n                return false;\n            }\n        }\n\n        return true;\n    }\n}\n\n// Two stems\nconst TwoStemEmptyObject = {\n    accompaniment: undefined,\n    vocals: undefined,\n};\n\nexport type TwoStemKeys = keyof typeof TwoStemEmptyObject;\nexport const TwoStemTrackValidator = makeStemTrackValidator(\n    TwoStemEmptyObject,\n    \"2stems\"\n);\n\ntype TwoStemTrackValidatedFields = iots.TypeOf<typeof TwoStemTrackValidator>;\n\nexport class TwoStemTrack\n    extends StemTrack<TwoStemKeys>\n    implements TwoStemTrackValidatedFields\n{\n    readonly track_type: \"2stems\";\n\n    constructor(id: string, label: string, stem_urls: StemURLs<TwoStemKeys>) {\n        super(id, label, stem_urls);\n        this.track_type = \"2stems\";\n    }\n\n    keyObject(): Record<TwoStemKeys, undefined> {\n        return TwoStemEmptyObject;\n    }\n\n    setLabel(newLabel: string): this {\n        // nobody else will extend this\n        return new TwoStemTrack(this.id, newLabel, this.stem_urls) as this;\n    }\n\n    static fromValidatedFields(\n        validatedFields: TwoStemTrackValidatedFields\n    ): TwoStemTrack {\n        return new TwoStemTrack(\n            validatedFields.id,\n            validatedFields.label,\n            validatedFields.stem_urls\n        );\n    }\n}\n\n// Four stems\nconst FourStemEmptyObject = {\n    bass: undefined,\n    drums: undefined,\n    other: undefined,\n    vocals: undefined,\n};\n\nexport type FourStemKeys = keyof typeof FourStemEmptyObject;\nexport const FourStemTrackValidator = makeStemTrackValidator(\n    FourStemEmptyObject,\n    \"4stems\"\n);\n\ntype FourStemTrackValidatedFields = iots.TypeOf<typeof FourStemTrackValidator>;\n\nexport class FourStemTrack\n    extends StemTrack<FourStemKeys>\n    implements FourStemTrackValidatedFields\n{\n    readonly track_type: \"4stems\";\n\n    constructor(id: string, label: string, stem_urls: StemURLs<FourStemKeys>) {\n        super(id, label, stem_urls);\n        this.track_type = \"4stems\";\n    }\n\n    keyObject(): Record<FourStemKeys, undefined> {\n        return FourStemEmptyObject;\n    }\n\n    setLabel(newLabel: string): this {\n        // nobody else will extend this\n        return new FourStemTrack(this.id, newLabel, this.stem_urls) as this;\n    }\n\n    static fromValidatedFields(\n        validatedFields: FourStemTrackValidatedFields\n    ): FourStemTrack {\n        return new FourStemTrack(\n            validatedFields.id,\n            validatedFields.label,\n            validatedFields.stem_urls\n        );\n    }\n}\n\n// Five stems\nconst FiveStemEmptyObject = {\n    bass: undefined,\n    drums: undefined,\n    other: undefined,\n    piano: undefined,\n    vocals: undefined,\n};\n\nexport type FiveStemKeys = keyof typeof FiveStemEmptyObject;\nexport const FiveStemTrackValidator = makeStemTrackValidator(\n    FiveStemEmptyObject,\n    \"5stems\"\n);\n\ntype FiveStemTrackValidatedFields = iots.TypeOf<typeof FiveStemTrackValidator>;\n\nexport class FiveStemTrack\n    extends StemTrack<FiveStemKeys>\n    implements FiveStemTrackValidatedFields\n{\n    readonly track_type: \"5stems\";\n\n    constructor(id: string, label: string, stem_urls: StemURLs<FiveStemKeys>) {\n        super(id, label, stem_urls);\n        this.track_type = \"5stems\";\n    }\n\n    keyObject(): Record<FiveStemKeys, undefined> {\n        return FiveStemEmptyObject;\n    }\n\n    setLabel(newLabel: string): this {\n        // nobody else will extend this\n        return new FiveStemTrack(this.id, newLabel, this.stem_urls) as this;\n    }\n\n    static fromValidatedFields(\n        validatedFields: FiveStemTrackValidatedFields\n    ): FiveStemTrack {\n        return new FiveStemTrack(\n            validatedFields.id,\n            validatedFields.label,\n            validatedFields.stem_urls\n        );\n    }\n}\n","import { TextFieldProps } from \"@material-ui/core\";\n\nconst validateValue = (value: string): boolean => {\n    return value.trim() !== \"\";\n};\n\nexport const textFieldValidation = (value: string): TextFieldProps => {\n    const validValue = validateValue(value);\n\n    return {\n        error: validValue ? undefined : true,\n        helperText: validValue ? undefined : \"Can't be empty\",\n    };\n};\n","import { TextField } from \"@material-ui/core\";\nimport React from \"react\";\nimport { textFieldValidation } from \"./error\";\n\ninterface LabelFieldProps {\n    value: string;\n    onChange: (newValue: string) => void;\n}\n\nconst LabelField: React.FC<LabelFieldProps> = (\n    props: LabelFieldProps\n): JSX.Element => {\n    const labelChangeHandler = (\n        event: React.ChangeEvent<HTMLTextAreaElement | HTMLInputElement>\n    ) => {\n        props.onChange(event.target.value);\n    };\n\n    return (\n        <TextField\n            label=\"Track Label\"\n            variant=\"outlined\"\n            value={props.value}\n            onChange={labelChangeHandler}\n            {...textFieldValidation(props.value)}\n        />\n    );\n};\n\nexport default LabelField;\n","const googleDriveExportLinkRegex = new RegExp(`.*drive.google.com/.*?.+`);\nconst googleDriveViewerLinkRegex = new RegExp(\n    `.*drive.google.com/file/d/(.+)/.*`\n);\n\nconst isGoogleDriveExportLink = (url: string): boolean => {\n    const results = url.match(googleDriveExportLinkRegex);\n    return results !== null;\n};\n\nexport const ensureGoogleDriveCacheBusted = (\n    url: string,\n    randID: string\n): string => {\n    if (!isGoogleDriveExportLink(url)) {\n        return url;\n    }\n\n    return url + \"&cacheBuster=\" + randID;\n};\n\nexport const convertViewLinkToExportLink = (url: string): string | null => {\n    const results = url.match(googleDriveViewerLinkRegex);\n    if (results === null) {\n        return null;\n    }\n\n    if (results.length < 2) {\n        return null;\n    }\n\n    const fileID = results[1];\n\n    return \"https://drive.google.com/uc?export=download&id=\" + fileID;\n};\n","import { TextField } from \"@material-ui/core\";\nimport React from \"react\";\nimport { convertViewLinkToExportLink } from \"../internal_player/google_drive\";\nimport { textFieldValidation } from \"./error\";\n\ninterface URLFieldProps {\n    labelText: string;\n    value: string;\n    onChange: (newValue: string) => void;\n    disabled?: boolean;\n}\n\nconst URLField: React.FC<URLFieldProps> = (\n    props: URLFieldProps\n): JSX.Element => {\n    const handleChange = (\n        event: React.ChangeEvent<HTMLTextAreaElement | HTMLInputElement>\n    ) => {\n        props.onChange(event.target.value);\n    };\n\n    const handleKey = (event: React.KeyboardEvent<HTMLDivElement>) => {\n        // only process for (CMD | CTRL) + g\n        if (!event.metaKey && !event.ctrlKey) {\n            return;\n        }\n\n        if (event.key !== \"g\" && event.key !== \"G\") {\n            return;\n        }\n\n        const possiblyGoogleDriveViewLink: string = props.value;\n        const result: string | null = convertViewLinkToExportLink(\n            possiblyGoogleDriveViewLink\n        );\n        if (result === null) {\n            return;\n        }\n\n        props.onChange(result);\n        event.preventDefault();\n    };\n\n    return (\n        <TextField\n            label={props.labelText}\n            variant=\"outlined\"\n            value={props.value}\n            onChange={handleChange}\n            onKeyDown={handleKey}\n            disabled={props.disabled}\n            {...textFieldValidation(props.value)}\n        />\n    );\n};\n\nexport default URLField;\n","import { Button, Divider, Grid, Theme } from \"@material-ui/core\";\nimport DeleteIcon from \"@material-ui/icons/Delete\";\nimport { withStyles } from \"@material-ui/styles\";\nimport React from \"react\";\nimport { SingleTrack } from \"../../../common/ChordModel/tracks/SingleTrack\";\nimport LabelField from \"./LabelField\";\nimport URLField from \"./URLField\";\n\ninterface SingleTrackRowProps {\n    track: SingleTrack;\n    onChange: (newTrack: SingleTrack) => void;\n    onRemove: () => void;\n}\n\nconst RowContainer = withStyles((theme: Theme) => ({\n    root: {\n        margin: theme.spacing(2),\n    },\n}))(Grid);\n\nconst SingleTrackRow: React.FC<SingleTrackRowProps> = (\n    props: SingleTrackRowProps\n): JSX.Element => {\n    const handleLabelChange = (newLabel: string) => {\n        const updatedTrack = props.track.set(\"label\", newLabel);\n        props.onChange(updatedTrack);\n    };\n\n    const handleURLChange = (newURL: string) => {\n        const updatedTrack = props.track.set(\"url\", newURL);\n        props.onChange(updatedTrack);\n    };\n\n    return (\n        <>\n            <RowContainer container alignItems=\"center\">\n                <Grid xs={5} item>\n                    <LabelField\n                        value={props.track.label}\n                        onChange={handleLabelChange}\n                    />\n                </Grid>\n                <Grid xs={5} item>\n                    <URLField\n                        labelText=\"Track URL\"\n                        value={props.track.url}\n                        onChange={handleURLChange}\n                    />\n                </Grid>\n                <Grid xs={2} item>\n                    <Button onClick={props.onRemove}>\n                        <DeleteIcon />\n                    </Button>\n                </Grid>\n            </RowContainer>\n\n            <Divider />\n        </>\n    );\n};\n\nexport default SingleTrackRow;\n","import { Button, Divider, Grid, Theme } from \"@material-ui/core\";\nimport DeleteIcon from \"@material-ui/icons/Delete\";\nimport { withStyles } from \"@material-ui/styles\";\nimport lodash from \"lodash\";\nimport React from \"react\";\nimport { StemTrack } from \"../../../common/ChordModel/tracks/StemTrack\";\nimport { mapObject } from \"../../../common/mapObject\";\nimport LabelField from \"./LabelField\";\nimport URLField from \"./URLField\";\n\nexport type URLFieldLabel<StemKey extends string> = {\n    key: StemKey;\n    label: string;\n};\n\ninterface StemTrackRowProps<\n    StemKey extends string,\n    T extends StemTrack<StemKey>\n> {\n    track: T;\n    urlFieldLabels: URLFieldLabel<StemKey>[];\n    onChange: (newTrack: T) => void;\n    onRemove: () => void;\n}\n\nconst RowContainer = withStyles((theme: Theme) => ({\n    root: {\n        margin: theme.spacing(2),\n    },\n}))(Grid);\n\nconst StemTrackRow = <StemKey extends string, T extends StemTrack<StemKey>>(\n    props: StemTrackRowProps<StemKey, T>\n): JSX.Element => {\n    const handleLabelChange = (newLabel: string) => {\n        const updatedTrack = props.track.setLabel(newLabel);\n        props.onChange(updatedTrack);\n    };\n\n    const makeURLField = (\n        url: string,\n        stemKey: StemKey\n    ): React.ReactElement => {\n        const handleChange = (newURL: string) => {\n            const updatedTrack = lodash.clone(props.track);\n            updatedTrack.stem_urls[stemKey] = newURL;\n            props.onChange(updatedTrack);\n        };\n\n        const label = (() => {\n            const fieldLabel = props.urlFieldLabels.find(\n                (value: URLFieldLabel<StemKey>) => value.key === stemKey\n            );\n            if (fieldLabel === undefined) {\n                return \"File URL\";\n            }\n\n            return fieldLabel.label;\n        })();\n\n        return (\n            <URLField labelText={label} value={url} onChange={handleChange} />\n        );\n    };\n\n    const stemURLFields = mapObject(props.track.stem_urls, makeURLField);\n\n    const createFirstRow = (stemKey: StemKey) => {\n        return (\n            <RowContainer key={stemKey} container alignItems=\"center\">\n                <Grid xs={5} item>\n                    <LabelField\n                        value={props.track.label}\n                        onChange={handleLabelChange}\n                    />\n                </Grid>\n                <Grid xs={5} item>\n                    {stemURLFields[stemKey]}\n                </Grid>\n                <Grid xs={2} item>\n                    <Button onClick={props.onRemove}>\n                        <DeleteIcon />\n                    </Button>\n                </Grid>\n            </RowContainer>\n        );\n    };\n\n    const createSubsequentRows = (stemKey: StemKey) => {\n        return (\n            <RowContainer key={stemKey} container alignItems=\"center\">\n                <Grid xs={5} item></Grid>\n                <Grid xs={5} item>\n                    {stemURLFields[stemKey]}\n                </Grid>\n                <Grid xs={2} item></Grid>\n            </RowContainer>\n        );\n    };\n\n    const rows = props.urlFieldLabels.map(\n        (fieldLabel: URLFieldLabel<StemKey>, index: number) => {\n            if (index === 0) {\n                return createFirstRow(fieldLabel.key);\n            }\n\n            return createSubsequentRows(fieldLabel.key);\n        }\n    );\n\n    return (\n        <>\n            {rows}\n            <Divider />\n        </>\n    );\n};\n\nexport default StemTrackRow;\n","import { Button, Divider, Grid, Theme } from \"@material-ui/core\";\nimport DeleteIcon from \"@material-ui/icons/Delete\";\nimport { withStyles } from \"@material-ui/styles\";\nimport React from \"react\";\nimport { SplitStemTrack } from \"../../../common/ChordModel/tracks/SplitStemRequest\";\nimport LabelField from \"./LabelField\";\nimport URLField from \"./URLField\";\n\ninterface SplitStemTrackRowProps {\n    track: SplitStemTrack;\n    onChange: (newTrack: SplitStemTrack) => void;\n    onRemove: () => void;\n}\n\nconst RowContainer = withStyles((theme: Theme) => ({\n    root: {\n        margin: theme.spacing(2),\n    },\n}))(Grid);\n\nconst SplitStemTrackRow: React.FC<SplitStemTrackRowProps> = (\n    props: SplitStemTrackRowProps\n): JSX.Element => {\n    const handleLabelChange = (newLabel: string) => {\n        const updatedTrack = props.track.set(\"label\", newLabel);\n        props.onChange(updatedTrack);\n    };\n\n    const handleURLChange = (newURL: string) => {\n        const updatedTrack = props.track.set(\"original_url\", newURL);\n        props.onChange(updatedTrack);\n    };\n\n    const currentlyProcessing = props.track.id !== \"\";\n\n    const urlLabelText: string = (() => {\n        if (currentlyProcessing) {\n            return \"Processing track...\";\n        }\n\n        switch (props.track.track_type) {\n            case \"split_2stems\": {\n                return \"Track URL to be split into 2 stems\";\n            }\n\n            case \"split_4stems\": {\n                return \"Track URL to be split into 4 stems\";\n            }\n\n            case \"split_5stems\": {\n                return \"Track URL to be split into 5 stems\";\n            }\n        }\n    })();\n\n    return (\n        <>\n            <RowContainer container alignItems=\"center\">\n                <Grid xs={5} item>\n                    <LabelField\n                        value={props.track.label}\n                        onChange={handleLabelChange}\n                    />\n                </Grid>\n                <Grid xs={5} item>\n                    <URLField\n                        labelText={urlLabelText}\n                        value={props.track.original_url}\n                        onChange={handleURLChange}\n                        disabled={currentlyProcessing}\n                    />\n                </Grid>\n                <Grid xs={2} item>\n                    <Button onClick={props.onRemove}>\n                        <DeleteIcon />\n                    </Button>\n                </Grid>\n            </RowContainer>\n\n            <Divider />\n        </>\n    );\n};\n\nexport default SplitStemTrackRow;\n","import * as iots from \"io-ts\";\nimport { BaseTrackValidator, validateValue } from \"./BaseTrack\";\nimport { Record } from \"immutable\";\n\nexport const SplitStemTrackValidator = iots.intersection([\n    BaseTrackValidator,\n    iots.type({\n        track_type: iots.union([\n            iots.literal(\"split_2stems\"),\n            iots.literal(\"split_4stems\"),\n            iots.literal(\"split_5stems\"),\n        ]),\n        original_url: iots.string,\n        job_status: iots.union([\n            iots.literal(\"requested\"),\n            iots.literal(\"processing\"),\n            iots.literal(\"error\"),\n        ]),\n        job_status_message: iots.string,\n        job_status_debug_log: iots.string,\n        job_progress: iots.number,\n    }),\n]);\n\ntype SplitStemTrackValidatedFields = iots.TypeOf<\n    typeof SplitStemTrackValidator\n>;\n\nexport type SplitStemTypes = \"split_2stems\" | \"split_4stems\" | \"split_5stems\";\nexport type SplitStemJobStatus = \"requested\" | \"processing\" | \"error\";\n\nconst DefaultSplitStemTrackRecord = {\n    id: \"\",\n    track_type: \"split_2stems\" as SplitStemTypes,\n    label: \"\",\n    original_url: \"\",\n    job_status: \"requested\" as SplitStemJobStatus,\n    job_status_message: \"\",\n    job_status_debug_log: \"\",\n    job_progress: 0,\n};\n\nexport class SplitStemTrack\n    extends Record(DefaultSplitStemTrackRecord)\n    implements SplitStemTrackValidatedFields\n{\n    constructor(\n        id: string,\n        label: string,\n        splitType: SplitStemTypes,\n        originalURL: string,\n        jobStatus: SplitStemJobStatus,\n        jobStatusMessage: string,\n        jobProgress: number,\n        jobStatusDebugLog: string\n    ) {\n        super({\n            id: id,\n            track_type: splitType,\n            label: label,\n            original_url: originalURL,\n            job_status: jobStatus,\n            job_status_message: jobStatusMessage,\n            job_progress: jobProgress,\n            job_status_debug_log: jobStatusDebugLog,\n        });\n    }\n\n    static newTrackRequest(splitType: SplitStemTypes): SplitStemTrack {\n        return new SplitStemTrack(\n            \"\",\n            \"\",\n            splitType,\n            \"\",\n            \"requested\",\n            \"\",\n            0,\n            \"\"\n        );\n    }\n\n    static fromValidatedFields(\n        validatedFields: SplitStemTrackValidatedFields\n    ): SplitStemTrack {\n        return new SplitStemTrack(\n            validatedFields.id,\n            validatedFields.label,\n            validatedFields.track_type,\n            validatedFields.original_url,\n            validatedFields.job_status,\n            validatedFields.job_status_message,\n            validatedFields.job_progress,\n            validatedFields.job_status_debug_log\n        );\n    }\n\n    validate(): boolean {\n        return validateValue(this.label) && validateValue(this.original_url);\n    }\n}\n","import {\n    Box,\n    Box as UnstyledBox,\n    Button,\n    CircularProgress,\n    Dialog,\n    DialogActions,\n    DialogContent,\n    DialogTitle,\n    Divider,\n    Menu,\n    MenuItem,\n    Theme,\n    Typography as UnstyledTypography,\n} from \"@material-ui/core\";\nimport AddIcon from \"@material-ui/icons/Add\";\nimport { withStyles } from \"@material-ui/styles\";\nimport lodash from \"lodash\";\nimport React, { useState } from \"react\";\nimport RefreshIcon from \"@material-ui/icons/Refresh\";\n\nimport { SingleTrack } from \"../../../common/ChordModel/tracks/SingleTrack\";\nimport {\n    FiveStemKeys,\n    FiveStemTrack,\n    FourStemKeys,\n    FourStemTrack,\n    TwoStemKeys,\n    TwoStemTrack,\n} from \"../../../common/ChordModel/tracks/StemTrack\";\nimport { Track } from \"../../../common/ChordModel/tracks/Track\";\nimport { TrackList } from \"../../../common/ChordModel/tracks/TrackList\";\nimport { PlainFn } from \"../../../common/PlainFn\";\nimport { TrackListLoad } from \"../providers/TrackListProvider\";\nimport SingleTrackRow from \"./SingleTrackRow\";\nimport StemTrackRow, { URLFieldLabel } from \"./StemTrackRow\";\nimport SplitStemTrackRow from \"./SplitStemTrackRow\";\nimport {\n    SplitStemTrack,\n    SplitStemTypes,\n} from \"../../../common/ChordModel/tracks/SplitStemRequest\";\n\ninterface TrackListEditDialogProps {\n    open: boolean;\n    onClose?: PlainFn;\n    trackListLoad: TrackListLoad;\n    onSubmit?: (trackList: TrackList) => void;\n    onRefresh?: PlainFn;\n}\n\nconst FlexBox = withStyles((theme: Theme) => ({\n    root: {\n        display: \"flex\",\n        padding: theme.spacing(5),\n        alignItems: \"center\",\n        justifyItems: \"center\",\n    },\n}))(Box);\n\nconst InlineBlockBox = withStyles({\n    root: {\n        display: \"inline-block\",\n    },\n})(UnstyledBox);\n\nconst AddNewRowBox = withStyles((theme: Theme) => ({\n    root: {\n        cursor: \"pointer\",\n        display: \"flex\",\n        alignItems: \"center\",\n        marginTop: theme.spacing(1),\n        marginBottom: theme.spacing(1),\n    },\n}))(UnstyledBox);\n\nconst Typography = withStyles((theme: Theme) => ({\n    root: {\n        marginLeft: theme.spacing(2),\n        marginBottom: theme.spacing(1),\n    },\n}))(UnstyledTypography);\n\nconst TrackListEditDialog: React.FC<TrackListEditDialogProps> = (\n    props: TrackListEditDialogProps\n): JSX.Element => {\n    const internalContent: JSX.Element = (() => {\n        if (props.trackListLoad.state === \"loading\") {\n            return (\n                <FlexBox>\n                    <CircularProgress size=\"15rem\" />\n                </FlexBox>\n            );\n        }\n\n        return (\n            <LoadedTrackListEditDialog\n                trackList={props.trackListLoad.tracklist}\n                onSubmit={props.onSubmit}\n                onClose={props.onClose}\n            />\n        );\n    })();\n\n    return (\n        <Dialog open={props.open} onClose={props.onClose} maxWidth={false}>\n            <DialogTitle>\n                <Button onClick={props.onRefresh}>\n                    <RefreshIcon />\n                </Button>\n                Edit Track List\n            </DialogTitle>\n            {internalContent}\n        </Dialog>\n    );\n};\n\ninterface LoadedTrackListEditDialogProps {\n    trackList: TrackList;\n    onSubmit?: (trackList: TrackList) => void;\n    onClose?: PlainFn;\n}\n\nconst LoadedTrackListEditDialog: React.FC<LoadedTrackListEditDialogProps> = (\n    props: LoadedTrackListEditDialogProps\n): JSX.Element => {\n    const emptySingleTrack = (): Track => {\n        return new SingleTrack(\"\", \"\", \"\");\n    };\n\n    const initialTrackList: TrackList = (() => {\n        const clone = lodash.cloneDeep(props.trackList);\n        if (clone.tracks.length === 0) {\n            clone.tracks.push(emptySingleTrack());\n        }\n\n        return clone;\n    })();\n\n    const [trackList, setTrackList] = useState<TrackList>(initialTrackList);\n    const [version, setVersion] = useState(0);\n    const [addTrackMenuElement, setAddTrackMenuElement] =\n        useState<HTMLElement | null>(null);\n\n    const bumpVersion = () => setVersion(version + 1);\n    const cloneTrackList = () => lodash.cloneDeep(trackList);\n\n    const handleAddTrackMenu = (event: React.MouseEvent<HTMLElement>) => {\n        setAddTrackMenuElement(event.currentTarget);\n    };\n\n    const handleCloseAddTrackMenu = () => {\n        setAddTrackMenuElement(null);\n    };\n\n    const handleAddSingleTrack = () => {\n        handleAddTrack(new SingleTrack(\"\", \"\", \"\"));\n    };\n\n    const handleAddTwoStemTrack = () => {\n        handleAddTrack(\n            new TwoStemTrack(\"\", \"\", { vocals: \"\", accompaniment: \"\" })\n        );\n    };\n\n    const handleAddFourStemTrack = () => {\n        handleAddTrack(\n            new FourStemTrack(\"\", \"\", {\n                vocals: \"\",\n                other: \"\",\n                bass: \"\",\n                drums: \"\",\n            })\n        );\n    };\n\n    const handleAddFiveStemTrack = () => {\n        handleAddTrack(\n            new FiveStemTrack(\"\", \"\", {\n                vocals: \"\",\n                other: \"\",\n                piano: \"\",\n                bass: \"\",\n                drums: \"\",\n            })\n        );\n    };\n\n    const handleAddSplitStemTrack = (splitType: SplitStemTypes) => {\n        handleAddTrack(SplitStemTrack.newTrackRequest(splitType));\n    };\n\n    const handleAddTrack = (newTrack: Track) => {\n        appendTrack(newTrack);\n        handleCloseAddTrackMenu();\n    };\n\n    const appendTrack = (track: Track) => {\n        const clone = cloneTrackList();\n        clone.tracks.push(track);\n        bumpVersion();\n        setTrackList(clone);\n    };\n\n    const removeTrack = (index: number) => {\n        const clone = cloneTrackList();\n        clone.tracks.splice(index, 1);\n        bumpVersion();\n        setTrackList(clone);\n    };\n\n    const hasError: boolean = (() => {\n        for (let track of trackList.tracks) {\n            if (!track.validate()) {\n                return true;\n            }\n        }\n\n        return false;\n    })();\n\n    const updateTrack = (index: number, track: Track) => {\n        const clone = cloneTrackList();\n        clone.tracks.splice(index, 1, track);\n        setTrackList(clone);\n    };\n\n    const trackChangeHandler = (index: number) => {\n        return (newTrack: Track) => {\n            updateTrack(index, newTrack);\n        };\n    };\n\n    const trackListInputs = (() => {\n        const rows: React.ReactElement[] = trackList.tracks.map(\n            // linter is wrong here - switch at the bottom is exhaustive and the compiler can verify\n            // it thinks that it may possibly return undefined, but it can't\n            // eslint-disable-next-line array-callback-return\n            (track: Track, index: number): React.ReactElement => {\n                // about version-index:\n                // we don't want to rerender the textboxes every time because it interrupts the\n                // typing experience by blurring focus while the user types\n                //\n                // but also we want to rerender the boxes every time the list is updated\n                // i.e. tracks are added or removed\n                // because the mapping of the track indices to the boxes may have changed\n                //\n                // version helps with this mostly because the track indices stably identify a track\n                // for the same version\n                const rowKey = `${version}-${index}`;\n\n                switch (track.track_type) {\n                    case \"single\": {\n                        return (\n                            <SingleTrackRow\n                                key={rowKey}\n                                track={track}\n                                onChange={trackChangeHandler(index)}\n                                onRemove={() => removeTrack(index)}\n                            />\n                        );\n                    }\n\n                    case \"2stems\": {\n                        const urlFieldLabels: URLFieldLabel<TwoStemKeys>[] = [\n                            {\n                                key: \"vocals\",\n                                label: \"Vocals File URL\",\n                            },\n                            {\n                                key: \"accompaniment\",\n                                label: \"Accompaniment File URL\",\n                            },\n                        ];\n\n                        return (\n                            <StemTrackRow\n                                key={rowKey}\n                                track={track}\n                                urlFieldLabels={urlFieldLabels}\n                                onChange={trackChangeHandler(index)}\n                                onRemove={() => removeTrack(index)}\n                            />\n                        );\n                    }\n\n                    case \"4stems\": {\n                        const urlFieldLabels: URLFieldLabel<FourStemKeys>[] = [\n                            {\n                                key: \"vocals\",\n                                label: \"Vocals File URL\",\n                            },\n                            {\n                                key: \"other\",\n                                label: \"Other File URL\",\n                            },\n                            {\n                                key: \"bass\",\n                                label: \"Bass File URL\",\n                            },\n                            {\n                                key: \"drums\",\n                                label: \"Drums File URL\",\n                            },\n                        ];\n\n                        return (\n                            <StemTrackRow\n                                key={rowKey}\n                                track={track}\n                                urlFieldLabels={urlFieldLabels}\n                                onChange={trackChangeHandler(index)}\n                                onRemove={() => removeTrack(index)}\n                            />\n                        );\n                    }\n\n                    case \"5stems\": {\n                        const urlFieldLabels: URLFieldLabel<FiveStemKeys>[] = [\n                            {\n                                key: \"vocals\",\n                                label: \"Vocals File URL\",\n                            },\n                            {\n                                key: \"other\",\n                                label: \"Other File URL\",\n                            },\n                            {\n                                key: \"piano\",\n                                label: \"Piano File URL\",\n                            },\n                            {\n                                key: \"bass\",\n                                label: \"Bass File URL\",\n                            },\n                            {\n                                key: \"drums\",\n                                label: \"Drums File URL\",\n                            },\n                        ];\n\n                        return (\n                            <StemTrackRow\n                                key={rowKey}\n                                track={track}\n                                urlFieldLabels={urlFieldLabels}\n                                onChange={trackChangeHandler(index)}\n                                onRemove={() => removeTrack(index)}\n                            />\n                        );\n                    }\n\n                    case \"split_2stems\":\n                    case \"split_4stems\":\n                    case \"split_5stems\": {\n                        return (\n                            <SplitStemTrackRow\n                                key={rowKey}\n                                track={track}\n                                onChange={trackChangeHandler(index)}\n                                onRemove={() => removeTrack(index)}\n                            />\n                        );\n                    }\n                }\n            }\n        );\n\n        const showAddTrackMenu = addTrackMenuElement !== null;\n\n        rows.push(\n            <React.Fragment key=\"append\">\n                <InlineBlockBox>\n                    <AddNewRowBox\n                        key=\"append-action\"\n                        onClick={handleAddTrackMenu}\n                    >\n                        <AddIcon />\n                        <Typography>Add a new track</Typography>\n                    </AddNewRowBox>\n                </InlineBlockBox>\n                <Menu\n                    open={showAddTrackMenu}\n                    anchorEl={addTrackMenuElement}\n                    onClose={handleCloseAddTrackMenu}\n                >\n                    <MenuItem onClick={handleAddSingleTrack}>\n                        Single Track\n                    </MenuItem>\n                    <MenuItem\n                        onClick={() => handleAddSplitStemTrack(\"split_2stems\")}\n                    >\n                        Split Track into 2 Stems\n                    </MenuItem>\n                    <MenuItem\n                        onClick={() => handleAddSplitStemTrack(\"split_4stems\")}\n                    >\n                        Split Track into 4 Stems\n                    </MenuItem>\n                    <MenuItem\n                        onClick={() => handleAddSplitStemTrack(\"split_5stems\")}\n                    >\n                        Split Track into 5 Stems\n                    </MenuItem>\n                    <MenuItem onClick={handleAddTwoStemTrack}>\n                        2 Stem Track\n                    </MenuItem>\n                    <MenuItem onClick={handleAddFourStemTrack}>\n                        4 Stem Track\n                    </MenuItem>\n                    <MenuItem onClick={handleAddFiveStemTrack}>\n                        5 Stem Track\n                    </MenuItem>\n                </Menu>\n            </React.Fragment>\n        );\n\n        return rows;\n    })();\n\n    const handleSubmit = () => {\n        if (hasError) {\n            return;\n        }\n\n        props.onSubmit?.(trackList);\n    };\n\n    return (\n        <>\n            <DialogContent>\n                <Typography variant=\"body2\" variantMapping={{ body2: \"div\" }}>\n                    <Box>Add URLs for the audio track this song.</Box>\n                    <Box>\n                        This can be your own hosted files, or Youtube, etc.\n                    </Box>\n                </Typography>\n                <Typography variant=\"body2\" variantMapping={{ body2: \"div\" }}>\n                    <Box>\n                        This player works best if every track is a version of\n                        the same song,\n                    </Box>\n                    <Box>\n                        e.g. the original recording, just the accompaniment,\n                        only drums + bass.\n                    </Box>\n                </Typography>\n                <Divider />\n                {trackListInputs}\n            </DialogContent>\n            <DialogActions>\n                <Button onClick={props.onClose}>Cancel</Button>\n                <Button disabled={hasError} onClick={handleSubmit}>\n                    OK\n                </Button>\n            </DialogActions>\n        </>\n    );\n};\n\nexport default TrackListEditDialog;\n","import { List } from \"immutable\";\nimport { Duration } from \"luxon\";\nimport { useContext, useEffect, useRef, useState } from \"react\";\nimport ReactPlayer from \"react-player\";\nimport FilePlayer from \"react-player/file\";\nimport { TimeSection } from \"../../../common/ChordModel/ChordLine\";\nimport { PlainFn, noopFn } from \"../../../common/PlainFn\";\nimport { PlayerTimeContext } from \"../../PlayerTimeContext\";\n\nexport interface ButtonActionAndState {\n    action: PlainFn;\n    enabled: boolean;\n}\n\nexport interface PlayerControls {\n    playerRef: React.MutableRefObject<ReactPlayer | FilePlayer | undefined>;\n    playing: boolean;\n    togglePlay: PlainFn;\n    jumpBack: PlainFn;\n    jumpForward: PlainFn;\n    goToBeginning: PlainFn;\n    skipBack: ButtonActionAndState;\n    skipForward: ButtonActionAndState;\n    currentTime: number;\n    currentTimeFormatted: string;\n    onProgress: (state: {\n        played: number;\n        playedSeconds: number;\n        loaded: number;\n        loadedSeconds: number;\n    }) => void;\n    onPlay: PlainFn;\n    onPause: PlainFn;\n    currentSectionLabel: string;\n    playrate: {\n        percentage: number;\n        onChange: (val: number) => void;\n    };\n}\n\nclass NoopMutableRef {\n    _current: ReactPlayer | FilePlayer | undefined;\n\n    constructor() {\n        this._current = undefined;\n    }\n\n    public set current(newCurrent: ReactPlayer | FilePlayer | undefined) {}\n\n    public get current(): ReactPlayer | FilePlayer | undefined {\n        return undefined;\n    }\n}\n\nexport const unfocusedControls: PlayerControls = {\n    playerRef: new NoopMutableRef(),\n    playing: false,\n    togglePlay: noopFn,\n    jumpBack: noopFn,\n    jumpForward: noopFn,\n    goToBeginning: noopFn,\n    skipBack: {\n        action: noopFn,\n        enabled: false,\n    },\n    skipForward: {\n        action: noopFn,\n        enabled: false,\n    },\n    currentTime: 0,\n    currentTimeFormatted: \"0:00\",\n    onProgress: noopFn,\n    onPlay: noopFn,\n    onPause: noopFn,\n    currentSectionLabel: \"\",\n    playrate: {\n        percentage: 100,\n        onChange: noopFn,\n    },\n};\n\nconst getSection = (\n    timeSections: List<TimeSection>,\n    index: number\n): TimeSection => {\n    const section = timeSections.get(index);\n    if (section === undefined) {\n        throw new Error(\"Section index is out of range, unexpected\");\n    }\n\n    return section;\n};\n\nexport const usePlayerControls = (\n    timeSections: List<TimeSection>\n): PlayerControls => {\n    const [playing, setPlaying] = useState(false);\n    const [currentTime, setCurrentTime] = useState(0);\n    const playerRef = useRef<ReactPlayer | FilePlayer>();\n    const [playratePercentage, setPlayratePercentage] = useState(100);\n\n    // a ref version so that a past render can access a future state\n    // see outOfSyncWorkaround for the reason\n    const currentTimeRef = useRef<number>(currentTime);\n    currentTimeRef.current = currentTime;\n\n    const jumpInterval = 5; // seconds\n\n    const skipBackBuffer = 2; // seconds;\n    const skipForwardBuffer = 2; // seconds;\n\n    // the amount to skip to before the section - helps not drop the user right on the down beat\n    const skipLeadIn = 1; // seconds;\n\n    {\n        const getPlayerTimeRef = useContext(PlayerTimeContext);\n        const getCurrentTime = () => currentTimeRef.current;\n\n        useEffect(() => {\n            getPlayerTimeRef.current = getCurrentTime;\n        }, [getPlayerTimeRef, getCurrentTime]);\n    }\n\n    const seekTo = (time: number) => {\n        if (time < 0) {\n            time = 0;\n        }\n\n        playerRef.current?.seekTo(time, \"seconds\");\n    };\n\n    const handlePlayState = () => {\n        setPlaying(true);\n    };\n\n    const handlePauseState = () => {\n        setPlaying(false);\n    };\n\n    const outOfSyncWorkaround = () => {\n        // this is pretty unpleasant, but on certain videos, React Player can run into a race condition where\n        // it doesn't respond to playing=true/false, so the play and pause button doesn't actually affect the track\n        // this can be repro'd inconsistently by quickly toggling play/pause several times, or jump back, then pause in the compact player\n        //\n        // attempt at throttling didn't work, the wonkiness can occur even at 5 seconds of throttling depending on the course of events\n        // one observation is that this wonky state can be reset out of by performing a seek after it gets into this state\n        // however, it can't be too soon, hence the set timeout\n        // and also we would want to seek to the time of the most updated time, not the one during the current render, hence the use of ref\n        setTimeout(() => {\n            seekTo(currentTimeRef.current);\n        }, 200);\n    };\n\n    const pauseAction = () => {\n        setPlaying(false);\n        outOfSyncWorkaround();\n    };\n\n    const playAction = () => {\n        setPlaying(true);\n    };\n\n    const togglePlayAction = () => {\n        if (playing) {\n            pauseAction();\n        } else {\n            playAction();\n        }\n    };\n\n    const jumpBackAction = () => {\n        let newTime = currentTime - jumpInterval;\n        if (newTime < 0) {\n            newTime = 0;\n        }\n\n        seekTo(newTime);\n    };\n\n    const jumpForwardAction = () => {\n        const newTime = currentTime + jumpInterval;\n        seekTo(newTime);\n    };\n\n    const goToBeginningAction = () => {\n        seekTo(0);\n    };\n\n    const currentSectionIndex = ((): number | null => {\n        if (timeSections.size === 0) {\n            return null;\n        }\n\n        let currentSectionIndex: number | null = null;\n\n        timeSections.forEach((section: TimeSection, index: number) => {\n            if (currentTime >= section.time) {\n                if (\n                    currentSectionIndex === null ||\n                    section.time >\n                        getSection(timeSections, currentSectionIndex).time\n                ) {\n                    currentSectionIndex = index;\n                }\n            }\n        });\n\n        return currentSectionIndex;\n    })();\n\n    const currentSection: TimeSection | null =\n        currentSectionIndex != null\n            ? getSection(timeSections, currentSectionIndex)\n            : null;\n\n    const currentSectionLabel =\n        currentSection !== null ? currentSection.name : \"\";\n\n    const skipBackButton: ButtonActionAndState = {\n        action: () => {\n            if (currentSection === null) {\n                return;\n            }\n\n            const previousSection: TimeSection | null = (() => {\n                if (currentSectionIndex === null || currentSectionIndex === 0) {\n                    return null;\n                }\n\n                return getSection(timeSections, currentSectionIndex - 1);\n            })();\n\n            if (\n                previousSection !== null &&\n                currentTime <= currentSection.time + skipBackBuffer\n            ) {\n                seekTo(previousSection.time - skipLeadIn);\n                return;\n            }\n\n            seekTo(currentSection.time - skipLeadIn);\n        },\n        enabled: currentSection !== null,\n    };\n\n    const skipForwardButton: ButtonActionAndState = (() => {\n        const findNextSectionIndex = (\n            sectionIndex: number | null\n        ): number | null => {\n            if (timeSections.size === 0) {\n                return null;\n            }\n\n            if (sectionIndex === null) {\n                return 0;\n            }\n\n            if (sectionIndex === timeSections.size - 1) {\n                return null;\n            }\n\n            return sectionIndex + 1;\n        };\n\n        const nextSectionIndex = findNextSectionIndex(currentSectionIndex);\n\n        // determine what the actual next section is - it could be the next one or next next one depending on the buffer\n        const nextSectionToSkipTo: TimeSection | null = (() => {\n            if (nextSectionIndex === null) {\n                return null;\n            }\n\n            const nextSection = getSection(timeSections, nextSectionIndex);\n\n            // we could return section (n + 1) or section (n + 2)\n            // the idea is that, e.g. the user is at 1:05 but the next section is at 1:06, and next next section is 1:30\n            // then the user actually wants to go to 1:30 by skipping forward\n            if (currentTime < nextSection.time - skipForwardBuffer) {\n                return nextSection;\n            }\n\n            const nextNextSectionIndex = findNextSectionIndex(nextSectionIndex);\n            if (nextNextSectionIndex === null) {\n                return null;\n            }\n\n            return getSection(timeSections, nextNextSectionIndex);\n        })();\n\n        return {\n            action: () => {\n                if (nextSectionToSkipTo !== null) {\n                    seekTo(nextSectionToSkipTo.time - skipLeadIn);\n                }\n            },\n            enabled: nextSectionToSkipTo !== null,\n        };\n    })();\n\n    const handleProgress = (state: {\n        played: number;\n        playedSeconds: number;\n        loaded: number;\n        loadedSeconds: number;\n    }) => {\n        setCurrentTime(state.playedSeconds);\n    };\n\n    const currentTimeFormatted: string = (() => {\n        const duration: Duration = Duration.fromMillis(currentTime * 1000);\n        return duration.toFormat(\"m:ss\");\n    })();\n\n    return {\n        playerRef: playerRef,\n        playing: playing,\n        togglePlay: togglePlayAction,\n        skipBack: skipBackButton,\n        skipForward: skipForwardButton,\n        jumpBack: jumpBackAction,\n        jumpForward: jumpForwardAction,\n        goToBeginning: goToBeginningAction,\n        currentTime: currentTime,\n        currentTimeFormatted: currentTimeFormatted,\n        onProgress: handleProgress,\n        onPlay: handlePlayState,\n        onPause: handlePauseState,\n        currentSectionLabel: currentSectionLabel,\n        playrate: {\n            percentage: playratePercentage,\n            onChange: setPlayratePercentage,\n        },\n    };\n};\n","import { Button, Slide, Theme, Tooltip } from \"@material-ui/core\";\nimport RadioIcon from \"@material-ui/icons/Radio\";\nimport { withStyles } from \"@material-ui/styles\";\nimport React, { useEffect, useState } from \"react\";\nimport { useRegisterTopKeyListener } from \"../GlobalKeyListener\";\nimport { roundedTopCornersStyle, withBottomRightBox } from \"./common\";\nimport { PlayerControls } from \"./internal_player/usePlayerControls\";\nimport UnstyledPlayIcon from \"@material-ui/icons/PlayArrow\";\nimport UnstyledPauseIcon from \"@material-ui/icons/Pause\";\nimport JumpBackIcon from \"@material-ui/icons/FastRewind\";\nimport JumpForwardIcon from \"@material-ui/icons/FastForward\";\n\nconst PlayIcon = withStyles((theme: Theme) => ({\n    root: {\n        color: theme.palette.primary.main,\n    },\n}))(UnstyledPlayIcon);\n\nconst PauseIcon = withStyles((theme: Theme) => ({\n    root: {\n        color: theme.palette.secondary.main,\n    },\n}))(UnstyledPauseIcon);\n\nconst ExpandButton = withStyles((theme: Theme) => ({\n    root: {\n        ...roundedTopCornersStyle(theme),\n    },\n}))(Button);\n\ninterface MicroPlayerProps {\n    show: boolean;\n    playersLoaded: boolean;\n    disabled?: boolean;\n    tooltipMessage: string;\n    playerControls: PlayerControls;\n    onClick: () => void;\n    className?: string;\n}\n\nconst MicroPlayer: React.FC<MicroPlayerProps> = (\n    props: MicroPlayerProps\n): JSX.Element => {\n    const [addTopKeyListener, removeKeyListener] = useRegisterTopKeyListener();\n    const [tempJumpIcon, setTempJumpIcon] = useState<\"back\" | \"forward\" | null>(\n        null\n    );\n\n    {\n        const togglePlay = props.playerControls.togglePlay;\n        const jumpBack = props.playerControls.jumpBack;\n        const jumpForward = props.playerControls.jumpForward;\n        const onClick = props.onClick;\n        const show = props.show;\n\n        useEffect(() => {\n            if (!show) {\n                return;\n            }\n\n            const handleKey = (event: KeyboardEvent) => {\n                if (event.code === \"Slash\") {\n                    onClick();\n                    event.preventDefault();\n                }\n\n                // make this only happen when CTRL/CMD is pressed\n                // don't want to just fire sporadically without\n                // visual feedback\n                if (!event.ctrlKey && !event.metaKey) {\n                    return;\n                }\n\n                switch (event.code) {\n                    // because space doesn't work because FUCK MACOS\n                    case \"Enter\":\n                    case \"Space\": {\n                        togglePlay();\n                        event.preventDefault();\n                        break;\n                    }\n\n                    case \"ArrowLeft\": {\n                        jumpBack();\n                        setTempJumpIcon(\"back\");\n                        event.preventDefault();\n                        break;\n                    }\n\n                    case \"ArrowRight\": {\n                        jumpForward();\n                        setTempJumpIcon(\"forward\");\n                        event.preventDefault();\n                        break;\n                    }\n                }\n            };\n\n            addTopKeyListener(handleKey);\n            return () => removeKeyListener(handleKey);\n        }, [\n            addTopKeyListener,\n            removeKeyListener,\n            show,\n            onClick,\n            togglePlay,\n            jumpBack,\n            jumpForward,\n            setTempJumpIcon,\n        ]);\n    }\n\n    useEffect(() => {\n        if (tempJumpIcon === null) {\n            return;\n        }\n\n        setTimeout(() => setTempJumpIcon(null), 1000);\n    }, [tempJumpIcon, setTempJumpIcon]);\n\n    const icon: React.ReactElement = (() => {\n        if (!props.playersLoaded) {\n            return <RadioIcon />;\n        }\n\n        if (tempJumpIcon === \"back\") {\n            return <JumpBackIcon />;\n        }\n\n        if (tempJumpIcon === \"forward\") {\n            return <JumpForwardIcon />;\n        }\n\n        if (!props.playerControls.playing) {\n            return <PauseIcon />;\n        }\n\n        return <PlayIcon />;\n    })();\n\n    return (\n        <Slide in={props.show} direction=\"up\">\n            {withBottomRightBox(\n                // span inserted to workaround disabled elements with tooltip\n                // https://material-ui.com/components/tooltips/#disabled-elements\n                <Tooltip title={props.tooltipMessage}>\n                    <span>\n                        <ExpandButton\n                            className={props.className}\n                            onClick={props.onClick}\n                            disabled={props.disabled}\n                        >\n                            {icon}\n                        </ExpandButton>\n                    </span>\n                </Tooltip>\n            )}\n        </Slide>\n    );\n};\n\nexport default MicroPlayer;\n","import { ReactEventHandler } from \"react\";\nimport { ReactPlayerProps } from \"react-player\";\nimport { BaseReactPlayerProps } from \"react-player/base\";\nimport { FilePlayerProps } from \"react-player/file\";\nimport { PlayerControls } from \"./usePlayerControls\";\n\nconst makeBasePlayerProps = (\n    playerControls: PlayerControls\n): BaseReactPlayerProps => {\n    return {\n        ref: playerControls.playerRef,\n        playing: playerControls.playing,\n        controls: true,\n        playbackRate: playerControls.playrate.percentage / 100,\n        onPlay: playerControls.onPlay,\n        onPause: playerControls.onPause,\n        onProgress: playerControls.onProgress,\n        progressInterval: 500,\n        height: \"auto\",\n        width: \"unset\",\n        onKeyUp: (event: KeyboardEvent) => event.preventDefault(),\n    };\n};\n\nconst filePlayerStyle = { width: \"100%\", height: \"revert\" };\n\nexport const makeFilePlayerProps = (\n    playerControls: PlayerControls,\n    masterVolumePercentage: number,\n    onVolumeChange?: ReactEventHandler<HTMLAudioElement>\n): FilePlayerProps => {\n    const attributes = {\n        onVolumeChange: onVolumeChange,\n        style: filePlayerStyle,\n    };\n\n    const basePlayerProps = makeBasePlayerProps(playerControls);\n\n    return {\n        ...basePlayerProps,\n        volume: masterVolumePercentage / 100,\n        config: {\n            forceAudio: true,\n            attributes: attributes,\n        },\n    };\n};\n\nexport const makeReactPlayerProps = (\n    playerControls: PlayerControls\n): ReactPlayerProps => {\n    const basePlayerProps = makeBasePlayerProps(playerControls);\n\n    return {\n        ...basePlayerProps,\n        config: {\n            file: {\n                forceAudio: true,\n                attributes: {\n                    style: filePlayerStyle,\n                },\n            },\n        },\n    };\n};\n","import { Box } from \"@material-ui/core\";\nimport React, { useEffect, useMemo } from \"react\";\nimport ReactPlayer, { ReactPlayerProps } from \"react-player\";\nimport shortid from \"shortid\";\nimport { SingleTrack } from \"../../../../common/ChordModel/tracks/SingleTrack\";\nimport ControlPane from \"../ControlPane\";\nimport { ensureGoogleDriveCacheBusted } from \"../google_drive\";\nimport { makeReactPlayerProps } from \"../reactPlayerProps\";\nimport { PlayerControls } from \"../usePlayerControls\";\n\ninterface SingleTrackPlayerProps {\n    focused: boolean;\n    isCurrentTrack: boolean;\n    playerControls: PlayerControls;\n    track: SingleTrack;\n}\n\nconst SingleTrackPlayer: React.FC<SingleTrackPlayerProps> = (\n    props: SingleTrackPlayerProps\n): JSX.Element => {\n    const trackURL: string = useMemo(\n        () => ensureGoogleDriveCacheBusted(props.track.url, shortid.generate()),\n        [props.track.url]\n    );\n\n    const reactPlayerProps: ReactPlayerProps = makeReactPlayerProps(\n        props.playerControls\n    );\n\n    useEffect(() => {\n        if (!props.isCurrentTrack && props.playerControls.playing) {\n            props.playerControls.onPause();\n        }\n    }, [props.isCurrentTrack, props.playerControls]);\n\n    return (\n        <Box>\n            <Box>\n                <ReactPlayer {...reactPlayerProps} url={trackURL} />\n            </Box>\n            <ControlPane\n                show={props.focused}\n                playing={props.playerControls.playing}\n                sectionLabel={props.playerControls.currentSectionLabel}\n                onTogglePlay={props.playerControls.togglePlay}\n                onJumpBack={props.playerControls.jumpBack}\n                onJumpForward={props.playerControls.jumpForward}\n                onSkipBack={props.playerControls.skipBack}\n                onSkipForward={props.playerControls.skipForward}\n                onGoToBeginning={props.playerControls.goToBeginning}\n                playrate={props.playerControls.playrate}\n            />\n        </Box>\n    );\n};\n\nexport default SingleTrackPlayer;\n","let audioCtx: AudioContext | null = null;\n\nexport const getAudioCtx = (): AudioContext => {\n    if (audioCtx === null) {\n        audioCtx = new window.AudioContext();\n    }\n\n    return audioCtx;\n};\n","import { Box } from \"@material-ui/core\";\nimport audioBufferToWav from \"audiobuffer-to-wav\";\nimport lodash from \"lodash\";\nimport { useSnackbar } from \"notistack\";\nimport React, {\n    ReactEventHandler,\n    SyntheticEvent,\n    useEffect,\n    useMemo,\n    useRef,\n    useState,\n} from \"react\";\nimport FilePlayer from \"react-player/file\";\nimport * as Tone from \"tone\";\nimport { PlainFn } from \"../../../../common/PlainFn\";\nimport ControlPane from \"../ControlPane\";\nimport { makeFilePlayerProps } from \"../reactPlayerProps\";\nimport { PlayerControls } from \"../usePlayerControls\";\nimport { getAudioCtx } from \"./audioCtx\";\nimport StemTrackControlPane, {\n    ControlPaneButtonColour,\n    StemControl,\n} from \"./StemTrackControlPane\";\n\ninterface StemToneNodes<StemKey extends string> {\n    label: StemKey;\n    playerNode: Tone.GrainPlayer;\n    volumeNode: Tone.Volume;\n    endNode: Tone.Volume;\n}\n\ninterface StemState<StemKey extends string> {\n    key: StemKey;\n    muted: boolean;\n    volumePercentage: number;\n}\n\ntype ToneNodes<StemKey extends string> = StemToneNodes<StemKey>[];\n\ntype PlayerState<StemKey extends string> = {\n    masterVolumePercentage: number;\n    masterPitchShift: number;\n    stems: StemState<StemKey>[];\n};\n\nexport interface StemInput<StemKey extends string> {\n    label: StemKey;\n    buttonColour: ControlPaneButtonColour;\n    audioBuffer: AudioBuffer;\n}\n\ninterface LoadedStemTrackPlayerProps<StemKey extends string> {\n    focused: boolean;\n    currentTrack: boolean;\n    stems: StemInput<StemKey>[];\n    playerControls: PlayerControls;\n    refreshTrackFn: PlainFn;\n}\n\nconst createToneNodes = <StemKey extends string>(\n    stem: StemInput<StemKey>\n): StemToneNodes<StemKey> => {\n    const volumeNode = new Tone.Volume();\n\n    const playerNode = new Tone.GrainPlayer({\n        url: stem.audioBuffer,\n        grainSize: 0.1,\n        overlap: 0.1,\n    });\n\n    playerNode.chain(volumeNode);\n\n    return {\n        label: stem.label,\n        volumeNode: volumeNode,\n        playerNode: playerNode,\n        endNode: volumeNode,\n    };\n};\n\nconst createEmptySongURL = (time: number): string => {\n    const audioCtx = getAudioCtx();\n    const audioBuffer = audioCtx.createBuffer(\n        2,\n        audioCtx.sampleRate * time,\n        audioCtx.sampleRate\n    );\n\n    const arrayBuffer = audioBufferToWav(audioBuffer);\n    const blob = new window.Blob([arrayBuffer]);\n    const songURL = URL.createObjectURL(blob);\n    return songURL;\n};\n\nconst LoadedStemTrackPlayer = <StemKey extends string>(\n    props: LoadedStemTrackPlayerProps<StemKey>\n): JSX.Element => {\n    const { enqueueSnackbar } = useSnackbar();\n\n    const toneNodes: ToneNodes<StemKey> = useMemo(\n        () => props.stems.map(createToneNodes),\n        [props.stems]\n    );\n\n    const initialPlayerState: PlayerState<StemKey> = (() => {\n        const stemStates: StemState<StemKey>[] = props.stems.map(\n            (stem: StemInput<StemKey>) => {\n                return {\n                    key: stem.label,\n                    muted: false,\n                    volumePercentage: 100,\n                };\n            }\n        );\n\n        return {\n            masterVolumePercentage: 100,\n            masterPitchShift: 0,\n            stems: stemStates,\n        };\n    })();\n\n    const [playerState, setPlayerState] =\n        useState<PlayerState<StemKey>>(initialPlayerState);\n\n    const playerStateRef = useRef(playerState);\n    playerStateRef.current = playerState;\n\n    const silentURL: string = useMemo(() => {\n        if (props.stems.length === 0) {\n            return \"\";\n        }\n\n        return createEmptySongURL(props.stems[0].audioBuffer.duration);\n    }, [props.stems]);\n\n    const handleMasterVolumeChange: ReactEventHandler<HTMLAudioElement> = (\n        event: SyntheticEvent<HTMLAudioElement>\n    ) => {\n        // need to use ref, seems like changing this doesn't cause a rerender in react player\n        const newPlayerState = lodash.cloneDeep(playerStateRef.current);\n        newPlayerState.masterVolumePercentage =\n            event.currentTarget.volume * 100;\n        setPlayerState(newPlayerState);\n    };\n\n    const filePlayerProps = makeFilePlayerProps(\n        props.playerControls,\n        playerState.masterVolumePercentage,\n        handleMasterVolumeChange\n    );\n\n    const refreshTrackFn = props.refreshTrackFn;\n\n    // check the integrity of the loaded tracks - they should all be the same length\n    // otherwise there could be a loading error\n    useEffect(() => {\n        let minDuration: number | null = null;\n        let maxDuration: number | null = null;\n\n        for (const stem of props.stems) {\n            const buffer = stem.audioBuffer;\n            if (minDuration === null || buffer.duration < minDuration) {\n                minDuration = buffer.duration;\n            }\n\n            if (maxDuration === null || buffer.duration > maxDuration) {\n                maxDuration = buffer.duration;\n            }\n        }\n\n        if (maxDuration === null || minDuration === null) {\n            return;\n        }\n\n        if (maxDuration - minDuration > 1) {\n            refreshTrackFn();\n        }\n    }, [enqueueSnackbar, props.stems, refreshTrackFn]);\n\n    // synchronize the time control and tone transport\n    useEffect(() => {\n        // sync the play state\n        if (\n            props.playerControls.playing &&\n            Tone.Transport.state !== \"started\"\n        ) {\n            Tone.Transport.start();\n        } else if (\n            !props.playerControls.playing &&\n            Tone.Transport.state !== \"paused\" &&\n            Tone.Transport.state !== \"stopped\"\n        ) {\n            Tone.Transport.pause();\n        }\n\n        const playrate = props.playerControls.playrate.percentage / 100;\n\n        // Tone transport doesn't observe slowed down time, only each individual node plays the sound back slower\n        // e.g. if a 10s clip is played at 50% speed, then Tone transport will finish playing it from 0s to 20s\n        // so to compare player time and Tone transport time, it needs to be scaled against the playrate\n        const adjustedToneTime = Tone.Transport.seconds * playrate;\n\n        // sync the time\n        if (Math.abs(props.playerControls.currentTime - adjustedToneTime) > 1) {\n            Tone.Transport.seconds =\n                props.playerControls.currentTime / playrate;\n        }\n    }, [\n        props.playerControls.playing,\n        props.playerControls.currentTime,\n        props.playerControls.playrate.percentage,\n    ]);\n\n    // synchronize player state and track volumes/mutedness\n    useEffect(() => {\n        playerState.stems.forEach(\n            (stemState: StemState<StemKey>, stemIndex: number) => {\n                const node = toneNodes[stemIndex];\n\n                const stemVolume =\n                    (stemState.volumePercentage / 100) *\n                    (playerState.masterVolumePercentage / 100);\n\n                // don't set if fraction is 0, log of 0 is undefined\n                if (stemVolume > 0) {\n                    const stemVolumeDecibels = 20 * Math.log10(stemVolume);\n                    node.volumeNode.volume.value = stemVolumeDecibels;\n                }\n\n                // mute needs to be set last because it can be overrided by volume\n                node.endNode.mute = stemState.muted || stemVolume === 0;\n\n                node.playerNode.playbackRate =\n                    props.playerControls.playrate.percentage / 100;\n            }\n        );\n    }, [toneNodes, playerState, props.playerControls.playrate.percentage]);\n\n    // synchronize player state and pitch shift\n    useEffect(() => {\n        playerState.stems.forEach(\n            (_stemState: StemState<StemKey>, stemIndex: number) => {\n                const node = toneNodes[stemIndex];\n\n                // a hard coded hack - drums don't sound good pitch shifted\n                // and also don't need to be harmonically in step with all the\n                // other tracks\n                const pitchShift = node.label !== \"drums\";\n                if (pitchShift) {\n                    node.playerNode.detune = playerState.masterPitchShift * 100;\n                }\n            }\n        );\n    }, [toneNodes, playerState]);\n\n    // connect and disconnect nodes from the transport when not in focus\n    // so that other tracks can use the transport\n    useEffect(() => {\n        if (props.currentTrack) {\n            toneNodes.forEach((toneNode: StemToneNodes<StemKey>) => {\n                toneNode.playerNode.sync().start(0);\n                toneNode.endNode.toDestination();\n            });\n\n            return () => {\n                toneNodes.forEach((toneNode: StemToneNodes<StemKey>) => {\n                    toneNode.playerNode.unsync();\n                    toneNode.endNode.disconnect();\n                });\n            };\n        }\n    }, [props.currentTrack, toneNodes]);\n\n    // pause the track when user switches to a different track\n    useEffect(() => {\n        if (!props.currentTrack && props.playerControls.playing) {\n            props.playerControls.onPause();\n        }\n    }, [props.currentTrack, props.playerControls]);\n\n    // cleanup buffer resources when this component goes out of scope\n    useEffect(() => {\n        return () => {\n            toneNodes.forEach((toneNode: StemToneNodes<StemKey>) => {\n                toneNode.volumeNode.dispose();\n                toneNode.playerNode.dispose();\n            });\n        };\n    }, [toneNodes]);\n\n    const stemControlPane = (() => {\n        const makeStemControl = (\n            stemState: StemState<StemKey>,\n            stemIndex: number\n        ): StemControl<StemKey> => {\n            const buttonColour: ControlPaneButtonColour = (() => {\n                const stemInput = props.stems.find(\n                    (value: StemInput<StemKey>) => value.label === stemState.key\n                );\n                if (stemInput === undefined) {\n                    return \"white\";\n                }\n\n                return stemInput.buttonColour;\n            })();\n\n            return {\n                label: stemState.key,\n                buttonColour: buttonColour,\n                enabled: !stemState.muted,\n                onEnabledChanged: (enabled: boolean) => {\n                    const newPlayerState = lodash.cloneDeep(playerState);\n                    newPlayerState.stems[stemIndex].muted = !enabled;\n                    setPlayerState(newPlayerState);\n                },\n                volume: stemState.volumePercentage,\n                onVolumeChanged: (newVolume: number) => {\n                    const newPlayerState = lodash.cloneDeep(playerState);\n                    newPlayerState.stems[stemIndex].volumePercentage =\n                        newVolume;\n                    setPlayerState(newPlayerState);\n                },\n            };\n        };\n\n        const stemControls = playerState.stems.map(makeStemControl);\n\n        return <StemTrackControlPane<StemKey> stemControls={stemControls} />;\n    })();\n\n    const handlePitchShift = (newPitchShift: number) => {\n        setPlayerState({\n            ...playerState,\n            masterPitchShift: newPitchShift,\n        });\n    };\n\n    return (\n        <Box>\n            <Box>\n                <FilePlayer {...filePlayerProps} url={silentURL} />\n            </Box>\n            {stemControlPane}\n            <ControlPane\n                show={props.focused}\n                playing={props.playerControls.playing}\n                sectionLabel={props.playerControls.currentSectionLabel}\n                onTogglePlay={props.playerControls.togglePlay}\n                onJumpBack={props.playerControls.jumpBack}\n                onJumpForward={props.playerControls.jumpForward}\n                onSkipBack={props.playerControls.skipBack}\n                onSkipForward={props.playerControls.skipForward}\n                onGoToBeginning={props.playerControls.goToBeginning}\n                playrate={props.playerControls.playrate}\n                transpose={{\n                    level: playerState.masterPitchShift,\n                    onChange: handlePitchShift,\n                }}\n            />\n        </Box>\n    );\n};\n\nexport default LoadedStemTrackPlayer;\n","import {\n    Box,\n    Button,\n    LinearProgress,\n    Theme,\n    Typography,\n} from \"@material-ui/core\";\nimport { grey } from \"@material-ui/core/colors\";\nimport RefreshIcon from \"@material-ui/icons/Refresh\";\nimport { withStyles } from \"@material-ui/styles\";\nimport ky, { DownloadProgress } from \"ky\";\nimport lodash from \"lodash\";\nimport prettyBytes from \"pretty-bytes\";\nimport React, { useEffect, useRef, useState } from \"react\";\nimport { StemTrack } from \"../../../../common/ChordModel/tracks/StemTrack\";\nimport { DetailedLoadingFetchState } from \"../../../../common/fetch\";\nimport { mapObject } from \"../../../../common/mapObject\";\nimport { PlainFn } from \"../../../../common/PlainFn\";\nimport { PlayerControls } from \"../usePlayerControls\";\nimport { getAudioCtx } from \"./audioCtx\";\nimport LoadedStemTrackPlayer, { StemInput } from \"./LoadedStemTrackPlayer\";\nimport { ControlPaneButtonColour } from \"./StemTrackControlPane\";\n\nconst PaddedBox = withStyles((theme: Theme) => ({\n    root: {\n        padding: theme.spacing(2),\n        backgroundColor: grey[100],\n    },\n}))(Box);\n\nexport interface StemButtonSpec<StemKey extends string> {\n    label: StemKey;\n    buttonColour: ControlPaneButtonColour;\n}\n\ninterface StemTrackPlayerProps<StemKey extends string> {\n    focused: boolean;\n    isCurrentTrack: boolean;\n\n    track: StemTrack<StemKey>;\n    buttonSpecs: StemButtonSpec<StemKey>[];\n\n    playerControls: PlayerControls;\n    refreshTrackFn: PlainFn;\n}\n\ninterface SingleLoadingProgress {\n    loadedBytes: number;\n    totalBytes: number | \"initial\" | \"unknown\";\n}\n\ntype FetchResult<StemKey extends string> = StemInput<StemKey>[];\ntype LoadingProgress<StemKey extends string> = Record<\n    StemKey,\n    SingleLoadingProgress\n>;\n\nconst StemTrackPlayer = <StemKey extends string>(\n    props: StemTrackPlayerProps<StemKey>\n): JSX.Element => {\n    const [fetchState, setFetchState] = useState<\n        DetailedLoadingFetchState<\n            FetchResult<StemKey>,\n            LoadingProgress<StemKey>\n        >\n    >({\n        state: \"not-started\",\n    });\n\n    const fetchStateRef = useRef(fetchState);\n    fetchStateRef.current = fetchState;\n\n    const fetchAudioBuffer = async (\n        url: string,\n        handleProgress: (progress: DownloadProgress) => void\n    ): Promise<AudioBuffer> => {\n        const response = await ky\n            .get(url, {\n                timeout: false,\n                onDownloadProgress: handleProgress,\n            })\n            .arrayBuffer();\n\n        return await getAudioCtx().decodeAudioData(response);\n    };\n\n    useEffect(() => {\n        type BufferKeyPair = {\n            audioBuffer: AudioBuffer;\n            stemKey: StemKey;\n        };\n\n        const fetchAudioBufferWithProgress = (\n            url: string,\n            stemKey: StemKey\n        ) => {\n            const handleProgress = (progress: DownloadProgress) => {\n                const currentFetchState = fetchStateRef.current;\n                if (currentFetchState.state !== \"loading\") {\n                    return;\n                }\n\n                const newFetchState = lodash.clone(currentFetchState);\n                newFetchState.details[stemKey].loadedBytes =\n                    progress.transferredBytes;\n                newFetchState.details[stemKey].totalBytes =\n                    progress.totalBytes !== 0 ? progress.totalBytes : \"unknown\";\n\n                setFetchState(newFetchState);\n            };\n\n            const audioBufferPromise = fetchAudioBuffer(url, handleProgress);\n\n            return audioBufferPromise.then((audioBuffer: AudioBuffer) => ({\n                audioBuffer: audioBuffer,\n                stemKey: stemKey,\n            }));\n        };\n\n        const loadPlayers = async () => {\n            try {\n                const audioBufferPromises: Promise<BufferKeyPair>[] = [];\n\n                let stemKey: StemKey;\n                for (stemKey in props.track.stem_urls) {\n                    const bufferPromise = fetchAudioBufferWithProgress(\n                        props.track.stem_urls[stemKey],\n                        stemKey\n                    );\n                    audioBufferPromises.push(bufferPromise);\n                }\n\n                const resolvedKeyBuffers = await Promise.all(\n                    audioBufferPromises\n                );\n\n                let encounteredError = false;\n                const stemInputs: StemInput<StemKey>[] = props.buttonSpecs.map(\n                    (buttonSpec: StemButtonSpec<StemKey>) => {\n                        const audioBufferSearch = resolvedKeyBuffers.find(\n                            (value: BufferKeyPair) =>\n                                value.stemKey === buttonSpec.label\n                        );\n\n                        let audioBuffer: AudioBuffer;\n                        if (audioBufferSearch === undefined) {\n                            encounteredError = true;\n\n                            audioBuffer = new AudioBuffer({\n                                length: 0,\n                                sampleRate: 1,\n                            });\n                        } else {\n                            audioBuffer = audioBufferSearch.audioBuffer;\n                        }\n\n                        return {\n                            label: buttonSpec.label,\n                            audioBuffer: audioBuffer,\n                            buttonColour: buttonSpec.buttonColour,\n                        };\n                    }\n                );\n\n                if (encounteredError) {\n                    setFetchState({\n                        state: \"error\",\n                        error: new Error(\n                            \"Could not find stem key in audio buffer array to object mapping\"\n                        ),\n                    });\n                    return;\n                }\n\n                setFetchState({\n                    state: \"loaded\",\n                    item: stemInputs,\n                });\n            } catch (e) {\n                setFetchState({\n                    state: \"error\",\n                    error: e,\n                });\n                return;\n            }\n        };\n\n        if (fetchState.state === \"not-started\") {\n            loadPlayers();\n            setFetchState({\n                state: \"loading\",\n                details: mapObject(\n                    props.track.keyObject(),\n                    (): SingleLoadingProgress => ({\n                        loadedBytes: 0,\n                        totalBytes: \"initial\",\n                    })\n                ),\n            });\n        }\n    }, [fetchState, setFetchState, props.track, props.buttonSpecs]);\n\n    if (fetchState.state === \"not-started\") {\n        return (\n            <PaddedBox>\n                <Typography variant=\"body1\">\n                    Tracks have not started loading...\n                </Typography>\n            </PaddedBox>\n        );\n    }\n\n    if (fetchState.state === \"loading\") {\n        const totalBytes: number | \"unknown\" | \"initial\" = (() => {\n            let total = 0;\n            let stemKey: StemKey;\n            for (stemKey in fetchState.details) {\n                const stemTotal = fetchState.details[stemKey].totalBytes;\n\n                switch (stemTotal) {\n                    case \"unknown\": {\n                        return \"unknown\";\n                    }\n\n                    case \"initial\": {\n                        return \"initial\";\n                    }\n\n                    default: {\n                        total += stemTotal;\n                        break;\n                    }\n                }\n            }\n            return total;\n        })();\n\n        const loadedBytes: number = (() => {\n            let loaded = 0;\n            let stemKey: StemKey;\n            for (stemKey in fetchState.details) {\n                loaded += fetchState.details[stemKey].loadedBytes;\n            }\n            return loaded;\n        })();\n\n        let formattedProgress = prettyBytes(loadedBytes);\n        if (totalBytes !== \"unknown\" && totalBytes !== \"initial\") {\n            formattedProgress += \"/\" + prettyBytes(totalBytes);\n        }\n\n        const progressBar = (() => {\n            if (totalBytes === \"unknown\") {\n                return <LinearProgress />;\n            }\n\n            const percent: number = (() => {\n                if (totalBytes === \"initial\") {\n                    // we don't know everything yet, just conservatively pretend it's out of 100MB\n                    // so the bar won't go backwards\n                    const pretendTotalBytes = 100 * 1000 * 1000;\n                    return (loadedBytes / pretendTotalBytes) * 100;\n                }\n\n                return (loadedBytes / totalBytes) * 100;\n            })();\n\n            return <LinearProgress variant=\"determinate\" value={percent} />;\n        })();\n\n        const label = (() => {\n            if (loadedBytes === totalBytes) {\n                return \"Processing track...\";\n            }\n\n            return \"Loading track...\";\n        })();\n\n        return (\n            <PaddedBox>\n                <Typography variant=\"body1\">\n                    {label}({formattedProgress})\n                </Typography>\n                {progressBar}\n            </PaddedBox>\n        );\n    }\n\n    if (fetchState.state === \"error\") {\n        console.error(fetchState.error);\n        const refresh = () => {\n            setFetchState({ state: \"not-started\" });\n        };\n\n        return (\n            <PaddedBox display=\"flex\" alignItems=\"center\">\n                <Button onClick={refresh}>\n                    <RefreshIcon />\n                </Button>\n                <Typography variant=\"body1\">Failed to load tracks</Typography>\n            </PaddedBox>\n        );\n    }\n\n    return (\n        <LoadedStemTrackPlayer\n            focused={props.focused}\n            currentTrack={props.isCurrentTrack}\n            stems={fetchState.item}\n            playerControls={props.playerControls}\n            refreshTrackFn={props.refreshTrackFn}\n        />\n    );\n};\n\nexport default StemTrackPlayer;\n","import { Box, LinearProgress, Theme, Typography } from \"@material-ui/core\";\nimport grey from \"@material-ui/core/colors/grey\";\nimport { withStyles } from \"@material-ui/styles\";\nimport React, { useEffect } from \"react\";\nimport { SplitStemTrack } from \"../../common/ChordModel/tracks/SplitStemRequest\";\nimport { PlainFn } from \"../../common/PlainFn\";\n\nconst PaddedBox = withStyles((theme: Theme) => ({\n    root: {\n        padding: theme.spacing(2),\n        backgroundColor: grey[100],\n    },\n}))(Box);\n\nconst refreshInterval = 10000;\n\ninterface LoadingSplitStemTrackViewProps {\n    track: SplitStemTrack;\n    refreshTrackFn: PlainFn;\n}\n\nconst LoadingSplitStemTrackView: React.FC<LoadingSplitStemTrackViewProps> = (\n    props: LoadingSplitStemTrackViewProps\n): JSX.Element => {\n    useEffect(() => {\n        if (props.track.job_status === \"error\") {\n            return;\n        }\n\n        setTimeout(props.refreshTrackFn, refreshInterval);\n    }, [props]);\n\n    if (props.track.job_status === \"error\") {\n        console.error(props.track.job_status_debug_log);\n\n        const message = `An Error Occurred: ${props.track.job_status_message}`;\n        return (\n            <PaddedBox>\n                <Typography variant=\"body1\">{message}</Typography>\n                <LinearProgress\n                    variant=\"determinate\"\n                    value={props.track.job_progress}\n                    color=\"secondary\"\n                />\n            </PaddedBox>\n        );\n    }\n\n    return (\n        <PaddedBox>\n            <Typography variant=\"body1\">\n                {props.track.job_status_message}\n            </Typography>\n            <LinearProgress\n                variant=\"determinate\"\n                value={props.track.job_progress}\n            />\n        </PaddedBox>\n    );\n};\n\nexport default LoadingSplitStemTrackView;\n","import * as iots from \"io-ts\";\nimport { SingleTrack, SingleTrackValidator } from \"./SingleTrack\";\nimport { SplitStemTrack, SplitStemTrackValidator } from \"./SplitStemRequest\";\nimport {\n    FiveStemTrack,\n    FiveStemTrackValidator,\n    FourStemTrack,\n    FourStemTrackValidator,\n    TwoStemTrack,\n    TwoStemTrackValidator,\n} from \"./StemTrack\";\n\nexport const TrackValidator = iots.union([\n    SingleTrackValidator,\n    TwoStemTrackValidator,\n    FourStemTrackValidator,\n    FiveStemTrackValidator,\n    SplitStemTrackValidator,\n]);\n\nexport type Track =\n    | SingleTrack\n    | TwoStemTrack\n    | FourStemTrack\n    | FiveStemTrack\n    | SplitStemTrack;\n","import { Either, isLeft, left, right } from \"fp-ts/lib/Either\";\nimport * as iots from \"io-ts\";\nimport { SingleTrack } from \"./SingleTrack\";\nimport { SplitStemTrack } from \"./SplitStemRequest\";\nimport { FiveStemTrack, FourStemTrack, TwoStemTrack } from \"./StemTrack\";\nimport { Track, TrackValidator } from \"./Track\";\n\nconst TrackListValidator = iots.type({\n    song_id: iots.string,\n    tracks: iots.array(TrackValidator),\n});\n\ntype TrackListValidatedFields = iots.TypeOf<typeof TrackListValidator>;\nexport class TrackList implements TrackListValidatedFields {\n    readonly song_id: string;\n    readonly tracks: Track[];\n\n    constructor(songID: string, tracks: Track[]) {\n        this.song_id = songID;\n        this.tracks = tracks;\n    }\n\n    static fromValidatedFields(\n        validatedFields: TrackListValidatedFields\n    ): TrackList {\n        const deserializeTrack = (\n            validatedFields: iots.TypeOf<typeof TrackValidator>\n        ): Track => {\n            switch (validatedFields.track_type) {\n                case \"single\": {\n                    return SingleTrack.fromValidatedFields(validatedFields);\n                }\n\n                case \"2stems\": {\n                    return TwoStemTrack.fromValidatedFields(validatedFields);\n                }\n\n                case \"4stems\": {\n                    return FourStemTrack.fromValidatedFields(validatedFields);\n                }\n\n                case \"5stems\": {\n                    return FiveStemTrack.fromValidatedFields(validatedFields);\n                }\n\n                case \"split_2stems\":\n                case \"split_4stems\":\n                case \"split_5stems\": {\n                    return SplitStemTrack.fromValidatedFields(validatedFields);\n                }\n            }\n        };\n\n        const tracks: Track[] = validatedFields.tracks.map(deserializeTrack);\n        return new TrackList(validatedFields.song_id, tracks);\n    }\n\n    static fromJSONObject(jsonObj: unknown): Either<Error, TrackList> {\n        const validationResult = TrackListValidator.decode(jsonObj);\n\n        if (isLeft(validationResult)) {\n            return left(new Error(\"Invalid Chord Song object\"));\n        }\n\n        return right(this.fromValidatedFields(validationResult.right));\n    }\n}\n","import { Either, isLeft } from \"fp-ts/lib/Either\";\nimport { useState } from \"react\";\nimport { useDebouncedCallback } from \"use-debounce\";\nimport {\n    getTrackList,\n    updateTrackList,\n} from \"../../../common/backend/requests\";\nimport { TrackList } from \"../../../common/ChordModel/tracks/TrackList\";\nimport { FetchState } from \"../../../common/fetch\";\nimport { PlainFn } from \"../../../common/PlainFn\";\n\ninterface LoadingTrackListState {\n    state: \"loading\";\n}\n\ninterface ErrorTrackListState {\n    state: \"error\";\n    error: unknown;\n}\n\ninterface LoadedTrackListState {\n    state: \"loaded\";\n    tracklist: TrackList;\n}\n\nexport type TrackListLoad =\n    | LoadedTrackListState\n    | LoadingTrackListState\n    | ErrorTrackListState;\n\nexport type TrackListUpdateFn = (\n    tracklist: TrackList,\n    userAuthToken: string | null\n) => Promise<void>;\n\nconst refreshDebounceThreshold = 500;\n\nexport const useTracklistFetch = (\n    tracklistID: string\n): [TrackListLoad, PlainFn, TrackListUpdateFn] => {\n    const [fetchState, setFetchState] = useState<FetchState<TrackList>>({\n        state: \"not-started\",\n    });\n\n    const refresh = useDebouncedCallback(\n        () => setFetchState({ state: \"not-started\" }),\n        refreshDebounceThreshold\n    );\n\n    const handleFetchedTracklist = (fetchResult: Either<Error, unknown>) => {\n        if (isLeft(fetchResult)) {\n            setFetchState({ state: \"error\", error: fetchResult.left });\n            return;\n        }\n\n        const result = TrackList.fromJSONObject(fetchResult.right);\n        if (isLeft(result)) {\n            setFetchState({\n                state: \"error\",\n                error: \"Failed to deserialize payload to tracklist\",\n            });\n            return;\n        }\n\n        setFetchState({ state: \"loaded\", item: result.right });\n    };\n\n    const fetchTrackList = async () => {\n        let fetchResult = await getTrackList(tracklistID);\n        handleFetchedTracklist(fetchResult);\n    };\n\n    const updateTracklist = async (\n        tracklist: TrackList,\n        userAuthToken: string | null\n    ) => {\n        if (userAuthToken === null) {\n            setFetchState({ state: \"loaded\", item: tracklist });\n            return;\n        }\n\n        const updateResult = await updateTrackList(tracklist, userAuthToken);\n        handleFetchedTracklist(updateResult);\n    };\n\n    switch (fetchState.state) {\n        case \"not-started\": {\n            setFetchState({ state: \"loading\" });\n            fetchTrackList();\n            return [{ state: \"loading\" }, refresh, updateTracklist];\n        }\n\n        case \"error\": {\n            return [\n                { state: \"error\", error: fetchState.error },\n                refresh,\n                updateTracklist,\n            ];\n        }\n\n        case \"loading\": {\n            return [{ state: \"loading\" }, refresh, updateTracklist];\n        }\n\n        case \"loaded\": {\n            return [\n                { state: \"loaded\", tracklist: fetchState.item },\n                refresh,\n                updateTracklist,\n            ];\n        }\n    }\n};\n","import { Box, CircularProgress, Theme } from \"@material-ui/core\";\nimport { withStyles } from \"@material-ui/styles\";\nimport React from \"react\";\n\nconst CenteredBox = withStyles((theme: Theme) => ({\n    root: {\n        display: \"flex\",\n        justifyContent: \"center\",\n        margin: theme.spacing(0.5),\n    },\n}))(Box);\n\nconst WaitingSpinner: React.FC<{}> = (): JSX.Element => {\n    return (\n        <CenteredBox>\n            <CircularProgress />\n        </CenteredBox>\n    );\n};\n\nexport default WaitingSpinner;\n","import { Collapse } from \"@material-ui/core\";\nimport React from \"react\";\nimport {\n    FiveStemKeys,\n    FourStemKeys,\n    TwoStemKeys,\n} from \"../../common/ChordModel/tracks/StemTrack\";\nimport { Track } from \"../../common/ChordModel/tracks/Track\";\nimport { PlainFn } from \"../../common/PlainFn\";\nimport ErrorImage from \"../display/ErrorImage\";\nimport SingleTrackPlayer from \"./internal_player/single/SingleTrackPlayer\";\nimport StemTrackPlayer, {\n    StemButtonSpec,\n} from \"./internal_player/stem/StemTrackPlayer\";\nimport { PlayerControls } from \"./internal_player/usePlayerControls\";\nimport LoadingSplitStemTrackView from \"./LoadingSplitStemTrackView\";\nimport { useTrackFetch } from \"./providers/useTrackFetch\";\nimport WaitingSpinner from \"./WaitingSpinner\";\n\ninterface TrackPlayerProps {\n    focused: boolean;\n    isCurrentTrack: boolean;\n    tracklistID: string;\n    trackID: string;\n    playerControls: PlayerControls;\n}\n\nconst TrackPlayer: React.FC<TrackPlayerProps> = (\n    props: TrackPlayerProps\n): JSX.Element => {\n    const [trackLoad, refreshTrackFn] = useTrackFetch(\n        props.tracklistID,\n        props.trackID\n    );\n\n    switch (trackLoad.state) {\n        case \"loading\": {\n            return <WaitingSpinner />;\n        }\n\n        case \"error\": {\n            return <ErrorImage error={trackLoad.error} />;\n        }\n\n        case \"loaded\": {\n            return (\n                <LoadedTrackPlayer\n                    track={trackLoad.track}\n                    focused={props.focused}\n                    isCurrentTrack={props.isCurrentTrack}\n                    playerControls={props.playerControls}\n                    refreshTrackFn={refreshTrackFn}\n                />\n            );\n        }\n    }\n};\n\ninterface LoadedTrackPlayerProps {\n    focused: boolean;\n    isCurrentTrack: boolean;\n    track: Track;\n    playerControls: PlayerControls;\n    refreshTrackFn: PlainFn;\n}\n\nconst LoadedTrackPlayer: React.FC<LoadedTrackPlayerProps> = (\n    props: LoadedTrackPlayerProps\n): JSX.Element => {\n    const innerPlayer: React.ReactElement = (() => {\n        switch (props.track.track_type) {\n            case \"single\": {\n                return (\n                    <SingleTrackPlayer\n                        focused={props.focused}\n                        isCurrentTrack={props.isCurrentTrack}\n                        track={props.track}\n                        playerControls={props.playerControls}\n                    />\n                );\n            }\n\n            case \"2stems\": {\n                const buttonSpecs: StemButtonSpec<TwoStemKeys>[] = [\n                    {\n                        label: \"vocals\",\n                        buttonColour: \"lightBlue\",\n                    },\n                    {\n                        label: \"accompaniment\",\n                        buttonColour: \"purple\",\n                    },\n                ];\n\n                return (\n                    <StemTrackPlayer\n                        focused={props.focused}\n                        isCurrentTrack={props.isCurrentTrack}\n                        track={props.track}\n                        buttonSpecs={buttonSpecs}\n                        playerControls={props.playerControls}\n                        refreshTrackFn={props.refreshTrackFn}\n                    />\n                );\n            }\n\n            case \"4stems\": {\n                const buttonSpecs: StemButtonSpec<FourStemKeys>[] = [\n                    {\n                        label: \"vocals\",\n                        buttonColour: \"lightBlue\",\n                    },\n                    {\n                        label: \"other\",\n                        buttonColour: \"purple\",\n                    },\n                    {\n                        label: \"bass\",\n                        buttonColour: \"pink\",\n                    },\n                    {\n                        label: \"drums\",\n                        buttonColour: \"yellow\",\n                    },\n                ];\n\n                return (\n                    <StemTrackPlayer\n                        focused={props.focused}\n                        isCurrentTrack={props.isCurrentTrack}\n                        track={props.track}\n                        buttonSpecs={buttonSpecs}\n                        playerControls={props.playerControls}\n                        refreshTrackFn={props.refreshTrackFn}\n                    />\n                );\n            }\n\n            case \"5stems\": {\n                const buttonSpecs: StemButtonSpec<FiveStemKeys>[] = [\n                    {\n                        label: \"vocals\",\n                        buttonColour: \"lightBlue\",\n                    },\n                    {\n                        label: \"other\",\n                        buttonColour: \"purple\",\n                    },\n                    {\n                        label: \"piano\",\n                        buttonColour: \"lightGreen\",\n                    },\n                    {\n                        label: \"bass\",\n                        buttonColour: \"pink\",\n                    },\n                    {\n                        label: \"drums\",\n                        buttonColour: \"yellow\",\n                    },\n                ];\n\n                return (\n                    <StemTrackPlayer\n                        focused={props.focused}\n                        isCurrentTrack={props.isCurrentTrack}\n                        track={props.track}\n                        buttonSpecs={buttonSpecs}\n                        playerControls={props.playerControls}\n                        refreshTrackFn={props.refreshTrackFn}\n                    />\n                );\n            }\n\n            case \"split_2stems\":\n            case \"split_4stems\":\n            case \"split_5stems\": {\n                return (\n                    <LoadingSplitStemTrackView\n                        track={props.track}\n                        refreshTrackFn={props.refreshTrackFn}\n                    />\n                );\n            }\n        }\n    })();\n\n    return <Collapse in={props.focused}>{innerPlayer}</Collapse>;\n};\n\nexport default TrackPlayer;\n","import { Track } from \"../../../common/ChordModel/tracks/Track\";\nimport { TrackList } from \"../../../common/ChordModel/tracks/TrackList\";\nimport { PlainFn } from \"../../../common/PlainFn\";\nimport { useTracklistFetch } from \"./useTracklistFetch\";\n\ninterface LoadingTrackState {\n    state: \"loading\";\n}\n\ninterface ErrorTrackState {\n    state: \"error\";\n    error: unknown;\n}\n\ninterface LoadedTrackState {\n    state: \"loaded\";\n    track: Track;\n}\n\nexport type TrackLoad = LoadedTrackState | LoadingTrackState | ErrorTrackState;\n\nexport const useTrackFetch = (\n    tracklistID: string,\n    trackID: string\n): [TrackLoad, PlainFn] => {\n    const [tracklistLoad, refresh] = useTracklistFetch(tracklistID);\n\n    const findTrack = (tracklist: TrackList): Track | undefined => {\n        const matchByID = (track: Track) => track.id === trackID;\n        return tracklist.tracks.find(matchByID);\n    };\n\n    switch (tracklistLoad.state) {\n        case \"error\": {\n            return [{ state: \"error\", error: tracklistLoad.error }, refresh];\n        }\n\n        case \"loading\": {\n            return [{ state: \"loading\" }, refresh];\n        }\n\n        case \"loaded\": {\n            const track = findTrack(tracklistLoad.tracklist);\n            if (track === undefined) {\n                const notFoundError = new Error(\"Track is not found\");\n\n                return [{ state: \"error\", error: notFoundError }, refresh];\n            }\n\n            return [{ state: \"loaded\", track: track }, refresh];\n        }\n    }\n};\n","import {\n    Box,\n    Button,\n    Divider,\n    MenuItem,\n    Select as UnstyledSelect,\n    Slide,\n    Theme,\n} from \"@material-ui/core\";\nimport EditIcon from \"@material-ui/icons/Edit\";\nimport CollapseDownIcon from \"@material-ui/icons/ExpandMore\";\nimport RefreshIcon from \"@material-ui/icons/Refresh\";\nimport { makeStyles, withStyles } from \"@material-ui/styles\";\nimport React, { useEffect } from \"react\";\nimport { Track } from \"../../common/ChordModel/tracks/Track\";\nimport { PlainFn } from \"../../common/PlainFn\";\nimport { useRegisterTopKeyListener } from \"../GlobalKeyListener\";\nimport {\n    roundedCornersStyle,\n    roundedTopCornersStyle,\n    TitleBar,\n    withBottomRightBox,\n} from \"./common\";\nimport {\n    PlayerControls,\n    unfocusedControls,\n} from \"./internal_player/usePlayerControls\";\nimport { TrackListLoad } from \"./providers/TrackListProvider\";\nimport TrackPlayer from \"./TrackPlayer\";\nimport WaitingSpinner from \"./WaitingSpinner\";\n\nconst FlexBox = withStyles((theme: Theme) => ({\n    root: {\n        display: \"flex\",\n        alignItems: \"center\",\n        margin: theme.spacing(0.5),\n    },\n}))(Box);\n\nconst TitleBarButton = withStyles((theme: Theme) => ({\n    root: {\n        minWidth: 0,\n        ...roundedCornersStyle(theme),\n    },\n}))(Button);\n\nconst usePaddingLeftStyle = makeStyles((theme: Theme) => ({\n    root: {\n        \"& .MuiSelect-select\": {\n            paddingLeft: theme.spacing(2),\n        },\n    },\n}));\n\nconst Select = withStyles((theme: Theme) => ({\n    root: {\n        minWidth: theme.spacing(30),\n    },\n}))(UnstyledSelect);\n\nconst FullPlayerContainer = withStyles((theme: Theme) => {\n    const transportControlsWidth = theme.spacing(36);\n\n    return {\n        root: {\n            backgroundColor: \"white\",\n            minWidth: \"50vw\",\n            maxWidth: transportControlsWidth,\n            ...roundedTopCornersStyle(theme),\n        },\n    };\n})(Box);\n\ninterface MultiTrackPlayerProps {\n    show: boolean;\n\n    tracklistLoad: TrackListLoad;\n    playerControls: PlayerControls;\n\n    currentTrackIndex: number;\n    onSelectCurrentTrack: (index: number) => void;\n\n    onOpenTrackEditDialog?: PlainFn;\n    onMinimize: PlainFn;\n    onRefresh: PlainFn;\n}\n\nconst MultiTrackPlayer: React.FC<MultiTrackPlayerProps> = (\n    props: MultiTrackPlayerProps\n): JSX.Element => {\n    const paddingLeftStyle = usePaddingLeftStyle();\n    const [addTopKeyListener, removeKeyListener] = useRegisterTopKeyListener();\n\n    {\n        const show = props.show;\n        const onMinimize = props.onMinimize;\n        useEffect(() => {\n            if (!show) {\n                return;\n            }\n\n            const handleKey = (event: KeyboardEvent) => {\n                if (event.code !== \"Slash\") {\n                    return;\n                }\n\n                onMinimize();\n                event.preventDefault();\n            };\n\n            addTopKeyListener(handleKey);\n            return () => removeKeyListener(handleKey);\n        }, [addTopKeyListener, removeKeyListener, onMinimize, show]);\n    }\n\n    const trackListEditButton = props.onOpenTrackEditDialog !== undefined && (\n        <TitleBarButton onClick={props.onOpenTrackEditDialog}>\n            <EditIcon />\n        </TitleBarButton>\n    );\n\n    const trackRefreshButton = (\n        <TitleBarButton onClick={props.onRefresh}>\n            <RefreshIcon />\n        </TitleBarButton>\n    );\n\n    const trackChangeHandler = (\n        event: React.ChangeEvent<{\n            name?: string | undefined;\n            value: unknown;\n        }>\n    ) => {\n        const value: unknown = event.target.value;\n        if (typeof value !== \"number\") {\n            console.error(\n                \"Unexpected! Selected value in full size player selector is not a number type\"\n            );\n            return;\n        }\n\n        props.onSelectCurrentTrack(value);\n    };\n\n    const trackListPicker = (() => {\n        const items = (() => {\n            if (props.tracklistLoad.state !== \"loaded\") {\n                return undefined;\n            }\n\n            return props.tracklistLoad.tracklist.tracks.map(\n                (track: Track, index: number) => (\n                    <MenuItem key={`${index}-${track.label}`} value={index}>\n                        {track.label}\n                    </MenuItem>\n                )\n            );\n        })();\n\n        return (\n            <Select\n                className={paddingLeftStyle.root}\n                disableUnderline\n                value={props.currentTrackIndex}\n                onChange={trackChangeHandler}\n            >\n                {items}\n            </Select>\n        );\n    })();\n\n    const titleBar = (\n        <TitleBar>\n            <Box />\n            <FlexBox>\n                {trackRefreshButton}\n                {trackListEditButton}\n                {trackListPicker}\n            </FlexBox>\n            <Box>\n                <TitleBarButton onClick={props.onMinimize}>\n                    <CollapseDownIcon />\n                </TitleBarButton>\n            </Box>\n        </TitleBar>\n    );\n\n    const internalContent: React.ReactNode = (() => {\n        if (props.tracklistLoad.state === \"loading\") {\n            return <WaitingSpinner />;\n        }\n\n        const tracklistID = props.tracklistLoad.tracklist.song_id;\n\n        const makePlayer = (track: Track, index: number) => {\n            const isCurrentTrack = index === props.currentTrackIndex;\n            const focused = isCurrentTrack && props.show;\n            const playerControls = isCurrentTrack\n                ? props.playerControls\n                : unfocusedControls;\n\n            return (\n                <TrackPlayer\n                    key={`${index}-${track.id}`}\n                    focused={focused}\n                    isCurrentTrack={isCurrentTrack}\n                    tracklistID={tracklistID}\n                    trackID={track.id}\n                    playerControls={playerControls}\n                />\n            );\n        };\n\n        return props.tracklistLoad.tracklist.tracks.map(makePlayer);\n    })();\n\n    return (\n        <Slide in={props.show} direction=\"up\">\n            {withBottomRightBox(\n                <FullPlayerContainer>\n                    {titleBar}\n                    <Divider />\n                    {internalContent}\n                </FullPlayerContainer>\n            )}\n        </Slide>\n    );\n};\n\nexport default MultiTrackPlayer;\n","import { List } from \"immutable\";\nimport React, { useCallback, useState } from \"react\";\nimport shortid from \"shortid\";\nimport { TimeSection } from \"../../common/ChordModel/ChordLine\";\nimport { TrackList } from \"../../common/ChordModel/tracks/TrackList\";\nimport { PlainFn } from \"../../common/PlainFn\";\nimport TrackListEditDialog from \"./dialog/TrackListEditDialog\";\nimport { usePlayerControls } from \"./internal_player/usePlayerControls\";\nimport MicroPlayer from \"./MicroPlayer\";\nimport MultiTrackPlayer from \"./MultiTrackPlayer\";\nimport { TrackListLoad } from \"./providers/TrackListProvider\";\n\ntype PlayerVisibilityState = \"minimized\" | \"full\";\n\ninterface JamStationProps {\n    tracklistLoad: TrackListLoad;\n    timeSections: List<TimeSection>;\n    onTrackListChanged: (trackList: TrackList) => void;\n    onRefresh: PlainFn;\n    collapsedButtonClassName?: string;\n}\n\ninterface TrackEditDialogState {\n    open: boolean;\n    randomID: string;\n}\n\nconst JamStation: React.FC<JamStationProps> = (\n    props: JamStationProps\n): JSX.Element => {\n    const [playerVisibilityState, setPlayerVisibilityState] =\n        useState<PlayerVisibilityState>(\"minimized\");\n\n    const [trackEditDialogState, setTrackEditDialogState] =\n        useState<TrackEditDialogState>({ open: false, randomID: \"\" });\n\n    // lazy loading - if we just render everything it will also\n    // cause heavy network traffic, don't do it without prompt\n    const [loadPlayers, setLoadPlayers] = useState(false);\n\n    const [currentTrackIndex, setCurrentTrackIndex] = useState(0);\n\n    const playerControls = usePlayerControls(props.timeSections);\n\n    const trackListIsEmpty =\n        props.tracklistLoad.state === \"loaded\" &&\n        props.tracklistLoad.tracklist.tracks.length === 0;\n\n    const collapsedButtonFn = (\n        disabled: boolean,\n        expandFn: () => void,\n        tooltipMessage: string\n    ) => (\n        <MicroPlayer\n            className={props.collapsedButtonClassName}\n            show={playerVisibilityState === \"minimized\"}\n            playersLoaded={loadPlayers}\n            playerControls={playerControls}\n            tooltipMessage={tooltipMessage}\n            disabled={disabled}\n            onClick={expandFn}\n        />\n    );\n\n    const handleTrackListChange = (tracklist: TrackList) => {\n        closeTrackEditDialog();\n        props.onTrackListChanged?.(tracklist);\n    };\n\n    const openTrackEditDialog = () => {\n        setTrackEditDialogState({ open: true, randomID: shortid.generate() });\n    };\n\n    const closeTrackEditDialog = () => {\n        setTrackEditDialogState({ open: false, randomID: \"\" });\n    };\n\n    const trackEditDialog = trackEditDialogState.open && (\n        <TrackListEditDialog\n            key={trackEditDialogState.randomID}\n            open={trackEditDialogState.open}\n            trackListLoad={props.tracklistLoad}\n            onSubmit={handleTrackListChange}\n            onClose={closeTrackEditDialog}\n            onRefresh={props.onRefresh}\n        />\n    );\n\n    const showPlayer = useCallback(() => {\n        if (!loadPlayers) {\n            setLoadPlayers(true);\n        }\n\n        setPlayerVisibilityState(\"full\");\n    }, [loadPlayers, setLoadPlayers, setPlayerVisibilityState]);\n\n    const minimizePlayer = useCallback(() => {\n        setPlayerVisibilityState(\"minimized\");\n    }, [setPlayerVisibilityState]);\n\n    if (trackListIsEmpty) {\n        // prompt the user to add tracks if there is none\n        return (\n            <>\n                {collapsedButtonFn(false, openTrackEditDialog, \"Show Player\")}\n                {trackEditDialog}\n            </>\n        );\n    }\n\n    if (!loadPlayers) {\n        return collapsedButtonFn(false, showPlayer, \"Show Player\");\n    }\n\n    const fullPlayer: false | JSX.Element = loadPlayers && (\n        <MultiTrackPlayer\n            show={playerVisibilityState === \"full\"}\n            tracklistLoad={props.tracklistLoad}\n            playerControls={playerControls}\n            currentTrackIndex={currentTrackIndex}\n            onSelectCurrentTrack={setCurrentTrackIndex}\n            onMinimize={minimizePlayer}\n            onRefresh={props.onRefresh}\n            onOpenTrackEditDialog={openTrackEditDialog}\n        />\n    );\n\n    return (\n        <>\n            {collapsedButtonFn(false, showPlayer, \"Show Player\")}\n            {fullPlayer}\n            {trackEditDialog}\n        </>\n    );\n};\n\nexport default JamStation;\n","import React from \"react\";\nimport { ChordSong } from \"../../../common/ChordModel/ChordSong\";\nimport { TrackList } from \"../../../common/ChordModel/tracks/TrackList\";\nimport { PlainFn } from \"../../../common/PlainFn\";\nimport ErrorImage from \"../../display/ErrorImage\";\nimport { User, UserContext } from \"../../user/userContext\";\nimport { useTracklistFetch } from \"./useTracklistFetch\";\n\ninterface LoadingTrackListState {\n    state: \"loading\";\n}\n\ninterface LoadedTrackListState {\n    state: \"loaded\";\n    tracklist: TrackList;\n}\n\nexport type TrackListLoad = LoadedTrackListState | LoadingTrackListState;\nexport type TrackListChangeHandler = (tracklist: TrackList) => Promise<void>;\n\ninterface TrackListProviderProps {\n    song: ChordSong;\n    children: (\n        trackLoad: TrackListLoad,\n        onRefresh: PlainFn,\n        onTrackListChanged: TrackListChangeHandler\n    ) => JSX.Element;\n}\n\nconst TrackListProvider: React.FC<TrackListProviderProps> = (\n    props: TrackListProviderProps\n): JSX.Element => {\n    const [tracklistLoad, refresh, updateTrackList] = useTracklistFetch(\n        props.song.id\n    );\n\n    const user: User | null = React.useContext(UserContext);\n\n    const handleTrackListChanged = async (tracklist: TrackList) => {\n        if (user === null || !props.song.isOwner(user)) {\n            await updateTrackList(tracklist, null);\n            return;\n        }\n\n        await updateTrackList(tracklist, user.authToken);\n    };\n\n    switch (tracklistLoad.state) {\n        case \"error\": {\n            return <ErrorImage error={tracklistLoad.error} />;\n        }\n        case \"loading\": {\n            return props.children(\n                { state: \"loading\" },\n                refresh,\n                handleTrackListChanged\n            );\n        }\n        case \"loaded\": {\n            return props.children(\n                { state: \"loaded\", tracklist: tracklistLoad.tracklist },\n                refresh,\n                handleTrackListChanged\n            );\n        }\n    }\n};\n\nexport default TrackListProvider;\n","import {\n    StyledComponentProps,\n    Typography as UnstyledTypography,\n} from \"@material-ui/core\";\nimport grey from \"@material-ui/core/colors/grey\";\nimport { withStyles } from \"@material-ui/styles\";\nimport { DateTime, Duration } from \"luxon\";\nimport React, { useEffect, useState } from \"react\";\n\nconst Typography = withStyles({\n    root: {\n        color: grey[600],\n    },\n})(UnstyledTypography);\n\ninterface LastSavedAtProps extends StyledComponentProps {\n    lastSaved: Date;\n}\n\nconst LastSavedAt: React.FC<LastSavedAtProps> = (\n    props: LastSavedAtProps\n): JSX.Element => {\n    const [, setLastRefreshed] = useState<Date>(new Date());\n\n    const timeDescription = (): string => {\n        const lastSaved = DateTime.fromJSDate(props.lastSaved);\n        const sinceSaved: Duration = lastSaved.diffNow();\n\n        const daysSinceSaved: number = sinceSaved.as(\"day\");\n        if (daysSinceSaved <= -1) {\n            return lastSaved.toLocaleString(DateTime.DATE_MED);\n        }\n\n        const secondsSinceSaved: number = lastSaved.diffNow().as(\"second\");\n        if (secondsSinceSaved >= -1) {\n            return \"just now\";\n        }\n\n        const relativeDescription = lastSaved.toRelative();\n        if (relativeDescription === null) {\n            return \"WHAT IS HAPPENING? CONTACT YOUR DEV\";\n        }\n\n        return relativeDescription;\n    };\n\n    useEffect(() => {\n        const interval = setInterval(() => setLastRefreshed(new Date()), 30000);\n        return () => clearInterval(interval);\n    }, [setLastRefreshed]);\n\n    return (\n        <Typography\n            classes={props.classes}\n            variant=\"caption\"\n        >{`Last Saved: ${timeDescription()}`}</Typography>\n    );\n};\n\nexport default LastSavedAt;\n","import { Box, Grid, Theme, Typography } from \"@material-ui/core\";\nimport { useTheme, withStyles } from \"@material-ui/styles\";\nimport React from \"react\";\nimport { ChordSong } from \"../../common/ChordModel/ChordSong\";\nimport UnstyledLastSavedAt from \"../display/LastSavedAt\";\nimport { ChordSongAction } from \"../reducer/reducer\";\nimport EditableTypography from \"./EditableTypography\";\n\nconst LastSavedAt = withStyles((theme: Theme) => ({\n    root: {\n        position: \"absolute\",\n        top: theme.spacing(2),\n        right: theme.spacing(2),\n    },\n}))(UnstyledLastSavedAt);\n\ninterface HeaderProps {\n    song: ChordSong;\n    songDispatch: React.Dispatch<ChordSongAction>;\n}\n\nconst Header: React.FC<HeaderProps> = (props: HeaderProps): JSX.Element => {\n    const theme: Theme = useTheme();\n\n    const updateTitleHandler = (newTitle: string) => {\n        props.songDispatch({ type: \"set-header\", title: newTitle });\n    };\n\n    const updateComposeHandler = (newComposer: string) => {\n        props.songDispatch({ type: \"set-header\", composedBy: newComposer });\n    };\n\n    const updatePerformerHandler = (newPerformer: string) => {\n        props.songDispatch({ type: \"set-header\", performedBy: newPerformer });\n    };\n\n    const title = (\n        <Box paddingBottom={theme.spacing(0.5)}>\n            <EditableTypography\n                value={props.song.title}\n                variant=\"h4\"\n                align=\"center\"\n                data-testid=\"SongTitle\"\n                placeholder=\"Song Title\"\n                onValueChange={updateTitleHandler}\n            />\n        </Box>\n    );\n\n    const lastSavedAt: React.ReactNode =\n        props.song.lastSavedAt === null ? null : (\n            <LastSavedAt lastSaved={props.song.lastSavedAt} />\n        );\n\n    const details = (\n        <Grid container justify=\"center\">\n            <Grid container item xs={6} justify=\"center\">\n                <Grid item>\n                    <Typography display=\"block\" variant=\"caption\">\n                        Composed by:{\" \"}\n                    </Typography>\n\n                    <EditableTypography\n                        value={props.song.composedBy}\n                        display=\"block\"\n                        variant=\"caption\"\n                        placeholder=\"Stock Aitken Waterman\"\n                        onValueChange={updateComposeHandler}\n                        data-testid=\"ComposedBy\"\n                    />\n                </Grid>\n            </Grid>\n            <Grid container item xs={6} justify=\"center\">\n                <Grid item>\n                    <Typography display=\"inline\" variant=\"caption\">\n                        Performed by:{\" \"}\n                    </Typography>\n\n                    <EditableTypography\n                        value={props.song.performedBy}\n                        variant=\"caption\"\n                        placeholder=\"Rick Astley\"\n                        onValueChange={updatePerformerHandler}\n                        data-testid=\"PerformedBy\"\n                    />\n                </Grid>\n            </Grid>\n        </Grid>\n    );\n\n    return (\n        <Box\n            paddingTop={theme.spacing(1)}\n            paddingLeft={theme.spacing(0.5)}\n            paddingRight={theme.spacing(0.5)}\n            data-testid=\"Header\"\n        >\n            {lastSavedAt}\n            {title}\n            {details}\n        </Box>\n    );\n};\n\nexport default React.memo(Header);\n","import { isLeft } from \"fp-ts/lib/Either\";\nimport { ProviderContext } from \"notistack\";\nimport { ChordSong } from \"../../../common/ChordModel/ChordSong\";\n\ntype EnqueueSnackbarType = ProviderContext[\"enqueueSnackbar\"];\n\nconst createFilePickerHandler = (\n    onLoad: (song: ChordSong) => void,\n    enqueueSnackbar: EnqueueSnackbarType\n) => {\n    return function (this: HTMLInputElement) {\n        const fileList = this.files;\n        if (fileList === null) {\n            return;\n        }\n\n        if (fileList.length > 1) {\n            enqueueSnackbar(\"Multiple files selected, only one file expected\", {\n                variant: \"error\",\n            });\n            return;\n        }\n\n        const file = fileList.item(0);\n        if (file === null) {\n            enqueueSnackbar(\"Could not retrieve file from file dialog\", {\n                variant: \"error\",\n            });\n            return;\n        }\n\n        const fileReader = new FileReader();\n        fileReader.onload = (ev: ProgressEvent<FileReader>) => {\n            if (\n                ev.target === null ||\n                ev.target.result === null ||\n                ev.target.result instanceof ArrayBuffer\n            ) {\n                return;\n            }\n\n            const results = ChordSong.deserialize(ev.target.result);\n            if (isLeft(results)) {\n                enqueueSnackbar(\n                    \"Can't load file, Song file failed validation\",\n                    {\n                        variant: \"error\",\n                    }\n                );\n                return;\n            }\n\n            onLoad(results.right);\n        };\n\n        fileReader.readAsText(file);\n    };\n};\n\nexport const useLoadMenuAction = (\n    onLoad: (song: ChordSong) => void,\n    enqueueSnackbar: EnqueueSnackbarType\n) => {\n    return () => {\n        const inputElem: HTMLInputElement = document.createElement(\"input\");\n        inputElem.type = \"file\";\n\n        const filePickerHandler = createFilePickerHandler(\n            onLoad,\n            enqueueSnackbar\n        );\n        inputElem.addEventListener(\"change\", filePickerHandler);\n\n        inputElem.click();\n    };\n};\n","import {\n    Button,\n    Dialog,\n    DialogActions,\n    DialogContent,\n    DialogTitle,\n    FormControl as UnstyledFormControl,\n    Grid,\n    InputLabel,\n    MenuItem,\n    Select as UnstyledSelect,\n    Theme,\n} from \"@material-ui/core\";\nimport { withStyles } from \"@material-ui/styles\";\nimport React, { useState } from \"react\";\nimport { ChordSong } from \"../../../common/ChordModel/ChordSong\";\nimport { AllNotes, Note } from \"../../../common/music/foundation/Note\";\nimport { PlainFn } from \"../../../common/PlainFn\";\nimport { ChordSongAction } from \"../../reducer/reducer\";\n\ninterface TransposeMenuProps {\n    open: boolean;\n    song: ChordSong;\n    songDispatch: React.Dispatch<ChordSongAction>;\n    onClose: PlainFn;\n}\n\nconst FormControl = withStyles((theme: Theme) => ({\n    root: {\n        margin: theme.spacing(2),\n        display: \"flex\",\n    },\n}))(UnstyledFormControl);\n\nconst Select = withStyles((theme: Theme) => ({\n    root: {\n        margin: theme.spacing(0.5),\n    },\n}))(UnstyledSelect);\n\ninterface KeySelection {\n    originalKey: Note;\n    transposedKey: Note;\n}\n\nconst TransposeMenu: React.FC<TransposeMenuProps> = (\n    props: TransposeMenuProps\n): JSX.Element => {\n    const [keySelection, setKeySelection] = useState<KeySelection>({\n        originalKey: \"C\",\n        transposedKey: \"C\",\n    });\n\n    const keySelectChangeHandler = (\n        changedField: \"originalKey\" | \"transposedKey\"\n    ): ((event: React.ChangeEvent<{ value: unknown }>) => void) => {\n        return (event: React.ChangeEvent<{ value: unknown }>) => {\n            const newSelectValue = event.target.value as Note;\n            const newKeySelection = { ...keySelection };\n            newKeySelection[changedField] = newSelectValue;\n            setKeySelection(newKeySelection);\n        };\n    };\n\n    const handleTransposeAction = (): void => {\n        props.songDispatch({\n            type: \"transpose\",\n            originalKey: keySelection.originalKey,\n            transposeKey: keySelection.transposedKey,\n        });\n\n        props.onClose();\n    };\n\n    const createKeySelect = (\n        id: string,\n        currentKey: Note,\n        changeHandler: (event: React.ChangeEvent<{ value: unknown }>) => void\n    ) => {\n        const menuItems: React.ReactElement[] = [];\n\n        for (const keyName in AllNotes) {\n            menuItems.push(<MenuItem value={keyName}>{keyName}</MenuItem>);\n        }\n\n        return (\n            <Select id={id} value={currentKey} onChange={changeHandler}>\n                {menuItems}\n            </Select>\n        );\n    };\n\n    return (\n        <Dialog open={props.open} onClose={props.onClose}>\n            <DialogTitle>Transpose Key</DialogTitle>\n            <DialogContent>\n                <Grid container direction=\"row\">\n                    <Grid item>\n                        <FormControl>\n                            <InputLabel htmlFor=\"original-key\">\n                                Original Key\n                            </InputLabel>\n                            {createKeySelect(\n                                \"original-key\",\n                                keySelection.originalKey,\n                                keySelectChangeHandler(\"originalKey\")\n                            )}\n                        </FormControl>\n                    </Grid>\n                    <Grid item>\n                        <FormControl>\n                            <InputLabel htmlFor=\"transposed-key\">\n                                Transposed Key\n                            </InputLabel>\n                            {createKeySelect(\n                                \"transposed-key\",\n                                keySelection.transposedKey,\n                                keySelectChangeHandler(\"transposedKey\")\n                            )}\n                        </FormControl>\n                    </Grid>\n                </Grid>\n            </DialogContent>\n            <DialogActions>\n                <Button onClick={props.onClose}>Cancel</Button>\n                <Button onClick={handleTransposeAction}>Transpose</Button>\n            </DialogActions>\n        </Dialog>\n    );\n};\n\nexport default TransposeMenu;\n","import { Theme } from \"@material-ui/core\";\nimport ForkIcon from \"@material-ui/icons/CallSplit\";\nimport CloudUploadIcon from \"@material-ui/icons/CloudUpload\";\nimport DeleteIcon from \"@material-ui/icons/Delete\";\nimport FolderOpenIcon from \"@material-ui/icons/FolderOpen\";\nimport TransposeIcon from \"@material-ui/icons/ImportExport\";\nimport MoreVertIcon from \"@material-ui/icons/MoreVert\";\nimport PlayIcon from \"@material-ui/icons/PlayArrow\";\nimport SaveIcon from \"@material-ui/icons/Save\";\nimport {\n    SpeedDial as UnstyledSpeedDial,\n    SpeedDialAction,\n} from \"@material-ui/lab\";\nimport { withStyles } from \"@material-ui/styles\";\nimport { useSnackbar } from \"notistack\";\nimport React, { useState } from \"react\";\nimport useKonamiCode from \"react-use-konami\";\nimport { ChordSong } from \"../../../common/ChordModel/ChordSong\";\nimport { PlainFn } from \"../../../common/PlainFn\";\nimport { ChordSongAction } from \"../../reducer/reducer\";\nimport { User, UserContext } from \"../../user/userContext\";\nimport { useCloudCreateSong, useCloudDeleteSongDialog } from \"./cloudSave\";\nimport { useLoadMenuAction } from \"./load\";\nimport { useSaveMenuAction } from \"./save\";\nimport TransposeMenu from \"./TransposeMenu\";\n\ninterface ChordPaperMenuProps {\n    song: ChordSong;\n    songDispatch: React.Dispatch<ChordSongAction>;\n    onPlay?: PlainFn;\n}\n\nconst SpeedDial = withStyles((theme: Theme) => ({\n    root: {\n        position: \"fixed\",\n        top: theme.spacing(3),\n        right: theme.spacing(2),\n    },\n}))(UnstyledSpeedDial);\n\nconst ChordPaperMenu: React.FC<ChordPaperMenuProps> = (\n    props: ChordPaperMenuProps\n): JSX.Element => {\n    const developmentEnv = process.env.NODE_ENV === \"development\";\n    const [open, setOpen] = useState(false);\n    const [transposeMenuOpen, setTransposeMenuOpen] = useState(false);\n    const [offlineMode, setOfflineMode] = useState(developmentEnv);\n    const { enqueueSnackbar } = useSnackbar();\n\n    const user = React.useContext(UserContext);\n\n    const setSong = (loadedSong: ChordSong) =>\n        props.songDispatch({ type: \"replace-song\", newSong: loadedSong });\n    const loadAction = useLoadMenuAction(setSong, enqueueSnackbar);\n    const saveAction = useSaveMenuAction(props.song);\n    const cloudSaveAction = useCloudCreateSong();\n    const [showDeleteDialog, deleteDialog] = useCloudDeleteSongDialog(\n        props.song,\n        user\n    );\n\n    const openMenu = () => {\n        setOpen(true);\n    };\n\n    const closeMenu = () => {\n        setOpen(false);\n    };\n\n    const forkSong = (song: ChordSong, user: User) => {\n        const songClone = song.fork();\n        cloudSaveAction(songClone, user);\n    };\n\n    useKonamiCode(() => {\n        setOfflineMode(true);\n        enqueueSnackbar(\"Local save and load buttons are enabled!\", {\n            variant: \"info\",\n        });\n    });\n\n    if (transposeMenuOpen) {\n        return (\n            <TransposeMenu\n                song={props.song}\n                songDispatch={props.songDispatch}\n                open\n                onClose={() => {\n                    setTransposeMenuOpen(false);\n                }}\n            ></TransposeMenu>\n        );\n    }\n\n    if (deleteDialog !== null) {\n        return deleteDialog;\n    }\n\n    return (\n        <SpeedDial\n            icon={<MoreVertIcon />}\n            open={open}\n            onOpen={openMenu}\n            onClose={closeMenu}\n            direction=\"down\"\n            ariaLabel=\"SpeedDial\"\n        >\n            <SpeedDialAction\n                icon={<PlayIcon />}\n                tooltipTitle=\"Play Mode\"\n                onClick={props.onPlay}\n            />\n\n            {!props.song.isUnsaved() && user !== null && (\n                <SpeedDialAction\n                    icon={<ForkIcon />}\n                    tooltipTitle=\"Fork\"\n                    onClick={() => forkSong(props.song, user)}\n                />\n            )}\n\n            {props.song.isUnsaved() && user !== null && (\n                <SpeedDialAction\n                    icon={<CloudUploadIcon />}\n                    tooltipTitle=\"Save to Cloud\"\n                    onClick={() => cloudSaveAction(props.song, user)}\n                />\n            )}\n\n            <SpeedDialAction\n                icon={<TransposeIcon />}\n                tooltipTitle=\"Transpose\"\n                onClick={() => {\n                    setTransposeMenuOpen(true);\n                }}\n            />\n\n            {offlineMode && (\n                <SpeedDialAction\n                    icon={<SaveIcon />}\n                    tooltipTitle=\"Save to computer\"\n                    onClick={saveAction}\n                />\n            )}\n\n            {offlineMode && (\n                <SpeedDialAction\n                    icon={<FolderOpenIcon />}\n                    tooltipTitle=\"Load from computer\"\n                    onClick={loadAction}\n                />\n            )}\n\n            {!props.song.isUnsaved() && user !== null && (\n                <SpeedDialAction\n                    icon={<DeleteIcon />}\n                    tooltipTitle=\"Delete Song\"\n                    onClick={showDeleteDialog}\n                />\n            )}\n        </SpeedDial>\n    );\n};\n\nexport default ChordPaperMenu;\n","import { ChordSong } from \"../../../common/ChordModel/ChordSong\";\nexport const useSaveMenuAction = (song: ChordSong) => {\n    return () => {\n        const jsonStr = JSON.stringify(song.fork());\n\n        const blob = new Blob([jsonStr], {\n            type: \"application/json\",\n        });\n        const objectURL = URL.createObjectURL(blob);\n\n        const anchor = document.createElement(\"a\");\n\n        anchor.download = \"chord_paper_song.json\";\n        if (song.title !== \"\") {\n            anchor.download = song.title + \".json\";\n        }\n        anchor.href = objectURL;\n        anchor.click();\n\n        URL.revokeObjectURL(objectURL);\n    };\n};\n","import {\n    Button,\n    Dialog,\n    DialogActions,\n    DialogContent,\n    DialogTitle,\n    Typography,\n} from \"@material-ui/core\";\nimport { isLeft } from \"fp-ts/lib/These\";\nimport { useSnackbar } from \"notistack\";\nimport React, { useState } from \"react\";\nimport { useHistory } from \"react-router-dom\";\nimport { useErrorMessage } from \"../../../common/backend/errors\";\nimport { createSong, deleteSong } from \"../../../common/backend/requests\";\nimport { ChordSong } from \"../../../common/ChordModel/ChordSong\";\nimport { newSongPath, songPath } from \"../../../common/paths\";\nimport { noopFn, PlainFn } from \"../../../common/PlainFn\";\nimport { User } from \"../../user/userContext\";\n\nexport const useCloudCreateSong = () => {\n    const { enqueueSnackbar } = useSnackbar();\n    const showError = useErrorMessage();\n    const history = useHistory();\n\n    const createNewSong = async (song: ChordSong, user: User) => {\n        const ownedSong = song.set(\"owner\", user.userID);\n\n        const createResult = await createSong(ownedSong, user.authToken);\n\n        if (isLeft(createResult)) {\n            await showError(createResult.left);\n            return;\n        }\n\n        let deserializeResult = ChordSong.fromJSONObject(createResult.right);\n\n        if (isLeft(deserializeResult)) {\n            console.error(\"Backend response does not match song format\");\n            console.log(createResult.right);\n            enqueueSnackbar(\n                \"A failure happened. Check console for more error details\",\n                { variant: \"error\" }\n            );\n            return;\n        }\n\n        const deserializedSong = deserializeResult.right;\n        history.push(\n            songPath.withID(deserializedSong.id).withMode(\"edit\").URL()\n        );\n    };\n\n    return async (song: ChordSong, user: User) => {\n        if (song.isUnsaved()) {\n            await createNewSong(song, user);\n        }\n    };\n};\n\nexport const useCloudDeleteSongDialog = (\n    song: ChordSong,\n    user: User | null\n): [PlainFn, React.ReactElement | null] => {\n    const { enqueueSnackbar } = useSnackbar();\n    const showError = useErrorMessage();\n    const history = useHistory();\n    const [shouldShowDialog, setShouldShowDialog] = useState(false);\n\n    const showDialog = () => setShouldShowDialog(true);\n\n    if (!shouldShowDialog) {\n        return [showDialog, null];\n    }\n\n    if (user === null) {\n        return [noopFn, null];\n    }\n\n    if (user === null) {\n        return [noopFn, null];\n    }\n\n    const closeDialog = () => setShouldShowDialog(false);\n\n    const deleteAction = async () => {\n        if (song.isUnsaved()) {\n            return;\n        }\n\n        const deleteResult = await deleteSong(song, user.authToken);\n\n        if (isLeft(deleteResult)) {\n            await showError(deleteResult.left);\n            return;\n        }\n\n        enqueueSnackbar(\"Song has been successfully deleted\", {\n            variant: \"success\",\n        });\n        history.push(newSongPath.URL());\n    };\n\n    const deleteDialog = (\n        <Dialog open onClose={closeDialog}>\n            <DialogTitle>Delete Song</DialogTitle>\n            <DialogContent>\n                <Typography>\n                    This will delete the song and cannot be undone. Are you\n                    sure?\n                </Typography>\n            </DialogContent>\n            <DialogActions>\n                <Button onClick={closeDialog}>Cancel</Button>\n                <Button onClick={deleteAction}>Delete</Button>\n            </DialogActions>\n        </Dialog>\n    );\n\n    return [noopFn, deleteDialog];\n};\n","import { Paper, Theme, withStyles } from \"@material-ui/core\";\nimport { makeStyles } from \"@material-ui/styles\";\nimport React from \"react\";\nimport { Helmet } from \"react-helmet-async\";\nimport { ChordSong } from \"../../common/ChordModel/ChordSong\";\nimport { PlainFn } from \"../../common/PlainFn\";\nimport PlayerTimeProvider from \"../PlayerTimeContext\";\nimport { ChordSongAction } from \"../reducer/reducer\";\nimport JamStation from \"../track_player/JamStation\";\nimport TrackListProvider, {\n    TrackListChangeHandler,\n    TrackListLoad,\n} from \"../track_player/providers/TrackListProvider\";\nimport ChordPaperBody from \"./ChordPaperBody\";\nimport Header from \"./Header\";\nimport ChordPaperMenu from \"./menu/ChordPaperMenu\";\n\nconst RootPaper = withStyles((theme: Theme) => ({\n    root: {\n        position: \"relative\",\n        margin: theme.spacing(5),\n        minHeight: theme.spacing(92),\n        minWidth: theme.spacing(92),\n    },\n}))(Paper);\n\nconst useWhiteStyle = makeStyles({\n    root: {\n        backgroundColor: \"white\",\n    },\n});\n\ninterface ChordPaperProps {\n    song: ChordSong;\n    songDispatch: React.Dispatch<ChordSongAction>;\n    onPlay?: PlainFn;\n}\n\nconst ChordPaper: React.FC<ChordPaperProps> = (\n    props: ChordPaperProps\n): JSX.Element => {\n    const whiteStyle = useWhiteStyle();\n\n    const trackPlayer: React.ReactNode = (() => {\n        if (props.song.isUnsaved()) {\n            return null;\n        }\n\n        return (\n            <TrackListProvider song={props.song}>\n                {(\n                    tracklistLoad: TrackListLoad,\n                    onRefresh: PlainFn,\n                    changeHandler: TrackListChangeHandler\n                ) => (\n                    <JamStation\n                        collapsedButtonClassName={whiteStyle.root}\n                        timeSections={props.song.timeSections}\n                        tracklistLoad={tracklistLoad}\n                        onTrackListChanged={changeHandler}\n                        onRefresh={onRefresh}\n                    />\n                )}\n            </TrackListProvider>\n        );\n    })();\n\n    return (\n        <PlayerTimeProvider>\n            <Helmet>\n                <title>\n                    {props.song.metadata.title !== \"\"\n                        ? props.song.metadata.title\n                        : \"New Song\"}\n                </title>\n            </Helmet>\n            <RootPaper elevation={3} data-testid=\"ChordPaper\">\n                <Header\n                    data-testid={\"Header\"}\n                    song={props.song}\n                    songDispatch={props.songDispatch}\n                />\n                <ChordPaperBody\n                    song={props.song}\n                    songDispatch={props.songDispatch}\n                />\n                <ChordPaperMenu\n                    song={props.song}\n                    songDispatch={props.songDispatch}\n                    onPlay={props.onPlay}\n                />\n                {trackPlayer}\n            </RootPaper>\n        </PlayerTimeProvider>\n    );\n};\n\nexport default ChordPaper;\n","const scrollBackwardsKeys: string[] = [\n    \"ArrowUp\",\n    \"ArrowLeft\",\n    \"Backspace\",\n    \"ShiftLeft\",\n];\n\nexport const isScrollBackwardsKey = (code: string): boolean => {\n    for (let backwardsKey of scrollBackwardsKeys) {\n        if (backwardsKey === code) {\n            return true;\n        }\n    }\n\n    return false;\n};\n\nexport const scrollForwardKeys: string[] = [\n    \"KeyA\",\n    \"KeyB\",\n    \"KeyC\",\n    \"KeyD\",\n    \"KeyE\",\n    \"KeyF\",\n    \"KeyG\",\n    \"KeyH\",\n    \"KeyI\",\n    \"KeyJ\",\n    \"KeyK\",\n    \"KeyL\",\n    \"KeyM\",\n    \"KeyN\",\n    \"KeyO\",\n    \"KeyP\",\n    \"KeyQ\",\n    \"KeyR\",\n    \"KeyS\",\n    \"KeyT\",\n    \"KeyU\",\n    \"KeyV\",\n    \"KeyW\",\n    \"KeyX\",\n    \"KeyY\",\n    \"KeyZ\",\n    \"Digit1\",\n    \"Digit2\",\n    \"Digit3\",\n    \"Digit4\",\n    \"Digit5\",\n    \"Digit6\",\n    \"Digit7\",\n    \"Digit8\",\n    \"Digit9\",\n    \"Digit0\",\n    \"Space\",\n    \"Enter\",\n    \"ArrowDown\",\n    \"ArrowRight\",\n    \"Comma\",\n    \"Period\",\n    \"Slash\",\n    \"Backslash\",\n    \"Semicolon\",\n    \"Quote\",\n    \"Backquote\",\n    \"Tab\",\n    \"ShiftRight\",\n    \"Equal\",\n    \"BracketLeft\",\n    \"BracketRight\",\n];\n\nexport const isScrollForwardsKey = (code: string): boolean => {\n    for (let forwardsKey of scrollForwardKeys) {\n        if (forwardsKey === code) {\n            return true;\n        }\n    }\n\n    return false;\n};\n","import { Box, Grid } from \"@material-ui/core\";\nimport React from \"react\";\nimport { ChordBlock } from \"../../common/ChordModel/ChordBlock\";\nimport ChordSymbol from \"../display/ChordSymbol\";\nimport LyricTypography from \"../display/Lyric\";\n\ninterface PlayBlockProps {\n    block: ChordBlock;\n}\n\nconst PlayBlock: React.FC<PlayBlockProps> = (\n    props: PlayBlockProps\n): JSX.Element => {\n    return (\n        <Box display=\"inline-block\">\n            <Grid container direction=\"column\" component=\"span\">\n                <Grid item>\n                    <ChordSymbol>{props.block.chord}</ChordSymbol>\n                </Grid>\n                <Grid item>\n                    <LyricTypography data-testid=\"lyric\">\n                        {props.block.lyric}\n                    </LyricTypography>\n                </Grid>\n            </Grid>\n        </Box>\n    );\n};\n\nexport default PlayBlock;\n","import { Box, Typography, Theme } from \"@material-ui/core\";\nimport React from \"react\";\nimport { ChordBlock } from \"../../common/ChordModel/ChordBlock\";\nimport { ChordLine } from \"../../common/ChordModel/ChordLine\";\nimport PlayBlock from \"./PlayBlock\";\nimport { withStyles } from \"@material-ui/styles\";\nimport {\n    sectionLabelStyle,\n    sectionTypographyVariant,\n} from \"../display/SectionLabel\";\n\nconst LabelTypography = withStyles(sectionLabelStyle)(Typography);\nconst TopMarginBox = withStyles((theme: Theme) => ({\n    root: {\n        marginTop: theme.spacing(1),\n    },\n}))(Box);\n\ninterface PlayLineProps {\n    chordLine: ChordLine;\n}\n\nconst PlayLine: React.FC<PlayLineProps> = (\n    props: PlayLineProps\n): JSX.Element => {\n    let lineComponent: React.ReactElement = (\n        <Box>\n            {props.chordLine.chordBlocks.list.map((block: ChordBlock) => (\n                <PlayBlock block={block} key={block.id}></PlayBlock>\n            ))}\n        </Box>\n    );\n\n    const label = props.chordLine.section?.name;\n    if (label !== undefined && label !== \"\") {\n        const labelElement = (\n            <TopMarginBox>\n                <LabelTypography variant={sectionTypographyVariant}>\n                    {label}\n                </LabelTypography>\n            </TopMarginBox>\n        );\n\n        lineComponent = (\n            <Box>\n                {labelElement}\n                {lineComponent}\n            </Box>\n        );\n    }\n\n    return lineComponent;\n};\n\nexport default PlayLine;\n","import { Box, Paper, RootRef } from \"@material-ui/core\";\nimport grey from \"@material-ui/core/colors/grey\";\nimport { withStyles } from \"@material-ui/styles\";\nimport { useWindowWidth } from \"@react-hook/window-size\";\nimport React, { useCallback, useEffect, useState } from \"react\";\nimport { ChordLine } from \"../../common/ChordModel/ChordLine\";\nimport { ChordSong } from \"../../common/ChordModel/ChordSong\";\nimport { useRegisterKeyListener } from \"../GlobalKeyListener\";\nimport { isScrollBackwardsKey, isScrollForwardsKey } from \"./keyMap\";\nimport PlayLine from \"./PlayLine\";\n\nexport interface DisplaySettings {\n    numberOfColumnsPerPage: number;\n    fontSize: number;\n    columnMargin: number;\n    scrollType: \"page\" | \"column\";\n}\n\ninterface PlayContentProps {\n    song: ChordSong;\n    displaySettings: DisplaySettings;\n}\n\nconst PlayContent: React.FC<PlayContentProps> = (\n    props: PlayContentProps\n): JSX.Element => {\n    const ref = React.useRef<HTMLElement>();\n    const [numberOfEmptyColumns, setNumberOfEmptyColumns] = useState<number>(0);\n    const [addKeyListener, removeKeyListener] = useRegisterKeyListener();\n\n    const numberOfColumnsPerPage =\n        props.displaySettings.numberOfColumnsPerPage >= 1\n            ? props.displaySettings.numberOfColumnsPerPage\n            : 1;\n    const columnMargin =\n        props.displaySettings.columnMargin >= 0\n            ? props.displaySettings.columnMargin\n            : 0;\n\n    const windowWidth = useWindowWidth();\n    const columnWidth = windowWidth / numberOfColumnsPerPage;\n    const snapThreshold = columnWidth / 2;\n\n    const scrollPage = useCallback(\n        (forward: boolean) => {\n            const currentPos = window.scrollX;\n            const delta: number = (() => {\n                const scrollDelta =\n                    props.displaySettings.scrollType === \"column\"\n                        ? columnWidth\n                        : windowWidth;\n                return forward ? scrollDelta : -scrollDelta;\n            })();\n\n            let nextPos = currentPos + delta;\n\n            const distanceFromLastColumn = nextPos % columnWidth;\n\n            if (distanceFromLastColumn < snapThreshold) {\n                nextPos -= distanceFromLastColumn;\n            } else {\n                const remainingDistance = columnWidth - distanceFromLastColumn;\n                nextPos += remainingDistance;\n            }\n\n            window.scrollTo({\n                left: nextPos,\n                top: 0,\n                behavior: \"smooth\",\n            });\n        },\n        [\n            columnWidth,\n            windowWidth,\n            snapThreshold,\n            props.displaySettings.scrollType,\n        ]\n    );\n\n    const scrollForward = useCallback(() => scrollPage(true), [scrollPage]);\n    const scrollBackward = useCallback(() => scrollPage(false), [scrollPage]);\n\n    const handleClick = (\n        event: React.MouseEvent<HTMLDivElement, MouseEvent>\n    ) => {\n        const handlers: ((\n            event: React.MouseEvent<HTMLDivElement, MouseEvent>\n        ) => boolean)[] = [handleLeftClick, handleRightClick];\n\n        for (const handler of handlers) {\n            const handled: boolean = handler(event);\n            if (handled) {\n                event.preventDefault();\n                return;\n            }\n        }\n    };\n\n    const handleLeftClick = (\n        event: React.MouseEvent<HTMLDivElement, MouseEvent>\n    ): boolean => {\n        // left click\n        if (event.button !== 0) {\n            return false;\n        }\n\n        scrollForward();\n\n        // returning false not prevent default\n        // preventing default would prevent clicking back into the main body to get focus\n        return false;\n    };\n\n    const handleRightClick = (\n        event: React.MouseEvent<HTMLDivElement, MouseEvent>\n    ): boolean => {\n        // right click\n        if (event.button !== 2) {\n            return false;\n        }\n\n        scrollBackward();\n        return true;\n    };\n\n    // sorry, preventing context menu from showing up to make the right mouse click\n    // experience less annoying\n    const cancelContextMenu = (\n        event: React.MouseEvent<HTMLDivElement, MouseEvent>\n    ) => {\n        event.preventDefault();\n    };\n\n    const ColumnedPaper = withStyles({\n        root: {\n            columnGap: \"0px\",\n            columnRuleWidth: \"2px\",\n            columnRuleStyle: \"solid\",\n            columnRuleColor: grey[300],\n            columns: numberOfColumnsPerPage,\n            height: \"100vh\",\n            width: \"100%\",\n        },\n    })(Paper);\n\n    // removing scrollbars on Windows\n    // play mode causes scrollbars on Windows\n    // this is sort of a workaround until we can find a better CSS solution\n    useEffect(() => {\n        const getScrollBarWidth = (): unknown => {\n            return (document.documentElement.style as any).scrollbarWidth;\n        };\n\n        const setScrollBarWidth = (scrollbarWidth: unknown) => {\n            (document.documentElement.style as any).scrollbarWidth =\n                scrollbarWidth;\n        };\n\n        const prevScrollbarWidthValue = getScrollBarWidth();\n        setScrollBarWidth(\"none\");\n\n        return () => setScrollBarWidth(prevScrollbarWidthValue);\n    }, []);\n\n    // using margins instead of column-gap, CSS columns force the rightmost column\n    // up against the edge of the viewport and doesn't strictly respect column width\n    //\n    // making 0 gap columns with margins makes the math a lot simpler for each column\n    const MarginBox = withStyles({\n        root: {\n            marginLeft: `${columnMargin}px`,\n            marginRight: `${columnMargin}px`,\n        },\n    })(Box);\n\n    const lines = props.song.chordLines.list.map((chordLine: ChordLine) => {\n        return <PlayLine chordLine={chordLine} key={chordLine.id} />;\n    });\n\n    const FullHeightBox = withStyles({\n        root: {\n            height: \"100vh\",\n            pageBreakInside: \"avoid\",\n        },\n    })(Box);\n\n    const emptyColumns: React.ReactElement[] = (() => {\n        if (numberOfEmptyColumns === null) {\n            return [];\n        }\n\n        const cols: React.ReactElement[] = [];\n\n        for (let i = 0; i < numberOfEmptyColumns; i++) {\n            cols.push(\n                <FullHeightBox key={`empty-column-${i}`}>\n                    <div />\n                </FullHeightBox>\n            );\n        }\n\n        return cols;\n    })();\n\n    useEffect(() => {\n        ref.current?.focus();\n    });\n\n    useEffect(() => {\n        const handleKey = (event: KeyboardEvent) => {\n            if (isScrollBackwardsKey(event.code)) {\n                scrollBackward();\n                event.preventDefault();\n                return;\n            }\n\n            if (isScrollForwardsKey(event.code)) {\n                scrollForward();\n                event.preventDefault();\n                return;\n            }\n        };\n\n        addKeyListener(handleKey);\n\n        return () => removeKeyListener(handleKey);\n    }, [scrollBackward, scrollForward, addKeyListener, removeKeyListener]);\n\n    useEffect(() => {\n        // add some empty columns to the end of the song\n        // so that each \"page scroll\" navigation ends evenly\n        // e.g. if a 3 column page is divided as 5 columns: a | b | c | d | e\n        // then the user will see\n        // page 1: a | b | c\n        // page 2: c | d | e\n        // this will add a div to the end so that it will look like\n        // page 1: a | b | c\n        // page 2: d | e | [empty]\n\n        const numberOfRenderedColumns = Math.round(\n            document.body.scrollWidth / columnWidth\n        );\n\n        const numberOfColumnsInLastPage: number =\n            numberOfRenderedColumns % numberOfColumnsPerPage;\n\n        if (numberOfColumnsInLastPage !== 0) {\n            let nextNumberOfEmptyColumns =\n                numberOfColumnsPerPage -\n                numberOfColumnsInLastPage +\n                numberOfEmptyColumns;\n\n            nextNumberOfEmptyColumns =\n                nextNumberOfEmptyColumns % numberOfColumnsPerPage;\n\n            setNumberOfEmptyColumns(nextNumberOfEmptyColumns);\n        }\n    }, [\n        numberOfColumnsPerPage,\n        columnWidth,\n        numberOfEmptyColumns,\n        setNumberOfEmptyColumns,\n        props,\n    ]);\n\n    return (\n        <RootRef rootRef={ref}>\n            <ColumnedPaper\n                onMouseDown={handleClick}\n                onContextMenu={cancelContextMenu}\n            >\n                <MarginBox>{lines}</MarginBox>\n                {emptyColumns}\n            </ColumnedPaper>\n        </RootRef>\n    );\n};\n\nexport default PlayContent;\n","import {\n    Box as UnstyledBox,\n    Button,\n    Dialog,\n    DialogActions,\n    DialogContent,\n    DialogTitle,\n    FormControl,\n    FormControlLabel,\n    FormLabel as UnstyledFormLabel,\n    InputAdornment,\n    Radio,\n    RadioGroup,\n    TextField,\n    TextFieldProps as TextFieldPropsWithVariant,\n    Theme,\n    Typography,\n} from \"@material-ui/core\";\nimport { withStyles } from \"@material-ui/styles\";\nimport { Either, isLeft, left, right } from \"fp-ts/lib/Either\";\nimport React, { ChangeEvent, useState } from \"react\";\nimport { PlainFn } from \"../../common/PlainFn\";\nimport { isWhitespace } from \"../../common/Whitespace\";\nimport { DisplaySettings } from \"./PlayContent\";\n\nconst Box = withStyles((theme: Theme) => ({\n    root: {\n        margin: theme.spacing(1),\n    },\n}))(UnstyledBox);\n\nconst FormLabel = withStyles((theme: Theme) => ({\n    root: {\n        fontSize: \"0.75rem\",\n    },\n}))(UnstyledFormLabel);\n\nconst RadioLabelTypography = withStyles((theme: Theme) => ({\n    root: {\n        fontSize: \"0.75rem\",\n    },\n}))(Typography);\n\ntype TextFieldProps = Omit<Partial<TextFieldPropsWithVariant>, \"variant\">;\n\ninterface DialogInput {\n    numberOfColumns: string;\n    fontSize: string;\n    columnMargin: string;\n    scrollType: DisplaySettings[\"scrollType\"];\n}\n\ntype TextInputFieldKeys = keyof Omit<DialogInput, \"scrollType\">;\n\ninterface InputFieldSpecification {\n    label: string;\n    field: TextInputFieldKeys;\n    adornment: string | null;\n    validationErrorPropsFn: (strValue: string) => Either<Error, number>;\n}\n\ninterface DisplaySettingsDialogProps {\n    open: boolean;\n    onClose?: PlainFn;\n    defaultSettings: DisplaySettings;\n    onSubmit?: (displaySettings: DisplaySettings) => void;\n}\n\nconst DisplaySettingsDialog: React.FC<DisplaySettingsDialogProps> = (\n    props: DisplaySettingsDialogProps\n): JSX.Element => {\n    const [settings, setSettings] = useState<DialogInput>({\n        numberOfColumns: props.defaultSettings.numberOfColumnsPerPage.toString(),\n        fontSize: props.defaultSettings.fontSize.toString(),\n        columnMargin: props.defaultSettings.columnMargin.toString(),\n        scrollType: props.defaultSettings.scrollType,\n    });\n\n    const validateNumber = (strValue: string): Either<Error, number> => {\n        if (strValue === \"\" || isWhitespace(strValue)) {\n            return left(new Error(\"A value is required\"));\n        }\n\n        const convertedNumber = Number(strValue);\n        if (isNaN(convertedNumber)) {\n            return left(new Error(\"Only numbers are allowed\"));\n        }\n\n        if (convertedNumber <= 0) {\n            return left(new Error(\"Only positive numbers are allowed\"));\n        }\n\n        return right(convertedNumber);\n    };\n\n    const validateInt = (strValue: string): Either<Error, number> => {\n        const result = validateNumber(strValue);\n\n        if (isLeft(result)) {\n            return result;\n        }\n\n        const convertedNumber = result.right;\n\n        const convertedInteger = Math.floor(convertedNumber);\n        if (convertedNumber !== convertedInteger) {\n            return left(new Error(\"Only integers are allowed\"));\n        }\n\n        return right(convertedInteger);\n    };\n\n    const validatedSettings = (): Either<Error, DisplaySettings> => {\n        const numberOfColumnsResults = validateInt(settings.numberOfColumns);\n        const fontSizeResults = validateNumber(settings.fontSize);\n        const columnMarginResults = validateNumber(settings.columnMargin);\n\n        if (isLeft(numberOfColumnsResults)) {\n            return numberOfColumnsResults;\n        }\n\n        if (isLeft(fontSizeResults)) {\n            return fontSizeResults;\n        }\n\n        if (isLeft(columnMarginResults)) {\n            return columnMarginResults;\n        }\n\n        const displaySettings: DisplaySettings = {\n            numberOfColumnsPerPage: numberOfColumnsResults.right,\n            fontSize: fontSizeResults.right,\n            columnMargin: columnMarginResults.right,\n            scrollType: settings.scrollType,\n        };\n\n        return right(displaySettings);\n    };\n\n    const hasValidationErrors = (): boolean => {\n        return isLeft(validatedSettings());\n    };\n\n    const handleSubmit = () => {\n        const settings = validatedSettings();\n\n        if (isLeft(settings)) {\n            return;\n        }\n\n        props.onSubmit?.({\n            numberOfColumnsPerPage: settings.right.numberOfColumnsPerPage,\n            fontSize: settings.right.fontSize,\n            columnMargin: settings.right.columnMargin,\n            scrollType: settings.right.scrollType,\n        });\n    };\n\n    const textSettingChangeHandler = (field: TextInputFieldKeys) => {\n        return (event: ChangeEvent<HTMLInputElement | HTMLTextAreaElement>) => {\n            const newValue = event.target.value;\n            const newSettings: DialogInput = { ...settings };\n            newSettings[field] = newValue;\n            setSettings(newSettings);\n        };\n    };\n\n    const validationErrorProps = (\n        result: Either<Error, number>\n    ): TextFieldProps => {\n        return {\n            error: isLeft(result) ? true : undefined,\n            helperText: isLeft(result) ? result.left.message : undefined,\n        };\n    };\n\n    const inputSpecs: InputFieldSpecification[] = [\n        {\n            label: \"number of columns\",\n            field: \"numberOfColumns\",\n            adornment: null,\n            validationErrorPropsFn: (val: string) => validateInt(val),\n        },\n        {\n            label: \"font size\",\n            field: \"fontSize\",\n            adornment: \"px\",\n            validationErrorPropsFn: (val: string) => validateNumber(val),\n        },\n        {\n            label: \"column margin\",\n            field: \"columnMargin\",\n            adornment: \"px\",\n            validationErrorPropsFn: (val: string) => validateNumber(val),\n        },\n    ];\n\n    const makeInput = (spec: InputFieldSpecification) => {\n        const textFieldProps: TextFieldProps = {\n            label: spec.label,\n            defaultValue: settings[spec.field],\n            onChange: textSettingChangeHandler(spec.field),\n            ...validationErrorProps(\n                spec.validationErrorPropsFn(settings[spec.field])\n            ),\n        };\n\n        if (spec.adornment !== null) {\n            textFieldProps.InputProps = {\n                endAdornment: (\n                    <InputAdornment position=\"end\">\n                        {spec.adornment}\n                    </InputAdornment>\n                ),\n            };\n        }\n\n        return (\n            <Box>\n                <TextField {...textFieldProps} />\n            </Box>\n        );\n    };\n\n    const scrollTypeToggle = (() => {\n        const handleScrollTypeChange = (\n            _event: React.ChangeEvent<HTMLInputElement>,\n            value: string\n        ) => {\n            if (value !== \"page\" && value !== \"column\") {\n                console.error(\n                    \"Display dialog - scroll type: Received an invalid radio value\"\n                );\n                return;\n            }\n\n            setSettings({\n                ...settings,\n                scrollType: value,\n            });\n        };\n\n        return (\n            <Box>\n                <FormControl component=\"fieldset\">\n                    <FormLabel>scroll type</FormLabel>\n                    <RadioGroup\n                        value={settings.scrollType}\n                        onChange={handleScrollTypeChange}\n                    >\n                        <FormControlLabel\n                            value=\"column\"\n                            control={<Radio size=\"small\" />}\n                            label={\n                                <RadioLabelTypography>\n                                    scroll by column\n                                </RadioLabelTypography>\n                            }\n                        />\n                        <FormControlLabel\n                            value=\"page\"\n                            control={<Radio size=\"small\" />}\n                            label={\n                                <RadioLabelTypography>\n                                    scroll by page\n                                </RadioLabelTypography>\n                            }\n                        />\n                    </RadioGroup>\n                </FormControl>\n            </Box>\n        );\n    })();\n\n    return (\n        <Dialog open={props.open} onClose={props.onClose}>\n            <DialogTitle>Display Settings</DialogTitle>\n            <DialogContent>\n                {scrollTypeToggle}\n\n                {inputSpecs.map((spec: InputFieldSpecification) =>\n                    makeInput(spec)\n                )}\n            </DialogContent>\n            <DialogActions>\n                <Button onClick={props.onClose}>Cancel</Button>\n                <Button disabled={hasValidationErrors()} onClick={handleSubmit}>\n                    OK\n                </Button>\n            </DialogActions>\n        </Dialog>\n    );\n};\n\nexport default DisplaySettingsDialog;\n","import { Theme } from \"@material-ui/core\";\nimport grey from \"@material-ui/core/colors/grey\";\nimport ExitToAppIcon from \"@material-ui/icons/ExitToApp\";\nimport UnstyledMoreVertIcon from \"@material-ui/icons/MoreVert\";\nimport TuneIcon from \"@material-ui/icons/Tune\";\nimport {\n    SpeedDial as UnstyledSpeedDial,\n    SpeedDialAction,\n} from \"@material-ui/lab\";\nimport { withStyles } from \"@material-ui/styles\";\nimport React, { useState } from \"react\";\nimport { PlainFn } from \"../../common/PlainFn\";\nimport DisplaySettingsDialog from \"./DisplaySettingsDialog\";\nimport { DisplaySettings } from \"./PlayContent\";\n\ninterface PlayMenuProps {\n    displaySettings: DisplaySettings;\n    onDisplaySettingsChange?: (displaySettings: DisplaySettings) => void;\n\n    onExit?: PlainFn;\n}\n\nconst MenuIcon = withStyles({\n    root: {\n        backgroundColor: \"transparent\",\n    },\n})(UnstyledMoreVertIcon);\n\nconst SpeedDial = withStyles((theme: Theme) => ({\n    root: {\n        position: \"fixed\",\n        top: theme.spacing(3),\n        right: theme.spacing(2),\n        \"& .MuiSpeedDial-fab\": {\n            backgroundColor: \"transparent\",\n            color: grey[500],\n        },\n    },\n}))(UnstyledSpeedDial);\n\nconst PlayMenu: React.FC<PlayMenuProps> = (\n    props: PlayMenuProps\n): JSX.Element => {\n    const [open, setOpen] = useState(false);\n    const [displaySettingsOpen, setDisplaySettingsOpen] = useState(false);\n\n    const openMenu = () => {\n        setOpen(true);\n    };\n\n    const closeMenu = () => {\n        setOpen(false);\n    };\n\n    const handleExit = (\n        event: React.MouseEvent<HTMLDivElement, MouseEvent>\n    ) => {\n        props.onExit?.();\n        event.stopPropagation();\n    };\n\n    // returning this instead of shoving it in the same fragment because\n    // returning speed dial in a fragment somehow causes some layout changes\n    if (displaySettingsOpen) {\n        const handleDisplaySettingsChange = (settings: DisplaySettings) => {\n            props.onDisplaySettingsChange?.(settings);\n            setDisplaySettingsOpen(false);\n        };\n\n        return (\n            <DisplaySettingsDialog\n                open\n                onClose={() => setDisplaySettingsOpen(false)}\n                defaultSettings={props.displaySettings}\n                onSubmit={handleDisplaySettingsChange}\n            />\n        );\n    }\n\n    return (\n        <SpeedDial\n            icon={<MenuIcon />}\n            direction=\"down\"\n            open={open}\n            onOpen={openMenu}\n            onClose={closeMenu}\n            ariaLabel=\"SpeedDial\"\n            FabProps={{\n                color: \"inherit\",\n            }}\n        >\n            <SpeedDialAction\n                icon={<TuneIcon />}\n                tooltipTitle=\"Display Settings\"\n                onMouseDownCapture={() => setDisplaySettingsOpen(true)}\n            />\n            <SpeedDialAction\n                icon={<ExitToAppIcon />}\n                tooltipTitle=\"Exit Play Mode\"\n                onMouseDownCapture={handleExit}\n            />\n        </SpeedDial>\n    );\n};\n\nexport default PlayMenu;\n","import { createMuiTheme, Theme, ThemeProvider } from \"@material-ui/core\";\nimport { makeStyles } from \"@material-ui/styles\";\nimport React, { useState } from \"react\";\nimport { Helmet } from \"react-helmet-async\";\nimport { ChordSong } from \"../../common/ChordModel/ChordSong\";\nimport { PlainFn } from \"../../common/PlainFn\";\nimport JamStation from \"../track_player/JamStation\";\nimport TrackListProvider, {\n    TrackListChangeHandler,\n    TrackListLoad,\n} from \"../track_player/providers/TrackListProvider\";\nimport PlayContent, { DisplaySettings } from \"./PlayContent\";\nimport PlayMenu from \"./PlayMenu\";\n\nconst useTransparentStyle = makeStyles({\n    root: {\n        backgroundColor: \"transparent\",\n    },\n});\n\ninterface PlayProps {\n    song: ChordSong;\n    onEdit?: PlainFn;\n}\n\nconst Play: React.FC<PlayProps> = (props: PlayProps): JSX.Element => {\n    const [displaySettings, setDisplaySettings] = useState<DisplaySettings>({\n        numberOfColumnsPerPage: 2,\n        fontSize: 14,\n        columnMargin: 20,\n        scrollType: \"column\",\n    });\n\n    const transparentStyle = useTransparentStyle();\n\n    const playTheme = (theme: Theme): Theme => {\n        return createMuiTheme({\n            ...theme,\n            typography: {\n                fontFamily: theme.typography.fontFamily,\n                fontWeightRegular: theme.typography.fontWeightRegular,\n                fontSize: displaySettings.fontSize,\n            },\n        });\n    };\n\n    const trackPlayer: React.ReactNode = (() => {\n        if (props.song.isUnsaved()) {\n            return null;\n        }\n\n        return (\n            <TrackListProvider song={props.song}>\n                {(\n                    tracklistLoad: TrackListLoad,\n                    onRefresh: PlainFn,\n                    onChange: TrackListChangeHandler\n                ) => (\n                    <JamStation\n                        collapsedButtonClassName={transparentStyle.root}\n                        timeSections={props.song.timeSections}\n                        tracklistLoad={tracklistLoad}\n                        onTrackListChanged={onChange}\n                        onRefresh={onRefresh}\n                    />\n                )}\n            </TrackListProvider>\n        );\n    })();\n\n    return (\n        <>\n            <Helmet>\n                <title>\n                    {props.song.metadata.title !== \"\"\n                        ? props.song.metadata.title\n                        : \"New Song\"}\n                </title>\n            </Helmet>\n            <PlayMenu\n                displaySettings={displaySettings}\n                onDisplaySettingsChange={setDisplaySettings}\n                onExit={props.onEdit}\n            />\n            <ThemeProvider theme={playTheme}>\n                <PlayContent\n                    song={props.song}\n                    displaySettings={displaySettings}\n                />\n            </ThemeProvider>\n            {trackPlayer}\n        </>\n    );\n};\n\nexport default Play;\n","import React from \"react\";\nimport { Redirect, Route, useHistory } from \"react-router-dom\";\nimport { ChordSong } from \"../common/ChordModel/ChordSong\";\nimport { MultiFC, transformToFC } from \"../common/FunctionalComponent\";\nimport { SongIDPath } from \"../common/paths\";\nimport ChordPaper from \"./edit/ChordPaper\";\nimport Play from \"./play/Play\";\nimport { ChordSongAction } from \"./reducer/reducer\";\n\ninterface SongRouterProps {\n    path: SongIDPath;\n    song: ChordSong;\n    songDispatch: React.Dispatch<ChordSongAction>;\n}\n\nconst SongRouter: MultiFC<SongRouterProps> = (\n    props: SongRouterProps\n): JSX.Element[] => {\n    const history = useHistory();\n\n    const editPath = props.path.withMode(\"edit\");\n    const playPath = props.path.withMode(\"play\");\n\n    const switchToEdit = () => {\n        history.push(editPath.URL());\n    };\n\n    const switchToPlay = () => {\n        history.push(playPath.URL());\n    };\n\n    return [\n        <Route key={props.path.URL()} path={props.path.URL()} exact>\n            <Redirect to={editPath.URL()} />,\n        </Route>,\n        <Route key={editPath.URL()} path={editPath.URL()}>\n            <ChordPaper\n                song={props.song}\n                songDispatch={props.songDispatch}\n                onPlay={switchToPlay}\n            />\n        </Route>,\n        <Route key={playPath.URL()} path={playPath.URL()}>\n            <Play song={props.song} onEdit={switchToEdit} />\n        </Route>,\n    ];\n};\n\nexport default transformToFC(SongRouter);\n","import React from \"react\";\nimport { Typography, Theme } from \"@material-ui/core\";\nimport { withStyles } from \"@material-ui/styles\";\nimport grey from \"@material-ui/core/colors/grey\";\n\nconst PaddedTypography = withStyles((theme: Theme) => ({\n    root: {\n        position: \"absolute\",\n        top: 0,\n        right: 0,\n        padding: theme.spacing(1),\n        color: grey[600],\n    },\n}))(Typography);\n\nconst Version: React.FC<{}> = (): JSX.Element => {\n    const version: string = process.env.REACT_APP_VERSION ?? \"dev-build\";\n\n    return <PaddedTypography variant=\"subtitle2\">{version}</PaddedTypography>;\n};\n\nexport default Version;\n","import {\n    createMuiTheme,\n    Grid,\n    PaletteColorOptions,\n    Theme,\n    ThemeProvider,\n} from \"@material-ui/core\";\nimport { withStyles } from \"@material-ui/styles\";\nimport { SnackbarProvider as UnstyledSnackbarProvider } from \"notistack\";\nimport React, { useState } from \"react\";\nimport { Helmet, HelmetProvider } from \"react-helmet-async\";\nimport {\n    HashRouter,\n    Redirect,\n    Route,\n    Switch,\n    useLocation,\n} from \"react-router-dom\";\nimport Background from \"./assets/img/symphony.png\";\nimport { ChordSong } from \"./common/ChordModel/ChordSong\";\nimport {\n    aboutPath,\n    guitarDemoPath,\n    newSongPath,\n    rootPath,\n    SongIDModePath,\n    songPath,\n} from \"./common/paths\";\nimport About from \"./components/about/About\";\nimport DragAndDrop from \"./components/edit/DragAndDrop\";\nimport GlobalKeyListenerProvider from \"./components/GlobalKeyListener\";\nimport GuitarDemo from \"./components/guitar/GuitarDemo\";\nimport SideMenu from \"./components/SideMenu\";\nimport SongFetcher from \"./components/SongFetcher\";\nimport SongRouter from \"./components/SongRouter\";\nimport { TutorialSwitches } from \"./components/Tutorial\";\nimport { User, UserContext } from \"./components/user/userContext\";\nimport Version from \"./components/Version\";\nimport { withCloudSaveSongContext } from \"./components/WithSongContext\";\n\nconst createTheme = (): Theme => {\n    const lightBlue: PaletteColorOptions = {\n        main: \"#4fc3f7\",\n        light: \"#8bf6ff\",\n        dark: \"#0093c4\",\n        contrastText: \"#000000\",\n    };\n\n    const purple: PaletteColorOptions = {\n        main: \"#844ffc\",\n        light: \"#bb7eff\",\n        dark: \"#4a1fc8\",\n        contrastText: \"#ffffff\",\n    };\n\n    const green: PaletteColorOptions = {\n        main: \"#00c853\",\n        light: \"#5efc82\",\n        dark: \"#009624\",\n        contrastText: \"#000000\",\n    };\n\n    return createMuiTheme({\n        palette: {\n            primary: lightBlue,\n            secondary: purple,\n            success: green,\n        },\n        typography: {\n            fontFamily: \"Merriweather\",\n            fontWeightRegular: 300,\n        },\n    });\n};\n\nconst theme: Theme = createTheme();\n\nconst SnackbarProvider = withStyles((theme: Theme) => ({\n    variantSuccess: {\n        backgroundColor: theme.palette.success.main,\n    },\n}))(UnstyledSnackbarProvider);\n\nconst AppLayout = withStyles({\n    root: {\n        backgroundImage: `url(${Background})`,\n        minHeight: \"100vh\",\n    },\n})(Grid);\n\nconst MainSong = withCloudSaveSongContext(SongRouter);\n\nconst AppContent: React.FC<{}> = (): JSX.Element => {\n    const [user, setUser] = useState<User | null>(null);\n\n    const handleUserChanged = (newUser: User) => setUser(newUser);\n\n    const location = useLocation();\n    const loadSongPath = songPath.withID(\":id\");\n\n    const isFullScreen =\n        SongIDModePath.isPlayMode(location.pathname) ||\n        location.pathname === guitarDemoPath.URL();\n\n    const withRegularAppLayout = (\n        child: React.ReactElement | React.ReactElement[]\n    ) => {\n        return (\n            <>\n                {!isFullScreen && (\n                    <SideMenu onUserChanged={handleUserChanged} />\n                )}\n                <AppLayout container>\n                    <Grid item container justify=\"center\">\n                        {child}\n                    </Grid>\n                </AppLayout>\n                <Version />\n            </>\n        );\n    };\n\n    const routes = (\n        <Switch>\n            <Redirect from={rootPath.URL()} to={newSongPath.URL()} exact />\n\n            <Route key={newSongPath.URL()} path={newSongPath.URL()}>\n                {withRegularAppLayout(\n                    <MainSong song={new ChordSong({})} path={newSongPath} />\n                )}\n            </Route>\n\n            <Route key={loadSongPath.URL()} path={loadSongPath.URL()}>\n                {withRegularAppLayout(\n                    <SongFetcher>\n                        {(song: ChordSong) => (\n                            <MainSong\n                                song={song}\n                                path={loadSongPath.parent().withID(song.id)}\n                            />\n                        )}\n                    </SongFetcher>\n                )}\n            </Route>\n\n            {TutorialSwitches(withRegularAppLayout)}\n            <Route key={aboutPath.URL()} path={aboutPath.URL()} exact>\n                {withRegularAppLayout(<About />)}\n            </Route>\n            <Route key={guitarDemoPath.URL()} path={guitarDemoPath.URL()} exact>\n                <GuitarDemo />\n            </Route>\n            <Redirect to={rootPath.URL()} />\n        </Switch>\n    );\n\n    return <UserContext.Provider value={user}>{routes}</UserContext.Provider>;\n};\n\nfunction App() {\n    return (\n        <HelmetProvider>\n            <ThemeProvider theme={theme}>\n                <Helmet\n                    titleTemplate=\"%s - Chord Paper\"\n                    defaultTitle=\"Chord Paper\"\n                />\n                <SnackbarProvider>\n                    <HashRouter>\n                        <DragAndDrop>\n                            <GlobalKeyListenerProvider>\n                                <AppContent />\n                            </GlobalKeyListenerProvider>\n                        </DragAndDrop>\n                    </HashRouter>\n                </SnackbarProvider>\n            </ThemeProvider>\n        </HelmetProvider>\n    );\n}\n\nexport default App;\n","import { isLeft } from \"fp-ts/lib/Either\";\nimport isOnline from \"is-online\";\nimport { useSnackbar } from \"notistack\";\nimport React, { useCallback, useEffect, useRef } from \"react\";\nimport { Prompt, useHistory } from \"react-router\";\nimport { useErrorMessage } from \"../common/backend/errors\";\nimport { updateSong } from \"../common/backend/requests\";\nimport { ChordSong } from \"../common/ChordModel/ChordSong\";\nimport { SongIDModePath } from \"../common/paths\";\nimport { ChordSongAction } from \"./reducer/reducer\";\nimport { User, UserContext } from \"./user/userContext\";\n\nconst saveInterval = 10000;\n\nexport const useCloud = (): [\n    (song: ChordSong, action: ChordSongAction) => void,\n    (\n        song: ChordSong,\n        songDispatch: React.Dispatch<ChordSongAction>\n    ) => JSX.Element\n] => {\n    const dirtyRef = useRef(false);\n\n    const handleSongChanged = useCallback(\n        (_song: ChordSong, action: ChordSongAction) => {\n            if (action.type === \"set-last-saved-at\") {\n                return;\n            }\n\n            dirtyRef.current = true;\n        },\n        []\n    );\n\n    const useSave = (\n        song: ChordSong,\n        songDispatch: React.Dispatch<ChordSongAction>\n    ): JSX.Element => {\n        const user: User | null = React.useContext(UserContext);\n        const showError = useErrorMessage();\n        const { enqueueSnackbar } = useSnackbar();\n        const history = useHistory();\n\n        const shouldSave = useCallback(\n            (newSong: ChordSong): boolean => {\n                return (\n                    dirtyRef.current &&\n                    !newSong.isUnsaved() &&\n                    newSong.isOwner(user)\n                );\n            },\n            [user]\n        );\n\n        useEffect(() => {\n            const handleError = async (error: Error | string) => {\n                if (typeof error === \"string\") {\n                    enqueueSnackbar(error, { variant: \"error\" });\n                } else {\n                    await showError(error);\n                }\n                // set dirty back to true to try again later\n                dirtyRef.current = true;\n            };\n\n            const save = async (user: User, newSong: ChordSong) => {\n                const result = await updateSong(newSong, user.authToken);\n                if (isLeft(result)) {\n                    await handleError(result.left);\n                    return;\n                }\n\n                dirtyRef.current = false;\n\n                const deserializeResult = ChordSong.fromJSONObject(\n                    result.right\n                );\n                if (isLeft(deserializeResult)) {\n                    await handleError(\n                        \"Song results from backend can't be deserialized\"\n                    );\n                    return;\n                }\n\n                songDispatch({\n                    type: \"set-last-saved-at\",\n                    lastSavedAt: deserializeResult.right.lastSavedAt,\n                });\n            };\n\n            const saveIfChanged = async (newSong: ChordSong) => {\n                if (user === null) {\n                    return;\n                }\n\n                if (!shouldSave(newSong)) {\n                    return;\n                }\n\n                if (!(await isOnline())) {\n                    return;\n                }\n\n                await save(user, newSong);\n            };\n\n            const interval = setInterval(\n                () => saveIfChanged(song),\n                saveInterval\n            );\n            return () => clearInterval(interval);\n        }, [song, songDispatch, user, enqueueSnackbar, showError, shouldSave]);\n\n        useEffect(() => {\n            const unloadMessageFn = (event: Event) => {\n                if (shouldSave(song)) {\n                    event.preventDefault();\n                    event.returnValue = true;\n                }\n            };\n\n            window.addEventListener(\"beforeunload\", unloadMessageFn);\n\n            return () =>\n                window.removeEventListener(\"beforeunload\", unloadMessageFn);\n        }, [song, shouldSave]);\n\n        const showLeavingPrompt = () => {\n            if (\n                shouldSave(song) &&\n                SongIDModePath.isEditMode(history.location.pathname)\n            ) {\n                return \"This page is asking you to confirm that you want to leave - data you have entered may not be saved.\";\n            }\n\n            return true;\n        };\n\n        return <Prompt message={showLeavingPrompt} />;\n    };\n\n    return [handleSongChanged, useSave];\n};\n","// This optional code is used to register a service worker.\n// register() is not called by default.\n\n// This lets the app load faster on subsequent visits in production, and gives\n// it offline capabilities. However, it also means that developers (and users)\n// will only see deployed updates on subsequent visits to a page, after all the\n// existing tabs open on the page have been closed, since previously cached\n// resources are updated in the background.\n\n// To learn more about the benefits of this model and instructions on how to\n// opt-in, read https://bit.ly/CRA-PWA\n\nconst isLocalhost = Boolean(\n  window.location.hostname === 'localhost' ||\n    // [::1] is the IPv6 localhost address.\n    window.location.hostname === '[::1]' ||\n    // 127.0.0.0/8 are considered localhost for IPv4.\n    window.location.hostname.match(\n      /^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/\n    )\n);\n\ntype Config = {\n  onSuccess?: (registration: ServiceWorkerRegistration) => void;\n  onUpdate?: (registration: ServiceWorkerRegistration) => void;\n};\n\nexport function register(config?: Config) {\n  if (process.env.NODE_ENV === 'production' && 'serviceWorker' in navigator) {\n    // The URL constructor is available in all browsers that support SW.\n    const publicUrl = new URL(\n      process.env.PUBLIC_URL,\n      window.location.href\n    );\n    if (publicUrl.origin !== window.location.origin) {\n      // Our service worker won't work if PUBLIC_URL is on a different origin\n      // from what our page is served on. This might happen if a CDN is used to\n      // serve assets; see https://github.com/facebook/create-react-app/issues/2374\n      return;\n    }\n\n    window.addEventListener('load', () => {\n      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`;\n\n      if (isLocalhost) {\n        // This is running on localhost. Let's check if a service worker still exists or not.\n        checkValidServiceWorker(swUrl, config);\n\n        // Add some additional logging to localhost, pointing developers to the\n        // service worker/PWA documentation.\n        navigator.serviceWorker.ready.then(() => {\n          console.log(\n            'This web app is being served cache-first by a service ' +\n              'worker. To learn more, visit https://bit.ly/CRA-PWA'\n          );\n        });\n      } else {\n        // Is not localhost. Just register service worker\n        registerValidSW(swUrl, config);\n      }\n    });\n  }\n}\n\nfunction registerValidSW(swUrl: string, config?: Config) {\n  navigator.serviceWorker\n    .register(swUrl)\n    .then(registration => {\n      registration.onupdatefound = () => {\n        const installingWorker = registration.installing;\n        if (installingWorker == null) {\n          return;\n        }\n        installingWorker.onstatechange = () => {\n          if (installingWorker.state === 'installed') {\n            if (navigator.serviceWorker.controller) {\n              // At this point, the updated precached content has been fetched,\n              // but the previous service worker will still serve the older\n              // content until all client tabs are closed.\n              console.log(\n                'New content is available and will be used when all ' +\n                  'tabs for this page are closed. See https://bit.ly/CRA-PWA.'\n              );\n\n              // Execute callback\n              if (config && config.onUpdate) {\n                config.onUpdate(registration);\n              }\n            } else {\n              // At this point, everything has been precached.\n              // It's the perfect time to display a\n              // \"Content is cached for offline use.\" message.\n              console.log('Content is cached for offline use.');\n\n              // Execute callback\n              if (config && config.onSuccess) {\n                config.onSuccess(registration);\n              }\n            }\n          }\n        };\n      };\n    })\n    .catch(error => {\n      console.error('Error during service worker registration:', error);\n    });\n}\n\nfunction checkValidServiceWorker(swUrl: string, config?: Config) {\n  // Check if the service worker can be found. If it can't reload the page.\n  fetch(swUrl, {\n    headers: { 'Service-Worker': 'script' }\n  })\n    .then(response => {\n      // Ensure service worker exists, and that we really are getting a JS file.\n      const contentType = response.headers.get('content-type');\n      if (\n        response.status === 404 ||\n        (contentType != null && contentType.indexOf('javascript') === -1)\n      ) {\n        // No service worker found. Probably a different app. Reload the page.\n        navigator.serviceWorker.ready.then(registration => {\n          registration.unregister().then(() => {\n            window.location.reload();\n          });\n        });\n      } else {\n        // Service worker found. Proceed as normal.\n        registerValidSW(swUrl, config);\n      }\n    })\n    .catch(() => {\n      console.log(\n        'No internet connection found. App is running in offline mode.'\n      );\n    });\n}\n\nexport function unregister() {\n  if ('serviceWorker' in navigator) {\n    navigator.serviceWorker.ready\n      .then(registration => {\n        registration.unregister();\n      })\n      .catch(error => {\n        console.error(error.message);\n      });\n  }\n}\n","import React from \"react\";\nimport ReactDOM from \"react-dom\";\nimport \"./index.css\";\nimport App from \"./App\";\nimport * as serviceWorker from \"./serviceWorker\";\n\nReactDOM.render(\n    <React.StrictMode>\n        <App />\n    </React.StrictMode>,\n    document.getElementById(\"root\")\n);\n\n// If you want your app to work offline and load faster, you can change\n// unregister() to register() below. Note this comes with some pitfalls.\n// Learn more about service workers: https://bit.ly/CRA-PWA\nserviceWorker.unregister();\n"],"sourceRoot":""}